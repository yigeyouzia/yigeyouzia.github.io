<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>JVM-内存结构 | cyt的笔记屋</title><meta name="author" content="cyt"><meta name="copyright" content="cyt"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="JVM内存结构">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM-内存结构">
<meta property="og:url" content="https://youcyt.ltd/post/java%E5%AD%A6%E4%B9%A0/jvm/1JVM-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html">
<meta property="og:site_name" content="cyt的笔记屋">
<meta property="og:description" content="JVM内存结构">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175134533.png">
<meta property="article:published_time" content="2025-10-24T12:30:12.000Z">
<meta property="article:modified_time" content="2025-10-30T05:10:12.286Z">
<meta property="article:author" content="cyt">
<meta property="article:tag" content="java">
<meta property="article:tag" content="JVM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175134533.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "JVM-内存结构",
  "url": "https://youcyt.ltd/post/java%E5%AD%A6%E4%B9%A0/jvm/1JVM-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html",
  "image": "https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175134533.png",
  "datePublished": "2025-10-24T12:30:12.000Z",
  "dateModified": "2025-10-30T05:10:12.286Z",
  "author": [
    {
      "@type": "Person",
      "name": "cyt",
      "url": "https://youcyt.ltd"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://youcyt.ltd/post/java%E5%AD%A6%E4%B9%A0/jvm/1JVM-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 18
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JVM-内存结构',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg" style="background-image: url(/img/bg/gongga.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/other/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/bg/gongga.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">cyt的笔记屋</span></a><a class="nav-page-title" href="/"><span class="site-name">JVM-内存结构</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">JVM-内存结构</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-24T12:30:12.000Z" title="发表于 2025-10-24 20:30:12">2025-10-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-30T05:10:12.286Z" title="更新于 2025-10-30 13:10:12">2025-10-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">6.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>31分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><h2 id="什么是JVM"><a href="#什么是JVM" class="headerlink" title="什么是JVM"></a>什么是JVM</h2><ul>
<li>定义： <ul>
<li>Java Virtual Machine - java 程序的运行环境（java 二进制字节码的运行环境）</li>
</ul>
</li>
<li>好处： <ul>
<li>一次编写，到处运行 </li>
<li>自动内存管理，垃圾回收功能 </li>
<li>数组下标越界检查 多态 比较： jvm jre jdk</li>
<li>多态</li>
</ul>
</li>
<li>比较： <code>jvm jre jdk</code><ul>
<li>基础类库： <code>IO List等</code></li>
<li>编译工具：<code>javac 内存监测工具</code></li>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021173908743.png"></li>
</ul>
</li>
</ul>
<h2 id="学jvm有什么用"><a href="#学jvm有什么用" class="headerlink" title="学jvm有什么用"></a>学jvm有什么用</h2><ul>
<li>面试 </li>
<li>理解底层的实现原理 </li>
<li>中高级程序员的必备技能</li>
</ul>
<h2 id="常见的JVM"><a href="#常见的JVM" class="headerlink" title="常见的JVM"></a>常见的JVM</h2><ul>
<li>jVM是一种规范</li>
<li>实现很多</li>
<li><strong>本课程讲hotspot</strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021174226097.png"></li>
</ul>
<h2 id="学习路线"><a href="#学习路线" class="headerlink" title="学习路线"></a>学习路线</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175134533.png"></p>
<h1 id="一、内存结构"><a href="#一、内存结构" class="headerlink" title="一、内存结构"></a>一、内存结构</h1><h2 id="1-程序计数器"><a href="#1-程序计数器" class="headerlink" title="1. 程序计数器"></a>1. 程序计数器</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175539978.png" alt="|600"></p>
<h3 id="1-1-定义"><a href="#1-1-定义" class="headerlink" title="1.1 定义"></a>1.1 定义</h3><p><strong>Program Counter Register 程序计数器（寄存器）</strong></p>
<ul>
<li>作用<ul>
<li>是记住<code>下一条jvm指令的执行地址</code></li>
</ul>
</li>
<li>特点 <ul>
<li>是线程私有的 （每个线程有属于自己的程序计数器）</li>
<li>不会存在内存溢出 <code>唯一一个不会内存溢出的地方</code></li>
</ul>
</li>
</ul>
<h3 id="1-2-作用"><a href="#1-2-作用" class="headerlink" title="1.2 作用"></a>1.2 作用</h3><ul>
<li>通过寄存器（CPU组件）实现java程序计数器<ul>
<li>屏蔽物理硬件<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021180457610.png"></li>
</ul>
</li>
</ul>
<h2 id="2-虚拟机栈"><a href="#2-虚拟机栈" class="headerlink" title="2.虚拟机栈"></a>2.虚拟机栈</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022115520708.png"></p>
<h3 id="2-1-定义"><a href="#2-1-定义" class="headerlink" title="2.1 定义"></a>2.1 定义</h3><ul>
<li><code>Java Virtual Machine Stacks （Java 虚拟机栈）</code></li>
<li>每个线程运行时所需要的内存，称为虚拟机栈 </li>
<li>每个栈由多个栈帧（Frame）组成，对应着每次方法调用时所占用的内存 </li>
<li>每个线程只能有一个活动栈帧，对应着当前正在执行的那个方法</li>
<li>问题辨析：<ol>
<li>垃圾回收是否涉及栈内存？ <code>不涉及，栈内存自动释放</code></li>
<li>栈内存分配越大越好吗？ <code>-Xss指定大小 默认1024kb 越大线程越少</code></li>
<li>方法内的局部变量是否线程安全？<ol>
<li>如果方法内局部变量没有逃离方法的作用访问，它是线程安全的 </li>
<li>如果是局部变量引用了对象，并逃离方法的作用范围，需要考虑线程安全 <code>如static全局变量</code></li>
</ol>
</li>
</ol>
</li>
</ul>
<p>demo：<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022122224752.png"></p>
<h3 id="2-2-栈内存溢出"><a href="#2-2-栈内存溢出" class="headerlink" title="2.2 栈内存溢出"></a>2.2 栈内存溢出</h3><ul>
<li>栈帧过多导致栈内存溢出 </li>
<li>栈帧过大导致栈内存溢出</li>
<li>演示<ul>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022124501500.png"></li>
<li>执行了 <code>42171</code>次</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示栈内存溢出 java.lang.StackOverflowError  </span></span><br><span class="line"><span class="comment"> * -Xss256k </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_2</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> count;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            method1();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            System.out.println(count);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;  </span><br><span class="line">        count++;  </span><br><span class="line">        method1();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>循环依赖问题</strong>：</p>
<ul>
<li>原因：<ul>
<li>部门下有员工，<code>员工属性有部门</code>，部门下有员工</li>
<li>无限套娃</li>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022125546440.png"></li>
</ul>
</li>
<li>如何正确使用：<ul>
<li>在员工下的部门加上 <code>@JsonIgnore </code></li>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022125726658.png" alt="|450"></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * json 数据转换  </span></span><br><span class="line"><span class="comment"> * 循环依赖问题  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_19</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException &#123;  </span><br><span class="line">        <span class="type">Dept</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dept</span>();  </span><br><span class="line">        d.setName(<span class="string">&quot;Market&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Emp</span> <span class="variable">e1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();  </span><br><span class="line">        e1.setName(<span class="string">&quot;zhang&quot;</span>);  </span><br><span class="line">        e1.setDept(d);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Emp</span> <span class="variable">e2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();  </span><br><span class="line">        e2.setName(<span class="string">&quot;li&quot;</span>);  </span><br><span class="line">        e2.setDept(d);  </span><br><span class="line">  </span><br><span class="line">        d.setEmps(Arrays.asList(e1, e2));  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// &#123; name: &#x27;Market&#x27;, emps: [&#123; name:&#x27;zhang&#x27;, dept:&#123; name:&#x27;&#x27;, emps: [ &#123;&#125;]&#125; &#125;,] &#125;  </span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();  </span><br><span class="line">        System.out.println(mapper.writeValueAsString(d));  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 员工  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Emp</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="comment">// !!! @JsonIgnore  </span></span><br><span class="line">    <span class="keyword">private</span> Dept dept;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> Dept <span class="title function_">getDept</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> dept;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDept</span><span class="params">(Dept dept)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.dept = dept;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// 部门  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dept</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> List&lt;Emp&gt; emps;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">getEmps</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> emps;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmps</span><span class="params">(List&lt;Emp&gt; emps)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.emps = emps;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-线程运行诊断"><a href="#2-3-线程运行诊断" class="headerlink" title="2.3 线程运行诊断"></a>2.3 线程运行诊断</h3><ul>
<li><p>案例1：cpu 占用过多  <code>nohup java Dem1_16 &amp;</code></p>
</li>
<li><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022131846694.png"></p>
</li>
<li><p>定位 </p>
<ul>
<li>用top定位哪个进程对cpu的占用过高<ul>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022130356898.png"></li>
</ul>
</li>
<li><code>ps H -eo pid,tid,%cpu | grep 进程id</code>（用ps命令进一步定位是哪个线程引起的cpu占用过高）</li>
<li><code>jstack 进程id</code> <ul>
<li>可以根据线程id 找到有问题的线程，进一步定位到问题代码的源码行号</li>
</ul>
</li>
</ul>
</li>
<li><p>案例2：程序运行很长时间没有结果 (死锁)</p>
</li>
</ul>
<h2 id="3-本地方法栈"><a href="#3-本地方法栈" class="headerlink" title="3. 本地方法栈"></a>3. 本地方法栈</h2><ul>
<li>用C语言写的native方法，直接和底层交互</li>
<li>举例 Object类下的方法<ul>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022132909246.png"></li>
<li><code>protected native Object clone() throws CloneNotSupportedException;</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022132724136.png"></li>
</ul>
</li>
</ul>
<h2 id="4-堆"><a href="#4-堆" class="headerlink" title="4. 堆"></a>4. 堆</h2><ul>
<li>上面三个线程私有 <code>堆和方法区线程共享</code></li>
</ul>
<h3 id="4-1-定义"><a href="#4-1-定义" class="headerlink" title="4.1 定义"></a>4.1 定义</h3><ul>
<li>Heap 堆 <ul>
<li>通过 new 关键字，创建对象都会使用堆内存</li>
</ul>
</li>
<li>特点 <ul>
<li>它是线程共享的，</li>
<li>堆中对象都需要考虑线程安全的问题 有垃圾回收机制</li>
</ul>
</li>
</ul>
<h3 id="4-2-堆内存溢出"><a href="#4-2-堆内存溢出" class="headerlink" title="4.2 堆内存溢出"></a>4.2 堆内存溢出</h3><ul>
<li>控制堆空间参数：<code>-Xmx8m</code></li>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022134312820.png" alt="|600"><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022133905746.png"></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示堆内存溢出 java.lang.OutOfMemoryError: Java heap space  </span></span><br><span class="line"><span class="comment"> * -Xmx8m */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_5</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">            <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                list.add(a); <span class="comment">// hello, hellohello, hellohellohellohello ...  </span></span><br><span class="line">                a = a + a;  <span class="comment">// hellohellohellohello  </span></span><br><span class="line">                i++;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-3-堆内存诊断"><a href="#4-3-堆内存诊断" class="headerlink" title="4.3 堆内存诊断"></a>4.3 堆内存诊断</h3><ol>
<li><code>jps</code> 工具 <ul>
<li>查看当前系统中有哪些 java 进程</li>
</ul>
</li>
<li><code>jmap</code> 工具 <ul>
<li>查看堆内存占用情况 jmap - heap 进程id </li>
<li>只能查看某一时刻</li>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022140005220.png" alt="|625"></li>
</ul>
</li>
<li><code>jconsole</code> 工具 <ul>
<li>图形界面的，多功能的监测工具，可以连续监测</li>
<li>功能全  。终端输入 <code>jconsole</code>  弹出选择框选择java类</li>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022140143587.png" alt="|550"></li>
</ul>
</li>
</ol>
<ul>
<li>案例 垃圾回收后，内存占用仍然很高</li>
<li><code>jvisualvm</code> 终端输入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示查看对象个数 堆转储 dump  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_13</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        List&lt;Student&gt; students = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;  </span><br><span class="line">            students.add(<span class="keyword">new</span> <span class="title class_">Student</span>());  </span><br><span class="line"><span class="comment">//            Student student = new Student();  </span></span><br><span class="line">        &#125;  </span><br><span class="line">        Thread.sleep(<span class="number">1000000000L</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] big = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-方法区"><a href="#5-方法区" class="headerlink" title="5. 方法区"></a>5. 方法区</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022150114127.png"></p>
<h3 id="5-1-定义"><a href="#5-1-定义" class="headerlink" title="5.1 定义"></a>5.1 定义</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html</a></p>
</li>
<li><p>The Java Virtual Machine has a <em>method area</em> that is shared among all Java Virtual Machine threads. The method area is analogous to the storage area for compiled code of a conventional language or analogous to the “text” segment in an operating system process. It stores per-class structures such as the run-time constant pool, field and method data, and the code for methods and constructors, including the special methods (<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.9" title="2.9. Special Methods">§2.9</a>) used in class and instance initialization and interface initialization.  </p>
</li>
<li><p>Java 虚拟机具有在所有 Java 虚拟机线程之间共享的方法_区域_ 。方法区域类似于常规语言的编译代码的存储区域，或类似于作系统进程中的“文本”段。它存储每个类的结构，例如运行时常量池、字段和方法数据，以及方法和构造函数的代码，包括类和实例初始化中使用的特殊方法 （<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.9" title="2.9. Special Methods">§2.9</a>） 和接口初始化。</p>
</li>
<li><p>The method area is created on virtual machine start-up. Although the method area is logically part of the heap, simple implementations may choose not to either garbage collect or compact it. This specification does not mandate the location of the method area or the policies used to manage compiled code. The method area may be of a fixed size or may be expanded as required by the computation and may be contracted if a larger method area becomes unnecessary. The memory for the method area does not need to be contiguous.  </p>
</li>
<li><p>方法区域在虚拟机启动时创建。尽管方法区域在逻辑上是堆的一部分，但简单的实现可以选择不进行垃圾回收或压缩。此规范不强制要求方法区域的位置或用于管理编译代码的策略。方法区域可以是固定大小的，也可以根据计算的需要进行扩展，如果不需要更大的方法区域，则可以收缩。方法区域的内存不需要是连续的。</p>
</li>
</ul>
<h3 id="5-2-组成"><a href="#5-2-组成" class="headerlink" title="5.2 组成"></a>5.2 组成</h3><ul>
<li>1.6用 <code>永久代</code></li>
<li>1.8用 <code>元空间</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022150211748.png"></li>
</ul>
<h3 id="5-3-方法区内存溢出"><a href="#5-3-方法区内存溢出" class="headerlink" title="5.3 方法区内存溢出"></a>5.3 方法区内存溢出</h3><ul>
<li>1.8 以前会导致永久代内存溢出<ul>
<li>&#96;* 演示永久代内存溢出 java.lang.OutOfMemoryError: PermGen space * </li>
<li><code>-XX:MaxPermSize=8m</code></li>
</ul>
</li>
<li>1.8 之后会导致元空间内存溢出<ul>
<li><code>* 演示元空间内存溢出 java.lang.OutOfMemoryError: Metaspace</code></li>
<li><code>* -XX:MaxMetaspaceSize=8m</code><br><strong>案例</strong>：</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示元空间内存溢出 java.lang.OutOfMemoryError: Metaspace  </span></span><br><span class="line"><span class="comment"> * -XX:MaxMetaspaceSize=8m */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_8</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123; <span class="comment">// 可以用来加载类的二进制字节码  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">Demo1_8</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo1_8</span>();  </span><br><span class="line">            <span class="comment">// 加载一万个类  </span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++, j++) &#123;  </span><br><span class="line">                <span class="comment">// ClassWriter 作用是生成类的二进制字节码  </span></span><br><span class="line">                <span class="type">ClassWriter</span> <span class="variable">cw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassWriter</span>(<span class="number">0</span>);  </span><br><span class="line">                <span class="comment">// 版本号， public， 类名, 包名, 父类， 接口  </span></span><br><span class="line">                cw.visit(Opcodes.V1_8, Opcodes.ACC_PUBLIC, <span class="string">&quot;Class&quot;</span> + i, <span class="literal">null</span>, <span class="string">&quot;java/lang/Object&quot;</span>, <span class="literal">null</span>);  </span><br><span class="line">                <span class="comment">// 返回 byte[]                byte[] code = cw.toByteArray();  </span></span><br><span class="line">                <span class="comment">// 执行了类的加载  </span></span><br><span class="line">                test.defineClass(<span class="string">&quot;Class&quot;</span> + i, code, <span class="number">0</span>, code.length); <span class="comment">// Class 对象  </span></span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(j);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>场景</strong>：</p>
<ul>
<li>使用<code>cglib</code><ul>
<li><code>spring</code></li>
<li><code>mybatis</code></li>
</ul>
</li>
</ul>
<h3 id="5-4-运行时常量池"><a href="#5-4-运行时常量池" class="headerlink" title="5.4 运行时常量池"></a>5.4 运行时常量池</h3><ul>
<li>常量池，就是一张表，虚拟机指令根据这张常量表找到要执行的类名、方法名、参数类型、字面量 等信息 </li>
<li>运行时常量池，常量池是 *.class 文件中的，当该类被加载，它的常量池信息就会放入运行时常量 池，并把里面的符号地址变为真实地址</li>
<li>执行 <code>javap -v</code> 如下</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">❯ javap -v out.production.jvm.cn.itcast.jvm.t5.HelloWorld</span><br><span class="line">警告: 文件 ./out/production/jvm/cn/itcast/jvm/t5/HelloWorld.class 不包含类 out.production.jvm.cn.itcast.jvm.t5.HelloWorld</span><br><span class="line">Classfile /Users/cyt/workspace/java/jvm-std/jvm/out/production/jvm/cn/itcast/jvm/t5/HelloWorld.class</span><br><span class="line">  Last modified 2025年10月22日; size 567 bytes</span><br><span class="line">  SHA-256 checksum 37204bf6e654f64ae56660a1e8becfaa98b3ae7592b81b4b6e331de92a460b96</span><br><span class="line">  Compiled from <span class="string">&quot;HelloWorld.java&quot;</span></span><br><span class="line">public class cn.itcast.jvm.t5.HelloWorld</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: (0x0021) ACC_PUBLIC, ACC_SUPER</span><br><span class="line">  this_class: <span class="comment">#5                          // cn/itcast/jvm/t5/HelloWorld</span></span><br><span class="line">  super_class: <span class="comment">#6                         // java/lang/Object</span></span><br><span class="line">  interfaces: 0, fields: 0, methods: 2, attributes: 1</span><br><span class="line">Constant pool: <span class="comment"># 常量池</span></span><br><span class="line">   <span class="comment">#1 = Methodref          #6.#20         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   <span class="comment">#2 = Fieldref           #21.#22        // java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   <span class="comment">#3 = String             #23            // hello world</span></span><br><span class="line">   <span class="comment">#4 = Methodref          #24.#25        // java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">   <span class="comment">#5 = Class              #26            // cn/itcast/jvm/t5/HelloWorld</span></span><br><span class="line">   <span class="comment">#6 = Class              #27            // java/lang/Object</span></span><br><span class="line">   <span class="comment">#7 = Utf8               &lt;init&gt;</span></span><br><span class="line">   <span class="comment">#8 = Utf8               ()V</span></span><br><span class="line">   <span class="comment">#9 = Utf8               Code</span></span><br><span class="line">  <span class="comment">#10 = Utf8               LineNumberTable</span></span><br><span class="line">  <span class="comment">#11 = Utf8               LocalVariableTable</span></span><br><span class="line">  <span class="comment">#12 = Utf8               this</span></span><br><span class="line">  <span class="comment">#13 = Utf8               Lcn/itcast/jvm/t5/HelloWorld;</span></span><br><span class="line">  <span class="comment">#14 = Utf8               main</span></span><br><span class="line">  <span class="comment">#15 = Utf8               ([Ljava/lang/String;)V</span></span><br><span class="line">  <span class="comment">#16 = Utf8               args</span></span><br><span class="line">  <span class="comment">#17 = Utf8               [Ljava/lang/String;</span></span><br><span class="line">  <span class="comment">#18 = Utf8               SourceFile</span></span><br><span class="line">  <span class="comment">#19 = Utf8               HelloWorld.java</span></span><br><span class="line">  <span class="comment">#20 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  <span class="comment">#21 = Class              #28            // java/lang/System</span></span><br><span class="line">  <span class="comment">#22 = NameAndType        #29:#30        // out:Ljava/io/PrintStream;</span></span><br><span class="line">  <span class="comment">#23 = Utf8               hello world</span></span><br><span class="line">  <span class="comment">#24 = Class              #31            // java/io/PrintStream</span></span><br><span class="line">  <span class="comment">#25 = NameAndType        #32:#33        // println:(Ljava/lang/String;)V</span></span><br><span class="line">  <span class="comment">#26 = Utf8               cn/itcast/jvm/t5/HelloWorld</span></span><br><span class="line">  <span class="comment">#27 = Utf8               java/lang/Object</span></span><br><span class="line">  <span class="comment">#28 = Utf8               java/lang/System</span></span><br><span class="line">  <span class="comment">#29 = Utf8               out</span></span><br><span class="line">  <span class="comment">#30 = Utf8               Ljava/io/PrintStream;</span></span><br><span class="line">  <span class="comment">#31 = Utf8               java/io/PrintStream</span></span><br><span class="line">  <span class="comment">#32 = Utf8               println</span></span><br><span class="line">  <span class="comment">#33 = Utf8               (Ljava/lang/String;)V</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment"># 无参构造方法</span></span><br><span class="line">  public cn.itcast.jvm.t5.HelloWorld();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: (0x0001) ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial <span class="comment">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         4: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 4: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       5     0  this   Lcn/itcast/jvm/t5/HelloWorld;</span><br><span class="line"></span><br><span class="line"><span class="comment"># mian 方法</span></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: (0x0009) ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">    <span class="comment"># 虚拟机指令</span></span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         <span class="comment"># #2上面常量池地址</span></span><br><span class="line">         0: getstatic     <span class="comment">#2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         3: ldc           <span class="comment">#3                  // String hello world</span></span><br><span class="line">         <span class="comment"># 执行方法调用</span></span><br><span class="line">         5: invokevirtual <span class="comment">#4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">         8: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 6: 0</span><br><span class="line">        line 7: 8</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       9     0  args   [Ljava/lang/String;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;HelloWorld.java&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="5-5-StringTable"><a href="#5-5-StringTable" class="headerlink" title="5.5 StringTable"></a>5.5 StringTable</h3><p>先看几道面试题：<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023165134535.png" alt="|725"></p>
<h3 id="案例解析"><a href="#案例解析" class="headerlink" title="案例解析"></a>案例解析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 串池（类似哈希表） StringTable [ &quot;a&quot;, &quot;b&quot; ,&quot;ab&quot; ]  hashtable 结构，不能扩容  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_22</span> &#123;  </span><br><span class="line">    <span class="comment">// 常量池中的信息，都会被加载到运行时常量池中， 这时 a b ab 都是常量池中的符号，还没有变为 java 字符串对象  </span></span><br><span class="line">    <span class="comment">// ldc #2 会把 a 符号变为 &quot;a&quot; 字符串对象  </span></span><br><span class="line">    <span class="comment">// ldc #3 会把 b 符号变为 &quot;b&quot; 字符串对象  </span></span><br><span class="line">    <span class="comment">// ldc #4 会把 ab 符号变为 &quot;ab&quot; 字符串对象  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>; <span class="comment">// 懒惰的  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2; <span class="comment">// new StringBuilder().append(&quot;a&quot;).append(&quot;b&quot;).toString()  new String(&quot;ab&quot;) 创建一个新对象  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span>;  <span class="comment">// javac 在编译期间的优化，结果已经在编译期确定为ab  </span></span><br><span class="line">        System.out.println(s3 == s4); <span class="comment">// false s3在串池中 s4在堆中  </span></span><br><span class="line">        System.out.println(s3 == s5); <span class="comment">// true  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>javac -g  Demo1_22.java  </code><ul>
<li>编译期优化</li>
<li>可以发现s5在javac编译时已经赋值“ab”</li>
<li>此时“ab”已在串池中</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  </span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA  </span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)  </span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">package</span> cn.itcast.jvm.t1.stringtable;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_22</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo1_22</span><span class="params">()</span> &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;  </span><br><span class="line">        (<span class="keyword">new</span> <span class="title class_">StringBuilder</span>()).append(s1).append(s2).toString();  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>javap -v Demo1_22.class &gt; output.txt</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">❯ javap -v my1</span><br><span class="line">Classfile /Users/cyt/workspace/java/jvm-std/jvm/src/cn/itcast/jvm/t1/stringtable/Demo1_22.class  </span><br><span class="line">  Last modified 2025-10-23; size 741 bytes  </span><br><span class="line">  MD5 checksum d4b9eed9cffe233ec5fa007c264eb2d2  </span><br><span class="line">  Compiled from <span class="string">&quot;Demo1_22.java&quot;</span>  </span><br><span class="line">public class cn.itcast.jvm.t1.stringtable.Demo1_22  </span><br><span class="line">  minor version: 0  </span><br><span class="line">  major version: 52  </span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER  </span><br><span class="line">Constant pool:  </span><br><span class="line">   <span class="comment">#1 = Methodref          #10.#30        // java/lang/Object.&quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">   <span class="comment">#2 = String             #31            // a  </span></span><br><span class="line">   <span class="comment">#3 = String             #32            // b  </span></span><br><span class="line">   <span class="comment">#4 = String             #33            // ab  </span></span><br><span class="line">   <span class="comment">#5 = Class              #34            // java/lang/StringBuilder  </span></span><br><span class="line">   <span class="comment">#6 = Methodref          #5.#30         // java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">   <span class="comment">#7 = Methodref          #5.#35         // java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">   <span class="comment">#8 = Methodref          #5.#36         // java/lang/StringBuilder.toString:()Ljava/lang/String;  </span></span><br><span class="line">   <span class="comment">#9 = Class              #37            // cn/itcast/jvm/t1/stringtable/Demo1_22  </span></span><br><span class="line">  <span class="comment">#10 = Class              #38            // java/lang/Object  </span></span><br><span class="line">  <span class="comment">#11 = Utf8               &lt;init&gt;  </span></span><br><span class="line">  <span class="comment">#12 = Utf8               ()V  </span></span><br><span class="line">  <span class="comment">#13 = Utf8               Code  </span></span><br><span class="line">  <span class="comment">#14 = Utf8               LineNumberTable  </span></span><br><span class="line">  <span class="comment">#15 = Utf8               LocalVariableTable  </span></span><br><span class="line">  <span class="comment">#16 = Utf8               this  </span></span><br><span class="line">  <span class="comment">#17 = Utf8               Lcn/itcast/jvm/t1/stringtable/Demo1_22;  </span></span><br><span class="line">  <span class="comment">#18 = Utf8               main  </span></span><br><span class="line">  <span class="comment">#19 = Utf8               ([Ljava/lang/String;)V  </span></span><br><span class="line">  <span class="comment">#20 = Utf8               args  </span></span><br><span class="line">  <span class="comment">#21 = Utf8               [Ljava/lang/String;  </span></span><br><span class="line">  <span class="comment">#22 = Utf8               s1  </span></span><br><span class="line">  <span class="comment">#23 = Utf8               Ljava/lang/String;  </span></span><br><span class="line">  <span class="comment">#24 = Utf8               s2  </span></span><br><span class="line">  <span class="comment">#25 = Utf8               s3  </span></span><br><span class="line">  <span class="comment">#26 = Utf8               s4  </span></span><br><span class="line">  <span class="comment">#27 = Utf8               s5  </span></span><br><span class="line">  <span class="comment">#28 = Utf8               SourceFile  </span></span><br><span class="line">  <span class="comment">#29 = Utf8               Demo1_22.java  </span></span><br><span class="line">  <span class="comment">#30 = NameAndType        #11:#12        // &quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">  <span class="comment">#31 = Utf8               a  </span></span><br><span class="line">  <span class="comment">#32 = Utf8               b  </span></span><br><span class="line">  <span class="comment">#33 = Utf8               ab  </span></span><br><span class="line">  <span class="comment">#34 = Utf8               java/lang/StringBuilder  </span></span><br><span class="line">  <span class="comment">#35 = NameAndType        #39:#40        // append:(Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">  <span class="comment">#36 = NameAndType        #41:#42        // toString:()Ljava/lang/String;  </span></span><br><span class="line">  <span class="comment">#37 = Utf8               cn/itcast/jvm/t1/stringtable/Demo1_22  </span></span><br><span class="line">  <span class="comment">#38 = Utf8               java/lang/Object  </span></span><br><span class="line">  <span class="comment">#39 = Utf8               append  </span></span><br><span class="line">  <span class="comment">#40 = Utf8               (Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">  <span class="comment">#41 = Utf8               toString  </span></span><br><span class="line">  <span class="comment">#42 = Utf8               ()Ljava/lang/String;  </span></span><br><span class="line">&#123;  </span><br><span class="line">  public cn.itcast.jvm.t1.stringtable.Demo1_22();  </span><br><span class="line">    descriptor: ()V  </span><br><span class="line">    flags: ACC_PUBLIC  </span><br><span class="line">    Code:  </span><br><span class="line">      stack=1, locals=1, args_size=1  </span><br><span class="line">         0: aload_0  </span><br><span class="line">         1: invokespecial <span class="comment">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">         4: <span class="built_in">return</span>  </span><br><span class="line">      LineNumberTable:  </span><br><span class="line">        line 4: 0  </span><br><span class="line">      LocalVariableTable:  </span><br><span class="line">        Start  Length  Slot  Name   Signature  </span><br><span class="line">            0       5     0  this   Lcn/itcast/jvm/t1/stringtable/Demo1_22;  </span><br><span class="line">  </span><br><span class="line">  public static void main(java.lang.String[]);  </span><br><span class="line">    descriptor: ([Ljava/lang/String;)V  </span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC  </span><br><span class="line">    Code:  </span><br><span class="line">      stack=2, locals=6, args_size=1  </span><br><span class="line">         0: ldc           <span class="comment">#2                  // String a  </span></span><br><span class="line">         2: astore_1  </span><br><span class="line">         3: ldc           <span class="comment">#3                  // String b  </span></span><br><span class="line">         5: astore_2  </span><br><span class="line">         6: ldc           <span class="comment">#4                  // String ab   第一次ldc #4</span></span><br><span class="line">         8: astore_3  </span><br><span class="line">         9: new           <span class="comment">#5                  // class java/lang/StringBuilder  </span></span><br><span class="line">        12: dup  </span><br><span class="line">        13: invokespecial <span class="comment">#6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">        16: aload_1  </span><br><span class="line">        17: invokevirtual <span class="comment">#7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">        20: aload_2  </span><br><span class="line">        21: invokevirtual <span class="comment">#7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">        24: invokevirtual <span class="comment">#8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;  </span></span><br><span class="line">        27: astore        4  </span><br><span class="line">        29: ldc           <span class="comment">#4                  // String ab   第二次ldc #4</span></span><br><span class="line">        31: astore        5  </span><br><span class="line">        33: <span class="built_in">return</span>  </span><br><span class="line">      LineNumberTable:  </span><br><span class="line">        line 11: 0  </span><br><span class="line">        line 12: 3  </span><br><span class="line">        line 13: 6  </span><br><span class="line">        line 14: 9  </span><br><span class="line">        line 15: 29  </span><br><span class="line">        line 18: 33  </span><br><span class="line">      LocalVariableTable:  </span><br><span class="line">        Start  Length  Slot  Name   Signature  </span><br><span class="line">            0      34     0  args   [Ljava/lang/String;  </span><br><span class="line">            3      31     1    s1   Ljava/lang/String;  </span><br><span class="line">            6      28     2    s2   Ljava/lang/String;  </span><br><span class="line">            9      25     3    s3   Ljava/lang/String;  </span><br><span class="line">           29       5     4    s4   Ljava/lang/String;  </span><br><span class="line">           33       1     5    s5   Ljava/lang/String;  </span><br><span class="line">&#125;  </span><br><span class="line">SourceFile: <span class="string">&quot;Demo1_22.java&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="5-5-StringTable特性"><a href="#5-5-StringTable特性" class="headerlink" title="5.5 StringTable特性"></a>5.5 StringTable特性</h3><ul>
<li>常量池中的字符串仅是符号，第一次用到时才变为对象 </li>
<li>利用串池的机制，来避免重复创建字符串对象 </li>
<li><code>字符串变量</code>拼接的原理是 StringBuilder （1.8） </li>
<li><code>字符串常量</code>拼接的原理是编译期优化 </li>
<li>可以使用 intern 方法，主动将串池中还没有的字符串对象放入串池<ul>
<li><code>1.8 将这个字符串对象尝试放入串池，如果有则并不会放入，如果没有则放入串池， 会把串 池中的对象返回</code> </li>
<li>1.6 将这个字符串对象尝试放入串池，如果有则并不会放入，如果没有会把此对象复制一份， 放入串池， 会把串池中的对象返回</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_23</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">x</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>; <span class="comment">// 串池中有 &quot;ab&quot;        </span></span><br><span class="line">        <span class="comment">// 此时堆中有：  new String(&quot;a&quot;)   new String(&quot;b&quot;) new String(&quot;ab&quot;)        </span></span><br><span class="line">        <span class="comment">// 字符串池中有： [&quot;a&quot;, &quot;b&quot;] 还没有 &quot;ab&quot;        </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 串池有“ab”， 此时s没有被放进串池中，s仍在堆中  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s.intern(); <span class="comment">// 将这个字符串对象尝试放入串池，如果有则并不会放入，如果没有则放入串池， 会把串池中的对象返回  </span></span><br><span class="line">  </span><br><span class="line">        System.out.println(s2 == x); <span class="comment">// true  </span></span><br><span class="line">        System.out.println(s == <span class="string">&quot;ab&quot;</span>); <span class="comment">// false  </span></span><br><span class="line">        System.out.println(s == x); <span class="comment">// false  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_23</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">       </span><br><span class="line">        <span class="comment">// 此时堆中有：  new String(&quot;a&quot;)   new String(&quot;b&quot;) new String(&quot;ab&quot;)        </span></span><br><span class="line">        <span class="comment">// 字符串池中有： [&quot;a&quot;, &quot;b&quot;] 还没有 &quot;ab&quot;        </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 串池无“ab” s被放进串池，返回： s2也是串池</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s.intern(); <span class="comment">// 将这个字符串对象尝试放入串池，如果有则并不会放入，如果没有则放入串池， 会把串池中的对象返回  </span></span><br><span class="line">  </span><br><span class="line">        System.out.println(s2 == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true  </span></span><br><span class="line">        System.out.println(s == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示字符串相关面试题  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_21</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;        <span class="comment">// 池中  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;        <span class="comment">// 池中  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span>; <span class="comment">// 池中 ab        String s4 = s1 + s2;   // 堆中 调用StringBuiler new String(&quot;ab&quot;)  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;        <span class="comment">// 池中  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s6</span> <span class="operator">=</span> s4.intern(); <span class="comment">// s4没有放进池中（仍在堆中） s6池中  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// 问  </span></span><br><span class="line">        System.out.println(s3 == s4); <span class="comment">// false  </span></span><br><span class="line">        System.out.println(s3 == s5); <span class="comment">// true  </span></span><br><span class="line">        System.out.println(s3 == s6); <span class="comment">// true  </span></span><br><span class="line">        System.out.println(s6 == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">x2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;d&quot;</span>); <span class="comment">// new String(&quot;cd&quot;)  </span></span><br><span class="line">        x2.intern(); <span class="comment">// 放进池中  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">x1</span> <span class="operator">=</span> <span class="string">&quot;cd&quot;</span>; <span class="comment">// 池中  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 问，如果调换了【最后两行代码】的位置呢，如果是jdk1.6呢  </span></span><br><span class="line">        System.out.println(x1 == x2); <span class="comment">// true  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-StringTable位置"><a href="#5-6-StringTable位置" class="headerlink" title="5.6 StringTable位置"></a>5.6 StringTable位置</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023180402231.png"></p>
<p><strong>演示代码</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示 StringTable 位置  </span></span><br><span class="line"><span class="comment"> * 在jdk8下设置 -Xmx10m -XX:-UseGCOverheadLimit  </span></span><br><span class="line"><span class="comment"> * 在jdk6下设置 -XX:MaxPermSize=10m  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_6</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">260000</span>; j++) &#123;  </span><br><span class="line">                list.add(String.valueOf(j).intern());  </span><br><span class="line">                i++;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>jdk1.6报错</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023180625780.png" alt="|600"></li>
<li><code>jdk1.8报错</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023180825140.png" alt="|550"></li>
</ul>
<h3 id="5-7-StringTable-垃圾回收"><a href="#5-7-StringTable-垃圾回收" class="headerlink" title="5.7 StringTable 垃圾回收"></a>5.7 StringTable 垃圾回收</h3><ul>
<li>代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示 StringTable 垃圾回收  </span></span><br><span class="line"><span class="comment"> * -Xmx10m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails -verbose:gc  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_7</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">100000</span>; j++) &#123; <span class="comment">// j=100, j=10000  </span></span><br><span class="line">                String.valueOf(j).intern();  </span><br><span class="line">                i++;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>日志<ul>
<li>循环十万次，放入十万个数到 <code>StringTable</code></li>
<li>触发GC回收 <code>GC (Allocation Failure) [PSYoungGen: 4096K-&gt;496K(4608K)] 4096K-&gt;536K(15872K),</code></li>
<li>并没有真正放入十万个数（53774个）： <code>Number of entries       :     53774 =   1290576 bytes, avg  24.000</code></li>
</ul>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">GC</span> <span class="string">(Allocation</span> <span class="string">Failure)</span> [<span class="attr">PSYoungGen:</span> <span class="string">4096K-&gt;496K(4608K)</span>] <span class="string">4096K-&gt;536K(15872K)</span>, <span class="number">0.0007230</span> <span class="string">secs</span>] [<span class="attr">Times:</span> <span class="string">user=0.01</span> <span class="string">sys=0.00</span>, <span class="string">real=0.00</span> <span class="string">secs</span>] </span><br><span class="line"><span class="number">100000</span></span><br><span class="line"><span class="string">Heap</span></span><br><span class="line"> <span class="string">PSYoungGen</span>      <span class="string">total</span> <span class="string">4608K,</span> <span class="string">used</span> <span class="string">3435K</span> [<span class="number">0x00000007bfb00000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span><span class="string">)</span></span><br><span class="line">  <span class="string">eden</span> <span class="string">space</span> <span class="string">4096K</span>, <span class="number">71</span><span class="string">%</span> <span class="string">used</span> [<span class="number">0x00000007bfb00000</span>,<span class="number">0x00000007bfddee40</span>,<span class="number">0x00000007bff00000</span><span class="string">)</span></span><br><span class="line">  <span class="string">from</span> <span class="string">space</span> <span class="string">512K</span>, <span class="number">96</span><span class="string">%</span> <span class="string">used</span> [<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007bff7c010</span>,<span class="number">0x00000007bff80000</span><span class="string">)</span></span><br><span class="line">  <span class="string">to</span>   <span class="string">space</span> <span class="string">512K</span>, <span class="number">0</span><span class="string">%</span> <span class="string">used</span> [<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007c0000000</span><span class="string">)</span></span><br><span class="line"> <span class="string">ParOldGen</span>       <span class="string">total</span> <span class="string">11264K</span>, <span class="string">used</span> <span class="string">40K</span> [<span class="number">0x00000007bf000000</span>, <span class="number">0x00000007bfb00000</span>, <span class="number">0x00000007bfb00000</span><span class="string">)</span></span><br><span class="line">  <span class="string">object</span> <span class="string">space</span> <span class="string">11264K</span>, <span class="number">0</span><span class="string">%</span> <span class="string">used</span> [<span class="number">0x00000007bf000000</span>,<span class="number">0x00000007bf00a000</span>,<span class="number">0x00000007bfb00000</span><span class="string">)</span></span><br><span class="line"> <span class="string">Metaspace</span>       <span class="string">used</span> <span class="string">3413K</span>, <span class="string">capacity</span> <span class="string">4564K</span>, <span class="string">committed</span> <span class="string">4864K</span>, <span class="string">reserved</span> <span class="string">1056768K</span></span><br><span class="line">  <span class="string">class</span> <span class="string">space</span>    <span class="string">used</span> <span class="string">368K</span>, <span class="string">capacity</span> <span class="string">388K</span>, <span class="string">committed</span> <span class="string">512K</span>, <span class="string">reserved</span> <span class="string">1048576K</span></span><br><span class="line"><span class="attr">SymbolTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">20011</span> <span class="string">=</span>    <span class="number">160088</span> <span class="string">bytes</span>, <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">13264</span> <span class="string">=</span>    <span class="number">318336</span> <span class="string">bytes</span>, <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">13264</span> <span class="string">=</span>    <span class="number">521312</span> <span class="string">bytes</span>, <span class="string">avg</span>  <span class="number">39.303</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>    <span class="number">999736</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.663</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.666</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.816</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">6</span></span><br><span class="line"><span class="attr">StringTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">60013</span> <span class="string">=</span>    <span class="number">480104</span> <span class="string">bytes</span>, <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">53774</span> <span class="string">=</span>   <span class="number">1290576</span> <span class="string">bytes</span>, <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">53774</span> <span class="string">=</span>   <span class="number">3021376</span> <span class="string">bytes</span>, <span class="string">avg</span>  <span class="number">56.187</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>   <span class="number">4792056</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.896</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.704</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.839</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="5-8-StringTable-性能调优"><a href="#5-8-StringTable-性能调优" class="headerlink" title="5.8 StringTable 性能调优"></a>5.8 StringTable 性能调优</h3><h4 id="调整-XX-StringTableSize-桶个数"><a href="#调整-XX-StringTableSize-桶个数" class="headerlink" title="调整 -XX:StringTableSize&#x3D;桶个数"></a>调整 -XX:StringTableSize&#x3D;桶个数</h4><ul>
<li>案例代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示串池大小对性能的影响  </span></span><br><span class="line"><span class="comment"> * -Xms500m -Xmx500m -XX:+PrintStringTableStatistics -XX:StringTableSize=1009  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_24</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="comment">// 读入48万个单词  </span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;linux.words&quot;</span>), <span class="string">&quot;utf-8&quot;</span>))) &#123;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">            <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                line = reader.readLine();  </span><br><span class="line">                <span class="keyword">if</span> (line == <span class="literal">null</span>) &#123;  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                line.intern(); <span class="comment">// 放入串池  </span></span><br><span class="line">            &#125;  </span><br><span class="line">            System.out.println(<span class="string">&quot;cost:&quot;</span> + (System.nanoTime() - start) / <span class="number">1000000</span>); <span class="comment">// 124ms  </span></span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>默认 <code>60013</code> 个</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cost:129</span> <span class="string">（时间</span> <span class="string">ms）</span></span><br><span class="line"><span class="attr">SymbolTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">20011</span> <span class="string">=</span>    <span class="number">160088</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">318384</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">521352</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">39.300</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>    <span class="number">999824</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.663</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.666</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.816</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">6</span></span><br><span class="line"><span class="attr">StringTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">60013</span> <span class="string">=</span>    <span class="number">480104</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">11535216</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">29632912</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">61.654</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>  <span class="number">41648232</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">8.009</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">8.067</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">2.840</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>        <span class="number">23</span></span><br></pre></td></tr></table></figure>
<ul>
<li>修改为 <code>200000</code>个后<ul>
<li>时间为98ms</li>
<li><code>-XX:StringTableSize=200000  </code></li>
<li>原因：空间换时间</li>
</ul>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cost:98</span></span><br><span class="line"><span class="attr">SymbolTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">20011</span> <span class="string">=</span>    <span class="number">160088</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">318384</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">521352</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">39.300</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>    <span class="number">999824</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.663</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.666</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.816</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">6</span></span><br><span class="line"><span class="attr">StringTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>    <span class="number">200000</span> <span class="string">=</span>   <span class="number">1600000</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">11535216</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">29632912</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">61.654</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>  <span class="number">42768128</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">2.403</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">2.416</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">1.554</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>        <span class="number">12</span></span><br></pre></td></tr></table></figure>
<ul>
<li>调小，修改为 <code>1009</code> 个<ul>
<li><code>-XX:StringTableSize=1009</code></li>
<li>时间明显变慢</li>
<li>原因：哈希冲突太多</li>
</ul>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cost:1497</span></span><br><span class="line"><span class="attr">SymbolTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">20011</span> <span class="string">=</span>    <span class="number">160088</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">318384</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">521352</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">39.300</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>    <span class="number">999824</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.663</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.666</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.816</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">6</span></span><br><span class="line"><span class="attr">StringTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>      <span class="number">1009</span> <span class="string">=</span>      <span class="number">8072 </span><span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">11535216</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">29632912</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">61.654</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>  <span class="number">41176200</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>   <span class="number">476.347</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>   <span class="number">434.024</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>    <span class="number">20.833</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>       <span class="number">544</span></span><br></pre></td></tr></table></figure>

<h4 id="考虑将字符串对象是否入池"><a href="#考虑将字符串对象是否入池" class="headerlink" title="考虑将字符串对象是否入池"></a>考虑将字符串对象是否入池</h4><ul>
<li>入池和不入池对内存占比</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示 intern 减少内存占用  </span></span><br><span class="line"><span class="comment"> * -XX:StringTableSize=200000 -XX:+PrintStringTableStatistics  </span></span><br><span class="line"><span class="comment"> * -Xsx500m -Xmx500m -XX:+PrintStringTableStatistics -XX:StringTableSize=200000 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_25</span> &#123;  </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        List&lt;String&gt; address = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        System.in.read();  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;  </span><br><span class="line">            <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;linux.words&quot;</span>), <span class="string">&quot;utf-8&quot;</span>))) &#123;  </span><br><span class="line">                <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">                <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                    line = reader.readLine();  </span><br><span class="line">                    <span class="keyword">if</span> (line == <span class="literal">null</span>) &#123;  </span><br><span class="line">                        <span class="keyword">break</span>;  </span><br><span class="line">                    &#125;  </span><br><span class="line"><span class="comment">//                    address.add(line);  </span></span><br><span class="line">                    address.add(line.intern());  </span><br><span class="line">                &#125;  </span><br><span class="line">                System.out.println(<span class="string">&quot;cost:&quot;</span> + (System.nanoTime() - start) / <span class="number">1000000</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.in.read();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>visualvm</code> 工具</li>
<li>读取文件之前<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023183405136.png" alt="|1000"></li>
<li>开始读文件 <code>address.add(line); </code><ul>
<li>加起来占用 <code>80%</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023183533655.png"></li>
</ul>
</li>
<li>使用放入串池方法 <code>address.add(line.intern());  </code><ul>
<li>加起来占用 <code>60%</code>   <code>String和char[]</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023183855130.png"></li>
</ul>
</li>
</ul>
<h2 id="6-直接内存"><a href="#6-直接内存" class="headerlink" title="6. 直接内存"></a>6. 直接内存</h2><h3 id="6-1-定义"><a href="#6-1-定义" class="headerlink" title="6.1 定义"></a>6.1 定义</h3><p>Direct Memory </p>
<ul>
<li>不属于jvm，是内存区域</li>
<li>常见于 NIO 操作时，</li>
<li>用于数据缓冲区 分配回收成本较高，</li>
<li>但读写性能高 不受 JVM 内存回收管理</li>
</ul>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示 ByteBuffer 作用  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_9</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FROM</span> <span class="operator">=</span> <span class="string">&quot;/Users/cyt/Movies/test/1.mp4&quot;</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TO</span> <span class="operator">=</span> <span class="string">&quot;/Users/cyt/Movies/test/2.mp4&quot;</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1Mb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        io(); <span class="comment">// io 用时：1535.586957 1766.963399 1359.240226  </span></span><br><span class="line">        directBuffer(); <span class="comment">// directBuffer 用时：479.295165 702.291454 562.56592  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">directBuffer</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">from</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(FROM).getChannel();  </span><br><span class="line">             <span class="type">FileChannel</span> <span class="variable">to</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(TO).getChannel();  </span><br><span class="line">        ) &#123;  </span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">bb</span> <span class="operator">=</span> ByteBuffer.allocateDirect(_1Mb);  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> from.read(bb);  </span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                bb.flip();  </span><br><span class="line">                to.write(bb);  </span><br><span class="line">                bb.clear();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">        System.out.println(<span class="string">&quot;directBuffer 用时：&quot;</span> + (end - start) / <span class="number">1000_000.0</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">io</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">from</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(FROM);  </span><br><span class="line">             <span class="type">FileOutputStream</span> <span class="variable">to</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(TO);  </span><br><span class="line">        ) &#123;  </span><br><span class="line">            <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[_1Mb];  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> from.read(buf);  </span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                to.write(buf, <span class="number">0</span>, len);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">        System.out.println(<span class="string">&quot;io 用时：&quot;</span> + (end - start) / <span class="number">1000_000.0</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024134050650.png"><br><strong>普通io</strong>：</p>
<ul>
<li>切换为内核态</li>
<li>在内存申请java缓冲区</li>
<li>系统缓冲区内容复制到java缓冲区<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024134733560.png" alt="|625"></li>
</ul>
<p><strong>directBuffer</strong>：</p>
<ul>
<li>调用 <code>ByteBuffer bb = ByteBuffer.allocateDirect(_1Mb);</code></li>
<li><code>direct memory</code> java和系统都可以直接访问<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024135125927.png" alt="|700"></li>
</ul>
<h3 id="内存溢出"><a href="#内存溢出" class="headerlink" title="内存溢出"></a>内存溢出</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 演示直接内存溢出  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_10</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_100Mb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        List&lt;ByteBuffer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(_100Mb); <span class="comment">// 直接内存分配 100MB                list.add(byteBuffer);  </span></span><br><span class="line">                i++;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// 方法区是jvm规范， jdk6 中对方法区的实现称为永久代  </span></span><br><span class="line">        <span class="comment">//                  jdk8 对方法区的实现称为元空间  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024135610375.png"></p>
<h3 id="6-2-分配和回收原理"><a href="#6-2-分配和回收原理" class="headerlink" title="6.2 分配和回收原理"></a>6.2 分配和回收原理</h3><ul>
<li>使用了 <code>Unsafe</code> 对象完成直接内存的分配回收，并且回收需要主动调用 freeMemory 方法 </li>
<li>ByteBuffer 的实现类内部，使用了 <code>Cleaner</code> （虚引用）来监测 ByteBuffer 对象，一旦 ByteBuffer 对象被垃圾回收，那么就会由 <code>ReferenceHandler</code> 线程通过 <code>Cleaner</code> 的 <code>clean</code> 方法调 用 <code>freeMemory</code> 来释放直接内存</li>
</ul>
<h4 id="演示垃圾回收"><a href="#演示垃圾回收" class="headerlink" title="演示垃圾回收"></a>演示垃圾回收</h4><ul>
<li>使用 <code>bytebuffer</code></li>
<li><code>-XX:+DisableExplicitGC 禁用显式的垃圾回收  System.gc();</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 禁用显式回收对直接内存的影响  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_26</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1Gb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/*  </span></span><br><span class="line"><span class="comment">     * -XX:+DisableExplicitGC 禁用显式的垃圾回收  System.gc();</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(_1Gb);  </span><br><span class="line">        System.out.println(<span class="string">&quot;分配完毕...&quot;</span>);  </span><br><span class="line">        System.in.read();  </span><br><span class="line">        System.out.println(<span class="string">&quot;开始释放...&quot;</span>);  </span><br><span class="line">        System.gc(); <span class="comment">// 显式的垃圾回收，Full GC  </span></span><br><span class="line">        byteBuffer = <span class="literal">null</span>;  </span><br><span class="line">        System.in.read();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>按下第一次回车出现java进程 占用1GB</li>
<li>再次按下回车释放内存<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024140153275.png" alt="|800"></li>
</ul>
<h4 id="unsafe"><a href="#unsafe" class="headerlink" title="unsafe"></a>unsafe</h4><ul>
<li>通过反射获取unsafe</li>
<li>java不推荐程序员使用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 直接内存分配的底层原理：Unsafe  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_27</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1Gb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> getUnsafe();  </span><br><span class="line">        <span class="comment">// 分配内存  </span></span><br><span class="line">        <span class="type">long</span> <span class="variable">base</span> <span class="operator">=</span> unsafe.allocateMemory(_1Gb); <span class="comment">// 内存地址  </span></span><br><span class="line">        System.out.println(<span class="string">&quot;base地址: &quot;</span> + base);  </span><br><span class="line">        unsafe.setMemory(base, _1Gb, (<span class="type">byte</span>) <span class="number">0</span>);  </span><br><span class="line">        System.in.read();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 释放内存  </span></span><br><span class="line">        unsafe.freeMemory(base);  </span><br><span class="line">        System.in.read();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> Unsafe.class.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);  </span><br><span class="line">            f.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">            <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) f.get(<span class="literal">null</span>);  </span><br><span class="line">            <span class="keyword">return</span> unsafe;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException | IllegalAccessException e) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="byteBuffer源码剖析"><a href="#byteBuffer源码剖析" class="headerlink" title="byteBuffer源码剖析"></a>byteBuffer源码剖析</h4><ul>
<li><code>ByteBuffer byteBuffer = ByteBuffer.allocateDirect(_1Gb);</code></li>
<li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024141552014.png"></li>
<li>多开一个线程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">DirectByteBuffer(<span class="type">int</span> cap) &#123;                   <span class="comment">// package-private  </span></span><br><span class="line">  </span><br><span class="line">    <span class="built_in">super</span>(-<span class="number">1</span>, <span class="number">0</span>, cap, cap);  </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">pa</span> <span class="operator">=</span> VM.isDirectMemoryPageAligned();  </span><br><span class="line">    <span class="type">int</span> <span class="variable">ps</span> <span class="operator">=</span> Bits.pageSize();  </span><br><span class="line">    <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> Math.max(<span class="number">1L</span>, (<span class="type">long</span>)cap + (pa ? ps : <span class="number">0</span>));  </span><br><span class="line">    Bits.reserveMemory(size, cap);  </span><br><span class="line">  </span><br><span class="line">    <span class="type">long</span> <span class="variable">base</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        base = unsafe.allocateMemory(size);  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (OutOfMemoryError x) &#123;  </span><br><span class="line">        Bits.unreserveMemory(size, cap);  </span><br><span class="line">        <span class="keyword">throw</span> x;  </span><br><span class="line">    &#125;  </span><br><span class="line">    unsafe.setMemory(base, size, (<span class="type">byte</span>) <span class="number">0</span>);  </span><br><span class="line">    <span class="keyword">if</span> (pa &amp;&amp; (base % ps != <span class="number">0</span>)) &#123;  </span><br><span class="line">        <span class="comment">// Round up to page boundary  </span></span><br><span class="line">        address = base + ps - (base &amp; (ps - <span class="number">1</span>));  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        address = base;  </span><br><span class="line">    &#125;  </span><br><span class="line">    cleaner = Cleaner.create(<span class="built_in">this</span>, <span class="keyword">new</span> <span class="title class_">Deallocator</span>(base, size, cap));  </span><br><span class="line">    att = <span class="literal">null</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="cleaner对象"><a href="#cleaner对象" class="headerlink" title="cleaner对象"></a>cleaner对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cleaner</span>  </span><br><span class="line">    <span class="keyword">extends</span> <span class="title class_">PhantomReference</span>&lt;Object&gt;  </span><br><span class="line">&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Dummy reference queue, needed because the PhantomReference constructor  </span></span><br><span class="line">    <span class="comment">// insists that we pass a queue.  Nothing will ever be placed on this queue    </span></span><br><span class="line">    <span class="comment">// since the reference handler invokes cleaners explicitly.    </span></span><br><span class="line">    <span class="comment">//    private static final ReferenceQueue&lt;Object&gt; dummyQueue = new ReferenceQueue&lt;&gt;();  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Doubly-linked list of live cleaners, which prevents the cleaners  </span></span><br><span class="line">    <span class="comment">// themselves from being GC&#x27;d before their referents    </span></span><br><span class="line">    <span class="comment">//    static private Cleaner first = null;  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">Cleaner</span>  </span><br><span class="line">        <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>,  </span><br><span class="line">        prev = <span class="literal">null</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Cleaner <span class="title function_">add</span><span class="params">(Cleaner cl)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (first != <span class="literal">null</span>) &#123;  </span><br><span class="line">            cl.next = first;  </span><br><span class="line">            first.prev = cl;  </span><br><span class="line">        &#125;  </span><br><span class="line">        first = cl;  </span><br><span class="line">        <span class="keyword">return</span> cl;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Cleaner cl)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// If already removed, do nothing  </span></span><br><span class="line">        <span class="keyword">if</span> (cl.next == cl)  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Update list  </span></span><br><span class="line">        <span class="keyword">if</span> (first == cl) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (cl.next != <span class="literal">null</span>)  </span><br><span class="line">                first = cl.next;  </span><br><span class="line">            <span class="keyword">else</span>  </span><br><span class="line">                first = cl.prev;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (cl.next != <span class="literal">null</span>)  </span><br><span class="line">            cl.next.prev = cl.prev;  </span><br><span class="line">        <span class="keyword">if</span> (cl.prev != <span class="literal">null</span>)  </span><br><span class="line">            cl.prev.next = cl.next;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Indicate removal by pointing the cleaner to itself  </span></span><br><span class="line">        cl.next = cl;  </span><br><span class="line">        cl.prev = cl;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Runnable thunk;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Cleaner</span><span class="params">(Object referent, Runnable thunk)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>(referent, dummyQueue);  </span><br><span class="line">        <span class="built_in">this</span>.thunk = thunk;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Creates a new cleaner.     *     * <span class="doctag">@param</span>  ob the referent object to be cleaned  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  thunk  </span></span><br><span class="line"><span class="comment">     *         The cleanup code to be run when the cleaner is invoked.  The  </span></span><br><span class="line"><span class="comment">     *         cleanup code is run directly from the reference-handler thread,     *         </span></span><br><span class="line"><span class="comment">       so it should be as simple and straightforward as possible.     *     * </span></span><br><span class="line"><span class="comment">       <span class="doctag">@return</span>  The new cleaner  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Cleaner <span class="title function_">create</span><span class="params">(Object ob, Runnable thunk)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (thunk == <span class="literal">null</span>)  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">return</span> add(<span class="keyword">new</span> <span class="title class_">Cleaner</span>(ob, thunk));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Runs this cleaner, if it has not been run before.     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clean</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (!remove(<span class="built_in">this</span>))  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            thunk.run();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Throwable x) &#123;  </span><br><span class="line">            AccessController.doPrivileged(<span class="keyword">new</span> <span class="title class_">PrivilegedAction</span>&lt;Void&gt;() &#123;  </span><br><span class="line">                    <span class="keyword">public</span> Void <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">                        <span class="keyword">if</span> (System.err != <span class="literal">null</span>)  </span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Cleaner terminated abnormally&quot;</span>, x)  </span><br><span class="line">                                .printStackTrace();  </span><br><span class="line">                        System.exit(<span class="number">1</span>);  </span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">                    &#125;&#125;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://youcyt.ltd">cyt</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://youcyt.ltd/post/java%E5%AD%A6%E4%B9%A0/jvm/1JVM-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html">https://youcyt.ltd/post/java学习/jvm/1JVM-内存结构.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://youcyt.ltd" target="_blank">cyt的笔记屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/JVM/">JVM</a></div><div class="post-share"><div class="social-share" data-image="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175134533.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/post/java%E5%AD%A6%E4%B9%A0/jvm/2JVM-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html" title="JVM-垃圾回收"><img class="cover" src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028145205154.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">JVM-垃圾回收</div></div><div class="info-2"><div class="info-item-1">二、垃圾回收1. 如何判断对象可以回收1.1引用计数法 有引用+1 断开引用-1 弊端：循环依赖问题 java未使用该方法  1.2 可达性分析计算法 Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象   扫描堆中的对象，看是否能够沿着 GC Root对象 为起点的引用链找到该对象，找不到，表示可以 回收   哪些对象可以作为 GC Root ?  类比葡萄串🍇，提起葡萄还在根上的就不能被回收案例：  保存jmap状态   1234567891011❯ jps31112 Main34184 Jps33769 Launcher33770 Demo2_2❯ jmap -dump:format=b,live,file=1.bin 33770Dumping heap to /Users/cyt/workspace/java/jvm-std/jvm/src/cn/itcast/jvm/t2/1.bin ...Heap dump file created❯ jmap -dump:format=b,live,file=2.bin 33770Dumping heap to /U...</div></div></div></a><a class="pagination-related" href="/post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98.html" title="ElasticSearch企业级应用实战"><img class="cover" src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720194230265.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">ElasticSearch企业级应用实战</div></div><div class="info-2"><div class="info-item-1">1.初识elasticsearch1.1.了解ES1.1.1.elasticsearch的作用elasticsearch是一款非常强大的开源搜索引擎，具备非常多强大功能，可以帮助我们从海量数据中快速找到需要的内容 例如：  在GitHub搜索代码   在电商网站搜索商品   在百度搜索答案   在打车软件搜索附近的车    1.1.2.ELK技术栈elasticsearch结合kibana、Logstash、Beats，也就是elastic stack（ELK）。被广泛应用在日志数据分析、实时监控等领域：  而elasticsearch是elastic stack的核心，负责存储、搜索、分析数据。  1.1.3.elasticsearch和luceneelasticsearch底层是基于lucene来实现的。 **Lucene**是一个Java语言的搜索引擎类库，是Apache公司的顶级项目，由DougCutting于1999年研发。官网地址：https://lucene.apache.org/ 。  elasticsearch的发展历史：  2004年Shay Banon基于L...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/post/java%E5%AD%A6%E4%B9%A0/jvm/2JVM-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html" title="JVM-垃圾回收"><img class="cover" src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028145205154.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-30</div><div class="info-item-2">JVM-垃圾回收</div></div><div class="info-2"><div class="info-item-1">二、垃圾回收1. 如何判断对象可以回收1.1引用计数法 有引用+1 断开引用-1 弊端：循环依赖问题 java未使用该方法  1.2 可达性分析计算法 Java 虚拟机中的垃圾回收器采用可达性分析来探索所有存活的对象   扫描堆中的对象，看是否能够沿着 GC Root对象 为起点的引用链找到该对象，找不到，表示可以 回收   哪些对象可以作为 GC Root ?  类比葡萄串🍇，提起葡萄还在根上的就不能被回收案例：  保存jmap状态   1234567891011❯ jps31112 Main34184 Jps33769 Launcher33770 Demo2_2❯ jmap -dump:format=b,live,file=1.bin 33770Dumping heap to /Users/cyt/workspace/java/jvm-std/jvm/src/cn/itcast/jvm/t2/1.bin ...Heap dump file created❯ jmap -dump:format=b,live,file=2.bin 33770Dumping heap to /U...</div></div></div></a><a class="pagination-related" href="/post/java%E5%9F%BA%E7%A1%80/java8.html" title="java8"><img class="cover" src="/img/cover/8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-18</div><div class="info-item-2">java8</div></div><div class="info-2"><div class="info-item-1"> 函数式编程–stream 流  概述为什么学  函数式编程思想 Lambda 表达式概述 使用情况 参数为一个接口，并且只有一个抽象方法 （不包含抽象方法|） 例如：   例例 1 例 2 例 4 例 5 ✨ 省略规则    Stream 流https://www.bilibili.com/video/BV1Gh41187uR?p=12&amp;spm_id_from=pageDriver&amp;vd_source=30924cc6debe913490fb34d7e3b62fdd 概述 初始化工程12345678910111213141516171819202122232425262728293031323334353637public class StreamDemo &#123;    public static void main(String[] args) &#123;        List&lt;Author&gt; authors = getAuthors();        System.out.println(authors);    &#125;    ...</div></div></div></a><a class="pagination-related" href="/post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMQ%E7%AC%94%E8%AE%B0.html" title="rocketMQ笔记"><img class="cover" src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929171632722.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-09</div><div class="info-item-2">rocketMQ笔记</div></div><div class="info-2"><div class="info-item-1">  教学地址：b站 https://www.bilibili.com/video/BV1AU4y157LX   本地使用mq cd /Users/cyt/huanjing/java/middle/rocketmq-all-4.8.0-bin-release sh start.sh  开启mq sh close.sh 关闭mq cd ../web  java -jar rocketmq-console-ng-2.0.0.jar 开启mq控制台   后续使用docker搭建mq   基本知识MQ介绍  对比  介绍  优势和劣势  优势应用解耦  提高系统容错性和可维护性 生产者发送消息到MQ mq可以复制多份到其他系统     异步提速  提升用户体验和系统吞吐量  从下单到结果只需要100ms  先发给mq  存入mysql  后面的200ms不用管          削峰填谷  提高系统稳定性 把mq当做缓存 10w个请求，从mq里面取数据，放入mysql     示意图  劣势  工作原理（重点）  生产者 消费者 服务器三大集群都要去 命名服务器 注册自己的ip信息 消费者...</div></div></div></a><a class="pagination-related" href="/post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98.html" title="ElasticSearch企业级应用实战"><img class="cover" src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720194230265.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-21</div><div class="info-item-2">ElasticSearch企业级应用实战</div></div><div class="info-2"><div class="info-item-1">1.初识elasticsearch1.1.了解ES1.1.1.elasticsearch的作用elasticsearch是一款非常强大的开源搜索引擎，具备非常多强大功能，可以帮助我们从海量数据中快速找到需要的内容 例如：  在GitHub搜索代码   在电商网站搜索商品   在百度搜索答案   在打车软件搜索附近的车    1.1.2.ELK技术栈elasticsearch结合kibana、Logstash、Beats，也就是elastic stack（ELK）。被广泛应用在日志数据分析、实时监控等领域：  而elasticsearch是elastic stack的核心，负责存储、搜索、分析数据。  1.1.3.elasticsearch和luceneelasticsearch底层是基于lucene来实现的。 **Lucene**是一个Java语言的搜索引擎类库，是Apache公司的顶级项目，由DougCutting于1999年研发。官网地址：https://lucene.apache.org/ 。  elasticsearch的发展历史：  2004年Shay Banon基于L...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/other/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">cyt</div><div class="author-info-description">归途也还可爱</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/yigeyouzia" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/c_cjwkwjsnsj" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1793402316&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:1793402316@qq.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFJVM"><span class="toc-number">1.1.</span> <span class="toc-text">什么是JVM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6jvm%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">学jvm有什么用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84JVM"><span class="toc-number">1.3.</span> <span class="toc-text">常见的JVM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF"><span class="toc-number">1.4.</span> <span class="toc-text">学习路线</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">一、内存结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">2.1.</span> <span class="toc-text">1. 程序计数器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%BD%9C%E7%94%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">1.2 作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88"><span class="toc-number">2.2.</span> <span class="toc-text">2.虚拟机栈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%AE%9A%E4%B9%89"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%A0%88%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2 栈内存溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E7%BA%BF%E7%A8%8B%E8%BF%90%E8%A1%8C%E8%AF%8A%E6%96%AD"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.3 线程运行诊断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88"><span class="toc-number">2.3.</span> <span class="toc-text">3. 本地方法栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%A0%86"><span class="toc-number">2.4.</span> <span class="toc-text">4. 堆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%9A%E4%B9%89"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%A0%86%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2 堆内存溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%A0%86%E5%86%85%E5%AD%98%E8%AF%8A%E6%96%AD"><span class="toc-number">2.4.3.</span> <span class="toc-text">4.3 堆内存诊断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%96%B9%E6%B3%95%E5%8C%BA"><span class="toc-number">2.5.</span> <span class="toc-text">5. 方法区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%AE%9A%E4%B9%89"><span class="toc-number">2.5.1.</span> <span class="toc-text">5.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%BB%84%E6%88%90"><span class="toc-number">2.5.2.</span> <span class="toc-text">5.2 组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%96%B9%E6%B3%95%E5%8C%BA%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA"><span class="toc-number">2.5.3.</span> <span class="toc-text">5.3 方法区内存溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">2.5.4.</span> <span class="toc-text">5.4 运行时常量池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-StringTable"><span class="toc-number">2.5.5.</span> <span class="toc-text">5.5 StringTable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90"><span class="toc-number">2.5.6.</span> <span class="toc-text">案例解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-StringTable%E7%89%B9%E6%80%A7"><span class="toc-number">2.5.7.</span> <span class="toc-text">5.5 StringTable特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">2.5.8.</span> <span class="toc-text">面试题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-StringTable%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.5.9.</span> <span class="toc-text">5.6 StringTable位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-StringTable-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">2.5.10.</span> <span class="toc-text">5.7 StringTable 垃圾回收</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-StringTable-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98"><span class="toc-number">2.5.11.</span> <span class="toc-text">5.8 StringTable 性能调优</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E6%95%B4-XX-StringTableSize-%E6%A1%B6%E4%B8%AA%E6%95%B0"><span class="toc-number">2.5.11.1.</span> <span class="toc-text">调整 -XX:StringTableSize&#x3D;桶个数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%80%83%E8%99%91%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E5%85%A5%E6%B1%A0"><span class="toc-number">2.5.11.2.</span> <span class="toc-text">考虑将字符串对象是否入池</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98"><span class="toc-number">2.6.</span> <span class="toc-text">6. 直接内存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%AE%9A%E4%B9%89"><span class="toc-number">2.6.1.</span> <span class="toc-text">6.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">2.6.2.</span> <span class="toc-text">案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA"><span class="toc-number">2.6.3.</span> <span class="toc-text">内存溢出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%88%86%E9%85%8D%E5%92%8C%E5%9B%9E%E6%94%B6%E5%8E%9F%E7%90%86"><span class="toc-number">2.6.4.</span> <span class="toc-text">6.2 分配和回收原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">2.6.4.1.</span> <span class="toc-text">演示垃圾回收</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unsafe"><span class="toc-number">2.6.4.2.</span> <span class="toc-text">unsafe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#byteBuffer%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90"><span class="toc-number">2.6.4.3.</span> <span class="toc-text">byteBuffer源码剖析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cleaner%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.6.4.4.</span> <span class="toc-text">cleaner对象</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/java%E5%AD%A6%E4%B9%A0/jvm/2JVM-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html" title="JVM-垃圾回收"><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028145205154.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JVM-垃圾回收"/></a><div class="content"><a class="title" href="/post/java%E5%AD%A6%E4%B9%A0/jvm/2JVM-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html" title="JVM-垃圾回收">JVM-垃圾回收</a><time datetime="2025-10-30T05:08:00.000Z" title="发表于 2025-10-30 13:08:00">2025-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/java%E5%AD%A6%E4%B9%A0/jvm/1JVM-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html" title="JVM-内存结构"><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175134533.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JVM-内存结构"/></a><div class="content"><a class="title" href="/post/java%E5%AD%A6%E4%B9%A0/jvm/1JVM-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html" title="JVM-内存结构">JVM-内存结构</a><time datetime="2025-10-24T12:30:12.000Z" title="发表于 2025-10-24 20:30:12">2025-10-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98.html" title="ElasticSearch企业级应用实战"><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720194230265.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ElasticSearch企业级应用实战"/></a><div class="content"><a class="title" href="/post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98.html" title="ElasticSearch企业级应用实战">ElasticSearch企业级应用实战</a><time datetime="2025-10-21T08:54:01.000Z" title="发表于 2025-10-21 16:54:01">2025-10-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/3%E5%B0%8F%E5%9C%9F%E5%A0%86pytorch.html" title="小土堆pytorch教程"><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/aedf385ac09752547290e85319b88081c812cf06.jpg%40672w_378h_1c_!web-search-common-cover.avif" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小土堆pytorch教程"/></a><div class="content"><a class="title" href="/post/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/3%E5%B0%8F%E5%9C%9F%E5%A0%86pytorch.html" title="小土堆pytorch教程">小土堆pytorch教程</a><time datetime="2025-10-17T10:05:11.000Z" title="发表于 2025-10-17 18:05:11">2025-10-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMQ%E7%AC%94%E8%AE%B0.html" title="rocketMQ笔记"><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929171632722.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="rocketMQ笔记"/></a><div class="content"><a class="title" href="/post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMQ%E7%AC%94%E8%AE%B0.html" title="rocketMQ笔记">rocketMQ笔记</a><time datetime="2025-10-09T10:32:06.000Z" title="发表于 2025-10-09 18:32:06">2025-10-09</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2025 By cyt</span></div><div class="footer_custom_text"><img src="https://haiyong.site/img/icp.png"><a href="https://beian.miit.gov.cn/#/Integrated/index"  style="color:white" target="_blank">蜀ICP备2023010926号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>(() => {
  const abcjsInit = () => {
    const abcjsFn = () => {
      setTimeout(() => {
        const sheets = document.querySelectorAll(".abc-music-sheet")
        for (let i = 0; i < sheets.length; i++) {
          const ele = sheets[i]
          if (ele.children.length > 0) continue

          // Parse parameters from data-params attribute
          let params = {}
          const dp = ele.getAttribute("data-params")
          if (dp) {
            try {
              params = JSON.parse(dp)
            } catch (e) {
              console.error("Failed to parse data-params:", e)
            }
          }

          // Merge parsed parameters with the responsive option
          // Ensures params content appears before responsive
          const options = { ...params, responsive: "resize" }

          // Render the music score using ABCJS.renderAbc
          ABCJS.renderAbc(ele, ele.innerHTML, options)
        }
      }, 100)
    }

    if (typeof ABCJS === "object") {
      abcjsFn()
    } else {
      btf.getScript("https://cdn.jsdelivr.net/npm/abcjs/dist/abcjs-basic-min.min.js").then(abcjsFn)
    }
  }

  if (window.pjax) {
    abcjsInit()
  } else {
    window.addEventListener("load", abcjsInit)
  }

  btf.addGlobalFn("encrypt", abcjsInit, "abcjs")
})()</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>