<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JVM-åƒåœ¾å›æ”¶</title>
      <link href="//post/java%E5%AD%A6%E4%B9%A0/jvm/2JVM-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html"/>
      <url>//post/java%E5%AD%A6%E4%B9%A0/jvm/2JVM-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html</url>
      
        <content type="html"><![CDATA[<h1 id="äºŒã€åƒåœ¾å›æ”¶"><a href="#äºŒã€åƒåœ¾å›æ”¶" class="headerlink" title="äºŒã€åƒåœ¾å›æ”¶"></a>äºŒã€åƒåœ¾å›æ”¶</h1><h2 id="1-å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"><a href="#1-å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶" class="headerlink" title="1. å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"></a>1. å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h2><h3 id="1-1å¼•ç”¨è®¡æ•°æ³•"><a href="#1-1å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="1.1å¼•ç”¨è®¡æ•°æ³•"></a>1.1å¼•ç”¨è®¡æ•°æ³•</h3><ul><li>æœ‰å¼•ç”¨+1</li><li>æ–­å¼€å¼•ç”¨-1</li><li>å¼Šç«¯ï¼šå¾ªç¯ä¾èµ–é—®é¢˜</li><li>javaæœªä½¿ç”¨è¯¥æ–¹æ³•<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024150012282.png"></li></ul><h3 id="1-2-å¯è¾¾æ€§åˆ†æè®¡ç®—æ³•"><a href="#1-2-å¯è¾¾æ€§åˆ†æè®¡ç®—æ³•" class="headerlink" title="1.2 å¯è¾¾æ€§åˆ†æè®¡ç®—æ³•"></a>1.2 å¯è¾¾æ€§åˆ†æè®¡ç®—æ³•</h3><ul><li><p>Java è™šæ‹Ÿæœºä¸­çš„åƒåœ¾å›æ”¶å™¨é‡‡ç”¨å¯è¾¾æ€§åˆ†ææ¥æ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ </p></li><li><p>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿæ²¿ç€ GC Rootå¯¹è±¡ ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œæ‰¾ä¸åˆ°ï¼Œè¡¨ç¤ºå¯ä»¥ å›æ”¶ </p></li><li><p>å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Root ?</p></li><li><p><code>ç±»æ¯”è‘¡è„ä¸²ğŸ‡ï¼Œæèµ·è‘¡è„è¿˜åœ¨æ ¹ä¸Šçš„å°±ä¸èƒ½è¢«å›æ”¶</code><br><strong>æ¡ˆä¾‹ï¼š</strong></p></li><li><p>ä¿å­˜jmapçŠ¶æ€</p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â¯ jps</span><br><span class="line">31112 Main</span><br><span class="line">34184 Jps</span><br><span class="line">33769 Launcher</span><br><span class="line">33770 Demo2_2</span><br><span class="line">â¯ jmap -dump:format=b,live,file=1.bin 33770</span><br><span class="line">Dumping heap to /Users/cyt/workspace/java/jvm-std/jvm/src/cn/itcast/jvm/t2/1.bin ...</span><br><span class="line">Heap dump file created</span><br><span class="line">â¯ jmap -dump:format=b,live,file=2.bin 33770</span><br><span class="line">Dumping heap to /Users/cyt/workspace/java/jvm-std/jvm/src/cn/itcast/jvm/t2/2.bin ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure><ul><li>ç”¨ <code>mat</code> è½¯ä»¶æ‰“å¼€åˆ†æ</li><li><code>GC ROOT</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024151048766.png"></li></ul><h3 id="1-3-å››ç§å¼•ç”¨"><a href="#1-3-å››ç§å¼•ç”¨" class="headerlink" title="1.3 å››ç§å¼•ç”¨"></a>1.3 å››ç§å¼•ç”¨</h3><ol><li><code>å¼ºå¼•ç”¨</code><ul><li>åªæœ‰æ‰€æœ‰ GC Roots å¯¹è±¡éƒ½ä¸é€šè¿‡ã€å¼ºå¼•ç”¨ã€‘å¼•ç”¨è¯¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰èƒ½è¢«åƒåœ¾å›æ”¶</li></ul></li><li><code>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</code><ul><li>ä»…æœ‰è½¯å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶åï¼Œå†…å­˜ä»ä¸è¶³æ—¶ä¼šå†æ¬¡å‡ºå‘åƒåœ¾å›æ”¶ï¼Œå›æ”¶è½¯å¼•ç”¨ å¯¹è±¡</li><li>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾è½¯å¼•ç”¨è‡ªèº«</li></ul></li><li><code>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</code><ul><li>ä»…æœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨å¯¹è±¡ </li><li>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾å¼±å¼•ç”¨è‡ªèº«</li></ul></li><li><code>è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</code><ul><li>å¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œä¸»è¦é…åˆ ByteBuffer ä½¿ç”¨ï¼Œè¢«å¼•ç”¨å¯¹è±¡å›æ”¶æ—¶ï¼Œä¼šå°†è™šå¼•ç”¨å…¥é˜Ÿï¼Œ ç”± Reference Handler çº¿ç¨‹è°ƒç”¨è™šå¼•ç”¨ç›¸å…³æ–¹æ³•é‡Šæ”¾ç›´æ¥å†…å­˜</li></ul></li><li><code>ç»ˆç»“å™¨å¼•ç”¨ï¼ˆFinalReferenceï¼‰</code><ul><li>æ— éœ€æ‰‹åŠ¨ç¼–ç ï¼Œä½†å…¶å†…éƒ¨é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼ˆè¢«å¼•ç”¨å¯¹è±¡ æš‚æ—¶æ²¡æœ‰è¢«å›æ”¶ï¼‰ï¼Œå†ç”± Finalizer çº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨å®ƒçš„ finalize æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡ GC æ—¶æ‰èƒ½å›æ”¶è¢«å¼•ç”¨å¯¹è±¡</li></ul></li></ol><h4 id="å¼ºè½¯å¼±"><a href="#å¼ºè½¯å¼±" class="headerlink" title="å¼ºè½¯å¼±"></a>å¼ºè½¯å¼±</h4><ul><li>å®çº¿æ˜¯å¼ºå¼•ç”¨<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024152339696.png"></li><li><code>è½¯ å¼±å¼•ç”¨æ–­å¼€</code><ul><li>å†…å­˜ä¸å¤Ÿå›æ”¶è½¯å¼•ç”¨</li><li>æ— è®ºå……è¶³ä¸å¦éƒ½å›æ”¶å¼±å¼•ç”¨</li><li>ç„¶åæ”¾å…¥ <code>å¼•ç”¨é˜Ÿåˆ—</code> ï¼ˆå¯ä»¥ä½¿ç”¨ï¼‰<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024152523935.png"></li></ul></li></ul><h4 id="è™šç»ˆ"><a href="#è™šç»ˆ" class="headerlink" title="è™šç»ˆ"></a>è™šç»ˆ</h4><ul><li>å¿…é¡»ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—</li><li>è™šå¼•ç”¨ï¼Œæ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œçº¿ç¨‹æ‰«æé˜Ÿåˆ—ä¸»åŠ¨é‡Šæ”¾ <code>ç›´æ¥å†…å­˜</code><ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024153856837.png" alt="|650"></li></ul></li><li>ç»ˆç»“å¼•ç”¨<ul><li>æ¯ä¸ªç±»ç»§æ‰¿è‡ªObjectç±»ï¼Œæœ‰ä¸€ä¸ª<code>finallize</code> æ–¹æ³• ï¼ˆä¸æ¨èï¼‰</li><li>æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—</li><li><code>ç”±finalizeHandleræ‰«æé‡Šæ”¾</code></li></ul></li></ul><h4 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºè½¯å¼•ç”¨  </span></span><br><span class="line"><span class="comment"> * -Xmx20m -XX:+PrintGCDetails -verbose:gc  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2_3</span> &#123;  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_4MB</span> <span class="operator">=</span> <span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line"><span class="comment">//        List&lt;byte[]&gt; list = new ArrayList&lt;&gt;();  </span></span><br><span class="line"><span class="comment">//        for (int i = 0; i &lt; 5; i++) &#123;  </span></span><br><span class="line"><span class="comment">//            list.add(new byte[_4MB]);  </span></span><br><span class="line"><span class="comment">//        &#125;  </span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line"><span class="comment">//        System.in.read();  </span></span><br><span class="line">        soft();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">soft</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="comment">// list --&gt; SoftReference --&gt; byte[]  </span></span><br><span class="line">  </span><br><span class="line">        List&lt;SoftReference&lt;<span class="type">byte</span>[]&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;  </span><br><span class="line">            SoftReference&lt;<span class="type">byte</span>[]&gt; ref = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">byte</span>[_4MB]);  </span><br><span class="line">            System.out.println(ref.get());  </span><br><span class="line">            list.add(ref);  </span><br><span class="line">            System.out.println(list.size());  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.out.println(<span class="string">&quot;å¾ªç¯ç»“æŸï¼š&quot;</span> + list.size());  </span><br><span class="line">        <span class="keyword">for</span> (SoftReference&lt;<span class="type">byte</span>[]&gt; ref : list) &#123;  </span><br><span class="line">            System.out.println(ref.get());  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æ™®é€šæ–¹æ³•åˆ†é…å†…å­˜ å‡ºç°å†…å­˜æº¢å‡º</li><li>ä½¿ç”¨è½¯å¼•ç”¨ç»“æœï¼š</li><li>è§‚å¯Ÿåˆ°æœ‰å››ä¸ªnull</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[B@<span class="number">4554617</span>c</span><br><span class="line"><span class="number">1</span></span><br><span class="line">[B@<span class="number">74</span>a14482</span><br><span class="line"><span class="number">2</span></span><br><span class="line">[B@<span class="number">1540e19</span>d</span><br><span class="line"><span class="number">3</span></span><br><span class="line">[B@<span class="number">677327b</span>6</span><br><span class="line"><span class="number">4</span></span><br><span class="line">[GC (Allocation Failure) --[PSYoungGen: <span class="number">5678</span>K-&gt;<span class="number">5678</span>K(<span class="number">7168</span>K)] <span class="number">17966</span>K-&gt;<span class="number">17974</span>K(<span class="number">23552</span>K), <span class="number">0.0006355</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[Full GC (Ergonomics) [PSYoungGen: <span class="number">5678</span>K-&gt;<span class="number">4453</span>K(<span class="number">7168</span>K)] [ParOldGen: <span class="number">12296</span>K-&gt;<span class="number">12288</span>K(<span class="number">16384</span>K)] <span class="number">17974</span>K-&gt;<span class="number">16741</span>K(<span class="number">23552</span>K), [Metaspace: <span class="number">3286</span>K-&gt;<span class="number">3286</span>K(<span class="number">1056768</span>K)], <span class="number">0.0018124</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">[GC (Allocation Failure) --[PSYoungGen: <span class="number">4453</span>K-&gt;<span class="number">4453</span>K(<span class="number">7168</span>K)] <span class="number">16741</span>K-&gt;<span class="number">16749</span>K(<span class="number">23552</span>K), <span class="number">0.0004038</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[Full GC (Allocation Failure) [PSYoungGen: <span class="number">4453</span>K-&gt;<span class="number">0</span>K(<span class="number">7168</span>K)] [ParOldGen: <span class="number">12296</span>K-&gt;<span class="number">331</span>K(<span class="number">10240</span>K)] <span class="number">16749</span>K-&gt;<span class="number">331</span>K(<span class="number">17408</span>K), [Metaspace: <span class="number">3286</span>K-&gt;<span class="number">3286</span>K(<span class="number">1056768</span>K)], <span class="number">0.0014106</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[B@<span class="number">14</span>ae5a5</span><br><span class="line"><span class="number">5</span></span><br><span class="line">å¾ªç¯ç»“æŸï¼š<span class="number">5</span></span><br><span class="line">null</span><br><span class="line">null</span><br><span class="line">null</span><br><span class="line">null</span><br><span class="line">[B@<span class="number">14</span>ae5a5</span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">7168</span>K, used <span class="number">4343</span>K [<span class="number">0x00000007bf800000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space <span class="number">6144</span>K, <span class="number">70</span>% used [<span class="number">0x00000007bf800000</span>,<span class="number">0x00000007bfc3de00</span>,<span class="number">0x00000007bfe00000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007c0000000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bfe00000</span>,<span class="number">0x00000007bfe00000</span>,<span class="number">0x00000007bff00000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">10240</span>K, used <span class="number">331</span>K [<span class="number">0x00000007be800000</span>, <span class="number">0x00000007bf200000</span>, <span class="number">0x00000007bf800000</span>)</span><br><span class="line">  object space <span class="number">10240</span>K, <span class="number">3</span>% used [<span class="number">0x00000007be800000</span>,<span class="number">0x00000007be852e20</span>,<span class="number">0x00000007bf200000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3313</span>K, capacity <span class="number">4564</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  class space    used <span class="number">350</span>K, capacity <span class="number">388</span>K, committed <span class="number">512</span>K, reserved <span class="number">1048576</span>K</span><br></pre></td></tr></table></figure><h4 id="è½¯å¼•ç”¨-å¼•ç”¨é˜Ÿåˆ—"><a href="#è½¯å¼•ç”¨-å¼•ç”¨é˜Ÿåˆ—" class="headerlink" title="è½¯å¼•ç”¨+å¼•ç”¨é˜Ÿåˆ—"></a>è½¯å¼•ç”¨+å¼•ç”¨é˜Ÿåˆ—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºè½¯å¼•ç”¨, é…åˆå¼•ç”¨é˜Ÿåˆ—  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2_4</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_4MB</span> <span class="operator">=</span> <span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        List&lt;SoftReference&lt;<span class="type">byte</span>[]&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// å¼•ç”¨é˜Ÿåˆ—  </span></span><br><span class="line">        ReferenceQueue&lt;<span class="type">byte</span>[]&gt; queue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;  </span><br><span class="line">            <span class="comment">// å…³è”äº†å¼•ç”¨é˜Ÿåˆ—ï¼Œ å½“è½¯å¼•ç”¨æ‰€å…³è”çš„ byte[]è¢«å›æ”¶æ—¶ï¼Œè½¯å¼•ç”¨è‡ªå·±ä¼šåŠ å…¥åˆ° queue ä¸­å»  </span></span><br><span class="line">            SoftReference&lt;<span class="type">byte</span>[]&gt; ref = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">byte</span>[_4MB], queue);  </span><br><span class="line">            System.out.println(ref.get());  </span><br><span class="line">            list.add(ref);  </span><br><span class="line">            System.out.println(list.size());  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// ä»é˜Ÿåˆ—ä¸­è·å–æ— ç”¨çš„ è½¯å¼•ç”¨å¯¹è±¡ï¼Œå¹¶ç§»é™¤  </span></span><br><span class="line">        Reference&lt;? <span class="keyword">extends</span> <span class="title class_">byte</span>[]&gt; poll = queue.poll();  </span><br><span class="line">        <span class="keyword">while</span>( poll != <span class="literal">null</span>) &#123;  </span><br><span class="line">            list.remove(poll);  </span><br><span class="line">            poll = queue.poll();  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">&quot;===========================&quot;</span>);  </span><br><span class="line">        <span class="keyword">for</span> (SoftReference&lt;<span class="type">byte</span>[]&gt; reference : list) &#123;  </span><br><span class="line">            System.out.println(reference.get());  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœï¼š</li><li>å››ä¸ªnullè¢«å›æ”¶</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[B@4554617c</span><br><span class="line">1</span><br><span class="line">[B@74a14482</span><br><span class="line">2</span><br><span class="line">[B@1540e19d</span><br><span class="line">3</span><br><span class="line">[B@677327b6</span><br><span class="line">4</span><br><span class="line">[B@14ae5a5</span><br><span class="line">5</span><br><span class="line">===========================</span><br><span class="line">[B@14ae5a5</span><br></pre></td></tr></table></figure><h4 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h4><ul><li>ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå¼±å¼•ç”¨  </span></span><br><span class="line"><span class="comment"> * -Xmx20m -XX:+PrintGCDetails -verbose:gc  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2_5</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_4MB</span> <span class="operator">=</span> <span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="comment">//  list --&gt; WeakReference --&gt; byte[]  </span></span><br><span class="line">        List&lt;WeakReference&lt;<span class="type">byte</span>[]&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;  </span><br><span class="line">            WeakReference&lt;<span class="type">byte</span>[]&gt; ref = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">byte</span>[_4MB]);  </span><br><span class="line">            list.add(ref);  </span><br><span class="line">            <span class="keyword">for</span> (WeakReference&lt;<span class="type">byte</span>[]&gt; w : list) &#123;  </span><br><span class="line">                System.out.print(w.get()+<span class="string">&quot; &quot;</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">            System.out.println();  </span><br><span class="line">  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.out.println(<span class="string">&quot;å¾ªç¯ç»“æŸï¼š&quot;</span> + list.size());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœï¼š</li><li><code>null [B@74a14482 [B@1540e19d [B@677327b6 null null null null null [B@330bedb4 </code> nullä¸ºå›æ”¶çš„æ•°ç»„å¯¹è±¡</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[B@<span class="number">4554617</span>c </span><br><span class="line">[B@<span class="number">4554617</span>c [B@<span class="number">74</span>a14482 </span><br><span class="line">[B@<span class="number">4554617</span>c [B@<span class="number">74</span>a14482 [B@<span class="number">1540e19</span>d </span><br><span class="line">[B@<span class="number">4554617</span>c [B@<span class="number">74</span>a14482 [B@<span class="number">1540e19</span>d [B@<span class="number">677327b</span>6 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">5678</span>K-&gt;<span class="number">528</span>K(<span class="number">7168</span>K)] <span class="number">17966</span>K-&gt;<span class="number">12824</span>K(<span class="number">23552</span>K), <span class="number">0.0006993</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">null [B@<span class="number">74</span>a14482 [B@<span class="number">1540e19</span>d [B@<span class="number">677327b</span>6 [B@<span class="number">14</span>ae5a5  <span class="comment">// ç¬¬äº”æ¬¡ æ”¾ä¸ä¸‹ å›æ”¶ç¬¬ä¸€ä¸ª</span></span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">4747</span>K-&gt;<span class="number">496</span>K(<span class="number">7168</span>K)] <span class="number">17043</span>K-&gt;<span class="number">12792</span>K(<span class="number">23552</span>K), <span class="number">0.0004962</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">null [B@<span class="number">74</span>a14482 [B@<span class="number">1540e19</span>d [B@<span class="number">677327b</span>6 null [B@<span class="number">7f</span>31245a </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">4776</span>K-&gt;<span class="number">448</span>K(<span class="number">7168</span>K)] <span class="number">17072</span>K-&gt;<span class="number">12744</span>K(<span class="number">23552</span>K), <span class="number">0.0005593</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">null [B@<span class="number">74</span>a14482 [B@<span class="number">1540e19</span>d [B@<span class="number">677327b</span>6 null null [B@<span class="number">6</span>d6f6e28 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">4705</span>K-&gt;<span class="number">432</span>K(<span class="number">7168</span>K)] <span class="number">17001</span>K-&gt;<span class="number">12728</span>K(<span class="number">23552</span>K), <span class="number">0.0004255</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">null [B@<span class="number">74</span>a14482 [B@<span class="number">1540e19</span>d [B@<span class="number">677327b</span>6 null null null [B@<span class="number">135f</span>baa4 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">4823</span>K-&gt;<span class="number">496</span>K(<span class="number">7168</span>K)] <span class="number">17119</span>K-&gt;<span class="number">12800</span>K(<span class="number">23552</span>K), <span class="number">0.0005512</span> secs] [Times: user=<span class="number">0.01</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">null [B@<span class="number">74</span>a14482 [B@<span class="number">1540e19</span>d [B@<span class="number">677327b</span>6 null null null null [B@<span class="number">45</span>ee12a7 </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: <span class="number">4727</span>K-&gt;<span class="number">512</span>K(<span class="number">7168</span>K)] <span class="number">17031</span>K-&gt;<span class="number">12816</span>K(<span class="number">23552</span>K), <span class="number">0.0003853</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">null [B@<span class="number">74</span>a14482 [B@<span class="number">1540e19</span>d [B@<span class="number">677327b</span>6 null null null null null [B@<span class="number">330b</span>edb4 </span><br><span class="line">å¾ªç¯ç»“æŸï¼š<span class="number">10</span></span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">7168</span>K, used <span class="number">4799</span>K [<span class="number">0x00000007bf800000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span>)</span><br><span class="line">  eden space <span class="number">6144</span>K, <span class="number">69</span>% used [<span class="number">0x00000007bf800000</span>,<span class="number">0x00000007bfc2fef0</span>,<span class="number">0x00000007bfe00000</span>)</span><br><span class="line">  from space <span class="number">1024</span>K, <span class="number">50</span>% used [<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007c0000000</span>)</span><br><span class="line">  to   space <span class="number">1024</span>K, <span class="number">0</span>% used [<span class="number">0x00000007bfe00000</span>,<span class="number">0x00000007bfe00000</span>,<span class="number">0x00000007bff00000</span>)</span><br><span class="line"> ParOldGen       total <span class="number">16384</span>K, used <span class="number">12304</span>K [<span class="number">0x00000007be800000</span>, <span class="number">0x00000007bf800000</span>, <span class="number">0x00000007bf800000</span>)</span><br><span class="line">  object space <span class="number">16384</span>K, <span class="number">75</span>% used [<span class="number">0x00000007be800000</span>,<span class="number">0x00000007bf404030</span>,<span class="number">0x00000007bf800000</span>)</span><br><span class="line"> Metaspace       used <span class="number">3363</span>K, capacity <span class="number">4564</span>K, committed <span class="number">4864</span>K, reserved <span class="number">1056768</span>K</span><br><span class="line">  class space    used <span class="number">361</span>K, capacity <span class="number">388</span>K, committed <span class="number">512</span>K, reserved <span class="number">1048576</span>K</span><br></pre></td></tr></table></figure><h2 id="2-åƒåœ¾å›æ”¶ç®—æ³•"><a href="#2-åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="2. åƒåœ¾å›æ”¶ç®—æ³•"></a>2. åƒåœ¾å›æ”¶ç®—æ³•</h2><h3 id="2-1-æ ‡è®°æ¸…é™¤æ³•"><a href="#2-1-æ ‡è®°æ¸…é™¤æ³•" class="headerlink" title="2.1 æ ‡è®°æ¸…é™¤æ³•"></a>2.1 æ ‡è®°æ¸…é™¤æ³•</h3><ul><li>å®šä¹‰ï¼š Mark Sweep </li><li>æ ‡è®°ï¼šæ²¡è¢« <code>GC Root</code>ç›´æ¥å¼•ç”¨çš„å¯¹è±¡æ ‡è®°ä¸ºåƒåœ¾ï¼ˆç°è‰²ï¼‰</li><li>ä¼˜ç¼ºç‚¹<ul><li>é€Ÿåº¦è¾ƒå¿« </li><li>ä¼šé€ æˆå†…å­˜ç¢ç‰‡<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027190915427.png" alt="|500"></li></ul></li></ul><h3 id="2-2-æ ‡è®°æ•´ç†"><a href="#2-2-æ ‡è®°æ•´ç†" class="headerlink" title="2.2 æ ‡è®°æ•´ç†"></a>2.2 æ ‡è®°æ•´ç†</h3><ul><li>å®šä¹‰ï¼šMark Compact </li><li>æ¸…é™¤ä¹‹å <code>ç´§å‡‘</code>æ“ä½œ ï¼ˆç±»ä¼¼OSï¼‰<ul><li>é€Ÿåº¦æ…¢ </li><li>æ²¡æœ‰å†…å­˜ç¢ç‰‡<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027191437401.png"></li></ul></li></ul><h3 id="2-3-å¤åˆ¶"><a href="#2-3-å¤åˆ¶" class="headerlink" title="2.3 å¤åˆ¶"></a>2.3 å¤åˆ¶</h3><ul><li><p>å®šä¹‰ï¼šCopy </p><ul><li>ä¸ä¼šæœ‰å†…å­˜ç¢ç‰‡ </li><li>éœ€è¦å ç”¨åŒå€å†…å­˜ç©ºé—´</li></ul></li><li><p>æ ‡è®°<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027191625910.png"></p></li><li><p>å¤åˆ¶ç§»åŠ¨<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027191639852.png"></p></li><li><p>å…¨éƒ¨æ¸…é™¤å·¦è¾¹<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027191701022.png"></p></li><li><p>äº¤æ¢<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027191713789.png"></p></li></ul><h3 id="2-4-æ€»ç»“"><a href="#2-4-æ€»ç»“" class="headerlink" title="2.4 æ€»ç»“"></a>2.4 æ€»ç»“</h3><ul><li>ä»¥ä¸Šä¸‰ç§éƒ½ä¼šç”¨åˆ°ï¼Œæ¥ä¸‹æ¥ä»‹ç»<code>åˆ†ä»£åƒåœ¾å›æ”¶æœºåˆ¶</code></li></ul><h2 id="3-åˆ†ä»£åƒåœ¾å›æ”¶"><a href="#3-åˆ†ä»£åƒåœ¾å›æ”¶" class="headerlink" title="3. åˆ†ä»£åƒåœ¾å›æ”¶"></a>3. åˆ†ä»£åƒåœ¾å›æ”¶</h2><ul><li><p>å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨ä¼Šç”¸å›­åŒºåŸŸ </p><ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027192436583.png"></li></ul></li><li><p>æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œè§¦å‘ <code>minor gc</code>ï¼Œä¼Šç”¸å›­å’Œ from <code>å­˜æ´»çš„å¯¹è±¡</code>ä½¿ç”¨ <code>copy å¤åˆ¶</code>åˆ° <code>å¹¸å­˜åŒºto</code> ä¸­ï¼Œå­˜æ´»çš„ å¯¹è±¡<code>å¹´é¾„åŠ  1</code>å¹¶ä¸”äº¤æ¢ <code>fromå’Œto</code> </p><ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027192931832.png"></li></ul></li><li><p>ç¬¬äºŒæ¬¡ <code>minor gc</code></p><ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027193427456.png"></li></ul></li><li><p>minor gc ä¼šå¼•å‘ <code>stop the world</code>ï¼Œæš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œ</p></li><li><p>å½“å¯¹è±¡å¯¿å‘½è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šæ™‹å‡è‡³è€å¹´ä»£ï¼Œæœ€å¤§å¯¿å‘½æ˜¯15ï¼ˆ4bitï¼‰ </p><ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027193545860.png"></li></ul></li><li><p>å½“è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼Œä¼šå…ˆå°è¯•è§¦å‘ <code>minor gc</code>ï¼Œå¦‚æœä¹‹åç©ºé—´ä»ä¸è¶³ï¼Œé‚£ä¹ˆè§¦å‘ <code>full gc</code>ï¼ŒSTWçš„æ—¶ é—´æ›´é•¿ã€</p><ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027193633172.png"></li></ul></li><li><p>ç†è§£</p><ul><li>æ–°ç”Ÿä»£ç±»ä¼¼æ—¥å¸¸åƒåœ¾ï¼Œæ¯ä¸ªå±…æ°‘æ”¾åœ¨åƒåœ¾æ¡¶</li><li>è€å¹´ä»£ç±»ä¼¼ç ´æ¤…å­ï¼Œç ´ç”µè§†ï¼Œå…ˆæš‚å­˜å®¶é‡Œï¼Œå®šæ—¶å¤§æ¸…ç†<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251027192436583.png"></li></ul></li></ul><h3 id="3-1-ç›¸å…³VMå‚æ•°"><a href="#3-1-ç›¸å…³VMå‚æ•°" class="headerlink" title="3.1 ç›¸å…³VMå‚æ•°"></a>3.1 ç›¸å…³VMå‚æ•°</h3><table><thead><tr><th>å«ä¹‰</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>å †åˆå§‹å¤§å°</td><td>-Xms</td></tr><tr><td>å †æœ€å¤§å¤§å°</td><td>-Xmx æˆ– -XX:MaxHeapSize&#x3D;size</td></tr><tr><td>æ–°ç”Ÿä»£å¤§å°</td><td>-Xmn æˆ– (-XX:NewSize&#x3D;size + -XX:MaxNewSize&#x3D;size )</td></tr><tr><td>å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰</td><td>-XX:InitialSurvivorRatio&#x3D;ratio å’Œ -XX:+UseAdaptiveSizePolicy</td></tr><tr><td>å¹¸å­˜åŒºæ¯”ä¾‹</td><td>-XX:SurvivorRatio&#x3D;ratio</td></tr><tr><td>æ™‹å‡é˜ˆå€¼</td><td>-XX:MaxTenuringThreshold&#x3D;threshold</td></tr><tr><td>æ™‹å‡è¯¦æƒ…</td><td>-XX:+PrintTenuringDistribution</td></tr><tr><td>GCè¯¦æƒ…</td><td>-XX:+PrintGCDetails -verbose:gc</td></tr><tr><td>FullGC å‰ MinorGC</td><td>-XX:+ScavengeBeforeFullGC</td></tr></tbody></table><h3 id="3-2-GCæ¼”ç¤º"><a href="#3-2-GCæ¼”ç¤º" class="headerlink" title="3.2 GCæ¼”ç¤º"></a>3.2 GCæ¼”ç¤º</h3><ul><li><p>æ–°ç”Ÿä»£ <code>-Xmn10M</code> 10mb</p></li><li><p>è€å¹´ä»£ï¼š <code>10mb</code></p></li><li><p>æ–°ç”Ÿä»£é»˜è®¤<code>1mb fromï¼› 1mb toï¼› eden 8mb</code></p></li><li><p>æ”¾å…¥7mbï¼Œè§¦å‘GC</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå†…å­˜çš„åˆ†é…ç­–ç•¥  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2_1</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_512KB</span> <span class="operator">=</span> <span class="number">512</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_6MB</span> <span class="operator">=</span> <span class="number">6</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_7MB</span> <span class="operator">=</span> <span class="number">7</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_8MB</span> <span class="operator">=</span> <span class="number">8</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// -Xms20M -Xmx20M -Xmn10M -XX:+UseSerialGC -XX:+PrintGCDetails -verbose:gc -XX:-ScavengeBeforeFullGC  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        ArrayList&lt;<span class="type">byte</span>[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_7MB]);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>minor GC é»˜è®¤å†™ <code>GC</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028123913072.png"></p></li><li><p><code>å¤§å¯¹è±¡å›æ”¶</code></p><ul><li>æ”¾å…¥8mbï¼Œæ–°ç”Ÿä»£æ”¾ä¸ä¸‹ï¼Œç›´æ¥æ™‹å‡è€å¹´ä»£</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå†…å­˜çš„åˆ†é…ç­–ç•¥  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2_1</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_512KB</span> <span class="operator">=</span> <span class="number">512</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_6MB</span> <span class="operator">=</span> <span class="number">6</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_7MB</span> <span class="operator">=</span> <span class="number">7</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_8MB</span> <span class="operator">=</span> <span class="number">8</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// -Xms20M -Xmx20M -Xmn10M -XX:+UseSerialGC -XX:+PrintGCDetails -verbose:gc -XX:-ScavengeBeforeFullGC  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        ArrayList&lt;<span class="type">byte</span>[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_8MB]);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028124426273.png"></p><ul><li><code>OOM</code> <ul><li>å­çº¿ç¨‹å†…å­˜æº¢å‡ºï¼Œä¸ä¼šå¯¼è‡´ä¸»çº¿ç¨‹ç»ˆæ­¢</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå†…å­˜çš„åˆ†é…ç­–ç•¥  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2_1</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_512KB</span> <span class="operator">=</span> <span class="number">512</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_6MB</span> <span class="operator">=</span> <span class="number">6</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_7MB</span> <span class="operator">=</span> <span class="number">7</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_8MB</span> <span class="operator">=</span> <span class="number">8</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// -Xms20M -Xmx20M -Xmn10M -XX:+UseSerialGC -XX:+PrintGCDetails -verbose:gc -XX:-ScavengeBeforeFullGC  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line"><span class="comment">//        ArrayList&lt;byte[]&gt; list = new ArrayList&lt;&gt;();  </span></span><br><span class="line"><span class="comment">//        list.add(new byte[_8MB]);  </span></span><br><span class="line"><span class="comment">//        list.add(new byte[_8MB]);  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ¼”ç¤º  </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;  </span><br><span class="line">            ArrayList&lt;<span class="type">byte</span>[]&gt; list = <span class="keyword">new</span>  <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_8MB]);  </span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_8MB]);  </span><br><span class="line">        &#125;).start();  </span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">&quot;sleep....&quot;</span>);  </span><br><span class="line">        Thread.sleep(<span class="number">100000000L</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028124931584.png"></p><h2 id="4-åƒåœ¾å›æ”¶å™¨"><a href="#4-åƒåœ¾å›æ”¶å™¨" class="headerlink" title="4. åƒåœ¾å›æ”¶å™¨"></a>4. åƒåœ¾å›æ”¶å™¨</h2><ul><li>ä¸²è¡Œ <ul><li>å•çº¿ç¨‹ </li><li>å †å†…å­˜è¾ƒå°ï¼Œé€‚åˆä¸ªäººç”µè„‘</li></ul></li><li>ååé‡ä¼˜å…ˆ <ul><li>å¤šçº¿ç¨‹ </li><li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸ cpu </li><li>è®©å•ä½æ—¶é—´å†…ï¼Œ<code>STW</code> çš„æ—¶é—´æœ€çŸ­ï¼ˆæ€»å…±æ—¶é—´æœ€çŸ­ï¼‰ <code>0.2+0.2 = 0.4</code>ï¼Œåƒåœ¾å›æ”¶æ—¶é—´å æ¯”æœ€ä½ï¼Œè¿™æ ·å°±ç§°ååé‡é«˜</li></ul></li><li>å“åº”æ—¶é—´ä¼˜å…ˆ <ul><li>å¤šçº¿ç¨‹ </li><li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸ cpu </li><li>å°½å¯èƒ½è®©å•æ¬¡ STW çš„æ—¶é—´æœ€çŸ­ ï¼ˆå•è¯æ—¶é—´æœ€çŸ­ï¼‰<code>0.1 0.1 0.1 0.1 0.1 = 0.5</code></li></ul></li></ul><h3 id="4-1-ä¸²è¡Œ"><a href="#4-1-ä¸²è¡Œ" class="headerlink" title="4.1 ä¸²è¡Œ"></a>4.1 ä¸²è¡Œ</h3><ul><li>ä½¿ç”¨ï¼š<code>-XX:+UseSerialGC = Serial + SerialOld</code><ul><li><code>Serial</code> ä½¿ç”¨å¤åˆ¶ç®—æ³•</li><li><code>SerialOld</code> è€å¹´ä»£</li></ul></li><li>å›æ”¶è¿‡ç¨‹<ul><li><code>cpu0 1 2 3</code> éƒ½åœ¨è¿è¡Œ</li><li>å‘ç”Ÿåƒåœ¾å›æ”¶æ—¶ï¼Œéƒ½åœ¨å®‰å…¨ç‚¹åœä¸‹æ¥</li><li>åƒåœ¾å›æ”¶çº¿ç¨‹è¿è¡Œï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡</li><li>å›æ”¶å å…¶ä»–çº¿ç¨‹è¿è¡Œ<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028134446146.png"></li></ul></li></ul><h3 id="4-2-ååé‡ä¼˜å…ˆ"><a href="#4-2-ååé‡ä¼˜å…ˆ" class="headerlink" title="4.2 ååé‡ä¼˜å…ˆ"></a>4.2 ååé‡ä¼˜å…ˆ</h3><ul><li><p><code>-XX:+UseParallelGC ~ -XX:+UseParallelOldGC</code> </p><ul><li>å¼€å¯ä¸€ä¸ªè‡ªåŠ¨å¼€å¯å¦ä¸€ä¸ª</li></ul></li><li><p><code>-XX:+UseAdaptiveSizePolicy</code>  </p><ul><li>é‡‡ç”¨è‡ªé€‚åº”å¤§å°ç­–ç•¥</li><li>æ–°ç”Ÿä»£å¤§å°ï¼š<code>Edenå’Œå¹¸å­˜åŒºï¼Œ æ™‹å‡é˜ˆå€¼</code></li></ul></li><li><p><code>-XX:GCTimeRatio=ratio</code> </p><ul><li>åƒåœ¾å›æ”¶æ—¶é—´å’Œæ€»æ—¶é—´å æ¯” ï¼ˆ1&#x2F;(1+ratio)ï¼‰</li></ul></li><li><p><code>-XX:MaxGCPauseMillis=ms</code> </p><ul><li>æœ€å¤§æš‚åœæ¯«ç§’æ•°</li><li>é»˜è®¤ <code>200ms</code></li><li>å’Œä¸Šä¸€ä¸ªé…ç½®çŸ›ç›¾ï¼ŒæŠ˜ä¸­</li></ul></li><li><p><code>-XX:ParallelGCThreads=n</code> </p><ul><li>æ§åˆ¶çº¿ç¨‹æ•°</li></ul></li><li><p>ä¸åŒç‚¹ï¼š</p><ul><li>å®‰å…¨ç‚¹åï¼šå¼€å¯å¤šä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028135258885.png"></li></ul></li></ul><h3 id="4-3-å“åº”æ—¶é—´ä¼˜å…ˆ"><a href="#4-3-å“åº”æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="4.3 å“åº”æ—¶é—´ä¼˜å…ˆ"></a>4.3 å“åº”æ—¶é—´ä¼˜å…ˆ</h3><ul><li><code>-XX:+UseConcMarkSweepGC ~ -XX:+UseParNewGC ~ SerialOld</code><ul><li>è§£é‡Šï¼šconcurrentï¼ˆå¹¶å‘çš„ï¼‰ markï¼ˆæ ‡è®°ï¼‰sweepï¼ˆæ¸…é™¤ï¼‰</li><li><strong>CMSï¼ˆConcurrent Mark-Sweepï¼‰</strong> å¹¶å‘æ ‡è®°æ¸…é™¤å›æ”¶æœºåˆ¶ </li><li>ï¼ˆåŒºåˆ«å¹¶å‘ä¸å¹¶è¡Œï¼‰å¹¶å‘ï¼šäº¤æ›¿è¿›è¡Œï¼›å¹¶è¡Œï¼šåŒæ—¶å‘ç”Ÿ</li><li><code>UseConcMarkSweepGC</code>ï¼šå·¥ä½œåœ¨è€å¹´ä»£</li><li><code>UseParNewGC</code>ï¼šå·¥ä½œåœ¨æ–°ç”Ÿä»£</li><li>æ–°è€æœ‰ç¢ç‰‡ï¼Œå†…å­˜éƒ½ä¸è¶³æ—¶ï¼Œé€€åŒ–ä¸º <code>SerialOld</code> åšä¸²è¡Œå›æ”¶</li></ul></li><li><code>-XX:ParallelGCThreads=n ~ -XX:ConcGCThreads=threads</code><ul><li>è®¾ç½®å¹¶å‘æ•°ï¼šä¸€èˆ¬æ˜¯å 1&#x2F;4</li></ul></li><li><code>-XX:CMSInitiatingOccupancyFraction=percent</code><ul><li>cmsæ‰§è¡Œåƒåœ¾å›æ”¶æ—¶çš„å æ¯”</li><li>percentç™¾åˆ†æ¯”è¶Šå°ï¼Œæ‰§è¡Œè¶Šæ—©</li><li>æ—©æœŸcms 65%å·¦å³</li></ul></li><li><code>-XX:+CMSScavengeBeforeRemark</code><ul><li>é‡æ–°æ ‡è®°ï¼šæ–°ç”Ÿä»£å¯èƒ½ç”¨åˆ°è€å¹´ä»£ï¼Œéœ€è¦é‡æ–°æ‰«æä¸€é<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028140455810.png" alt="|1550"></li></ul></li></ul><h3 id="4-1-G1-ï¼ˆé‡ç‚¹ï¼‰"><a href="#4-1-G1-ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="4.1 G1 ï¼ˆé‡ç‚¹ï¼‰"></a>4.1 G1 ï¼ˆé‡ç‚¹ï¼‰</h3><p>å®šä¹‰ï¼šGarbage First </p><ul><li><p>2004 è®ºæ–‡å‘å¸ƒ </p></li><li><p>2009 JDK 6u14 ä½“éªŒ </p></li><li><p>2012 JDK 7u4 å®˜æ–¹æ”¯æŒ </p></li><li><p>2017 JDK 9 é»˜è®¤</p></li><li><p>é€‚ç”¨åœºæ™¯ </p><ul><li>åŒæ—¶æ³¨é‡ååé‡ï¼ˆ<code>Throughput</code>ï¼‰å’Œä½å»¶è¿Ÿï¼ˆ<code>Low latency</code>ï¼‰ï¼Œé»˜è®¤çš„æš‚åœç›®æ ‡æ˜¯ 200 ms </li><li>é€‚ç”¨è¶…å¤§å †å†…å­˜ï¼Œä¼šå°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ <code>Region</code> </li><li>æ•´ä½“ä¸Šæ˜¯ <code>æ ‡è®°+æ•´ç†</code> ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸï¼ˆRegionï¼‰ä¹‹é—´æ˜¯ <code>å¤åˆ¶</code> ç®—æ³•<br><strong>ç›¸å…³ JVM å‚æ•°</strong>ï¼š</li></ul></li><li><p><code>-XX:+UseG1GC</code> </p><ul><li>JDK8 ä¸é»˜è®¤ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯</li><li>JDK9 åŠä»¥åè‡ªåŠ¨å¼€å¯</li></ul></li><li><p><code>-XX:G1HeapRegionSize=size</code> </p><ul><li>è®¾ç½®åŒºåŸŸå¤§å° ï¼ˆ1 2 4 8 16ï¼‰</li></ul></li><li><p><code>-XX:MaxGCPauseMillis=time</code></p></li></ul><h4 id="1ï¼‰G1åƒåœ¾å›æ”¶é˜¶æ®µ"><a href="#1ï¼‰G1åƒåœ¾å›æ”¶é˜¶æ®µ" class="headerlink" title="1ï¼‰G1åƒåœ¾å›æ”¶é˜¶æ®µ"></a>1ï¼‰G1åƒåœ¾å›æ”¶é˜¶æ®µ</h4><ul><li>æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†</li><li>æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†+å¹¶å‘æ ‡è®°</li><li>æ··åˆæ”¶é›†</li><li><strong>å°†å†…å­˜åˆ†ä¸ºå¾ˆå¤šåŒºåŸŸï¼š<code>Region</code>ï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä½œä¸º<code>eden å¹¸å­˜åŒº è€å¹´ä»£</code></strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028143900767.png"></li></ul><h4 id="2ï¼‰Young-Collectionï¼ˆæ–°ç”Ÿä»£å›æ”¶ï¼‰"><a href="#2ï¼‰Young-Collectionï¼ˆæ–°ç”Ÿä»£å›æ”¶ï¼‰" class="headerlink" title="2ï¼‰Young Collectionï¼ˆæ–°ç”Ÿä»£å›æ”¶ï¼‰"></a>2ï¼‰Young Collectionï¼ˆæ–°ç”Ÿä»£å›æ”¶ï¼‰</h4><ul><li>ä¼š STW </li><li>æ­¤æ—¶å…¶ä»–çº¿ç¨‹é˜»å¡ï¼Œåªæœ‰åƒåœ¾å›æ”¶çº¿ç¨‹è¿è¡Œ</li><li>Eï¼šeden ä¼Šç”¸å›­<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028144310384.png" alt="|475"></li><li>æ–°ç”ŸåŒºï¼šedenå¤åˆ¶copyåˆ° Sï¼ˆå¹¸å­˜åŒºServivalï¼‰<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028144443202.png"></li><li>å¹¸å­˜åŒºæ™‹å‡åˆ°è€å¹´ä»£ï¼ˆOï¼‰<ul><li>éƒ¨åˆ†å¯å¤åˆ¶åˆ°æ–°çš„å¹¸å­˜åŒº<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028144509041.png"></li></ul></li></ul><h4 id="3ï¼‰Young-Collection-CMï¼ˆå¹¶å‘æ ‡è®°ï¼‰"><a href="#3ï¼‰Young-Collection-CMï¼ˆå¹¶å‘æ ‡è®°ï¼‰" class="headerlink" title="3ï¼‰Young Collection + CMï¼ˆå¹¶å‘æ ‡è®°ï¼‰"></a>3ï¼‰Young Collection + CMï¼ˆå¹¶å‘æ ‡è®°ï¼‰</h4><ul><li>åœ¨ Young GC æ—¶ä¼šè¿›è¡Œ GC Root çš„åˆå§‹æ ‡è®° </li><li>è€å¹´ä»£å ç”¨å †ç©ºé—´æ¯”ä¾‹è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè¿›è¡Œ<code>å¹¶å‘æ ‡è®°CM</code>ï¼ˆä¸ä¼š STWï¼‰ï¼Œç”±ä¸‹é¢çš„ JVM å‚æ•°å†³å®š </li><li><code>-XX:InitiatingHeapOccupancyPercent=percent </code> ï¼ˆé»˜è®¤45%ï¼‰<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028145043631.png" alt="|575"></li></ul><h4 id="4ï¼‰Mixed-Collection"><a href="#4ï¼‰Mixed-Collection" class="headerlink" title="4ï¼‰Mixed Collection"></a>4ï¼‰Mixed Collection</h4><p>ä¼šå¯¹ Eã€Sã€O è¿›è¡Œå…¨é¢åƒåœ¾å›æ”¶</p><ul><li><p>æœ€ç»ˆæ ‡è®°ï¼ˆRemarkï¼‰ä¼š STW </p></li><li><p>æ‹·è´å­˜æ´»ï¼ˆEvacuationï¼‰ä¼š STW</p></li><li><p><code>-XX:MaxGCPauseMillis=ms </code></p></li><li><p>éƒ¨åˆ†è€å¹´ä»£ä¼šå›æ”¶åˆ° <code>æ–°çš„è€å¹´ä»£åŒºåŸŸ</code></p><ul><li>æ ¹æ®æš‚åœæ—¶é—´</li><li>å›æ”¶æœ€å¤šçš„ è€å¹´ä»£ <code>copyç®—æ³•</code></li></ul></li><li><p>æ–°ç”Ÿä»£æœªè¾¾åˆ°é˜ˆå€¼æ”¾å…¥ <code>æ–°çš„æ–°ç”Ÿä»£</code></p><ul><li>è¾¾åˆ°é˜ˆå€¼çš„æ”¾å…¥ <code>è€å¹´ä»£</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028145205154.png" alt="|550"></li></ul></li></ul><h4 id="5ï¼‰-Full-GC"><a href="#5ï¼‰-Full-GC" class="headerlink" title="5ï¼‰ Full GC"></a>5ï¼‰ Full GC</h4><ul><li>SerialGC <ul><li>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc </li><li>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - full gc</li></ul></li><li>ParallelGC <ul><li>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc </li><li>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - full gc</li></ul></li><li>CMS <ul><li>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc </li><li>è€å¹´ä»£å†…å­˜ä¸è¶³</li></ul></li><li>G1 <ul><li>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc </li><li>è€å¹´ä»£å†…å­˜ä¸è¶³<ul><li>CM + æ··åˆ</li><li>å›æ”¶é€Ÿåº¦è·Ÿä¸ä¸Šï¼šfull gc</li></ul></li></ul></li></ul><h4 id="6-Young-Collection-è·¨ä»£å¼•ç”¨"><a href="#6-Young-Collection-è·¨ä»£å¼•ç”¨" class="headerlink" title="6) Young Collection è·¨ä»£å¼•ç”¨"></a>6) Young Collection è·¨ä»£å¼•ç”¨</h4><ul><li><p>æ–°ç”Ÿä»£å›æ”¶çš„è·¨ä»£å¼•ç”¨ï¼ˆè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£ï¼‰é—®é¢˜</p></li><li><p>å¯¹è€å¹´ä»£åˆ’åˆ†ä¸ºå¤šä¸ª <code>512kb</code>å¡</p><ul><li>å¼±å¼•ç”¨äº†edenï¼Œ åˆ™æ ‡è®°ä¸º <code>è„å¡</code></li><li>æ¯æ¬¡GC Rootæ‰«æåˆ™åªç®¡è„å¡<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028172143936.png" alt="|625"></li></ul></li><li><p>å¡è¡¨ä¸ <code>Remembered Set</code></p><ul><li>æ–°ç”Ÿä»£æœ‰ <code>Remembered Set</code>ï¼Œè®°å½•å“ªäº›å¼•ç”¨äº†è‡ªå·±</li></ul></li><li><p>åœ¨å¼•ç”¨å˜æ›´æ—¶é€šè¿‡ <code>post-write barrier</code> + <code>dirty card queue</code> </p><ul><li>å¼€çº¿ç¨‹å¼‚æ­¥æ›´æ”¹å¡è¡¨</li></ul></li><li><p><code>concurrent refinement threads</code> æ›´æ–° <code>Remembered Set</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028172229083.png" alt="|650"></p></li></ul><h4 id="7-Remarkï¼ˆé‡æ–°æ ‡è®°ï¼‰"><a href="#7-Remarkï¼ˆé‡æ–°æ ‡è®°ï¼‰" class="headerlink" title="7) Remarkï¼ˆé‡æ–°æ ‡è®°ï¼‰"></a>7) Remarkï¼ˆé‡æ–°æ ‡è®°ï¼‰</h4><ul><li><p><code>pre-write barrier + satb_mark_queue</code>  å†™å±éšœ+é˜Ÿåˆ—</p><ul><li>é»‘è‰²ï¼šå¤„ç†å®Œ ï¼ˆä¸æ˜¯åƒåœ¾ï¼‰</li><li>ç°è‰²ï¼šå¤„ç†ä¸­</li><li>ç™½è‰²ï¼šæ²¡å¤„ç† ï¼ˆåƒåœ¾ï¼‰<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028180834008.png"></li></ul></li><li><p>remark<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028180949895.png" alt="|350"></p></li><li><p>åŠ å…¥é˜Ÿåˆ—<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028181145750.png" alt="|500"></p></li></ul><h4 id="8-JDK-8u20-å­—ç¬¦ä¸²å»é‡"><a href="#8-JDK-8u20-å­—ç¬¦ä¸²å»é‡" class="headerlink" title="8) JDK 8u20 å­—ç¬¦ä¸²å»é‡"></a>8) JDK 8u20 å­—ç¬¦ä¸²å»é‡</h4><ul><li>ä¼˜ç‚¹ï¼šèŠ‚çœå¤§é‡å†…å­˜ </li><li>ç¼ºç‚¹ï¼šç•¥å¾®å¤šå ç”¨äº† cpu æ—¶é—´ï¼Œæ–°ç”Ÿä»£å›æ”¶æ—¶é—´ç•¥å¾®å¢åŠ </li><li><code>-XX:+UseStringDeduplicatio</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>); <span class="comment">// char[&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125; </span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>); <span class="comment">// char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125; </span></span><br></pre></td></tr></table></figure><ul><li>å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ— </li><li>å½“æ–°ç”Ÿä»£å›æ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰å­—ç¬¦ä¸²é‡å¤ </li><li>å¦‚æœå®ƒä»¬å€¼ä¸€æ ·ï¼Œè®©å®ƒä»¬å¼•ç”¨åŒä¸€ä¸ª char[]</li><li>æ³¨æ„ï¼Œä¸ <code>String.intern()</code> ä¸ä¸€æ ·<ul><li><code>String.intern()</code> å…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡</li><li>è€Œå­—ç¬¦ä¸²å»é‡å…³æ³¨çš„æ˜¯ char[]</li><li>åœ¨JVM å†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²è¡¨</li></ul></li></ul><h4 id="9-JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½"><a href="#9-JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½" class="headerlink" title="9) JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½"></a>9) JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½</h4><ul><li>æ‰€æœ‰å¯¹è±¡éƒ½ç»è¿‡å¹¶å‘æ ‡è®°åï¼Œå°±èƒ½çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸å†ä½¿ç”¨ï¼Œåˆ™å¸ è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±»</li><li><code>-XX:+ClassUnloadingWithConcurrentMark</code> é»˜è®¤å¯ç”¨</li></ul><h4 id="10-JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡"><a href="#10-JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡" class="headerlink" title="10) JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡"></a>10) JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡</h4><ul><li>ä¸€ä¸ªå¯¹è±¡å¤§äº region çš„ä¸€åŠæ—¶ï¼Œç§°ä¹‹ä¸ºå·¨å‹å¯¹è±¡ </li><li>G1 ä¸ä¼šå¯¹å·¨å‹å¯¹è±¡è¿›è¡Œæ‹·è´</li><li>å›æ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘ </li><li>G1 ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰ <code>incoming</code> å¼•ç”¨ï¼Œè¿™æ ·è€å¹´ä»£ <code>incoming</code> å¼•ç”¨ä¸º0 çš„å·¨å‹å¯¹è±¡å°±å¯ä»¥åœ¨æ–°ç”Ÿ ä»£åƒåœ¾å›æ”¶æ—¶å¤„ç†æ‰<ul><li>ç†è§£ï¼šå…¥åº¦ä¸º0æ—¶å›æ”¶<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251028230520578.png"></li></ul></li></ul><h4 id="11-JDK-9-å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´"><a href="#11-JDK-9-å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´" class="headerlink" title="11) JDK 9 å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´"></a>11) JDK 9 å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´</h4><ul><li>å¹¶å‘æ ‡è®°å¿…é¡»åœ¨å †ç©ºé—´å æ»¡å‰å®Œæˆï¼Œå¦åˆ™é€€åŒ–ä¸º FullGC </li><li>JDK 9 ä¹‹å‰éœ€è¦ä½¿ç”¨ <code>-XX:InitiatingHeapOccupancyPercent</code> </li><li>JDK 9 å¯ä»¥åŠ¨æ€è°ƒæ•´<ul><li><code>-XX:InitiatingHeapOccupancyPercent</code> ç”¨æ¥è®¾ç½®åˆå§‹å€¼</li><li>è¿›è¡Œæ•°æ®é‡‡æ ·å¹¶åŠ¨æ€è°ƒæ•´ </li><li>æ€»ä¼šæ·»åŠ ä¸€ä¸ªå®‰å…¨çš„ç©ºæ¡£ç©ºé—´</li></ul></li></ul><h4 id="12-JDK-9-æ›´é«˜æ•ˆçš„å›æ”¶"><a href="#12-JDK-9-æ›´é«˜æ•ˆçš„å›æ”¶" class="headerlink" title="12) JDK 9 æ›´é«˜æ•ˆçš„å›æ”¶"></a>12) JDK 9 æ›´é«˜æ•ˆçš„å›æ”¶</h4><ul><li>250+å¢å¼º </li><li>180+bugä¿®å¤</li><li><a href="https://docs.oracle.com/en/java/javase/12/gctuning/">https://docs.oracle.com/en/java/javase/12/gctuning/</a></li></ul><h2 id="5-åƒåœ¾å›æ”¶è°ƒä¼˜"><a href="#5-åƒåœ¾å›æ”¶è°ƒä¼˜" class="headerlink" title="5. åƒåœ¾å›æ”¶è°ƒä¼˜"></a>5. åƒåœ¾å›æ”¶è°ƒä¼˜</h2><ul><li>é¢„å¤‡çŸ¥è¯† <ul><li>æŒæ¡ GC ç›¸å…³çš„ VM å‚æ•°ï¼Œä¼šåŸºæœ¬çš„ç©ºé—´è°ƒæ•´ </li><li>æŒæ¡ç›¸å…³å·¥å…· </li><li>æ˜ç™½ä¸€ç‚¹ï¼šè°ƒä¼˜è·Ÿåº”ç”¨ã€ç¯å¢ƒæœ‰å…³ï¼Œæ²¡æœ‰æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„æ³•åˆ™</li></ul></li></ul><h3 id="5-1-è°ƒä¼˜é¢†åŸŸ"><a href="#5-1-è°ƒä¼˜é¢†åŸŸ" class="headerlink" title="5.1 è°ƒä¼˜é¢†åŸŸ"></a>5.1 è°ƒä¼˜é¢†åŸŸ</h3><ul><li>å†…å­˜ </li><li>é”ç«äº‰ </li><li>cpu </li><li>å ç”¨ io</li></ul><h3 id="5-2-ç¡®å®šç›®æ ‡"><a href="#5-2-ç¡®å®šç›®æ ‡" class="headerlink" title="5.2 ç¡®å®šç›®æ ‡"></a>5.2 ç¡®å®šç›®æ ‡</h3><ul><li>ã€ä½å»¶è¿Ÿã€‘è¿˜æ˜¯ã€é«˜ååé‡ã€‘ï¼Œé€‰æ‹©åˆé€‚çš„å›æ”¶å™¨ </li><li>CMSï¼ŒG1ï¼ŒZGC ï¼ˆä½å»¶è¿Ÿï¼‰</li><li>ParallelGC ï¼ˆé«˜ååï¼‰</li><li>Zing</li></ul><h3 id="5-3-æœ€å¿«çš„-GCæ˜¯ä¸å‘ç”Ÿ-GC"><a href="#5-3-æœ€å¿«çš„-GCæ˜¯ä¸å‘ç”Ÿ-GC" class="headerlink" title="5.3 æœ€å¿«çš„ GCæ˜¯ä¸å‘ç”Ÿ GC"></a>5.3 æœ€å¿«çš„ GCæ˜¯ä¸å‘ç”Ÿ GC</h3><ul><li>æŸ¥çœ‹ FullGC å‰åçš„å†…å­˜å ç”¨ï¼Œè€ƒè™‘ä¸‹é¢å‡ ä¸ªé—®é¢˜<ul><li>æ•°æ®æ˜¯ä¸æ˜¯å¤ªå¤šï¼Ÿ<ul><li>resultSet &#x3D; statement.executeQuery(â€œselect * from å¤§è¡¨ limit nâ€)</li><li><code>select * from å¤§è¡¨</code> åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜</li></ul></li><li>æ•°æ®è¡¨ç¤ºæ˜¯å¦å¤ªè‡ƒè‚¿ï¼Ÿ <ul><li>å¯¹è±¡å›¾ </li><li>å¯¹è±¡å¤§å° 16ï¼› Integer 24ï¼› int 4</li></ul></li><li>æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼Ÿ <ul><li>static Map map &#x3D; </li><li>è½¯ </li><li>å¼± </li><li>ç¬¬ä¸‰æ–¹ç¼“å­˜å®ç°</li></ul></li></ul></li></ul><h3 id="5-4-æ–°ç”Ÿä»£è°ƒä¼˜"><a href="#5-4-æ–°ç”Ÿä»£è°ƒä¼˜" class="headerlink" title="5.4 æ–°ç”Ÿä»£è°ƒä¼˜"></a>5.4 æ–°ç”Ÿä»£è°ƒä¼˜</h3><ul><li><p>æ–°ç”Ÿä»£çš„ç‰¹ç‚¹</p><ul><li>æ‰€æœ‰çš„ new æ“ä½œçš„å†…å­˜åˆ†é…éå¸¸å»‰ä»· <ul><li>TLAB <code>thread-local allocation buffer</code> çº¿ç¨‹å±€éƒ¨çš„</li></ul></li><li>æ­»äº¡å¯¹è±¡çš„å›æ”¶ä»£ä»·æ˜¯é›¶ ï¼ˆæ­»äº¡å¯¹è±¡å†…å­˜ä¸º0ï¼Œ <code>å¤åˆ¶ç®—æ³•</code>ä»£ä»·0ï¼‰</li><li>å¤§éƒ¨åˆ†å¯¹è±¡ç”¨è¿‡å³æ­» </li><li>Minor GC çš„æ—¶é—´è¿œè¿œä½äº Full GC</li></ul></li><li><p>è¶Šå¤§è¶Šå¥½å—ï¼Ÿ<br>-Xmn </p></li><li><p>Sets the initial and maximum size (in bytes) of the heap for the young generation (nursery). GC is performed in this region more often than in other regions. If the size for the young generation is too small, then a lot of minor garbage collections are performed. If the size is too large, then only full garbage collections are performed, which can take a long time to complete. Oracle recommends that you keep the size for the young generation greater than 25% and less than 50% of the overall heap size</p></li><li><p>è®¾ç½®å¹´è½»ä»£ï¼ˆ nurseryï¼‰çš„åˆå§‹å’Œæœ€å¤§å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚åƒåœ¾å›æ”¶åœ¨è¿™ä¸ªåŒºåŸŸæ¯”åœ¨å…¶ä»–åŒºåŸŸè¿›è¡Œå¾—æ›´é¢‘ç¹ã€‚å¦‚æœå¹´è½»ä»£çš„å¤§å°å¤ªå°ï¼Œå°±ä¼šè¿›è¡Œå¾ˆå¤šæ¬¡ Minor GCã€‚å¦‚æœå¤§å°å¤ªå¤§ï¼Œå°±åªä¼šè¿›è¡Œ Full GCï¼Œè¿™å¯èƒ½ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´å®Œæˆã€‚Oracle å»ºè®®å¹´<code>è½»ä»£çš„å¤§å°ä¿æŒåœ¨æ€»å †å¤§å°çš„ 25% åˆ° 50% ä¹‹é—´ã€‚</code></p></li><li><p>æ–°ç”Ÿä»£èƒ½å®¹çº³æ‰€æœ‰<code>ã€å¹¶å‘é‡ * (è¯·æ±‚-å“åº”)ã€‘</code>çš„æ•°æ® </p></li><li><p>å¹¸å­˜åŒºå¤§åˆ°èƒ½ä¿ç•™<code>ã€å½“å‰æ´»è·ƒå¯¹è±¡+éœ€è¦æ™‹å‡å¯¹è±¡ã€‘</code> </p></li><li><p>æ™‹å‡é˜ˆå€¼é…ç½®å¾—å½“ï¼Œè®©é•¿æ—¶é—´å­˜æ´»å¯¹è±¡å°½å¿«æ™‹å‡</p></li><li><p><code>-XX:MaxTenuringThreshold=threshold</code> æ™‹å‡é˜ˆå€¼</p></li><li><p><code>-XX:+PrintTenuringDistribution</code></p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Desired survivor size 48286924 bytes, new threshold 10 (max 10) </span><br><span class="line">- age 1: 28992024 bytes, 28992024 total </span><br><span class="line">- age 2: 1366864 bytes, 30358888 total </span><br><span class="line">- age 3: 1425912 bytes, 31784800 total </span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="5-5-è€å¹´ä»£è°ƒä¼˜"><a href="#5-5-è€å¹´ä»£è°ƒä¼˜" class="headerlink" title="5.5 è€å¹´ä»£è°ƒä¼˜"></a>5.5 è€å¹´ä»£è°ƒä¼˜</h3><p>ä»¥ CMS ä¸ºä¾‹</p><ul><li><strong>CMS çš„è€å¹´ä»£å†…å­˜è¶Šå¤§è¶Šå¥½</strong> </li><li>å…ˆå°è¯•ä¸åšè°ƒä¼˜ï¼Œå¦‚æœæ²¡æœ‰ Full GC é‚£ä¹ˆå·²ç»â€¦ï¼Œå¦åˆ™å…ˆå°è¯•è°ƒä¼˜æ–°ç”Ÿä»£ </li><li>è§‚å¯Ÿå‘ç”Ÿ Full GC æ—¶è€å¹´ä»£å†…å­˜å ç”¨ï¼Œå°†è€å¹´ä»£å†…å­˜é¢„è®¾è°ƒå¤§ 1&#x2F;4 ~ 1&#x2F;3<ul><li><code>-XX:CMSInitiatingOccupancyFraction=percent</code> </li><li>è€å¹´ä»£å æ¯”percentæ—¶å‘ç”Ÿå›æ”¶</li></ul></li></ul><h3 id="5-6-æ¡ˆä¾‹"><a href="#5-6-æ¡ˆä¾‹" class="headerlink" title="5.6 æ¡ˆä¾‹"></a>5.6 æ¡ˆä¾‹</h3><ul><li><strong>æ¡ˆä¾‹1ï¼š Full GC å’Œ Minor GCé¢‘ç¹</strong><ul><li>é€‚å½“å¢å¤§æ–°ç”Ÿä»£</li><li>å¢å¤§æ™‹å‡é˜ˆå€¼</li></ul></li><li>æ¡ˆä¾‹2 è¯·æ±‚é«˜å³°æœŸå‘ç”Ÿ Full GCï¼Œå•æ¬¡æš‚åœæ—¶é—´ç‰¹åˆ«é•¿ ï¼ˆCMSï¼‰<ul><li>æŸ¥çœ‹GCæ—¥å¿—</li><li>æŸ¥çœ‹å“ªä¸ªé˜¶æ®µæ—¶é—´é•¿ï¼ˆåˆå§‹æ ‡è®°ï¼Œå¹¶å‘æ ‡è®°ï¼Œé‡æ–°æ ‡è®°ï¼Œå¹¶å‘æ¸…ç†ï¼‰</li><li>ä¸€èˆ¬æ˜¯é‡æ–°æ ‡è®°æ—¶é—´é•¿</li><li>ä½¿ç”¨ <code>-XX:+CMSScavengeBeforeRemark</code> é‡æ–°æ ‡è®°å‰æ¸…ç†æ–°ç”Ÿä»£</li></ul></li><li>æ¡ˆä¾‹3 è€å¹´ä»£å……è£•æƒ…å†µä¸‹ï¼Œå‘ç”Ÿ Full GC ï¼ˆCMS jdk1.7ï¼‰</li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM-å†…å­˜ç»“æ„</title>
      <link href="//post/java%E5%AD%A6%E4%B9%A0/jvm/1JVM-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html"/>
      <url>//post/java%E5%AD%A6%E4%B9%A0/jvm/1JVM-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><h2 id="ä»€ä¹ˆæ˜¯JVM"><a href="#ä»€ä¹ˆæ˜¯JVM" class="headerlink" title="ä»€ä¹ˆæ˜¯JVM"></a>ä»€ä¹ˆæ˜¯JVM</h2><ul><li>å®šä¹‰ï¼š <ul><li>Java Virtual Machine - java ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼ˆjava äºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼‰</li></ul></li><li>å¥½å¤„ï¼š <ul><li>ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ </li><li>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å›æ”¶åŠŸèƒ½ </li><li>æ•°ç»„ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥ å¤šæ€ æ¯”è¾ƒï¼š jvm jre jdk</li><li>å¤šæ€</li></ul></li><li>æ¯”è¾ƒï¼š <code>jvm jre jdk</code><ul><li>åŸºç¡€ç±»åº“ï¼š <code>IO Listç­‰</code></li><li>ç¼–è¯‘å·¥å…·ï¼š<code>javac å†…å­˜ç›‘æµ‹å·¥å…·</code></li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021173908743.png"></li></ul></li></ul><h2 id="å­¦jvmæœ‰ä»€ä¹ˆç”¨"><a href="#å­¦jvmæœ‰ä»€ä¹ˆç”¨" class="headerlink" title="å­¦jvmæœ‰ä»€ä¹ˆç”¨"></a>å­¦jvmæœ‰ä»€ä¹ˆç”¨</h2><ul><li>é¢è¯• </li><li>ç†è§£åº•å±‚çš„å®ç°åŸç† </li><li>ä¸­é«˜çº§ç¨‹åºå‘˜çš„å¿…å¤‡æŠ€èƒ½</li></ul><h2 id="å¸¸è§çš„JVM"><a href="#å¸¸è§çš„JVM" class="headerlink" title="å¸¸è§çš„JVM"></a>å¸¸è§çš„JVM</h2><ul><li>jVMæ˜¯ä¸€ç§è§„èŒƒ</li><li>å®ç°å¾ˆå¤š</li><li><strong>æœ¬è¯¾ç¨‹è®²hotspot</strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021174226097.png"></li></ul><h2 id="å­¦ä¹ è·¯çº¿"><a href="#å­¦ä¹ è·¯çº¿" class="headerlink" title="å­¦ä¹ è·¯çº¿"></a>å­¦ä¹ è·¯çº¿</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175134533.png"></p><h1 id="ä¸€ã€å†…å­˜ç»“æ„"><a href="#ä¸€ã€å†…å­˜ç»“æ„" class="headerlink" title="ä¸€ã€å†…å­˜ç»“æ„"></a>ä¸€ã€å†…å­˜ç»“æ„</h1><h2 id="1-ç¨‹åºè®¡æ•°å™¨"><a href="#1-ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1. ç¨‹åºè®¡æ•°å™¨"></a>1. ç¨‹åºè®¡æ•°å™¨</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021175539978.png" alt="|600"></p><h3 id="1-1-å®šä¹‰"><a href="#1-1-å®šä¹‰" class="headerlink" title="1.1 å®šä¹‰"></a>1.1 å®šä¹‰</h3><p><strong>Program Counter Register ç¨‹åºè®¡æ•°å™¨ï¼ˆå¯„å­˜å™¨ï¼‰</strong></p><ul><li>ä½œç”¨<ul><li>æ˜¯è®°ä½<code>ä¸‹ä¸€æ¡jvmæŒ‡ä»¤çš„æ‰§è¡Œåœ°å€</code></li></ul></li><li>ç‰¹ç‚¹ <ul><li>æ˜¯çº¿ç¨‹ç§æœ‰çš„ ï¼ˆæ¯ä¸ªçº¿ç¨‹æœ‰å±äºè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼‰</li><li>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º <code>å”¯ä¸€ä¸€ä¸ªä¸ä¼šå†…å­˜æº¢å‡ºçš„åœ°æ–¹</code></li></ul></li></ul><h3 id="1-2-ä½œç”¨"><a href="#1-2-ä½œç”¨" class="headerlink" title="1.2 ä½œç”¨"></a>1.2 ä½œç”¨</h3><ul><li>é€šè¿‡å¯„å­˜å™¨ï¼ˆCPUç»„ä»¶ï¼‰å®ç°javaç¨‹åºè®¡æ•°å™¨<ul><li>å±è”½ç‰©ç†ç¡¬ä»¶<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021180457610.png"></li></ul></li></ul><h2 id="2-è™šæ‹Ÿæœºæ ˆ"><a href="#2-è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2.è™šæ‹Ÿæœºæ ˆ"></a>2.è™šæ‹Ÿæœºæ ˆ</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022115520708.png"></p><h3 id="2-1-å®šä¹‰"><a href="#2-1-å®šä¹‰" class="headerlink" title="2.1 å®šä¹‰"></a>2.1 å®šä¹‰</h3><ul><li><code>Java Virtual Machine Stacks ï¼ˆJava è™šæ‹Ÿæœºæ ˆï¼‰</code></li><li>æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æ‰€éœ€è¦çš„å†…å­˜ï¼Œç§°ä¸ºè™šæ‹Ÿæœºæ ˆ </li><li>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜ </li><li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</li><li>é—®é¢˜è¾¨æï¼š<ol><li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ <code>ä¸æ¶‰åŠï¼Œæ ˆå†…å­˜è‡ªåŠ¨é‡Šæ”¾</code></li><li>æ ˆå†…å­˜åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿ <code>-XssæŒ‡å®šå¤§å° é»˜è®¤1024kb è¶Šå¤§çº¿ç¨‹è¶Šå°‘</code></li><li>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ<ol><li>å¦‚æœæ–¹æ³•å†…å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨è®¿é—®ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ </li><li>å¦‚æœæ˜¯å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼Œå¹¶é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ <code>å¦‚staticå…¨å±€å˜é‡</code></li></ol></li></ol></li></ul><p>demoï¼š<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022122224752.png"></p><h3 id="2-2-æ ˆå†…å­˜æº¢å‡º"><a href="#2-2-æ ˆå†…å­˜æº¢å‡º" class="headerlink" title="2.2 æ ˆå†…å­˜æº¢å‡º"></a>2.2 æ ˆå†…å­˜æº¢å‡º</h3><ul><li>æ ˆå¸§è¿‡å¤šå¯¼è‡´æ ˆå†…å­˜æº¢å‡º </li><li>æ ˆå¸§è¿‡å¤§å¯¼è‡´æ ˆå†…å­˜æº¢å‡º</li><li>æ¼”ç¤º<ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022124501500.png"></li><li>æ‰§è¡Œäº† <code>42171</code>æ¬¡</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºæ ˆå†…å­˜æº¢å‡º java.lang.StackOverflowError  </span></span><br><span class="line"><span class="comment"> * -Xss256k </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_2</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> count;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            method1();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            System.out.println(count);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;  </span><br><span class="line">        count++;  </span><br><span class="line">        method1();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¾ªç¯ä¾èµ–é—®é¢˜</strong>ï¼š</p><ul><li>åŸå› ï¼š<ul><li>éƒ¨é—¨ä¸‹æœ‰å‘˜å·¥ï¼Œ<code>å‘˜å·¥å±æ€§æœ‰éƒ¨é—¨</code>ï¼Œéƒ¨é—¨ä¸‹æœ‰å‘˜å·¥</li><li>æ— é™å¥—å¨ƒ</li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022125546440.png"></li></ul></li><li>å¦‚ä½•æ­£ç¡®ä½¿ç”¨ï¼š<ul><li>åœ¨å‘˜å·¥ä¸‹çš„éƒ¨é—¨åŠ ä¸Š <code>@JsonIgnore </code></li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022125726658.png" alt="|450"></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * json æ•°æ®è½¬æ¢  </span></span><br><span class="line"><span class="comment"> * å¾ªç¯ä¾èµ–é—®é¢˜  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_19</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException &#123;  </span><br><span class="line">        <span class="type">Dept</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dept</span>();  </span><br><span class="line">        d.setName(<span class="string">&quot;Market&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Emp</span> <span class="variable">e1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();  </span><br><span class="line">        e1.setName(<span class="string">&quot;zhang&quot;</span>);  </span><br><span class="line">        e1.setDept(d);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Emp</span> <span class="variable">e2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();  </span><br><span class="line">        e2.setName(<span class="string">&quot;li&quot;</span>);  </span><br><span class="line">        e2.setDept(d);  </span><br><span class="line">  </span><br><span class="line">        d.setEmps(Arrays.asList(e1, e2));  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// &#123; name: &#x27;Market&#x27;, emps: [&#123; name:&#x27;zhang&#x27;, dept:&#123; name:&#x27;&#x27;, emps: [ &#123;&#125;]&#125; &#125;,] &#125;  </span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();  </span><br><span class="line">        System.out.println(mapper.writeValueAsString(d));  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// å‘˜å·¥  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Emp</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="comment">// !!! @JsonIgnore  </span></span><br><span class="line">    <span class="keyword">private</span> Dept dept;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> Dept <span class="title function_">getDept</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> dept;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDept</span><span class="params">(Dept dept)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.dept = dept;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// éƒ¨é—¨  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dept</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> String name;  </span><br><span class="line">    <span class="keyword">private</span> List&lt;Emp&gt; emps;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.name = name;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">getEmps</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> emps;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmps</span><span class="params">(List&lt;Emp&gt; emps)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.emps = emps;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-çº¿ç¨‹è¿è¡Œè¯Šæ–­"><a href="#2-3-çº¿ç¨‹è¿è¡Œè¯Šæ–­" class="headerlink" title="2.3 çº¿ç¨‹è¿è¡Œè¯Šæ–­"></a>2.3 çº¿ç¨‹è¿è¡Œè¯Šæ–­</h3><ul><li><p>æ¡ˆä¾‹1ï¼šcpu å ç”¨è¿‡å¤š  <code>nohup java Dem1_16 &amp;</code></p></li><li><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022131846694.png"></p></li><li><p>å®šä½ </p><ul><li>ç”¨topå®šä½å“ªä¸ªè¿›ç¨‹å¯¹cpuçš„å ç”¨è¿‡é«˜<ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022130356898.png"></li></ul></li><li><code>ps H -eo pid,tid,%cpu | grep è¿›ç¨‹id</code>ï¼ˆç”¨pså‘½ä»¤è¿›ä¸€æ­¥å®šä½æ˜¯å“ªä¸ªçº¿ç¨‹å¼•èµ·çš„cpuå ç”¨è¿‡é«˜ï¼‰</li><li><code>jstack è¿›ç¨‹id</code> <ul><li>å¯ä»¥æ ¹æ®çº¿ç¨‹id æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥å®šä½åˆ°é—®é¢˜ä»£ç çš„æºç è¡Œå·</li></ul></li></ul></li><li><p>æ¡ˆä¾‹2ï¼šç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æœ (æ­»é”)</p></li></ul><h2 id="3-æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3-æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3. æœ¬åœ°æ–¹æ³•æ ˆ"></a>3. æœ¬åœ°æ–¹æ³•æ ˆ</h2><ul><li>ç”¨Cè¯­è¨€å†™çš„nativeæ–¹æ³•ï¼Œç›´æ¥å’Œåº•å±‚äº¤äº’</li><li>ä¸¾ä¾‹ Objectç±»ä¸‹çš„æ–¹æ³•<ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022132909246.png"></li><li><code>protected native Object clone() throws CloneNotSupportedException;</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022132724136.png"></li></ul></li></ul><h2 id="4-å †"><a href="#4-å †" class="headerlink" title="4. å †"></a>4. å †</h2><ul><li>ä¸Šé¢ä¸‰ä¸ªçº¿ç¨‹ç§æœ‰ <code>å †å’Œæ–¹æ³•åŒºçº¿ç¨‹å…±äº«</code></li></ul><h3 id="4-1-å®šä¹‰"><a href="#4-1-å®šä¹‰" class="headerlink" title="4.1 å®šä¹‰"></a>4.1 å®šä¹‰</h3><ul><li>Heap å † <ul><li>é€šè¿‡ new å…³é”®å­—ï¼Œåˆ›å»ºå¯¹è±¡éƒ½ä¼šä½¿ç”¨å †å†…å­˜</li></ul></li><li>ç‰¹ç‚¹ <ul><li>å®ƒæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œ</li><li>å †ä¸­å¯¹è±¡éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ æœ‰åƒåœ¾å›æ”¶æœºåˆ¶</li></ul></li></ul><h3 id="4-2-å †å†…å­˜æº¢å‡º"><a href="#4-2-å †å†…å­˜æº¢å‡º" class="headerlink" title="4.2 å †å†…å­˜æº¢å‡º"></a>4.2 å †å†…å­˜æº¢å‡º</h3><ul><li>æ§åˆ¶å †ç©ºé—´å‚æ•°ï¼š<code>-Xmx8m</code></li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022134312820.png" alt="|600"><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022133905746.png"></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå †å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Java heap space  </span></span><br><span class="line"><span class="comment"> * -Xmx8m */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_5</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">            <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                list.add(a); <span class="comment">// hello, hellohello, hellohellohellohello ...  </span></span><br><span class="line">                a = a + a;  <span class="comment">// hellohellohellohello  </span></span><br><span class="line">                i++;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-å †å†…å­˜è¯Šæ–­"><a href="#4-3-å †å†…å­˜è¯Šæ–­" class="headerlink" title="4.3 å †å†…å­˜è¯Šæ–­"></a>4.3 å †å†…å­˜è¯Šæ–­</h3><ol><li><code>jps</code> å·¥å…· <ul><li>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å“ªäº› java è¿›ç¨‹</li></ul></li><li><code>jmap</code> å·¥å…· <ul><li>æŸ¥çœ‹å †å†…å­˜å ç”¨æƒ…å†µ jmap - heap è¿›ç¨‹id </li><li>åªèƒ½æŸ¥çœ‹æŸä¸€æ—¶åˆ»</li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022140005220.png" alt="|625"></li></ul></li><li><code>jconsole</code> å·¥å…· <ul><li>å›¾å½¢ç•Œé¢çš„ï¼Œå¤šåŠŸèƒ½çš„ç›‘æµ‹å·¥å…·ï¼Œå¯ä»¥è¿ç»­ç›‘æµ‹</li><li>åŠŸèƒ½å…¨  ã€‚ç»ˆç«¯è¾“å…¥ <code>jconsole</code>  å¼¹å‡ºé€‰æ‹©æ¡†é€‰æ‹©javaç±»</li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022140143587.png" alt="|550"></li></ul></li></ol><ul><li>æ¡ˆä¾‹ åƒåœ¾å›æ”¶åï¼Œå†…å­˜å ç”¨ä»ç„¶å¾ˆé«˜</li><li><code>jvisualvm</code> ç»ˆç«¯è¾“å…¥</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºæŸ¥çœ‹å¯¹è±¡ä¸ªæ•° å †è½¬å‚¨ dump  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_13</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        List&lt;Student&gt; students = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;  </span><br><span class="line">            students.add(<span class="keyword">new</span> <span class="title class_">Student</span>());  </span><br><span class="line"><span class="comment">//            Student student = new Student();  </span></span><br><span class="line">        &#125;  </span><br><span class="line">        Thread.sleep(<span class="number">1000000000L</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] big = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>];  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-æ–¹æ³•åŒº"><a href="#5-æ–¹æ³•åŒº" class="headerlink" title="5. æ–¹æ³•åŒº"></a>5. æ–¹æ³•åŒº</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022150114127.png"></p><h3 id="5-1-å®šä¹‰"><a href="#5-1-å®šä¹‰" class="headerlink" title="5.1 å®šä¹‰"></a>5.1 å®šä¹‰</h3><ul><li><p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html</a></p></li><li><p>The Java Virtual Machine has aÂ <em>method area</em>Â that is shared among all Java Virtual Machine threads. The method area is analogous to the storage area for compiled code of a conventional language or analogous to the â€œtextâ€ segment in an operating system process. It stores per-class structures such as the run-time constant pool, field and method data, and the code for methods and constructors, including the special methods (<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.9" title="2.9.Â Special Methods">Â§2.9</a>) used in class and instance initialization and interface initialization.  </p></li><li><p>Java è™šæ‹Ÿæœºå…·æœ‰åœ¨æ‰€æœ‰ Java è™šæ‹Ÿæœºçº¿ç¨‹ä¹‹é—´å…±äº«çš„æ–¹æ³•_åŒºåŸŸ_Â ã€‚æ–¹æ³•åŒºåŸŸç±»ä¼¼äºå¸¸è§„è¯­è¨€çš„ç¼–è¯‘ä»£ç çš„å­˜å‚¨åŒºåŸŸï¼Œæˆ–ç±»ä¼¼äºä½œç³»ç»Ÿè¿›ç¨‹ä¸­çš„â€œæ–‡æœ¬â€æ®µã€‚å®ƒå­˜å‚¨æ¯ä¸ªç±»çš„ç»“æ„ï¼Œä¾‹å¦‚è¿è¡Œæ—¶å¸¸é‡æ± ã€å­—æ®µå’Œæ–¹æ³•æ•°æ®ï¼Œä»¥åŠæ–¹æ³•å’Œæ„é€ å‡½æ•°çš„ä»£ç ï¼ŒåŒ…æ‹¬ç±»å’Œå®ä¾‹åˆå§‹åŒ–ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ–¹æ³• ï¼ˆ<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.9" title="2.9.Â Special Methods">Â§2.9</a>ï¼‰ å’Œæ¥å£åˆå§‹åŒ–ã€‚</p></li><li><p>The method area is created on virtual machine start-up. Although the method area is logically part of the heap, simple implementations may choose not to either garbage collect or compact it. This specification does not mandate the location of the method area or the policies used to manage compiled code. The method area may be of a fixed size or may be expanded as required by the computation and may be contracted if a larger method area becomes unnecessary. The memory for the method area does not need to be contiguous.  </p></li><li><p>æ–¹æ³•åŒºåŸŸåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚å°½ç®¡æ–¹æ³•åŒºåŸŸåœ¨é€»è¾‘ä¸Šæ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œä½†ç®€å•çš„å®ç°å¯ä»¥é€‰æ‹©ä¸è¿›è¡Œåƒåœ¾å›æ”¶æˆ–å‹ç¼©ã€‚æ­¤è§„èŒƒä¸å¼ºåˆ¶è¦æ±‚æ–¹æ³•åŒºåŸŸçš„ä½ç½®æˆ–ç”¨äºç®¡ç†ç¼–è¯‘ä»£ç çš„ç­–ç•¥ã€‚æ–¹æ³•åŒºåŸŸå¯ä»¥æ˜¯å›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è®¡ç®—çš„éœ€è¦è¿›è¡Œæ‰©å±•ï¼Œå¦‚æœä¸éœ€è¦æ›´å¤§çš„æ–¹æ³•åŒºåŸŸï¼Œåˆ™å¯ä»¥æ”¶ç¼©ã€‚æ–¹æ³•åŒºåŸŸçš„å†…å­˜ä¸éœ€è¦æ˜¯è¿ç»­çš„ã€‚</p></li></ul><h3 id="5-2-ç»„æˆ"><a href="#5-2-ç»„æˆ" class="headerlink" title="5.2 ç»„æˆ"></a>5.2 ç»„æˆ</h3><ul><li>1.6ç”¨ <code>æ°¸ä¹…ä»£</code></li><li>1.8ç”¨ <code>å…ƒç©ºé—´</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251022150211748.png"></li></ul><h3 id="5-3-æ–¹æ³•åŒºå†…å­˜æº¢å‡º"><a href="#5-3-æ–¹æ³•åŒºå†…å­˜æº¢å‡º" class="headerlink" title="5.3 æ–¹æ³•åŒºå†…å­˜æº¢å‡º"></a>5.3 æ–¹æ³•åŒºå†…å­˜æº¢å‡º</h3><ul><li>1.8 ä»¥å‰ä¼šå¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡º<ul><li>&#96;* æ¼”ç¤ºæ°¸ä¹…ä»£å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: PermGen space * </li><li><code>-XX:MaxPermSize=8m</code></li></ul></li><li>1.8 ä¹‹åä¼šå¯¼è‡´å…ƒç©ºé—´å†…å­˜æº¢å‡º<ul><li><code>* æ¼”ç¤ºå…ƒç©ºé—´å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Metaspace</code></li><li><code>* -XX:MaxMetaspaceSize=8m</code><br><strong>æ¡ˆä¾‹</strong>ï¼š</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå…ƒç©ºé—´å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Metaspace  </span></span><br><span class="line"><span class="comment"> * -XX:MaxMetaspaceSize=8m */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_8</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123; <span class="comment">// å¯ä»¥ç”¨æ¥åŠ è½½ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç   </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">Demo1_8</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo1_8</span>();  </span><br><span class="line">            <span class="comment">// åŠ è½½ä¸€ä¸‡ä¸ªç±»  </span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++, j++) &#123;  </span><br><span class="line">                <span class="comment">// ClassWriter ä½œç”¨æ˜¯ç”Ÿæˆç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç   </span></span><br><span class="line">                <span class="type">ClassWriter</span> <span class="variable">cw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassWriter</span>(<span class="number">0</span>);  </span><br><span class="line">                <span class="comment">// ç‰ˆæœ¬å·ï¼Œ publicï¼Œ ç±»å, åŒ…å, çˆ¶ç±»ï¼Œ æ¥å£  </span></span><br><span class="line">                cw.visit(Opcodes.V1_8, Opcodes.ACC_PUBLIC, <span class="string">&quot;Class&quot;</span> + i, <span class="literal">null</span>, <span class="string">&quot;java/lang/Object&quot;</span>, <span class="literal">null</span>);  </span><br><span class="line">                <span class="comment">// è¿”å› byte[]                byte[] code = cw.toByteArray();  </span></span><br><span class="line">                <span class="comment">// æ‰§è¡Œäº†ç±»çš„åŠ è½½  </span></span><br><span class="line">                test.defineClass(<span class="string">&quot;Class&quot;</span> + i, code, <span class="number">0</span>, code.length); <span class="comment">// Class å¯¹è±¡  </span></span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(j);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœºæ™¯</strong>ï¼š</p><ul><li>ä½¿ç”¨<code>cglib</code><ul><li><code>spring</code></li><li><code>mybatis</code></li></ul></li></ul><h3 id="5-4-è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#5-4-è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="5.4 è¿è¡Œæ—¶å¸¸é‡æ± "></a>5.4 è¿è¡Œæ—¶å¸¸é‡æ± </h3><ul><li>å¸¸é‡æ± ï¼Œå°±æ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ ç­‰ä¿¡æ¯ </li><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¸¸é‡æ± æ˜¯ *.class æ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥ç±»è¢«åŠ è½½ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼šæ”¾å…¥è¿è¡Œæ—¶å¸¸é‡ æ± ï¼Œå¹¶æŠŠé‡Œé¢çš„ç¬¦å·åœ°å€å˜ä¸ºçœŸå®åœ°å€</li><li>æ‰§è¡Œ <code>javap -v</code> å¦‚ä¸‹</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">â¯ javap -v out.production.jvm.cn.itcast.jvm.t5.HelloWorld</span><br><span class="line">è­¦å‘Š: æ–‡ä»¶ ./out/production/jvm/cn/itcast/jvm/t5/HelloWorld.class ä¸åŒ…å«ç±» out.production.jvm.cn.itcast.jvm.t5.HelloWorld</span><br><span class="line">Classfile /Users/cyt/workspace/java/jvm-std/jvm/out/production/jvm/cn/itcast/jvm/t5/HelloWorld.class</span><br><span class="line">  Last modified 2025å¹´10æœˆ22æ—¥; size 567 bytes</span><br><span class="line">  SHA-256 checksum 37204bf6e654f64ae56660a1e8becfaa98b3ae7592b81b4b6e331de92a460b96</span><br><span class="line">  Compiled from <span class="string">&quot;HelloWorld.java&quot;</span></span><br><span class="line">public class cn.itcast.jvm.t5.HelloWorld</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: (0x0021) ACC_PUBLIC, ACC_SUPER</span><br><span class="line">  this_class: <span class="comment">#5                          // cn/itcast/jvm/t5/HelloWorld</span></span><br><span class="line">  super_class: <span class="comment">#6                         // java/lang/Object</span></span><br><span class="line">  interfaces: 0, fields: 0, methods: 2, attributes: 1</span><br><span class="line">Constant pool: <span class="comment"># å¸¸é‡æ± </span></span><br><span class="line">   <span class="comment">#1 = Methodref          #6.#20         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   <span class="comment">#2 = Fieldref           #21.#22        // java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   <span class="comment">#3 = String             #23            // hello world</span></span><br><span class="line">   <span class="comment">#4 = Methodref          #24.#25        // java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">   <span class="comment">#5 = Class              #26            // cn/itcast/jvm/t5/HelloWorld</span></span><br><span class="line">   <span class="comment">#6 = Class              #27            // java/lang/Object</span></span><br><span class="line">   <span class="comment">#7 = Utf8               &lt;init&gt;</span></span><br><span class="line">   <span class="comment">#8 = Utf8               ()V</span></span><br><span class="line">   <span class="comment">#9 = Utf8               Code</span></span><br><span class="line">  <span class="comment">#10 = Utf8               LineNumberTable</span></span><br><span class="line">  <span class="comment">#11 = Utf8               LocalVariableTable</span></span><br><span class="line">  <span class="comment">#12 = Utf8               this</span></span><br><span class="line">  <span class="comment">#13 = Utf8               Lcn/itcast/jvm/t5/HelloWorld;</span></span><br><span class="line">  <span class="comment">#14 = Utf8               main</span></span><br><span class="line">  <span class="comment">#15 = Utf8               ([Ljava/lang/String;)V</span></span><br><span class="line">  <span class="comment">#16 = Utf8               args</span></span><br><span class="line">  <span class="comment">#17 = Utf8               [Ljava/lang/String;</span></span><br><span class="line">  <span class="comment">#18 = Utf8               SourceFile</span></span><br><span class="line">  <span class="comment">#19 = Utf8               HelloWorld.java</span></span><br><span class="line">  <span class="comment">#20 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  <span class="comment">#21 = Class              #28            // java/lang/System</span></span><br><span class="line">  <span class="comment">#22 = NameAndType        #29:#30        // out:Ljava/io/PrintStream;</span></span><br><span class="line">  <span class="comment">#23 = Utf8               hello world</span></span><br><span class="line">  <span class="comment">#24 = Class              #31            // java/io/PrintStream</span></span><br><span class="line">  <span class="comment">#25 = NameAndType        #32:#33        // println:(Ljava/lang/String;)V</span></span><br><span class="line">  <span class="comment">#26 = Utf8               cn/itcast/jvm/t5/HelloWorld</span></span><br><span class="line">  <span class="comment">#27 = Utf8               java/lang/Object</span></span><br><span class="line">  <span class="comment">#28 = Utf8               java/lang/System</span></span><br><span class="line">  <span class="comment">#29 = Utf8               out</span></span><br><span class="line">  <span class="comment">#30 = Utf8               Ljava/io/PrintStream;</span></span><br><span class="line">  <span class="comment">#31 = Utf8               java/io/PrintStream</span></span><br><span class="line">  <span class="comment">#32 = Utf8               println</span></span><br><span class="line">  <span class="comment">#33 = Utf8               (Ljava/lang/String;)V</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment"># æ— å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">  public cn.itcast.jvm.t5.HelloWorld();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: (0x0001) ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial <span class="comment">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         4: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 4: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       5     0  this   Lcn/itcast/jvm/t5/HelloWorld;</span><br><span class="line"></span><br><span class="line"><span class="comment"># mian æ–¹æ³•</span></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: (0x0009) ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">    <span class="comment"># è™šæ‹ŸæœºæŒ‡ä»¤</span></span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         <span class="comment"># #2ä¸Šé¢å¸¸é‡æ± åœ°å€</span></span><br><span class="line">         0: getstatic     <span class="comment">#2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         3: ldc           <span class="comment">#3                  // String hello world</span></span><br><span class="line">         <span class="comment"># æ‰§è¡Œæ–¹æ³•è°ƒç”¨</span></span><br><span class="line">         5: invokevirtual <span class="comment">#4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">         8: <span class="built_in">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 6: 0</span><br><span class="line">        line 7: 8</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       9     0  args   [Ljava/lang/String;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;HelloWorld.java&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-5-StringTable"><a href="#5-5-StringTable" class="headerlink" title="5.5 StringTable"></a>5.5 StringTable</h3><p>å…ˆçœ‹å‡ é“é¢è¯•é¢˜ï¼š<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023165134535.png" alt="|725"></p><h3 id="æ¡ˆä¾‹è§£æ"><a href="#æ¡ˆä¾‹è§£æ" class="headerlink" title="æ¡ˆä¾‹è§£æ"></a>æ¡ˆä¾‹è§£æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸²æ± ï¼ˆç±»ä¼¼å“ˆå¸Œè¡¨ï¼‰ StringTable [ &quot;a&quot;, &quot;b&quot; ,&quot;ab&quot; ]  hashtable ç»“æ„ï¼Œä¸èƒ½æ‰©å®¹  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_22</span> &#123;  </span><br><span class="line">    <span class="comment">// å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œéƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œ è¿™æ—¶ a b ab éƒ½æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œè¿˜æ²¡æœ‰å˜ä¸º java å­—ç¬¦ä¸²å¯¹è±¡  </span></span><br><span class="line">    <span class="comment">// ldc #2 ä¼šæŠŠ a ç¬¦å·å˜ä¸º &quot;a&quot; å­—ç¬¦ä¸²å¯¹è±¡  </span></span><br><span class="line">    <span class="comment">// ldc #3 ä¼šæŠŠ b ç¬¦å·å˜ä¸º &quot;b&quot; å­—ç¬¦ä¸²å¯¹è±¡  </span></span><br><span class="line">    <span class="comment">// ldc #4 ä¼šæŠŠ ab ç¬¦å·å˜ä¸º &quot;ab&quot; å­—ç¬¦ä¸²å¯¹è±¡  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>; <span class="comment">// æ‡’æƒ°çš„  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2; <span class="comment">// new StringBuilder().append(&quot;a&quot;).append(&quot;b&quot;).toString()  new String(&quot;ab&quot;) åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span>;  <span class="comment">// javac åœ¨ç¼–è¯‘æœŸé—´çš„ä¼˜åŒ–ï¼Œç»“æœå·²ç»åœ¨ç¼–è¯‘æœŸç¡®å®šä¸ºab  </span></span><br><span class="line">        System.out.println(s3 == s4); <span class="comment">// false s3åœ¨ä¸²æ± ä¸­ s4åœ¨å †ä¸­  </span></span><br><span class="line">        System.out.println(s3 == s5); <span class="comment">// true  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>javac -g  Demo1_22.java  </code><ul><li>ç¼–è¯‘æœŸä¼˜åŒ–</li><li>å¯ä»¥å‘ç°s5åœ¨javacç¼–è¯‘æ—¶å·²ç»èµ‹å€¼â€œabâ€</li><li>æ­¤æ—¶â€œabâ€å·²åœ¨ä¸²æ± ä¸­</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  </span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA  </span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)  </span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">package</span> cn.itcast.jvm.t1.stringtable;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_22</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo1_22</span><span class="params">()</span> &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;  </span><br><span class="line">        (<span class="keyword">new</span> <span class="title class_">StringBuilder</span>()).append(s1).append(s2).toString();  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>javap -v Demo1_22.class &gt; output.txt</code></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">â¯ javap -v my1</span><br><span class="line">Classfile /Users/cyt/workspace/java/jvm-std/jvm/src/cn/itcast/jvm/t1/stringtable/Demo1_22.class  </span><br><span class="line">  Last modified 2025-10-23; size 741 bytes  </span><br><span class="line">  MD5 checksum d4b9eed9cffe233ec5fa007c264eb2d2  </span><br><span class="line">  Compiled from <span class="string">&quot;Demo1_22.java&quot;</span>  </span><br><span class="line">public class cn.itcast.jvm.t1.stringtable.Demo1_22  </span><br><span class="line">  minor version: 0  </span><br><span class="line">  major version: 52  </span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER  </span><br><span class="line">Constant pool:  </span><br><span class="line">   <span class="comment">#1 = Methodref          #10.#30        // java/lang/Object.&quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">   <span class="comment">#2 = String             #31            // a  </span></span><br><span class="line">   <span class="comment">#3 = String             #32            // b  </span></span><br><span class="line">   <span class="comment">#4 = String             #33            // ab  </span></span><br><span class="line">   <span class="comment">#5 = Class              #34            // java/lang/StringBuilder  </span></span><br><span class="line">   <span class="comment">#6 = Methodref          #5.#30         // java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">   <span class="comment">#7 = Methodref          #5.#35         // java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">   <span class="comment">#8 = Methodref          #5.#36         // java/lang/StringBuilder.toString:()Ljava/lang/String;  </span></span><br><span class="line">   <span class="comment">#9 = Class              #37            // cn/itcast/jvm/t1/stringtable/Demo1_22  </span></span><br><span class="line">  <span class="comment">#10 = Class              #38            // java/lang/Object  </span></span><br><span class="line">  <span class="comment">#11 = Utf8               &lt;init&gt;  </span></span><br><span class="line">  <span class="comment">#12 = Utf8               ()V  </span></span><br><span class="line">  <span class="comment">#13 = Utf8               Code  </span></span><br><span class="line">  <span class="comment">#14 = Utf8               LineNumberTable  </span></span><br><span class="line">  <span class="comment">#15 = Utf8               LocalVariableTable  </span></span><br><span class="line">  <span class="comment">#16 = Utf8               this  </span></span><br><span class="line">  <span class="comment">#17 = Utf8               Lcn/itcast/jvm/t1/stringtable/Demo1_22;  </span></span><br><span class="line">  <span class="comment">#18 = Utf8               main  </span></span><br><span class="line">  <span class="comment">#19 = Utf8               ([Ljava/lang/String;)V  </span></span><br><span class="line">  <span class="comment">#20 = Utf8               args  </span></span><br><span class="line">  <span class="comment">#21 = Utf8               [Ljava/lang/String;  </span></span><br><span class="line">  <span class="comment">#22 = Utf8               s1  </span></span><br><span class="line">  <span class="comment">#23 = Utf8               Ljava/lang/String;  </span></span><br><span class="line">  <span class="comment">#24 = Utf8               s2  </span></span><br><span class="line">  <span class="comment">#25 = Utf8               s3  </span></span><br><span class="line">  <span class="comment">#26 = Utf8               s4  </span></span><br><span class="line">  <span class="comment">#27 = Utf8               s5  </span></span><br><span class="line">  <span class="comment">#28 = Utf8               SourceFile  </span></span><br><span class="line">  <span class="comment">#29 = Utf8               Demo1_22.java  </span></span><br><span class="line">  <span class="comment">#30 = NameAndType        #11:#12        // &quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">  <span class="comment">#31 = Utf8               a  </span></span><br><span class="line">  <span class="comment">#32 = Utf8               b  </span></span><br><span class="line">  <span class="comment">#33 = Utf8               ab  </span></span><br><span class="line">  <span class="comment">#34 = Utf8               java/lang/StringBuilder  </span></span><br><span class="line">  <span class="comment">#35 = NameAndType        #39:#40        // append:(Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">  <span class="comment">#36 = NameAndType        #41:#42        // toString:()Ljava/lang/String;  </span></span><br><span class="line">  <span class="comment">#37 = Utf8               cn/itcast/jvm/t1/stringtable/Demo1_22  </span></span><br><span class="line">  <span class="comment">#38 = Utf8               java/lang/Object  </span></span><br><span class="line">  <span class="comment">#39 = Utf8               append  </span></span><br><span class="line">  <span class="comment">#40 = Utf8               (Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">  <span class="comment">#41 = Utf8               toString  </span></span><br><span class="line">  <span class="comment">#42 = Utf8               ()Ljava/lang/String;  </span></span><br><span class="line">&#123;  </span><br><span class="line">  public cn.itcast.jvm.t1.stringtable.Demo1_22();  </span><br><span class="line">    descriptor: ()V  </span><br><span class="line">    flags: ACC_PUBLIC  </span><br><span class="line">    Code:  </span><br><span class="line">      stack=1, locals=1, args_size=1  </span><br><span class="line">         0: aload_0  </span><br><span class="line">         1: invokespecial <span class="comment">#1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">         4: <span class="built_in">return</span>  </span><br><span class="line">      LineNumberTable:  </span><br><span class="line">        line 4: 0  </span><br><span class="line">      LocalVariableTable:  </span><br><span class="line">        Start  Length  Slot  Name   Signature  </span><br><span class="line">            0       5     0  this   Lcn/itcast/jvm/t1/stringtable/Demo1_22;  </span><br><span class="line">  </span><br><span class="line">  public static void main(java.lang.String[]);  </span><br><span class="line">    descriptor: ([Ljava/lang/String;)V  </span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC  </span><br><span class="line">    Code:  </span><br><span class="line">      stack=2, locals=6, args_size=1  </span><br><span class="line">         0: ldc           <span class="comment">#2                  // String a  </span></span><br><span class="line">         2: astore_1  </span><br><span class="line">         3: ldc           <span class="comment">#3                  // String b  </span></span><br><span class="line">         5: astore_2  </span><br><span class="line">         6: ldc           <span class="comment">#4                  // String ab   ç¬¬ä¸€æ¬¡ldc #4</span></span><br><span class="line">         8: astore_3  </span><br><span class="line">         9: new           <span class="comment">#5                  // class java/lang/StringBuilder  </span></span><br><span class="line">        12: dup  </span><br><span class="line">        13: invokespecial <span class="comment">#6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V  </span></span><br><span class="line">        16: aload_1  </span><br><span class="line">        17: invokevirtual <span class="comment">#7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">        20: aload_2  </span><br><span class="line">        21: invokevirtual <span class="comment">#7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;  </span></span><br><span class="line">        24: invokevirtual <span class="comment">#8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;  </span></span><br><span class="line">        27: astore        4  </span><br><span class="line">        29: ldc           <span class="comment">#4                  // String ab   ç¬¬äºŒæ¬¡ldc #4</span></span><br><span class="line">        31: astore        5  </span><br><span class="line">        33: <span class="built_in">return</span>  </span><br><span class="line">      LineNumberTable:  </span><br><span class="line">        line 11: 0  </span><br><span class="line">        line 12: 3  </span><br><span class="line">        line 13: 6  </span><br><span class="line">        line 14: 9  </span><br><span class="line">        line 15: 29  </span><br><span class="line">        line 18: 33  </span><br><span class="line">      LocalVariableTable:  </span><br><span class="line">        Start  Length  Slot  Name   Signature  </span><br><span class="line">            0      34     0  args   [Ljava/lang/String;  </span><br><span class="line">            3      31     1    s1   Ljava/lang/String;  </span><br><span class="line">            6      28     2    s2   Ljava/lang/String;  </span><br><span class="line">            9      25     3    s3   Ljava/lang/String;  </span><br><span class="line">           29       5     4    s4   Ljava/lang/String;  </span><br><span class="line">           33       1     5    s5   Ljava/lang/String;  </span><br><span class="line">&#125;  </span><br><span class="line">SourceFile: <span class="string">&quot;Demo1_22.java&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-5-StringTableç‰¹æ€§"><a href="#5-5-StringTableç‰¹æ€§" class="headerlink" title="5.5 StringTableç‰¹æ€§"></a>5.5 StringTableç‰¹æ€§</h3><ul><li>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ°æ—¶æ‰å˜ä¸ºå¯¹è±¡ </li><li>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ </li><li><code>å­—ç¬¦ä¸²å˜é‡</code>æ‹¼æ¥çš„åŸç†æ˜¯ StringBuilder ï¼ˆ1.8ï¼‰ </li><li><code>å­—ç¬¦ä¸²å¸¸é‡</code>æ‹¼æ¥çš„åŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ– </li><li>å¯ä»¥ä½¿ç”¨ intern æ–¹æ³•ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± <ul><li><code>1.8 å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œ ä¼šæŠŠä¸² æ± ä¸­çš„å¯¹è±¡è¿”å›</code> </li><li>1.6 å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œ æ”¾å…¥ä¸²æ± ï¼Œ ä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_23</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">x</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>; <span class="comment">// ä¸²æ± ä¸­æœ‰ &quot;ab&quot;        </span></span><br><span class="line">        <span class="comment">// æ­¤æ—¶å †ä¸­æœ‰ï¼š  new String(&quot;a&quot;)   new String(&quot;b&quot;) new String(&quot;ab&quot;)        </span></span><br><span class="line">        <span class="comment">// å­—ç¬¦ä¸²æ± ä¸­æœ‰ï¼š [&quot;a&quot;, &quot;b&quot;] è¿˜æ²¡æœ‰ &quot;ab&quot;        </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸²æ± æœ‰â€œabâ€ï¼Œ æ­¤æ—¶sæ²¡æœ‰è¢«æ”¾è¿›ä¸²æ± ä¸­ï¼Œsä»åœ¨å †ä¸­  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s.intern(); <span class="comment">// å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œ ä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›  </span></span><br><span class="line">  </span><br><span class="line">        System.out.println(s2 == x); <span class="comment">// true  </span></span><br><span class="line">        System.out.println(s == <span class="string">&quot;ab&quot;</span>); <span class="comment">// false  </span></span><br><span class="line">        System.out.println(s == x); <span class="comment">// false  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_23</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">       </span><br><span class="line">        <span class="comment">// æ­¤æ—¶å †ä¸­æœ‰ï¼š  new String(&quot;a&quot;)   new String(&quot;b&quot;) new String(&quot;ab&quot;)        </span></span><br><span class="line">        <span class="comment">// å­—ç¬¦ä¸²æ± ä¸­æœ‰ï¼š [&quot;a&quot;, &quot;b&quot;] è¿˜æ²¡æœ‰ &quot;ab&quot;        </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸²æ± æ— â€œabâ€ sè¢«æ”¾è¿›ä¸²æ± ï¼Œè¿”å›ï¼š s2ä¹Ÿæ˜¯ä¸²æ± </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s.intern(); <span class="comment">// å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œ ä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›  </span></span><br><span class="line">  </span><br><span class="line">        System.out.println(s2 == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true  </span></span><br><span class="line">        System.out.println(s == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºå­—ç¬¦ä¸²ç›¸å…³é¢è¯•é¢˜  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_21</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;        <span class="comment">// æ± ä¸­  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;        <span class="comment">// æ± ä¸­  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span>; <span class="comment">// æ± ä¸­ ab        String s4 = s1 + s2;   // å †ä¸­ è°ƒç”¨StringBuiler new String(&quot;ab&quot;)  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;        <span class="comment">// æ± ä¸­  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s6</span> <span class="operator">=</span> s4.intern(); <span class="comment">// s4æ²¡æœ‰æ”¾è¿›æ± ä¸­ï¼ˆä»åœ¨å †ä¸­ï¼‰ s6æ± ä¸­  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// é—®  </span></span><br><span class="line">        System.out.println(s3 == s4); <span class="comment">// false  </span></span><br><span class="line">        System.out.println(s3 == s5); <span class="comment">// true  </span></span><br><span class="line">        System.out.println(s3 == s6); <span class="comment">// true  </span></span><br><span class="line">        System.out.println(s6 == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true  </span></span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">x2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;d&quot;</span>); <span class="comment">// new String(&quot;cd&quot;)  </span></span><br><span class="line">        x2.intern(); <span class="comment">// æ”¾è¿›æ± ä¸­  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">x1</span> <span class="operator">=</span> <span class="string">&quot;cd&quot;</span>; <span class="comment">// æ± ä¸­  </span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">// é—®ï¼Œå¦‚æœè°ƒæ¢äº†ã€æœ€åä¸¤è¡Œä»£ç ã€‘çš„ä½ç½®å‘¢ï¼Œå¦‚æœæ˜¯jdk1.6å‘¢  </span></span><br><span class="line">        System.out.println(x1 == x2); <span class="comment">// true  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-6-StringTableä½ç½®"><a href="#5-6-StringTableä½ç½®" class="headerlink" title="5.6 StringTableä½ç½®"></a>5.6 StringTableä½ç½®</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023180402231.png"></p><p><strong>æ¼”ç¤ºä»£ç </strong>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤º StringTable ä½ç½®  </span></span><br><span class="line"><span class="comment"> * åœ¨jdk8ä¸‹è®¾ç½® -Xmx10m -XX:-UseGCOverheadLimit  </span></span><br><span class="line"><span class="comment"> * åœ¨jdk6ä¸‹è®¾ç½® -XX:MaxPermSize=10m  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_6</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">260000</span>; j++) &#123;  </span><br><span class="line">                list.add(String.valueOf(j).intern());  </span><br><span class="line">                i++;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>jdk1.6æŠ¥é”™</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023180625780.png" alt="|600"></li><li><code>jdk1.8æŠ¥é”™</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023180825140.png" alt="|550"></li></ul><h3 id="5-7-StringTable-åƒåœ¾å›æ”¶"><a href="#5-7-StringTable-åƒåœ¾å›æ”¶" class="headerlink" title="5.7 StringTable åƒåœ¾å›æ”¶"></a>5.7 StringTable åƒåœ¾å›æ”¶</h3><ul><li>ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤º StringTable åƒåœ¾å›æ”¶  </span></span><br><span class="line"><span class="comment"> * -Xmx10m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails -verbose:gc  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_7</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">100000</span>; j++) &#123; <span class="comment">// j=100, j=10000  </span></span><br><span class="line">                String.valueOf(j).intern();  </span><br><span class="line">                i++;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ—¥å¿—<ul><li>å¾ªç¯åä¸‡æ¬¡ï¼Œæ”¾å…¥åä¸‡ä¸ªæ•°åˆ° <code>StringTable</code></li><li>è§¦å‘GCå›æ”¶ <code>GC (Allocation Failure) [PSYoungGen: 4096K-&gt;496K(4608K)] 4096K-&gt;536K(15872K),</code></li><li>å¹¶æ²¡æœ‰çœŸæ­£æ”¾å…¥åä¸‡ä¸ªæ•°ï¼ˆ53774ä¸ªï¼‰ï¼š <code>Number of entries       :     53774 =   1290576 bytes, avg  24.000</code></li></ul></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">GC</span> <span class="string">(Allocation</span> <span class="string">Failure)</span> [<span class="attr">PSYoungGen:</span> <span class="string">4096K-&gt;496K(4608K)</span>] <span class="string">4096K-&gt;536K(15872K)</span>, <span class="number">0.0007230</span> <span class="string">secs</span>] [<span class="attr">Times:</span> <span class="string">user=0.01</span> <span class="string">sys=0.00</span>, <span class="string">real=0.00</span> <span class="string">secs</span>] </span><br><span class="line"><span class="number">100000</span></span><br><span class="line"><span class="string">Heap</span></span><br><span class="line"> <span class="string">PSYoungGen</span>      <span class="string">total</span> <span class="string">4608K,</span> <span class="string">used</span> <span class="string">3435K</span> [<span class="number">0x00000007bfb00000</span>, <span class="number">0x00000007c0000000</span>, <span class="number">0x00000007c0000000</span><span class="string">)</span></span><br><span class="line">  <span class="string">eden</span> <span class="string">space</span> <span class="string">4096K</span>, <span class="number">71</span><span class="string">%</span> <span class="string">used</span> [<span class="number">0x00000007bfb00000</span>,<span class="number">0x00000007bfddee40</span>,<span class="number">0x00000007bff00000</span><span class="string">)</span></span><br><span class="line">  <span class="string">from</span> <span class="string">space</span> <span class="string">512K</span>, <span class="number">96</span><span class="string">%</span> <span class="string">used</span> [<span class="number">0x00000007bff00000</span>,<span class="number">0x00000007bff7c010</span>,<span class="number">0x00000007bff80000</span><span class="string">)</span></span><br><span class="line">  <span class="string">to</span>   <span class="string">space</span> <span class="string">512K</span>, <span class="number">0</span><span class="string">%</span> <span class="string">used</span> [<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007bff80000</span>,<span class="number">0x00000007c0000000</span><span class="string">)</span></span><br><span class="line"> <span class="string">ParOldGen</span>       <span class="string">total</span> <span class="string">11264K</span>, <span class="string">used</span> <span class="string">40K</span> [<span class="number">0x00000007bf000000</span>, <span class="number">0x00000007bfb00000</span>, <span class="number">0x00000007bfb00000</span><span class="string">)</span></span><br><span class="line">  <span class="string">object</span> <span class="string">space</span> <span class="string">11264K</span>, <span class="number">0</span><span class="string">%</span> <span class="string">used</span> [<span class="number">0x00000007bf000000</span>,<span class="number">0x00000007bf00a000</span>,<span class="number">0x00000007bfb00000</span><span class="string">)</span></span><br><span class="line"> <span class="string">Metaspace</span>       <span class="string">used</span> <span class="string">3413K</span>, <span class="string">capacity</span> <span class="string">4564K</span>, <span class="string">committed</span> <span class="string">4864K</span>, <span class="string">reserved</span> <span class="string">1056768K</span></span><br><span class="line">  <span class="string">class</span> <span class="string">space</span>    <span class="string">used</span> <span class="string">368K</span>, <span class="string">capacity</span> <span class="string">388K</span>, <span class="string">committed</span> <span class="string">512K</span>, <span class="string">reserved</span> <span class="string">1048576K</span></span><br><span class="line"><span class="attr">SymbolTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">20011</span> <span class="string">=</span>    <span class="number">160088</span> <span class="string">bytes</span>, <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">13264</span> <span class="string">=</span>    <span class="number">318336</span> <span class="string">bytes</span>, <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">13264</span> <span class="string">=</span>    <span class="number">521312</span> <span class="string">bytes</span>, <span class="string">avg</span>  <span class="number">39.303</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>    <span class="number">999736</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.663</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.666</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.816</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">6</span></span><br><span class="line"><span class="attr">StringTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">60013</span> <span class="string">=</span>    <span class="number">480104</span> <span class="string">bytes</span>, <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">53774</span> <span class="string">=</span>   <span class="number">1290576</span> <span class="string">bytes</span>, <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">53774</span> <span class="string">=</span>   <span class="number">3021376</span> <span class="string">bytes</span>, <span class="string">avg</span>  <span class="number">56.187</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>   <span class="number">4792056</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.896</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.704</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.839</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">5</span></span><br></pre></td></tr></table></figure><h3 id="5-8-StringTable-æ€§èƒ½è°ƒä¼˜"><a href="#5-8-StringTable-æ€§èƒ½è°ƒä¼˜" class="headerlink" title="5.8 StringTable æ€§èƒ½è°ƒä¼˜"></a>5.8 StringTable æ€§èƒ½è°ƒä¼˜</h3><h4 id="è°ƒæ•´-XX-StringTableSize-æ¡¶ä¸ªæ•°"><a href="#è°ƒæ•´-XX-StringTableSize-æ¡¶ä¸ªæ•°" class="headerlink" title="è°ƒæ•´ -XX:StringTableSize&#x3D;æ¡¶ä¸ªæ•°"></a>è°ƒæ•´ -XX:StringTableSize&#x3D;æ¡¶ä¸ªæ•°</h4><ul><li>æ¡ˆä¾‹ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºä¸²æ± å¤§å°å¯¹æ€§èƒ½çš„å½±å“  </span></span><br><span class="line"><span class="comment"> * -Xms500m -Xmx500m -XX:+PrintStringTableStatistics -XX:StringTableSize=1009  </span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_24</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="comment">// è¯»å…¥48ä¸‡ä¸ªå•è¯  </span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;linux.words&quot;</span>), <span class="string">&quot;utf-8&quot;</span>))) &#123;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">            <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                line = reader.readLine();  </span><br><span class="line">                <span class="keyword">if</span> (line == <span class="literal">null</span>) &#123;  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                line.intern(); <span class="comment">// æ”¾å…¥ä¸²æ±   </span></span><br><span class="line">            &#125;  </span><br><span class="line">            System.out.println(<span class="string">&quot;cost:&quot;</span> + (System.nanoTime() - start) / <span class="number">1000000</span>); <span class="comment">// 124ms  </span></span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é»˜è®¤ <code>60013</code> ä¸ª</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cost:129</span> <span class="string">ï¼ˆæ—¶é—´</span> <span class="string">msï¼‰</span></span><br><span class="line"><span class="attr">SymbolTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">20011</span> <span class="string">=</span>    <span class="number">160088</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">318384</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">521352</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">39.300</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>    <span class="number">999824</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.663</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.666</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.816</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">6</span></span><br><span class="line"><span class="attr">StringTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">60013</span> <span class="string">=</span>    <span class="number">480104</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">11535216</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">29632912</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">61.654</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>  <span class="number">41648232</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">8.009</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">8.067</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">2.840</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>        <span class="number">23</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ä¸º <code>200000</code>ä¸ªå<ul><li>æ—¶é—´ä¸º98ms</li><li><code>-XX:StringTableSize=200000  </code></li><li>åŸå› ï¼šç©ºé—´æ¢æ—¶é—´</li></ul></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cost:98</span></span><br><span class="line"><span class="attr">SymbolTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">20011</span> <span class="string">=</span>    <span class="number">160088</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">318384</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">521352</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">39.300</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>    <span class="number">999824</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.663</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.666</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.816</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">6</span></span><br><span class="line"><span class="attr">StringTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>    <span class="number">200000</span> <span class="string">=</span>   <span class="number">1600000</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">11535216</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">29632912</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">61.654</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>  <span class="number">42768128</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">2.403</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">2.416</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">1.554</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>        <span class="number">12</span></span><br></pre></td></tr></table></figure><ul><li>è°ƒå°ï¼Œä¿®æ”¹ä¸º <code>1009</code> ä¸ª<ul><li><code>-XX:StringTableSize=1009</code></li><li>æ—¶é—´æ˜æ˜¾å˜æ…¢</li><li>åŸå› ï¼šå“ˆå¸Œå†²çªå¤ªå¤š</li></ul></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cost:1497</span></span><br><span class="line"><span class="attr">SymbolTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>     <span class="number">20011</span> <span class="string">=</span>    <span class="number">160088</span> <span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">318384</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>     <span class="number">13266</span> <span class="string">=</span>    <span class="number">521352</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">39.300</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>    <span class="number">999824</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>     <span class="number">0.663</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>     <span class="number">0.666</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>     <span class="number">0.816</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>         <span class="number">6</span></span><br><span class="line"><span class="attr">StringTable statistics:</span></span><br><span class="line"><span class="attr">Number of buckets       :</span>      <span class="number">1009</span> <span class="string">=</span>      <span class="number">8072 </span><span class="string">bytes,</span> <span class="string">avg</span>   <span class="number">8.000</span></span><br><span class="line"><span class="attr">Number of entries       :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">11535216</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">24.000</span></span><br><span class="line"><span class="attr">Number of literals      :</span>    <span class="number">480634</span> <span class="string">=</span>  <span class="number">29632912</span> <span class="string">bytes,</span> <span class="string">avg</span>  <span class="number">61.654</span></span><br><span class="line"><span class="attr">Total footprint         :</span>           <span class="string">=</span>  <span class="number">41176200</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Average bucket size     :</span>   <span class="number">476.347</span></span><br><span class="line"><span class="attr">Variance of bucket size :</span>   <span class="number">434.024</span></span><br><span class="line"><span class="attr">Std. dev. of bucket size:</span>    <span class="number">20.833</span></span><br><span class="line"><span class="attr">Maximum bucket size     :</span>       <span class="number">544</span></span><br></pre></td></tr></table></figure><h4 id="è€ƒè™‘å°†å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦å…¥æ± "><a href="#è€ƒè™‘å°†å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦å…¥æ± " class="headerlink" title="è€ƒè™‘å°†å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦å…¥æ± "></a>è€ƒè™‘å°†å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦å…¥æ± </h4><ul><li>å…¥æ± å’Œä¸å…¥æ± å¯¹å†…å­˜å æ¯”</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤º intern å‡å°‘å†…å­˜å ç”¨  </span></span><br><span class="line"><span class="comment"> * -XX:StringTableSize=200000 -XX:+PrintStringTableStatistics  </span></span><br><span class="line"><span class="comment"> * -Xsx500m -Xmx500m -XX:+PrintStringTableStatistics -XX:StringTableSize=200000 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_25</span> &#123;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        List&lt;String&gt; address = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        System.in.read();  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;  </span><br><span class="line">            <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;linux.words&quot;</span>), <span class="string">&quot;utf-8&quot;</span>))) &#123;  </span><br><span class="line">                <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">                <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                    line = reader.readLine();  </span><br><span class="line">                    <span class="keyword">if</span> (line == <span class="literal">null</span>) &#123;  </span><br><span class="line">                        <span class="keyword">break</span>;  </span><br><span class="line">                    &#125;  </span><br><span class="line"><span class="comment">//                    address.add(line);  </span></span><br><span class="line">                    address.add(line.intern());  </span><br><span class="line">                &#125;  </span><br><span class="line">                System.out.println(<span class="string">&quot;cost:&quot;</span> + (System.nanoTime() - start) / <span class="number">1000000</span>);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.in.read();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>visualvm</code> å·¥å…·</li><li>è¯»å–æ–‡ä»¶ä¹‹å‰<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023183405136.png" alt="|1000"></li><li>å¼€å§‹è¯»æ–‡ä»¶ <code>address.add(line); </code><ul><li>åŠ èµ·æ¥å ç”¨ <code>80%</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023183533655.png"></li></ul></li><li>ä½¿ç”¨æ”¾å…¥ä¸²æ± æ–¹æ³• <code>address.add(line.intern());  </code><ul><li>åŠ èµ·æ¥å ç”¨ <code>60%</code>   <code>Stringå’Œchar[]</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251023183855130.png"></li></ul></li></ul><h2 id="6-ç›´æ¥å†…å­˜"><a href="#6-ç›´æ¥å†…å­˜" class="headerlink" title="6. ç›´æ¥å†…å­˜"></a>6. ç›´æ¥å†…å­˜</h2><h3 id="6-1-å®šä¹‰"><a href="#6-1-å®šä¹‰" class="headerlink" title="6.1 å®šä¹‰"></a>6.1 å®šä¹‰</h3><p>Direct Memory </p><ul><li>ä¸å±äºjvmï¼Œæ˜¯å†…å­˜åŒºåŸŸ</li><li>å¸¸è§äº NIO æ“ä½œæ—¶ï¼Œ</li><li>ç”¨äºæ•°æ®ç¼“å†²åŒº åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œ</li><li>ä½†è¯»å†™æ€§èƒ½é«˜ ä¸å— JVM å†…å­˜å›æ”¶ç®¡ç†</li></ul><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤º ByteBuffer ä½œç”¨  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_9</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FROM</span> <span class="operator">=</span> <span class="string">&quot;/Users/cyt/Movies/test/1.mp4&quot;</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TO</span> <span class="operator">=</span> <span class="string">&quot;/Users/cyt/Movies/test/2.mp4&quot;</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1Mb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        io(); <span class="comment">// io ç”¨æ—¶ï¼š1535.586957 1766.963399 1359.240226  </span></span><br><span class="line">        directBuffer(); <span class="comment">// directBuffer ç”¨æ—¶ï¼š479.295165 702.291454 562.56592  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">directBuffer</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">from</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(FROM).getChannel();  </span><br><span class="line">             <span class="type">FileChannel</span> <span class="variable">to</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(TO).getChannel();  </span><br><span class="line">        ) &#123;  </span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">bb</span> <span class="operator">=</span> ByteBuffer.allocateDirect(_1Mb);  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> from.read(bb);  </span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                bb.flip();  </span><br><span class="line">                to.write(bb);  </span><br><span class="line">                bb.clear();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">        System.out.println(<span class="string">&quot;directBuffer ç”¨æ—¶ï¼š&quot;</span> + (end - start) / <span class="number">1000_000.0</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">io</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">from</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(FROM);  </span><br><span class="line">             <span class="type">FileOutputStream</span> <span class="variable">to</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(TO);  </span><br><span class="line">        ) &#123;  </span><br><span class="line">            <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[_1Mb];  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> from.read(buf);  </span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                to.write(buf, <span class="number">0</span>, len);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();  </span><br><span class="line">        System.out.println(<span class="string">&quot;io ç”¨æ—¶ï¼š&quot;</span> + (end - start) / <span class="number">1000_000.0</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024134050650.png"><br><strong>æ™®é€šio</strong>ï¼š</p><ul><li>åˆ‡æ¢ä¸ºå†…æ ¸æ€</li><li>åœ¨å†…å­˜ç”³è¯·javaç¼“å†²åŒº</li><li>ç³»ç»Ÿç¼“å†²åŒºå†…å®¹å¤åˆ¶åˆ°javaç¼“å†²åŒº<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024134733560.png" alt="|625"></li></ul><p><strong>directBuffer</strong>ï¼š</p><ul><li>è°ƒç”¨ <code>ByteBuffer bb = ByteBuffer.allocateDirect(_1Mb);</code></li><li><code>direct memory</code> javaå’Œç³»ç»Ÿéƒ½å¯ä»¥ç›´æ¥è®¿é—®<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024135125927.png" alt="|700"></li></ul><h3 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºç›´æ¥å†…å­˜æº¢å‡º  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_10</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_100Mb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">100</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        List&lt;ByteBuffer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(_100Mb); <span class="comment">// ç›´æ¥å†…å­˜åˆ†é… 100MB                list.add(byteBuffer);  </span></span><br><span class="line">                i++;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            System.out.println(i);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// æ–¹æ³•åŒºæ˜¯jvmè§„èŒƒï¼Œ jdk6 ä¸­å¯¹æ–¹æ³•åŒºçš„å®ç°ç§°ä¸ºæ°¸ä¹…ä»£  </span></span><br><span class="line">        <span class="comment">//                  jdk8 å¯¹æ–¹æ³•åŒºçš„å®ç°ç§°ä¸ºå…ƒç©ºé—´  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024135610375.png"></p><h3 id="6-2-åˆ†é…å’Œå›æ”¶åŸç†"><a href="#6-2-åˆ†é…å’Œå›æ”¶åŸç†" class="headerlink" title="6.2 åˆ†é…å’Œå›æ”¶åŸç†"></a>6.2 åˆ†é…å’Œå›æ”¶åŸç†</h3><ul><li>ä½¿ç”¨äº† <code>Unsafe</code> å¯¹è±¡å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå¹¶ä¸”å›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨ freeMemory æ–¹æ³• </li><li>ByteBuffer çš„å®ç°ç±»å†…éƒ¨ï¼Œä½¿ç”¨äº† <code>Cleaner</code> ï¼ˆè™šå¼•ç”¨ï¼‰æ¥ç›‘æµ‹ ByteBuffer å¯¹è±¡ï¼Œä¸€æ—¦ ByteBuffer å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šç”± <code>ReferenceHandler</code> çº¿ç¨‹é€šè¿‡ <code>Cleaner</code> çš„ <code>clean</code> æ–¹æ³•è°ƒ ç”¨ <code>freeMemory</code> æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li></ul><h4 id="æ¼”ç¤ºåƒåœ¾å›æ”¶"><a href="#æ¼”ç¤ºåƒåœ¾å›æ”¶" class="headerlink" title="æ¼”ç¤ºåƒåœ¾å›æ”¶"></a>æ¼”ç¤ºåƒåœ¾å›æ”¶</h4><ul><li>ä½¿ç”¨ <code>bytebuffer</code></li><li><code>-XX:+DisableExplicitGC ç¦ç”¨æ˜¾å¼çš„åƒåœ¾å›æ”¶  System.gc();</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * ç¦ç”¨æ˜¾å¼å›æ”¶å¯¹ç›´æ¥å†…å­˜çš„å½±å“  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_26</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1Gb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/*  </span></span><br><span class="line"><span class="comment">     * -XX:+DisableExplicitGC ç¦ç”¨æ˜¾å¼çš„åƒåœ¾å›æ”¶  System.gc();</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(_1Gb);  </span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ†é…å®Œæ¯•...&quot;</span>);  </span><br><span class="line">        System.in.read();  </span><br><span class="line">        System.out.println(<span class="string">&quot;å¼€å§‹é‡Šæ”¾...&quot;</span>);  </span><br><span class="line">        System.gc(); <span class="comment">// æ˜¾å¼çš„åƒåœ¾å›æ”¶ï¼ŒFull GC  </span></span><br><span class="line">        byteBuffer = <span class="literal">null</span>;  </span><br><span class="line">        System.in.read();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŒ‰ä¸‹ç¬¬ä¸€æ¬¡å›è½¦å‡ºç°javaè¿›ç¨‹ å ç”¨1GB</li><li>å†æ¬¡æŒ‰ä¸‹å›è½¦é‡Šæ”¾å†…å­˜<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024140153275.png" alt="|800"></li></ul><h4 id="unsafe"><a href="#unsafe" class="headerlink" title="unsafe"></a>unsafe</h4><ul><li>é€šè¿‡åå°„è·å–unsafe</li><li>javaä¸æ¨èç¨‹åºå‘˜ä½¿ç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * ç›´æ¥å†…å­˜åˆ†é…çš„åº•å±‚åŸç†ï¼šUnsafe  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1_27</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">_1Gb</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">        <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> getUnsafe();  </span><br><span class="line">        <span class="comment">// åˆ†é…å†…å­˜  </span></span><br><span class="line">        <span class="type">long</span> <span class="variable">base</span> <span class="operator">=</span> unsafe.allocateMemory(_1Gb); <span class="comment">// å†…å­˜åœ°å€  </span></span><br><span class="line">        System.out.println(<span class="string">&quot;baseåœ°å€: &quot;</span> + base);  </span><br><span class="line">        unsafe.setMemory(base, _1Gb, (<span class="type">byte</span>) <span class="number">0</span>);  </span><br><span class="line">        System.in.read();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// é‡Šæ”¾å†…å­˜  </span></span><br><span class="line">        unsafe.freeMemory(base);  </span><br><span class="line">        System.in.read();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> Unsafe.class.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);  </span><br><span class="line">            f.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">            <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) f.get(<span class="literal">null</span>);  </span><br><span class="line">            <span class="keyword">return</span> unsafe;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException | IllegalAccessException e) &#123;  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="byteBufferæºç å‰–æ"><a href="#byteBufferæºç å‰–æ" class="headerlink" title="byteBufferæºç å‰–æ"></a>byteBufferæºç å‰–æ</h4><ul><li><code>ByteBuffer byteBuffer = ByteBuffer.allocateDirect(_1Gb);</code></li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251024141552014.png"></li><li>å¤šå¼€ä¸€ä¸ªçº¿ç¨‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">DirectByteBuffer(<span class="type">int</span> cap) &#123;                   <span class="comment">// package-private  </span></span><br><span class="line">  </span><br><span class="line">    <span class="built_in">super</span>(-<span class="number">1</span>, <span class="number">0</span>, cap, cap);  </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">pa</span> <span class="operator">=</span> VM.isDirectMemoryPageAligned();  </span><br><span class="line">    <span class="type">int</span> <span class="variable">ps</span> <span class="operator">=</span> Bits.pageSize();  </span><br><span class="line">    <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> Math.max(<span class="number">1L</span>, (<span class="type">long</span>)cap + (pa ? ps : <span class="number">0</span>));  </span><br><span class="line">    Bits.reserveMemory(size, cap);  </span><br><span class="line">  </span><br><span class="line">    <span class="type">long</span> <span class="variable">base</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        base = unsafe.allocateMemory(size);  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (OutOfMemoryError x) &#123;  </span><br><span class="line">        Bits.unreserveMemory(size, cap);  </span><br><span class="line">        <span class="keyword">throw</span> x;  </span><br><span class="line">    &#125;  </span><br><span class="line">    unsafe.setMemory(base, size, (<span class="type">byte</span>) <span class="number">0</span>);  </span><br><span class="line">    <span class="keyword">if</span> (pa &amp;&amp; (base % ps != <span class="number">0</span>)) &#123;  </span><br><span class="line">        <span class="comment">// Round up to page boundary  </span></span><br><span class="line">        address = base + ps - (base &amp; (ps - <span class="number">1</span>));  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">        address = base;  </span><br><span class="line">    &#125;  </span><br><span class="line">    cleaner = Cleaner.create(<span class="built_in">this</span>, <span class="keyword">new</span> <span class="title class_">Deallocator</span>(base, size, cap));  </span><br><span class="line">    att = <span class="literal">null</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="cleanerå¯¹è±¡"><a href="#cleanerå¯¹è±¡" class="headerlink" title="cleanerå¯¹è±¡"></a>cleanerå¯¹è±¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cleaner</span>  </span><br><span class="line">    <span class="keyword">extends</span> <span class="title class_">PhantomReference</span>&lt;Object&gt;  </span><br><span class="line">&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Dummy reference queue, needed because the PhantomReference constructor  </span></span><br><span class="line">    <span class="comment">// insists that we pass a queue.  Nothing will ever be placed on this queue    </span></span><br><span class="line">    <span class="comment">// since the reference handler invokes cleaners explicitly.    </span></span><br><span class="line">    <span class="comment">//    private static final ReferenceQueue&lt;Object&gt; dummyQueue = new ReferenceQueue&lt;&gt;();  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Doubly-linked list of live cleaners, which prevents the cleaners  </span></span><br><span class="line">    <span class="comment">// themselves from being GC&#x27;d before their referents    </span></span><br><span class="line">    <span class="comment">//    static private Cleaner first = null;  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">Cleaner</span>  </span><br><span class="line">        <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>,  </span><br><span class="line">        prev = <span class="literal">null</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Cleaner <span class="title function_">add</span><span class="params">(Cleaner cl)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (first != <span class="literal">null</span>) &#123;  </span><br><span class="line">            cl.next = first;  </span><br><span class="line">            first.prev = cl;  </span><br><span class="line">        &#125;  </span><br><span class="line">        first = cl;  </span><br><span class="line">        <span class="keyword">return</span> cl;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Cleaner cl)</span> &#123;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// If already removed, do nothing  </span></span><br><span class="line">        <span class="keyword">if</span> (cl.next == cl)  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Update list  </span></span><br><span class="line">        <span class="keyword">if</span> (first == cl) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (cl.next != <span class="literal">null</span>)  </span><br><span class="line">                first = cl.next;  </span><br><span class="line">            <span class="keyword">else</span>  </span><br><span class="line">                first = cl.prev;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (cl.next != <span class="literal">null</span>)  </span><br><span class="line">            cl.next.prev = cl.prev;  </span><br><span class="line">        <span class="keyword">if</span> (cl.prev != <span class="literal">null</span>)  </span><br><span class="line">            cl.prev.next = cl.next;  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// Indicate removal by pointing the cleaner to itself  </span></span><br><span class="line">        cl.next = cl;  </span><br><span class="line">        cl.prev = cl;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Runnable thunk;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Cleaner</span><span class="params">(Object referent, Runnable thunk)</span> &#123;  </span><br><span class="line">        <span class="built_in">super</span>(referent, dummyQueue);  </span><br><span class="line">        <span class="built_in">this</span>.thunk = thunk;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Creates a new cleaner.     *     * <span class="doctag">@param</span>  ob the referent object to be cleaned  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  thunk  </span></span><br><span class="line"><span class="comment">     *         The cleanup code to be run when the cleaner is invoked.  The  </span></span><br><span class="line"><span class="comment">     *         cleanup code is run directly from the reference-handler thread,     *         </span></span><br><span class="line"><span class="comment">       so it should be as simple and straightforward as possible.     *     * </span></span><br><span class="line"><span class="comment">       <span class="doctag">@return</span>  The new cleaner  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Cleaner <span class="title function_">create</span><span class="params">(Object ob, Runnable thunk)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (thunk == <span class="literal">null</span>)  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">return</span> add(<span class="keyword">new</span> <span class="title class_">Cleaner</span>(ob, thunk));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Runs this cleaner, if it has not been run before.     */</span>    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clean</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (!remove(<span class="built_in">this</span>))  </span><br><span class="line">            <span class="keyword">return</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            thunk.run();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Throwable x) &#123;  </span><br><span class="line">            AccessController.doPrivileged(<span class="keyword">new</span> <span class="title class_">PrivilegedAction</span>&lt;Void&gt;() &#123;  </span><br><span class="line">                    <span class="keyword">public</span> Void <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">                        <span class="keyword">if</span> (System.err != <span class="literal">null</span>)  </span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Cleaner terminated abnormally&quot;</span>, x)  </span><br><span class="line">                                .printStackTrace();  </span><br><span class="line">                        System.exit(<span class="number">1</span>);  </span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">                    &#125;&#125;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearchä¼ä¸šçº§åº”ç”¨å®æˆ˜</title>
      <link href="//post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98.html"/>
      <url>//post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-åˆè¯†elasticsearch"><a href="#1-åˆè¯†elasticsearch" class="headerlink" title="1.åˆè¯†elasticsearch"></a>1.åˆè¯†elasticsearch</h1><h2 id="1-1-äº†è§£ES"><a href="#1-1-äº†è§£ES" class="headerlink" title="1.1.äº†è§£ES"></a>1.1.äº†è§£ES</h2><h3 id="1-1-1-elasticsearchçš„ä½œç”¨"><a href="#1-1-1-elasticsearchçš„ä½œç”¨" class="headerlink" title="1.1.1.elasticsearchçš„ä½œç”¨"></a>1.1.1.elasticsearchçš„ä½œç”¨</h3><p>elasticsearchæ˜¯ä¸€æ¬¾éå¸¸å¼ºå¤§çš„å¼€æºæœç´¢å¼•æ“ï¼Œå…·å¤‡éå¸¸å¤šå¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»æµ·é‡æ•°æ®ä¸­å¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„å†…å®¹</p><p>ä¾‹å¦‚ï¼š</p><ul><li><p>åœ¨GitHubæœç´¢ä»£ç </p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720193623245.png" alt="image-20210720193623245"></p></li><li><p>åœ¨ç”µå•†ç½‘ç«™æœç´¢å•†å“</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720193633483.png" alt="image-20210720193633483"></p></li><li><p>åœ¨ç™¾åº¦æœç´¢ç­”æ¡ˆ</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720193641907.png" alt="image-20210720193641907"></p></li><li><p>åœ¨æ‰“è½¦è½¯ä»¶æœç´¢é™„è¿‘çš„è½¦</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720193648044.png" alt="image-20210720193648044"></p></li></ul><h3 id="1-1-2-ELKæŠ€æœ¯æ ˆ"><a href="#1-1-2-ELKæŠ€æœ¯æ ˆ" class="headerlink" title="1.1.2.ELKæŠ€æœ¯æ ˆ"></a>1.1.2.ELKæŠ€æœ¯æ ˆ</h3><p><code>elasticsearchç»“åˆkibanaã€Logstashã€Beats</code>ï¼Œä¹Ÿå°±æ˜¯elastic stackï¼ˆELKï¼‰ã€‚è¢«å¹¿æ³›åº”ç”¨åœ¨æ—¥å¿—æ•°æ®åˆ†æã€å®æ—¶ç›‘æ§ç­‰é¢†åŸŸï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720194008781.png" alt="image-20210720194008781"></p><p>è€Œelasticsearchæ˜¯elastic stackçš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨ã€æœç´¢ã€åˆ†ææ•°æ®ã€‚</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720194230265.png" alt="image-20210720194230265"></p><h3 id="1-1-3-elasticsearchå’Œlucene"><a href="#1-1-3-elasticsearchå’Œlucene" class="headerlink" title="1.1.3.elasticsearchå’Œlucene"></a>1.1.3.elasticsearchå’Œlucene</h3><p>elasticsearchåº•å±‚æ˜¯åŸºäº<strong>lucene</strong>æ¥å®ç°çš„ã€‚</p><p><code>**Lucene**æ˜¯ä¸€ä¸ªJavaè¯­è¨€çš„æœç´¢å¼•æ“ç±»åº“</code>ï¼Œæ˜¯Apacheå…¬å¸çš„é¡¶çº§é¡¹ç›®ï¼Œç”±DougCuttingäº1999å¹´ç ”å‘ã€‚å®˜ç½‘åœ°å€ï¼š<a href="https://lucene.apache.org/">https://lucene.apache.org/</a> ã€‚</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720194547780.png" alt="image-20210720194547780"></p><p><strong>elasticsearch</strong>çš„å‘å±•å†å²ï¼š</p><ul><li>2004å¹´Shay BanonåŸºäºLuceneå¼€å‘äº†Compass</li><li>2010å¹´Shay Banon é‡å†™äº†Compassï¼Œå–åä¸ºElasticsearchã€‚</li></ul><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720195001221.png" alt="image-20210720195001221"></p><h3 id="1-1-4-ä¸ºä»€ä¹ˆä¸æ˜¯å…¶ä»–æœç´¢æŠ€æœ¯ï¼Ÿ"><a href="#1-1-4-ä¸ºä»€ä¹ˆä¸æ˜¯å…¶ä»–æœç´¢æŠ€æœ¯ï¼Ÿ" class="headerlink" title="1.1.4.ä¸ºä»€ä¹ˆä¸æ˜¯å…¶ä»–æœç´¢æŠ€æœ¯ï¼Ÿ"></a>1.1.4.ä¸ºä»€ä¹ˆä¸æ˜¯å…¶ä»–æœç´¢æŠ€æœ¯ï¼Ÿ</h3><p>ç›®å‰æ¯”è¾ƒçŸ¥åçš„æœç´¢å¼•æ“æŠ€æœ¯æ’åï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720195142535.png" alt="image-20210720195142535"></p><p>è™½ç„¶åœ¨æ—©æœŸï¼ŒApache Solræ˜¯æœ€ä¸»è¦çš„æœç´¢å¼•æ“æŠ€æœ¯ï¼Œä½†éšç€å‘å±•elasticsearchå·²ç»æ¸æ¸è¶…è¶Šäº†Solrï¼Œç‹¬å é³Œå¤´ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720195306484.png" alt="image-20210720195306484"></p><h3 id="1-1-5-æ€»ç»“"><a href="#1-1-5-æ€»ç»“" class="headerlink" title="1.1.5.æ€»ç»“"></a>1.1.5.æ€»ç»“</h3><p>ä»€ä¹ˆæ˜¯elasticsearchï¼Ÿ</p><ul><li>ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå¯ä»¥ç”¨æ¥å®ç°æœç´¢ã€æ—¥å¿—ç»Ÿè®¡ã€åˆ†æã€ç³»ç»Ÿç›‘æ§ç­‰åŠŸèƒ½</li></ul><p>ä»€ä¹ˆæ˜¯elastic stackï¼ˆELKï¼‰ï¼Ÿ</p><ul><li>æ˜¯ä»¥elasticsearchä¸ºæ ¸å¿ƒçš„æŠ€æœ¯æ ˆï¼ŒåŒ…æ‹¬beatsã€Logstashã€kibanaã€elasticsearch</li></ul><p>ä»€ä¹ˆæ˜¯Luceneï¼Ÿ</p><ul><li>æ˜¯Apacheçš„å¼€æºæœç´¢å¼•æ“ç±»åº“ï¼Œæä¾›äº†æœç´¢å¼•æ“çš„æ ¸å¿ƒAPI</li></ul><h2 id="1-2-å€’æ’ç´¢å¼•ï¼ˆé‡ç‚¹ï¼‰"><a href="#1-2-å€’æ’ç´¢å¼•ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="1.2.å€’æ’ç´¢å¼•ï¼ˆé‡ç‚¹ï¼‰"></a>1.2.å€’æ’ç´¢å¼•ï¼ˆé‡ç‚¹ï¼‰</h2><p>å€’æ’ç´¢å¼•çš„æ¦‚å¿µæ˜¯åŸºäºMySQLè¿™æ ·çš„æ­£å‘ç´¢å¼•è€Œè¨€çš„ã€‚</p><h3 id="1-2-1-æ­£å‘ç´¢å¼•"><a href="#1-2-1-æ­£å‘ç´¢å¼•" class="headerlink" title="1.2.1.æ­£å‘ç´¢å¼•"></a>1.2.1.æ­£å‘ç´¢å¼•</h3><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯æ­£å‘ç´¢å¼•å‘¢ï¼Ÿä¾‹å¦‚ç»™ä¸‹è¡¨ï¼ˆtb_goodsï¼‰ä¸­çš„idåˆ›å»ºç´¢å¼•ï¼š</p><img src="assets/image-20210720195531539.png" alt=" " style="zoom:70%;" /><p>å¦‚æœæ˜¯æ ¹æ®idæŸ¥è¯¢ï¼Œé‚£ä¹ˆç›´æ¥èµ°ç´¢å¼•ï¼ŒæŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«ã€‚</p><p>ä½†å¦‚æœæ˜¯åŸºäºtitleåšæ¨¡ç³ŠæŸ¥è¯¢ï¼Œåªèƒ½æ˜¯é€è¡Œæ‰«ææ•°æ®ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>1ï¼‰ç”¨æˆ·æœç´¢æ•°æ®ï¼Œæ¡ä»¶æ˜¯titleç¬¦åˆ<code>&quot;%æ‰‹æœº%&quot;</code></p><p>2ï¼‰é€è¡Œè·å–æ•°æ®ï¼Œæ¯”å¦‚idä¸º1çš„æ•°æ®</p><p>3ï¼‰åˆ¤æ–­æ•°æ®ä¸­çš„titleæ˜¯å¦ç¬¦åˆç”¨æˆ·æœç´¢æ¡ä»¶</p><p>4ï¼‰å¦‚æœç¬¦åˆåˆ™æ”¾å…¥ç»“æœé›†ï¼Œä¸ç¬¦åˆåˆ™ä¸¢å¼ƒã€‚å›åˆ°æ­¥éª¤1</p><p>é€è¡Œæ‰«æï¼Œä¹Ÿå°±æ˜¯<code>å…¨è¡¨æ‰«æ</code>ï¼Œéšç€æ•°æ®é‡å¢åŠ ï¼Œå…¶æŸ¥è¯¢æ•ˆç‡ä¹Ÿä¼šè¶Šæ¥è¶Šä½ã€‚å½“æ•°æ®é‡è¾¾åˆ°æ•°ç™¾ä¸‡æ—¶ï¼Œå°±æ˜¯ä¸€åœºç¾éš¾ã€‚</p><h3 id="1-2-2-å€’æ’ç´¢å¼•"><a href="#1-2-2-å€’æ’ç´¢å¼•" class="headerlink" title="1.2.2.å€’æ’ç´¢å¼•"></a>1.2.2.å€’æ’ç´¢å¼•</h3><blockquote><p>å€’æ’ç´¢å¼•ä¸­æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æ–‡æ¡£ï¼ˆ<code>Document</code>ï¼‰ï¼šç”¨æ¥æœç´¢çš„æ•°æ®ï¼Œå…¶ä¸­çš„æ¯ä¸€æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ã€‚ä¾‹å¦‚ä¸€ä¸ªç½‘é¡µã€ä¸€ä¸ªå•†å“ä¿¡æ¯</li><li>è¯æ¡ï¼ˆ<code>Term</code>ï¼‰ï¼šå¯¹æ–‡æ¡£æ•°æ®æˆ–ç”¨æˆ·æœç´¢æ•°æ®ï¼Œåˆ©ç”¨æŸç§ç®—æ³•åˆ†è¯ï¼Œå¾—åˆ°çš„å…·å¤‡å«ä¹‰çš„è¯è¯­å°±æ˜¯è¯æ¡ã€‚ä¾‹å¦‚ï¼šæˆ‘æ˜¯ä¸­å›½äººï¼Œå°±å¯ä»¥åˆ†ä¸ºï¼šæˆ‘ã€æ˜¯ã€ä¸­å›½äººã€ä¸­å›½ã€å›½äººè¿™æ ·çš„å‡ ä¸ªè¯æ¡</li></ul><p><strong>åˆ›å»ºå€’æ’ç´¢å¼•</strong>æ˜¯å¯¹æ­£å‘ç´¢å¼•çš„ä¸€ç§ç‰¹æ®Šå¤„ç†ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å°†æ¯ä¸€ä¸ªæ–‡æ¡£çš„æ•°æ®åˆ©ç”¨ç®—æ³•åˆ†è¯ï¼Œå¾—åˆ°ä¸€ä¸ªä¸ªè¯æ¡</li><li>åˆ›å»ºè¡¨ï¼Œæ¯è¡Œæ•°æ®åŒ…æ‹¬è¯æ¡ã€è¯æ¡æ‰€åœ¨æ–‡æ¡£idã€ä½ç½®ç­‰ä¿¡æ¯</li><li>å› ä¸ºè¯æ¡å”¯ä¸€æ€§ï¼Œå¯ä»¥ç»™è¯æ¡åˆ›å»ºç´¢å¼•ï¼Œä¾‹å¦‚hashè¡¨ç»“æ„ç´¢å¼•</li></ul><p>ç†è§£ï¼š</p><ul><li><code>æ­£å‘ç´¢å¼•</code>ï¼š æ ¹æ®æ–‡æ¡£æ‰¾è¯</li><li><code>å€’æ’ç´¢å¼•</code>ï¼šæ ¹æ®åˆ†è¯åè¿‡æ¥æ‰¾æ–‡æ¡£</li></ul></blockquote><p>å¦‚å›¾ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720200457207.png" alt="image-20210720200457207"></p><p>å€’æ’ç´¢å¼•çš„<strong>æœç´¢æµç¨‹</strong>å¦‚ä¸‹ï¼ˆä»¥æœç´¢â€åä¸ºæ‰‹æœºâ€ä¸ºä¾‹ï¼‰ï¼š</p><p>1ï¼‰ç”¨æˆ·è¾“å…¥æ¡ä»¶<code>&quot;åä¸ºæ‰‹æœº&quot;</code>è¿›è¡Œæœç´¢ã€‚</p><p>2ï¼‰å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹<strong>åˆ†è¯</strong>ï¼Œå¾—åˆ°è¯æ¡ï¼š<code>åä¸º</code>ã€<code>æ‰‹æœº</code>ã€‚</p><p>3ï¼‰æ‹¿ç€è¯æ¡åœ¨å€’æ’ç´¢å¼•ä¸­æŸ¥æ‰¾ï¼Œå¯ä»¥å¾—åˆ°åŒ…å«è¯æ¡çš„æ–‡æ¡£idï¼š1ã€2ã€3ã€‚</p><p>4ï¼‰æ‹¿ç€æ–‡æ¡£idåˆ°æ­£å‘ç´¢å¼•ä¸­æŸ¥æ‰¾å…·ä½“æ–‡æ¡£ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720201115192.png" alt="image-20210720201115192"></p><p>è™½ç„¶è¦å…ˆæŸ¥è¯¢å€’æ’ç´¢å¼•ï¼Œå†æŸ¥è¯¢å€’æ’ç´¢å¼•ï¼Œä½†æ˜¯æ— è®ºæ˜¯è¯æ¡ã€è¿˜æ˜¯æ–‡æ¡£idéƒ½å»ºç«‹äº†ç´¢å¼•ï¼ŒæŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«ï¼æ— éœ€å…¨è¡¨æ‰«æã€‚</p><h3 id="1-2-3-æ­£å‘å’Œå€’æ’"><a href="#1-2-3-æ­£å‘å’Œå€’æ’" class="headerlink" title="1.2.3.æ­£å‘å’Œå€’æ’"></a>1.2.3.æ­£å‘å’Œå€’æ’</h3><img src="./assets/image-20251010134946035.png" alt=" " style="zoom:50%;" /><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¸€ä¸ªå«åšæ­£å‘ç´¢å¼•ï¼Œä¸€ä¸ªå«åšå€’æ’ç´¢å¼•å‘¢ï¼Ÿ</p><ul><li><p><strong>æ­£å‘ç´¢å¼•</strong>æ˜¯æœ€ä¼ ç»Ÿçš„ï¼Œæ ¹æ®idç´¢å¼•çš„æ–¹å¼ã€‚ä½†æ ¹æ®è¯æ¡æŸ¥è¯¢æ—¶ï¼Œå¿…é¡»å…ˆé€æ¡è·å–æ¯ä¸ªæ–‡æ¡£ï¼Œç„¶ååˆ¤æ–­æ–‡æ¡£ä¸­æ˜¯å¦åŒ…å«æ‰€éœ€è¦çš„è¯æ¡ï¼Œæ˜¯<strong>æ ¹æ®æ–‡æ¡£æ‰¾è¯æ¡çš„è¿‡ç¨‹</strong>ã€‚</p></li><li><p>è€Œ<strong>å€’æ’ç´¢å¼•</strong>åˆ™ç›¸åï¼Œæ˜¯å…ˆæ‰¾åˆ°ç”¨æˆ·è¦æœç´¢çš„è¯æ¡ï¼Œæ ¹æ®è¯æ¡å¾—åˆ°ä¿æŠ¤è¯æ¡çš„æ–‡æ¡£çš„idï¼Œç„¶åæ ¹æ®idè·å–æ–‡æ¡£ã€‚æ˜¯<strong>æ ¹æ®è¯æ¡æ‰¾æ–‡æ¡£çš„è¿‡ç¨‹</strong>ã€‚</p></li></ul><p>æ˜¯ä¸æ˜¯æ°å¥½åè¿‡æ¥äº†ï¼Ÿ</p><p>é‚£ä¹ˆä¸¤è€…æ–¹å¼çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p><strong>æ­£å‘ç´¢å¼•</strong>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼š<ul><li>å¯ä»¥ç»™å¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•</li><li>æ ¹æ®ç´¢å¼•å­—æ®µæœç´¢ã€æ’åºé€Ÿåº¦éå¸¸å¿«</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>æ ¹æ®éç´¢å¼•å­—æ®µï¼Œæˆ–è€…ç´¢å¼•å­—æ®µä¸­çš„éƒ¨åˆ†è¯æ¡æŸ¥æ‰¾æ—¶ï¼Œåªèƒ½å…¨è¡¨æ‰«æã€‚</li></ul></li></ul><p><strong>å€’æ’ç´¢å¼•</strong>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼š<ul><li>æ ¹æ®è¯æ¡æœç´¢ã€æ¨¡ç³Šæœç´¢æ—¶ï¼Œé€Ÿåº¦éå¸¸å¿«</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>åªèƒ½ç»™è¯æ¡åˆ›å»ºç´¢å¼•ï¼Œè€Œä¸æ˜¯å­—æ®µ</li><li>æ— æ³•æ ¹æ®å­—æ®µåšæ’åº</li></ul></li></ul><h2 id="1-3-esçš„ä¸€äº›æ¦‚å¿µï¼ˆé‡è¦ï¼‰"><a href="#1-3-esçš„ä¸€äº›æ¦‚å¿µï¼ˆé‡è¦ï¼‰" class="headerlink" title="1.3.esçš„ä¸€äº›æ¦‚å¿µï¼ˆé‡è¦ï¼‰"></a>1.3.esçš„ä¸€äº›æ¦‚å¿µï¼ˆé‡è¦ï¼‰</h2><p>elasticsearchä¸­æœ‰å¾ˆå¤šç‹¬æœ‰çš„æ¦‚å¿µï¼Œä¸mysqlä¸­ç•¥æœ‰å·®åˆ«ï¼Œä½†ä¹Ÿæœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚</p><h3 id="1-3-1-æ–‡æ¡£å’Œå­—æ®µ"><a href="#1-3-1-æ–‡æ¡£å’Œå­—æ®µ" class="headerlink" title="1.3.1.æ–‡æ¡£å’Œå­—æ®µ"></a>1.3.1.æ–‡æ¡£å’Œå­—æ®µ</h3><p>elasticsearchæ˜¯é¢å‘**æ–‡æ¡£ï¼ˆDocumentï¼‰**å­˜å‚¨çš„ï¼Œå¯ä»¥æ˜¯æ•°æ®åº“ä¸­çš„ä¸€æ¡å•†å“æ•°æ®ï¼Œä¸€ä¸ªè®¢å•ä¿¡æ¯ã€‚<code>æ–‡æ¡£æ•°æ®ä¼šè¢«åºåˆ—åŒ–ä¸ºjsonæ ¼å¼åå­˜å‚¨åœ¨elasticsearchä¸­</code>ï¼š</p><ul><li><code>æ–‡æ¡£</code>ï¼š ç†è§£ä¸ºæ¯ä¸€ä¸ª{} èŠ±æ‹¬å·é‡Œçš„æ•°æ®</li><li><code>å­—æ®µ</code>ï¼š èŠ±æ‹¬å·é‡Œçš„å­—æ®µï¼š <code>id title price</code></li></ul><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720202707797.png" alt="image-20210720202707797"></p><p>è€ŒJsonæ–‡æ¡£ä¸­å¾€å¾€åŒ…å«å¾ˆå¤šçš„<strong>å­—æ®µï¼ˆFieldï¼‰</strong>ï¼Œç±»ä¼¼äºæ•°æ®åº“ä¸­çš„åˆ—ã€‚</p><h3 id="1-3-2-ç´¢å¼•å’Œæ˜ å°„"><a href="#1-3-2-ç´¢å¼•å’Œæ˜ å°„" class="headerlink" title="1.3.2.ç´¢å¼•å’Œæ˜ å°„"></a>1.3.2.ç´¢å¼•å’Œæ˜ å°„</h3><p><strong>ç´¢å¼•ï¼ˆIndexï¼‰</strong>ï¼Œå°±æ˜¯ç›¸åŒç±»å‹çš„æ–‡æ¡£çš„é›†åˆã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li>æ‰€æœ‰ç”¨æˆ·æ–‡æ¡£ï¼Œå°±å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç§°ä¸ºç”¨æˆ·çš„ç´¢å¼•ï¼›</li><li>æ‰€æœ‰å•†å“çš„æ–‡æ¡£ï¼Œå¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç§°ä¸ºå•†å“çš„ç´¢å¼•ï¼›</li><li>æ‰€æœ‰è®¢å•çš„æ–‡æ¡£ï¼Œå¯ä»¥ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç§°ä¸ºè®¢å•çš„ç´¢å¼•ï¼›</li></ul><img src="./assets/image-20251010135309300.png" alt=" " style="zoom:50%;" /><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç´¢å¼•å½“åšæ˜¯æ•°æ®åº“ä¸­çš„è¡¨ã€‚</p><p>æ•°æ®åº“çš„è¡¨ä¼šæœ‰çº¦æŸä¿¡æ¯ï¼Œç”¨æ¥å®šä¹‰è¡¨çš„ç»“æ„ã€å­—æ®µçš„åç§°ã€ç±»å‹ç­‰ä¿¡æ¯ã€‚å› æ­¤ï¼Œç´¢å¼•åº“ä¸­å°±æœ‰<strong>æ˜ å°„ï¼ˆmappingï¼‰</strong>ï¼Œæ˜¯ç´¢å¼•ä¸­æ–‡æ¡£çš„å­—æ®µçº¦æŸä¿¡æ¯ï¼Œç±»ä¼¼è¡¨çš„ç»“æ„çº¦æŸã€‚</p><h3 id="1-3-3-mysqlä¸elasticsearch"><a href="#1-3-3-mysqlä¸elasticsearch" class="headerlink" title="1.3.3.mysqlä¸elasticsearch"></a>1.3.3.mysqlä¸elasticsearch</h3><p>æˆ‘ä»¬ç»Ÿä¸€çš„æŠŠmysqlä¸elasticsearchçš„æ¦‚å¿µåšä¸€ä¸‹å¯¹æ¯”ï¼š</p><table><thead><tr><th><strong>MySQL</strong></th><th><strong>Elasticsearch</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>Table</td><td>Index</td><td>ç´¢å¼•(index)ï¼Œå°±æ˜¯æ–‡æ¡£çš„é›†åˆï¼Œç±»ä¼¼æ•°æ®åº“çš„è¡¨(table)</td></tr><tr><td>Row</td><td>Document</td><td>æ–‡æ¡£ï¼ˆDocumentï¼‰ï¼Œå°±æ˜¯ä¸€æ¡æ¡çš„æ•°æ®ï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„è¡Œï¼ˆRowï¼‰ï¼Œæ–‡æ¡£éƒ½æ˜¯JSONæ ¼å¼</td></tr><tr><td>Column</td><td>Field</td><td>å­—æ®µï¼ˆFieldï¼‰ï¼Œå°±æ˜¯JSONæ–‡æ¡£ä¸­çš„å­—æ®µï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„åˆ—ï¼ˆColumnï¼‰</td></tr><tr><td>Schema</td><td>Mapping</td><td>Mappingï¼ˆæ˜ å°„ï¼‰æ˜¯ç´¢å¼•ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œä¾‹å¦‚å­—æ®µç±»å‹çº¦æŸã€‚ç±»ä¼¼æ•°æ®åº“çš„è¡¨ç»“æ„ï¼ˆSchemaï¼‰</td></tr><tr><td>SQL</td><td>DSL</td><td>DSLæ˜¯elasticsearchæä¾›çš„JSONé£æ ¼çš„è¯·æ±‚è¯­å¥ï¼Œç”¨æ¥æ“ä½œelasticsearchï¼Œå®ç°CRUD ï¼ˆä¸€ç§è¯­æ³•ï¼‰</td></tr></tbody></table><img src="./assets/image-20251010135617487.png" alt=" " style="zoom:50%;" /><blockquote><p>æ˜¯ä¸æ˜¯è¯´ï¼Œæˆ‘ä»¬å­¦ä¹ äº†elasticsearchå°±ä¸å†éœ€è¦mysqläº†å‘¢ï¼Ÿ</p><p>å¹¶ä¸æ˜¯å¦‚æ­¤ï¼Œä¸¤è€…å„è‡ªæœ‰è‡ªå·±çš„æ“…é•¿æ”¯å‡ºï¼š</p><ul><li><p>Mysqlï¼šæ“…é•¿äº‹åŠ¡ç±»å‹æ“ä½œï¼Œå¯ä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨å’Œä¸€è‡´æ€§</p></li><li><p>Elasticsearchï¼šæ“…é•¿æµ·é‡æ•°æ®çš„æœç´¢ã€åˆ†æã€è®¡ç®— ï¼ˆæ²¡æœ‰äº‹åŠ¡ï¼‰</p></li></ul><p>å› æ­¤åœ¨ä¼ä¸šä¸­ï¼Œå¾€å¾€æ˜¯ä¸¤è€…ç»“åˆä½¿ç”¨ï¼š</p><ul><li>å¯¹å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„å†™æ“ä½œï¼Œä½¿ç”¨mysqlå®ç°</li><li>å¯¹æŸ¥è¯¢æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„æœç´¢éœ€æ±‚ï¼Œä½¿ç”¨elasticsearchå®ç°</li><li>ä¸¤è€…å†åŸºäºæŸç§æ–¹å¼ï¼Œå®ç°æ•°æ®çš„åŒæ­¥ï¼Œä¿è¯ä¸€è‡´æ€§</li></ul></blockquote><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720203534945.png" alt="image-20210720203534945"></p><h3 id="1-3-4-æ€»ç»“"><a href="#1-3-4-æ€»ç»“" class="headerlink" title="1.3.4 æ€»ç»“"></a>1.3.4 æ€»ç»“</h3><img src="./assets/image-20251010140139887.png" alt=" " style="zoom:50%;" /><h2 id="1-4-å®‰è£…esã€kibana"><a href="#1-4-å®‰è£…esã€kibana" class="headerlink" title="1.4.å®‰è£…esã€kibana"></a>1.4.å®‰è£…esã€kibana</h2><h3 id="1-4-1-å®‰è£…"><a href="#1-4-1-å®‰è£…" class="headerlink" title="1.4.1.å®‰è£…"></a>1.4.1.å®‰è£…</h3><p>å‚è€ƒè¯¾å‰èµ„æ–™ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720203805350.png" alt="image-20210720203805350"> </p><h3 id="1-4-2-åˆ†è¯å™¨"><a href="#1-4-2-åˆ†è¯å™¨" class="headerlink" title="1.4.2.åˆ†è¯å™¨"></a>1.4.2.åˆ†è¯å™¨</h3><p>å‚è€ƒè¯¾å‰èµ„æ–™ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720203805350.png" alt="image-20210720203805350"> </p><h3 id="1-4-3-æ€»ç»“"><a href="#1-4-3-æ€»ç»“" class="headerlink" title="1.4.3.æ€»ç»“"></a>1.4.3.æ€»ç»“</h3><p>åˆ†è¯å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>åˆ›å»ºå€’æ’ç´¢å¼•æ—¶å¯¹æ–‡æ¡£åˆ†è¯</li><li>ç”¨æˆ·æœç´¢æ—¶ï¼Œå¯¹è¾“å…¥çš„å†…å®¹åˆ†è¯</li></ul><p>IKåˆ†è¯å™¨æœ‰å‡ ç§æ¨¡å¼ï¼Ÿ</p><ul><li>ik_smartï¼šæ™ºèƒ½åˆ‡åˆ†ï¼Œç²—ç²’åº¦</li><li>ik_max_wordï¼šæœ€ç»†åˆ‡åˆ†ï¼Œç»†ç²’åº¦</li></ul><h1 id="DSLè¯­æ³•è¡¥å……"><a href="#DSLè¯­æ³•è¡¥å……" class="headerlink" title="DSLè¯­æ³•è¡¥å……"></a>DSLè¯­æ³•è¡¥å……</h1><h2 id="ç´¢å¼•åº“æ“ä½œ"><a href="#ç´¢å¼•åº“æ“ä½œ" class="headerlink" title="ç´¢å¼•åº“æ“ä½œ"></a>ç´¢å¼•åº“æ“ä½œ</h2><h3 id="mappingæ˜ å°„å±æ€§"><a href="#mappingæ˜ å°„å±æ€§" class="headerlink" title="mappingæ˜ å°„å±æ€§"></a>mappingæ˜ å°„å±æ€§</h3><img src="./assets/image-20251010155822840.png" alt=" " style="zoom:50%;" /><h3 id="åˆ›å»ºç´¢å¼•åº“ï¼ˆDSLè¯­æ³•ï¼‰"><a href="#åˆ›å»ºç´¢å¼•åº“ï¼ˆDSLè¯­æ³•ï¼‰" class="headerlink" title="åˆ›å»ºç´¢å¼•åº“ï¼ˆDSLè¯­æ³•ï¼‰"></a>åˆ›å»ºç´¢å¼•åº“ï¼ˆDSLè¯­æ³•ï¼‰</h3><img src="./assets/image-20251010160030238.png" alt=" " style="zoom:50%;" /><h3 id="ç´¢å¼•åº“CRUD"><a href="#ç´¢å¼•åº“CRUD" class="headerlink" title="ç´¢å¼•åº“CRUD"></a>ç´¢å¼•åº“CRUD</h3><h4 id="æŸ¥è¯¢åˆ é™¤"><a href="#æŸ¥è¯¢åˆ é™¤" class="headerlink" title="æŸ¥è¯¢åˆ é™¤"></a>æŸ¥è¯¢åˆ é™¤</h4><img src="./assets/image-20251010160405164.png" alt=" " style="zoom:50%;" /><h4 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h4><img src="./assets/image-20251010160627990.png" alt=" " style="zoom:53%;" /><h2 id="æ–‡æ¡£æ“ä½œ"><a href="#æ–‡æ¡£æ“ä½œ" class="headerlink" title="æ–‡æ¡£æ“ä½œ"></a>æ–‡æ¡£æ“ä½œ</h2><h3 id="æ–°å¢æ–‡æ¡£"><a href="#æ–°å¢æ–‡æ¡£" class="headerlink" title="æ–°å¢æ–‡æ¡£"></a>æ–°å¢æ–‡æ¡£</h3><blockquote><p>ç±»ä¼¼mysqlæ–°å¢ä¸€è¡Œæ•°æ®</p></blockquote><img src="./assets/image-20251010160843721.png" alt=" " style="zoom:50%;" /><h3 id="æŸ¥çœ‹-åˆ é™¤æ–‡æ¡£"><a href="#æŸ¥çœ‹-åˆ é™¤æ–‡æ¡£" class="headerlink" title="æŸ¥çœ‹&amp;åˆ é™¤æ–‡æ¡£"></a>æŸ¥çœ‹&amp;åˆ é™¤æ–‡æ¡£</h3><img src="./assets/image-20251010161033464.png" alt=" " style="zoom:50%;" /><h3 id="ä¿®æ”¹æ–‡æ¡£"><a href="#ä¿®æ”¹æ–‡æ¡£" class="headerlink" title="ä¿®æ”¹æ–‡æ¡£"></a>ä¿®æ”¹æ–‡æ¡£</h3><img src="./assets/image-20251010161407184.png" alt=" " style="zoom:50%;" /><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><img src="./assets/image-20251010161526034.png" alt=" " style="zoom:50%;" /><h1 id="2-RestAPIæ“ä½œç´¢å¼•"><a href="#2-RestAPIæ“ä½œç´¢å¼•" class="headerlink" title="2.RestAPIæ“ä½œç´¢å¼•"></a>2.RestAPIæ“ä½œç´¢å¼•</h1><p>ESå®˜æ–¹æä¾›äº†å„ç§ä¸åŒè¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥æ“ä½œESã€‚è¿™äº›å®¢æˆ·ç«¯çš„æœ¬è´¨å°±æ˜¯ç»„è£…DSLè¯­å¥ï¼Œé€šè¿‡httpè¯·æ±‚å‘é€ç»™ESã€‚å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/client/index.html">https://www.elastic.co/guide/en/elasticsearch/client/index.html</a></p><p>å…¶ä¸­çš„Java Rest ClientåˆåŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>Java Low Level Rest Client</li><li>Java High Level Rest Client</li></ul><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720214555863.png" alt="image-20210720214555863"></p><p>æˆ‘ä»¬å­¦ä¹ çš„æ˜¯Java HighLevel Rest Clientå®¢æˆ·ç«¯API</p><h2 id="2-0-å¯¼å…¥Demoå·¥ç¨‹"><a href="#2-0-å¯¼å…¥Demoå·¥ç¨‹" class="headerlink" title="2.0.å¯¼å…¥Demoå·¥ç¨‹"></a>2.0.å¯¼å…¥Demoå·¥ç¨‹</h2><h3 id="2-0-1-å¯¼å…¥æ•°æ®"><a href="#2-0-1-å¯¼å…¥æ•°æ®" class="headerlink" title="2.0.1.å¯¼å…¥æ•°æ®"></a>2.0.1.å¯¼å…¥æ•°æ®</h3><p>é¦–å…ˆå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„æ•°æ®åº“æ•°æ®ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720220400297.png" alt="image-20210720220400297"> </p><p>æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>Â <span class="keyword">TABLE</span>Â `tb_hotel`Â (</span><br><span class="line">Â Â `id`Â <span class="type">bigint</span>(<span class="number">20</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;é…’åº—id&#x27;</span>,</span><br><span class="line">Â Â `name`Â <span class="type">varchar</span>(<span class="number">255</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;é…’åº—åç§°ï¼›ä¾‹ï¼š7å¤©é…’åº—&#x27;</span>,</span><br><span class="line">Â Â `address`Â <span class="type">varchar</span>(<span class="number">255</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;é…’åº—åœ°å€ï¼›ä¾‹ï¼šèˆªå¤´è·¯&#x27;</span>,</span><br><span class="line">Â Â `price`Â <span class="type">int</span>(<span class="number">10</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;é…’åº—ä»·æ ¼ï¼›ä¾‹ï¼š329&#x27;</span>,</span><br><span class="line">Â Â `score`Â <span class="type">int</span>(<span class="number">2</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;é…’åº—è¯„åˆ†ï¼›ä¾‹ï¼š45ï¼Œå°±æ˜¯4.5åˆ†&#x27;</span>,</span><br><span class="line">Â Â `brand`Â <span class="type">varchar</span>(<span class="number">32</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;é…’åº—å“ç‰Œï¼›ä¾‹ï¼šå¦‚å®¶&#x27;</span>,</span><br><span class="line">Â Â `city`Â <span class="type">varchar</span>(<span class="number">32</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;æ‰€åœ¨åŸå¸‚ï¼›ä¾‹ï¼šä¸Šæµ·&#x27;</span>,</span><br><span class="line">Â Â `star_name`Â <span class="type">varchar</span>(<span class="number">16</span>)Â <span class="keyword">DEFAULT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;é…’åº—æ˜Ÿçº§ï¼Œä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯ï¼š1æ˜Ÿåˆ°5æ˜Ÿï¼Œ1é’»åˆ°5é’»&#x27;</span>,</span><br><span class="line">Â Â `business`Â <span class="type">varchar</span>(<span class="number">255</span>)Â <span class="keyword">DEFAULT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;å•†åœˆï¼›ä¾‹ï¼šè™¹æ¡¥&#x27;</span>,</span><br><span class="line">Â Â `latitude`Â <span class="type">varchar</span>(<span class="number">32</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;çº¬åº¦ï¼›ä¾‹ï¼š31.2497&#x27;</span>,</span><br><span class="line">Â Â `longitude`Â <span class="type">varchar</span>(<span class="number">32</span>)Â <span class="keyword">NOT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;ç»åº¦ï¼›ä¾‹ï¼š120.3925&#x27;</span>,</span><br><span class="line">Â Â `pic`Â <span class="type">varchar</span>(<span class="number">255</span>)Â <span class="keyword">DEFAULT</span>Â <span class="keyword">NULL</span>Â COMMENTÂ <span class="string">&#x27;é…’åº—å›¾ç‰‡ï¼›ä¾‹:/img/1.jpg&#x27;</span>,</span><br><span class="line">Â Â <span class="keyword">PRIMARY</span>Â KEYÂ (`id`)</span><br><span class="line">)Â ENGINE<span class="operator">=</span>InnoDBÂ <span class="keyword">DEFAULT</span>Â CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure><h3 id="2-0-2-å¯¼å…¥é¡¹ç›®"><a href="#2-0-2-å¯¼å…¥é¡¹ç›®" class="headerlink" title="2.0.2.å¯¼å…¥é¡¹ç›®"></a>2.0.2.å¯¼å…¥é¡¹ç›®</h3><p>ç„¶åå¯¼å…¥è¯¾å‰èµ„æ–™æä¾›çš„é¡¹ç›®:</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720220503411.png" alt="image-20210720220503411"> </p><p>é¡¹ç›®ç»“æ„å¦‚å›¾ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720220647541.png" alt="image-20210720220647541"></p><h3 id="2-0-3-mappingæ˜ å°„åˆ†æ"><a href="#2-0-3-mappingæ˜ å°„åˆ†æ" class="headerlink" title="2.0.3.mappingæ˜ å°„åˆ†æ"></a>2.0.3.mappingæ˜ å°„åˆ†æ</h3><p>åˆ›å»ºç´¢å¼•åº“ï¼Œæœ€å…³é”®çš„æ˜¯mappingæ˜ å°„ï¼Œè€Œmappingæ˜ å°„è¦è€ƒè™‘çš„ä¿¡æ¯åŒ…æ‹¬ï¼š</p><ul><li>å­—æ®µå</li><li>å­—æ®µæ•°æ®ç±»å‹</li><li>æ˜¯å¦å‚ä¸æœç´¢</li><li>æ˜¯å¦éœ€è¦åˆ†è¯</li><li>å¦‚æœåˆ†è¯ï¼Œåˆ†è¯å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><p>å…¶ä¸­ï¼š</p><ul><li>å­—æ®µåã€å­—æ®µæ•°æ®ç±»å‹ï¼Œå¯ä»¥å‚è€ƒæ•°æ®è¡¨ç»“æ„çš„åç§°å’Œç±»å‹</li><li>æ˜¯å¦å‚ä¸æœç´¢è¦åˆ†æä¸šåŠ¡æ¥åˆ¤æ–­ï¼Œä¾‹å¦‚å›¾ç‰‡åœ°å€ï¼Œå°±æ— éœ€å‚ä¸æœç´¢</li><li>æ˜¯å¦åˆ†è¯å‘¢è¦çœ‹å†…å®¹ï¼Œå†…å®¹å¦‚æœæ˜¯ä¸€ä¸ªæ•´ä½“å°±æ— éœ€åˆ†è¯ï¼Œåä¹‹åˆ™è¦åˆ†è¯</li><li>åˆ†è¯å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€ä½¿ç”¨ik_max_word</li></ul><p>æ¥çœ‹ä¸‹é…’åº—æ•°æ®çš„ç´¢å¼•åº“ç»“æ„:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">PUT /hotel</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;starName&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;business&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;geo_point&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pic&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;all&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å‡ ä¸ªç‰¹æ®Šå­—æ®µè¯´æ˜ï¼š</p><ul><li>locationï¼šåœ°ç†åæ ‡ï¼Œé‡Œé¢åŒ…å«ç²¾åº¦ã€çº¬åº¦</li><li>allï¼šä¸€ä¸ªç»„åˆå­—æ®µï¼Œå…¶ç›®çš„æ˜¯å°†å¤šå­—æ®µçš„å€¼ åˆ©ç”¨copy_toåˆå¹¶ï¼Œæä¾›ç»™ç”¨æˆ·æœç´¢</li></ul><p>åœ°ç†åæ ‡è¯´æ˜ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720222110126.png" alt="image-20210720222110126"></p><p>copy_toè¯´æ˜ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720222221516.png" alt="image-20210720222221516"></p><h3 id="2-0-4-åˆå§‹åŒ–RestClient"><a href="#2-0-4-åˆå§‹åŒ–RestClient" class="headerlink" title="2.0.4.åˆå§‹åŒ–RestClient"></a>2.0.4.åˆå§‹åŒ–RestClient</h3><p>åœ¨elasticsearchæä¾›çš„APIä¸­ï¼Œä¸elasticsearchä¸€åˆ‡äº¤äº’éƒ½å°è£…åœ¨ä¸€ä¸ªåä¸ºRestHighLevelClientçš„ç±»ä¸­ï¼Œå¿…é¡»å…ˆå®Œæˆè¿™ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œå»ºç«‹ä¸elasticsearchçš„è¿æ¥ã€‚</p><p>åˆ†ä¸ºä¸‰æ­¥ï¼š</p><p>1ï¼‰å¼•å…¥esçš„RestHighLevelClientä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰å› ä¸ºSpringBooté»˜è®¤çš„ESç‰ˆæœ¬æ˜¯7.6.2ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¦†ç›–é»˜è®¤çš„ESç‰ˆæœ¬ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.12.1<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3ï¼‰åˆå§‹åŒ–RestHighLevelClientï¼š</p><p>åˆå§‹åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">        HttpHost.create(<span class="string">&quot;http://192.168.150.101:9200&quot;</span>)</span><br><span class="line">));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ºäº†å•å…ƒæµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»HotelIndexTestï¼Œç„¶åå°†åˆå§‹åŒ–çš„ä»£ç ç¼–å†™åœ¨@BeforeEachæ–¹æ³•ä¸­ï¼š</p><ul><li><code>ä¸€ä¸ªå¤§å‘ï¼ï¼http://localhost:9200</code> åé¢ä¸èƒ½åŠ æ–œæ  <code>/</code></li><li></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelIndexTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">&quot;http://localhost:9200&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-1-åˆ›å»ºç´¢å¼•åº“"><a href="#2-1-åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="2.1.åˆ›å»ºç´¢å¼•åº“"></a>2.1.åˆ›å»ºç´¢å¼•åº“</h2><h3 id="2-1-1-ä»£ç è§£è¯»"><a href="#2-1-1-ä»£ç è§£è¯»" class="headerlink" title="2.1.1.ä»£ç è§£è¯»"></a>2.1.1.ä»£ç è§£è¯»</h3><p>åˆ›å»ºç´¢å¼•åº“çš„APIå¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720223049408.png" alt="image-20210720223049408"></p><p>ä»£ç åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚å› ä¸ºæ˜¯åˆ›å»ºç´¢å¼•åº“çš„æ“ä½œï¼Œå› æ­¤Requestæ˜¯CreateIndexRequestã€‚</li><li>2ï¼‰æ·»åŠ è¯·æ±‚å‚æ•°ï¼Œå…¶å®å°±æ˜¯DSLçš„JSONå‚æ•°éƒ¨åˆ†ã€‚å› ä¸ºjsonå­—ç¬¦ä¸²å¾ˆé•¿ï¼Œè¿™é‡Œæ˜¯å®šä¹‰äº†é™æ€å­—ç¬¦ä¸²å¸¸é‡MAPPING_TEMPLATEï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´åŠ ä¼˜é›…ã€‚</li><li>3ï¼‰å‘é€è¯·æ±‚ï¼Œclient.indices()æ–¹æ³•çš„è¿”å›å€¼æ˜¯IndicesClientç±»å‹ï¼Œå°è£…äº†æ‰€æœ‰ä¸ç´¢å¼•åº“æ“ä½œæœ‰å…³çš„æ–¹æ³•ã€‚</li></ul><h3 id="2-1-2-å®Œæ•´ç¤ºä¾‹"><a href="#2-1-2-å®Œæ•´ç¤ºä¾‹" class="headerlink" title="2.1.2.å®Œæ•´ç¤ºä¾‹"></a>2.1.2.å®Œæ•´ç¤ºä¾‹</h3><p>åœ¨hotel-demoçš„cn.itcast.hotel.constantsåŒ…ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç±»ï¼Œå®šä¹‰mappingæ˜ å°„çš„JSONå­—ç¬¦ä¸²å¸¸é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelConstants</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MAPPING_TEMPLATE</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;  \&quot;mappings\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    \&quot;properties\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;id\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;name\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;address\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;price\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;score\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;integer\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;brand\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;city\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;starName\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;business\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;location\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;geo_point\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;pic\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;keyword\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;index\&quot;: false\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      \&quot;all\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;type\&quot;: \&quot;text\&quot;,\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;      &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;  &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨hotel-demoä¸­çš„HotelIndexTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå®ç°åˆ›å»ºç´¢å¼•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">createHotelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequestå¯¹è±¡</span></span><br><span class="line">    <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡è¯·æ±‚çš„å‚æ•°ï¼šDSLè¯­å¥</span></span><br><span class="line">    request.source(MAPPING_TEMPLATE, XContentType.JSON);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-åˆ é™¤ç´¢å¼•åº“"><a href="#2-2-åˆ é™¤ç´¢å¼•åº“" class="headerlink" title="2.2.åˆ é™¤ç´¢å¼•åº“"></a>2.2.åˆ é™¤ç´¢å¼•åº“</h2><p>åˆ é™¤ç´¢å¼•åº“çš„DSLè¯­å¥éå¸¸ç®€å•ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /hotel</span><br></pre></td></tr></table></figure><p>ä¸åˆ›å»ºç´¢å¼•åº“ç›¸æ¯”ï¼š</p><ul><li>è¯·æ±‚æ–¹å¼ä»PUTå˜ä¸ºDELTE</li><li>è¯·æ±‚è·¯å¾„ä¸å˜</li><li>æ— è¯·æ±‚å‚æ•°</li></ul><p>æ‰€ä»¥ä»£ç çš„å·®å¼‚ï¼Œæ³¨æ„ä½“ç°åœ¨Requestå¯¹è±¡ä¸Šã€‚ä¾ç„¶æ˜¯ä¸‰æ­¥èµ°ï¼š</p><ul><li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯DeleteIndexRequestå¯¹è±¡</li><li>2ï¼‰å‡†å¤‡å‚æ•°ã€‚è¿™é‡Œæ˜¯æ— å‚</li><li>3ï¼‰å‘é€è¯·æ±‚ã€‚æ”¹ç”¨deleteæ–¹æ³•</li></ul><p>åœ¨hotel-demoä¸­çš„HotelIndexTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå®ç°åˆ é™¤ç´¢å¼•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteHotelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequestå¯¹è±¡</span></span><br><span class="line">    <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨"><a href="#2-3-åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨" class="headerlink" title="2.3.åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨"></a>2.3.åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨</h2><p>åˆ¤æ–­ç´¢å¼•åº“æ˜¯å¦å­˜åœ¨ï¼Œæœ¬è´¨å°±æ˜¯æŸ¥è¯¢ï¼Œå¯¹åº”çš„DSLæ˜¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel</span><br></pre></td></tr></table></figure><p>å› æ­¤ä¸åˆ é™¤çš„Javaä»£ç æµç¨‹æ˜¯ç±»ä¼¼çš„ã€‚ä¾ç„¶æ˜¯ä¸‰æ­¥èµ°ï¼š</p><ul><li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯GetIndexRequestå¯¹è±¡</li><li>2ï¼‰å‡†å¤‡å‚æ•°ã€‚è¿™é‡Œæ˜¯æ— å‚</li><li>3ï¼‰å‘é€è¯·æ±‚ã€‚æ”¹ç”¨existsæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testExistsHotelIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequestå¯¹è±¡</span></span><br><span class="line">    <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 3.è¾“å‡º</span></span><br><span class="line">    System.err.println(exists ? <span class="string">&quot;ç´¢å¼•åº“å·²ç»å­˜åœ¨ï¼&quot;</span> : <span class="string">&quot;ç´¢å¼•åº“ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-4-æ€»ç»“"><a href="#2-4-æ€»ç»“" class="headerlink" title="2.4.æ€»ç»“"></a>2.4.æ€»ç»“</h2><p>JavaRestClientæ“ä½œelasticsearchçš„æµç¨‹åŸºæœ¬ç±»ä¼¼ã€‚æ ¸å¿ƒæ˜¯client.indices()æ–¹æ³•æ¥è·å–ç´¢å¼•åº“çš„æ“ä½œå¯¹è±¡ã€‚</p><img src="./assets/image-20251011132058061.png" alt=" " style="zoom:50%;" /><h1 id="3-RestClientæ“ä½œæ–‡æ¡£"><a href="#3-RestClientæ“ä½œæ–‡æ¡£" class="headerlink" title="3.RestClientæ“ä½œæ–‡æ¡£"></a>3.RestClientæ“ä½œæ–‡æ¡£</h1><p>ä¸ºäº†ä¸ç´¢å¼•åº“æ“ä½œåˆ†ç¦»ï¼Œæˆ‘ä»¬å†æ¬¡å‚åŠ ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œåšä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li>åˆå§‹åŒ–RestHighLevelClient</li><li>æˆ‘ä»¬çš„é…’åº—æ•°æ®åœ¨æ•°æ®åº“ï¼Œéœ€è¦åˆ©ç”¨IHotelServiceå»æŸ¥è¯¢ï¼Œæ‰€ä»¥æ³¨å…¥è¿™ä¸ªæ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.hotel.pojo.Hotel;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.hotel.service.IHotelService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelDocumentTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IHotelService hotelService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">&quot;http://192.168.150.101:9200&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-1-æ–°å¢æ–‡æ¡£"><a href="#3-1-æ–°å¢æ–‡æ¡£" class="headerlink" title="3.1.æ–°å¢æ–‡æ¡£"></a>3.1.æ–°å¢æ–‡æ¡£</h2><p>æˆ‘ä»¬è¦å°†æ•°æ®åº“çš„é…’åº—æ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼Œå†™å…¥elasticsearchä¸­ã€‚</p><h3 id="3-1-1-ç´¢å¼•åº“å®ä½“ç±»"><a href="#3-1-1-ç´¢å¼•åº“å®ä½“ç±»" class="headerlink" title="3.1.1.ç´¢å¼•åº“å®ä½“ç±»"></a>3.1.1.ç´¢å¼•åº“å®ä½“ç±»</h3><p>æ•°æ®åº“æŸ¥è¯¢åçš„ç»“æœæ˜¯ä¸€ä¸ªHotelç±»å‹çš„å¯¹è±¡ã€‚ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_hotel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hotel</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.INPUT)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer score;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> String business;</span><br><span class="line">    <span class="keyword">private</span> String longitude;</span><br><span class="line">    <span class="keyword">private</span> String latitude;</span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸æˆ‘ä»¬çš„ç´¢å¼•åº“ç»“æ„å­˜åœ¨å·®å¼‚ï¼š</p><ul><li>longitudeå’Œlatitudeéœ€è¦åˆå¹¶ä¸ºlocation</li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œä¸ç´¢å¼•åº“ç»“æ„å»åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelDoc</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer score;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> String business;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HotelDoc</span><span class="params">(Hotel hotel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = hotel.getId();</span><br><span class="line">        <span class="built_in">this</span>.name = hotel.getName();</span><br><span class="line">        <span class="built_in">this</span>.address = hotel.getAddress();</span><br><span class="line">        <span class="built_in">this</span>.price = hotel.getPrice();</span><br><span class="line">        <span class="built_in">this</span>.score = hotel.getScore();</span><br><span class="line">        <span class="built_in">this</span>.brand = hotel.getBrand();</span><br><span class="line">        <span class="built_in">this</span>.city = hotel.getCity();</span><br><span class="line">        <span class="built_in">this</span>.starName = hotel.getStarName();</span><br><span class="line">        <span class="built_in">this</span>.business = hotel.getBusiness();</span><br><span class="line">        <span class="built_in">this</span>.location = hotel.getLatitude() + <span class="string">&quot;, &quot;</span> + hotel.getLongitude();</span><br><span class="line">        <span class="built_in">this</span>.pic = hotel.getPic();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-1-2-è¯­æ³•è¯´æ˜"><a href="#3-1-2-è¯­æ³•è¯´æ˜" class="headerlink" title="3.1.2.è¯­æ³•è¯´æ˜"></a>3.1.2.è¯­æ³•è¯´æ˜</h3><p>æ–°å¢æ–‡æ¡£çš„DSLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /<span class="punctuation">&#123;</span>ç´¢å¼•åº“å<span class="punctuation">&#125;</span>/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Jack&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">21</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„javaä»£ç å¦‚å›¾ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720230027240.png" alt="image-20210720230027240"></p><p>å¯ä»¥çœ‹åˆ°ä¸åˆ›å»ºç´¢å¼•åº“ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯ä¸‰æ­¥èµ°ï¼š</p><ul><li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡</li><li>2ï¼‰å‡†å¤‡è¯·æ±‚å‚æ•°ï¼Œä¹Ÿå°±æ˜¯DSLä¸­çš„JSONæ–‡æ¡£</li><li>3ï¼‰å‘é€è¯·æ±‚</li></ul><p>å˜åŒ–çš„åœ°æ–¹åœ¨äºï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨client.xxx()çš„APIï¼Œä¸å†éœ€è¦client.indices()äº†ã€‚</p><h3 id="3-1-3-å®Œæ•´ä»£ç "><a href="#3-1-3-å®Œæ•´ä»£ç " class="headerlink" title="3.1.3.å®Œæ•´ä»£ç "></a>3.1.3.å®Œæ•´ä»£ç </h3><p>æˆ‘ä»¬å¯¼å…¥é…’åº—æ•°æ®ï¼ŒåŸºæœ¬æµç¨‹ä¸€è‡´ï¼Œä½†æ˜¯éœ€è¦è€ƒè™‘å‡ ç‚¹å˜åŒ–ï¼š</p><ul><li>é…’åº—æ•°æ®æ¥è‡ªäºæ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŸ¥è¯¢å‡ºæ¥ï¼Œå¾—åˆ°hotelå¯¹è±¡</li><li>hotelå¯¹è±¡éœ€è¦è½¬ä¸ºHotelDocå¯¹è±¡</li><li>HotelDocéœ€è¦åºåˆ—åŒ–ä¸ºjsonæ ¼å¼</li></ul><p>å› æ­¤ï¼Œä»£ç æ•´ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>1ï¼‰æ ¹æ®idæŸ¥è¯¢é…’åº—æ•°æ®Hotel</li><li>2ï¼‰å°†Hotelå°è£…ä¸ºHotelDoc</li><li>3ï¼‰å°†HotelDocåºåˆ—åŒ–ä¸ºJSON</li><li>4ï¼‰åˆ›å»ºIndexRequestï¼ŒæŒ‡å®šç´¢å¼•åº“åå’Œid</li><li>5ï¼‰å‡†å¤‡è¯·æ±‚å‚æ•°ï¼Œä¹Ÿå°±æ˜¯JSONæ–‡æ¡£</li><li>6ï¼‰å‘é€è¯·æ±‚</li></ul><p>åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAddDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¹æ®idæŸ¥è¯¢é…’åº—æ•°æ®</span></span><br><span class="line">    <span class="type">Hotel</span> <span class="variable">hotel</span> <span class="operator">=</span> hotelService.getById(<span class="number">61083L</span>);</span><br><span class="line">    <span class="comment">// 2.è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹</span></span><br><span class="line">    <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line">    <span class="comment">// 3.å°†HotelDocè½¬json</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(hotelDoc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Requestå¯¹è±¡</span></span><br><span class="line">    <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>).id(hotelDoc.getId().toString());</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡Jsonæ–‡æ¡£</span></span><br><span class="line">    request.source(json, XContentType.JSON);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-æŸ¥è¯¢æ–‡æ¡£"><a href="#3-2-æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="3.2.æŸ¥è¯¢æ–‡æ¡£"></a>3.2.æŸ¥è¯¢æ–‡æ¡£</h2><h3 id="3-2-1-è¯­æ³•è¯´æ˜"><a href="#3-2-1-è¯­æ³•è¯´æ˜" class="headerlink" title="3.2.1.è¯­æ³•è¯´æ˜"></a>3.2.1.è¯­æ³•è¯´æ˜</h3><p>æŸ¥è¯¢çš„DSLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_doc/<span class="punctuation">&#123;</span>id<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>éå¸¸ç®€å•ï¼Œå› æ­¤ä»£ç å¤§æ¦‚åˆ†ä¸¤æ­¥ï¼š</p><ul><li>å‡†å¤‡Requestå¯¹è±¡</li><li>å‘é€è¯·æ±‚</li></ul><p>ä¸è¿‡æŸ¥è¯¢çš„ç›®çš„æ˜¯å¾—åˆ°ç»“æœï¼Œè§£æä¸ºHotelDocï¼Œå› æ­¤éš¾ç‚¹æ˜¯ç»“æœçš„è§£æã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720230811674.png" alt="image-20210720230811674"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç»“æœæ˜¯ä¸€ä¸ªJSONï¼Œå…¶ä¸­æ–‡æ¡£æ”¾åœ¨ä¸€ä¸ª<code>_source</code>å±æ€§ä¸­ï¼Œå› æ­¤è§£æå°±æ˜¯æ‹¿åˆ°<code>_source</code>ï¼Œååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡å³å¯ã€‚</p><p>ä¸ä¹‹å‰ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸‰æ­¥èµ°ï¼š</p><ul><li>1ï¼‰å‡†å¤‡Requestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯æŸ¥è¯¢ï¼Œæ‰€ä»¥æ˜¯GetRequest</li><li>2ï¼‰å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœã€‚å› ä¸ºæ˜¯æŸ¥è¯¢ï¼Œè¿™é‡Œè°ƒç”¨client.get()æ–¹æ³•</li><li>3ï¼‰è§£æç»“æœï¼Œå°±æ˜¯å¯¹JSONåšååºåˆ—åŒ–</li></ul><h3 id="3-2-2-å®Œæ•´ä»£ç "><a href="#3-2-2-å®Œæ•´ä»£ç " class="headerlink" title="3.2.2.å®Œæ•´ä»£ç "></a>3.2.2.å®Œæ•´ä»£ç </h3><p>åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetDocumentById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;61082&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‘é€è¯·æ±‚ï¼Œå¾—åˆ°å“åº”</span></span><br><span class="line">    <span class="type">GetResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 3.è§£æå“åº”ç»“æœ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> response.getSourceAsString();</span><br><span class="line"></span><br><span class="line">    <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">    System.out.println(hotelDoc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3-åˆ é™¤æ–‡æ¡£"><a href="#3-3-åˆ é™¤æ–‡æ¡£" class="headerlink" title="3.3.åˆ é™¤æ–‡æ¡£"></a>3.3.åˆ é™¤æ–‡æ¡£</h2><p>åˆ é™¤çš„DSLä¸ºæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /hotel/_doc/<span class="punctuation">&#123;</span>id<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸æŸ¥è¯¢ç›¸æ¯”ï¼Œä»…ä»…æ˜¯è¯·æ±‚æ–¹å¼ä»DELETEå˜æˆGETï¼Œå¯ä»¥æƒ³è±¡Javaä»£ç åº”è¯¥ä¾ç„¶æ˜¯ä¸‰æ­¥èµ°ï¼š</p><ul><li>1ï¼‰å‡†å¤‡Requestå¯¹è±¡ï¼Œå› ä¸ºæ˜¯åˆ é™¤ï¼Œè¿™æ¬¡æ˜¯DeleteRequestå¯¹è±¡ã€‚è¦æŒ‡å®šç´¢å¼•åº“åå’Œid</li><li>2ï¼‰å‡†å¤‡å‚æ•°ï¼Œæ— å‚</li><li>3ï¼‰å‘é€è¯·æ±‚ã€‚å› ä¸ºæ˜¯åˆ é™¤ï¼Œæ‰€ä»¥æ˜¯client.delete()æ–¹æ³•</li></ul><p>åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;61083&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-4-ä¿®æ”¹æ–‡æ¡£"><a href="#3-4-ä¿®æ”¹æ–‡æ¡£" class="headerlink" title="3.4.ä¿®æ”¹æ–‡æ¡£"></a>3.4.ä¿®æ”¹æ–‡æ¡£</h2><h3 id="3-4-1-è¯­æ³•è¯´æ˜"><a href="#3-4-1-è¯­æ³•è¯´æ˜" class="headerlink" title="3.4.1.è¯­æ³•è¯´æ˜"></a>3.4.1.è¯­æ³•è¯´æ˜</h3><p>ä¿®æ”¹æˆ‘ä»¬è®²è¿‡ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>å…¨é‡ä¿®æ”¹ï¼šæœ¬è´¨æ˜¯å…ˆæ ¹æ®idåˆ é™¤ï¼Œå†æ–°å¢</li><li>å¢é‡ä¿®æ”¹ï¼šä¿®æ”¹æ–‡æ¡£ä¸­çš„æŒ‡å®šå­—æ®µå€¼</li></ul><p>åœ¨RestClientçš„APIä¸­ï¼Œå…¨é‡ä¿®æ”¹ä¸æ–°å¢çš„APIå®Œå…¨ä¸€è‡´ï¼Œåˆ¤æ–­ä¾æ®æ˜¯IDï¼š</p><ul><li>å¦‚æœæ–°å¢æ—¶ï¼ŒIDå·²ç»å­˜åœ¨ï¼Œåˆ™ä¿®æ”¹</li><li>å¦‚æœæ–°å¢æ—¶ï¼ŒIDä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢</li></ul><p>è¿™é‡Œä¸å†èµ˜è¿°ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨å¢é‡ä¿®æ”¹ã€‚</p><p>ä»£ç ç¤ºä¾‹å¦‚å›¾ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720231040875.png" alt="image-20210720231040875"></p><p>ä¸ä¹‹å‰ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸‰æ­¥èµ°ï¼š</p><ul><li>1ï¼‰å‡†å¤‡Requestå¯¹è±¡ã€‚è¿™æ¬¡æ˜¯ä¿®æ”¹ï¼Œæ‰€ä»¥æ˜¯UpdateRequest</li><li>2ï¼‰å‡†å¤‡å‚æ•°ã€‚ä¹Ÿå°±æ˜¯JSONæ–‡æ¡£ï¼Œé‡Œé¢åŒ…å«è¦ä¿®æ”¹çš„å­—æ®µ</li><li>3ï¼‰æ›´æ–°æ–‡æ¡£ã€‚è¿™é‡Œè°ƒç”¨client.update()æ–¹æ³•</li></ul><h3 id="3-4-2-å®Œæ•´ä»£ç "><a href="#3-4-2-å®Œæ•´ä»£ç " class="headerlink" title="3.4.2.å®Œæ•´ä»£ç "></a>3.4.2.å®Œæ•´ä»£ç </h3><p>åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">UpdateRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;61083&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡è¯·æ±‚å‚æ•°</span></span><br><span class="line">    request.doc(</span><br><span class="line">        <span class="string">&quot;price&quot;</span>, <span class="string">&quot;952&quot;</span>,</span><br><span class="line">        <span class="string">&quot;starName&quot;</span>, <span class="string">&quot;å››é’»&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.update(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-5-æ‰¹é‡å¯¼å…¥æ–‡æ¡£"><a href="#3-5-æ‰¹é‡å¯¼å…¥æ–‡æ¡£" class="headerlink" title="3.5.æ‰¹é‡å¯¼å…¥æ–‡æ¡£"></a>3.5.æ‰¹é‡å¯¼å…¥æ–‡æ¡£</h2><p>æ¡ˆä¾‹éœ€æ±‚ï¼šåˆ©ç”¨BulkRequestæ‰¹é‡å°†æ•°æ®åº“æ•°æ®å¯¼å…¥åˆ°ç´¢å¼•åº“ä¸­ã€‚</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><p>åˆ©ç”¨mybatis-plusæŸ¥è¯¢é…’åº—æ•°æ®</p></li><li><p>å°†æŸ¥è¯¢åˆ°çš„é…’åº—æ•°æ®ï¼ˆHotelï¼‰è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹æ•°æ®ï¼ˆHotelDocï¼‰</p></li><li><p>åˆ©ç”¨JavaRestClientä¸­çš„BulkRequestæ‰¹å¤„ç†ï¼Œå®ç°æ‰¹é‡æ–°å¢æ–‡æ¡£</p></li></ul><h3 id="3-5-1-è¯­æ³•è¯´æ˜"><a href="#3-5-1-è¯­æ³•è¯´æ˜" class="headerlink" title="3.5.1.è¯­æ³•è¯´æ˜"></a>3.5.1.è¯­æ³•è¯´æ˜</h3><p>æ‰¹é‡å¤„ç†BulkRequestï¼Œå…¶æœ¬è´¨å°±æ˜¯å°†å¤šä¸ªæ™®é€šçš„CRUDè¯·æ±‚ç»„åˆåœ¨ä¸€èµ·å‘é€ã€‚</p><p>å…¶ä¸­æä¾›äº†ä¸€ä¸ªaddæ–¹æ³•ï¼Œç”¨æ¥æ·»åŠ å…¶ä»–è¯·æ±‚ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720232105943.png" alt="image-20210720232105943"></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œèƒ½æ·»åŠ çš„è¯·æ±‚åŒ…æ‹¬ï¼š</p><ul><li>IndexRequestï¼Œä¹Ÿå°±æ˜¯æ–°å¢</li><li>UpdateRequestï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹</li><li>DeleteRequestï¼Œä¹Ÿå°±æ˜¯åˆ é™¤</li></ul><p>å› æ­¤Bulkä¸­æ·»åŠ äº†å¤šä¸ªIndexRequestï¼Œå°±æ˜¯æ‰¹é‡æ–°å¢åŠŸèƒ½äº†ã€‚ç¤ºä¾‹ï¼š</p></blockquote><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210720232431383.png" alt="image-20210720232431383"></p><p>å…¶å®è¿˜æ˜¯ä¸‰æ­¥èµ°ï¼š</p><ul><li>1ï¼‰åˆ›å»ºRequestå¯¹è±¡ã€‚è¿™é‡Œæ˜¯BulkRequest</li><li>2ï¼‰å‡†å¤‡å‚æ•°ã€‚æ‰¹å¤„ç†çš„å‚æ•°ï¼Œå°±æ˜¯å…¶å®ƒRequestå¯¹è±¡ï¼Œè¿™é‡Œå°±æ˜¯å¤šä¸ªIndexRequest</li><li>3ï¼‰å‘èµ·è¯·æ±‚ã€‚è¿™é‡Œæ˜¯æ‰¹å¤„ç†ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¸ºclient.bulk()æ–¹æ³•</li></ul><p>æˆ‘ä»¬åœ¨å¯¼å…¥é…’åº—æ•°æ®æ—¶ï¼Œå°†ä¸Šè¿°ä»£ç æ”¹é€ æˆforå¾ªç¯å¤„ç†å³å¯ã€‚</p><h3 id="3-5-2-å®Œæ•´ä»£ç "><a href="#3-5-2-å®Œæ•´ä»£ç " class="headerlink" title="3.5.2.å®Œæ•´ä»£ç "></a>3.5.2.å®Œæ•´ä»£ç </h3><p>åœ¨hotel-demoçš„HotelDocumentTestæµ‹è¯•ç±»ä¸­ï¼Œç¼–å†™å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// æ‰¹é‡æŸ¥è¯¢é…’åº—æ•°æ®</span></span><br><span class="line">    List&lt;Hotel&gt; hotels = hotelService.list();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºRequest</span></span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡å‚æ•°ï¼Œæ·»åŠ å¤šä¸ªæ–°å¢çš„Request</span></span><br><span class="line">    <span class="keyword">for</span> (Hotel hotel : hotels) &#123;</span><br><span class="line">        <span class="comment">// 2.1.è½¬æ¢ä¸ºæ–‡æ¡£ç±»å‹HotelDoc</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line">        <span class="comment">// 2.2.åˆ›å»ºæ–°å¢æ–‡æ¡£çš„Requestå¯¹è±¡</span></span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>)</span><br><span class="line">                    .id(hotelDoc.getId().toString())</span><br><span class="line">                    .source(JSON.toJSONString(hotelDoc), XContentType.JSON));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-6-å°ç»“"><a href="#3-6-å°ç»“" class="headerlink" title="3.6.å°ç»“"></a>3.6.å°ç»“</h2><p>æ–‡æ¡£æ“ä½œçš„åŸºæœ¬æ­¥éª¤ï¼š</p><ul><li>åˆå§‹åŒ–RestHighLevelClient</li><li>åˆ›å»ºXxxRequestã€‚XXXæ˜¯Indexã€Getã€Updateã€Deleteã€Bulk</li><li>å‡†å¤‡å‚æ•°ï¼ˆIndexã€Updateã€Bulkæ—¶éœ€è¦ï¼‰</li><li>å‘é€è¯·æ±‚ã€‚è°ƒç”¨RestHighLevelClient#.xxx()æ–¹æ³•ï¼Œxxxæ˜¯indexã€getã€updateã€deleteã€bulk</li><li>è§£æç»“æœï¼ˆGetæ—¶éœ€è¦ï¼‰</li></ul><h1 id="4-RestClientæŸ¥è¯¢æ–‡æ¡£"><a href="#4-RestClientæŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="4.RestClientæŸ¥è¯¢æ–‡æ¡£"></a>4.RestClientæŸ¥è¯¢æ–‡æ¡£</h1><h2 id="4-1-æŸ¥è¯¢åˆ†ç±»"><a href="#4-1-æŸ¥è¯¢åˆ†ç±»" class="headerlink" title="4.1.æŸ¥è¯¢åˆ†ç±»"></a>4.1.æŸ¥è¯¢åˆ†ç±»</h2><blockquote><p>å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š</p><ul><li><p><strong>æŸ¥è¯¢æ‰€æœ‰</strong>ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œä¸€èˆ¬æµ‹è¯•ç”¨ã€‚ä¾‹å¦‚ï¼š<code>match_all</code></p></li><li><p><strong>å…¨æ–‡æ£€ç´¢ï¼ˆfull textï¼‰æŸ¥è¯¢</strong>ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»<code>å€’æ’ç´¢å¼•</code>åº“ä¸­åŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>match_query</code></li><li><code>multi_match_query</code></li></ul></li><li><p><strong>ç²¾ç¡®æŸ¥è¯¢</strong>ï¼šæ ¹æ®ç²¾ç¡®è¯æ¡å€¼æŸ¥æ‰¾æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æŸ¥æ‰¾<code>keywordã€æ•°å€¼ã€æ—¥æœŸã€boolean</code>ç­‰ç±»å‹å­—æ®µï¼ˆä¸éœ€è¦åˆ†è¯ï¼‰ã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>ids</code></li><li><code>range</code></li><li><code>term</code></li></ul></li><li><p><strong>åœ°ç†ï¼ˆgeoï¼‰æŸ¥è¯¢</strong>ï¼šæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>geo_distance</code></li><li><code>geo_bounding_box</code></li></ul></li><li><p><strong>å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢</strong>ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†ä¸Šè¿°å„ç§æŸ¥è¯¢æ¡ä»¶ç»„åˆèµ·æ¥ï¼Œåˆå¹¶æŸ¥è¯¢æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><ul><li><code>bool</code></li><li><code>function_score</code></li></ul></li></ul></blockquote><h2 id="4-2-å¿«é€Ÿå…¥é—¨ï¼ˆmatch-allï¼‰"><a href="#4-2-å¿«é€Ÿå…¥é—¨ï¼ˆmatch-allï¼‰" class="headerlink" title="4.2.å¿«é€Ÿå…¥é—¨ï¼ˆmatch_allï¼‰"></a>4.2.å¿«é€Ÿå…¥é—¨ï¼ˆmatch_allï¼‰</h2><ul><li>æˆ‘ä»¬ä»¥<code>match_all</code>æŸ¥è¯¢ä¸ºä¾‹</li></ul><h3 id="4-2-1-å‘èµ·æŸ¥è¯¢è¯·æ±‚"><a href="#4-2-1-å‘èµ·æŸ¥è¯¢è¯·æ±‚" class="headerlink" title="4.2.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚"></a>4.2.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721203950559.png" alt="image-20210721203950559"></p><p>ä»£ç è§£è¯»ï¼š</p><ul><li><p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»º<code>SearchRequest</code>å¯¹è±¡ï¼ŒæŒ‡å®šç´¢å¼•åº“å</p></li><li><p>ç¬¬äºŒæ­¥ï¼Œåˆ©ç”¨<code>request.source()</code>æ„å»ºDSLï¼ŒDSLä¸­å¯ä»¥åŒ…å«æŸ¥è¯¢ã€åˆ†é¡µã€æ’åºã€é«˜äº®ç­‰</p><ul><li><code>query()</code>ï¼šä»£è¡¨æŸ¥è¯¢æ¡ä»¶ï¼Œåˆ©ç”¨<code>QueryBuilders.matchAllQuery()</code>æ„å»ºä¸€ä¸ªmatch_allæŸ¥è¯¢çš„DSL</li></ul></li><li><p>ç¬¬ä¸‰æ­¥ï¼Œåˆ©ç”¨client.search()å‘é€è¯·æ±‚ï¼Œå¾—åˆ°å“åº”</p></li></ul><p>è¿™é‡Œå…³é”®çš„APIæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯<code>request.source()</code>ï¼Œå…¶ä¸­åŒ…å«äº†æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€é«˜äº®ç­‰æ‰€æœ‰åŠŸèƒ½ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721215640790.png" alt="image-20210721215640790"></p><p>å¦ä¸€ä¸ªæ˜¯<code>QueryBuilders</code>ï¼Œå…¶ä¸­åŒ…å«<code>matchã€termã€function_scoreã€bool</code>ç­‰å„ç§æŸ¥è¯¢ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721215729236.png" alt="image-20210721215729236"></p><h3 id="4-2-2-è§£æå“åº”"><a href="#4-2-2-è§£æå“åº”" class="headerlink" title="4.2.2.è§£æå“åº”"></a>4.2.2.è§£æå“åº”</h3><p>å“åº”ç»“æœçš„è§£æï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721214221057.png" alt="image-20210721214221057"></p><p>elasticsearchè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œç»“æ„åŒ…å«ï¼š</p><ul><li><code>hits</code>ï¼šå‘½ä¸­çš„ç»“æœ<ul><li><code>total</code>ï¼šæ€»æ¡æ•°ï¼Œå…¶ä¸­çš„valueæ˜¯å…·ä½“çš„æ€»æ¡æ•°å€¼</li><li><code>max_score</code>ï¼šæ‰€æœ‰ç»“æœä¸­å¾—åˆ†æœ€é«˜çš„æ–‡æ¡£çš„ç›¸å…³æ€§ç®—åˆ†</li><li><code>hits</code>ï¼šæœç´¢ç»“æœçš„æ–‡æ¡£æ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯ä¸€ä¸ªjsonå¯¹è±¡<ul><li><code>_source</code>ï¼šæ–‡æ¡£ä¸­çš„åŸå§‹æ•°æ®ï¼Œä¹Ÿæ˜¯jsonå¯¹è±¡</li></ul></li></ul></li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬è§£æå“åº”ç»“æœï¼Œå°±æ˜¯é€å±‚è§£æJSONå­—ç¬¦ä¸²ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><code>SearchHits</code>ï¼šé€šè¿‡response.getHits()è·å–ï¼Œå°±æ˜¯JSONä¸­çš„æœ€å¤–å±‚çš„hitsï¼Œä»£è¡¨å‘½ä¸­çš„ç»“æœ<ul><li><code>SearchHits#getTotalHits().value</code>ï¼šè·å–æ€»æ¡æ•°ä¿¡æ¯</li><li><code>SearchHits#getHits()</code>ï¼šè·å–SearchHitæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ–‡æ¡£æ•°ç»„<ul><li><code>SearchHit#getSourceAsString()</code>ï¼šè·å–æ–‡æ¡£ç»“æœä¸­çš„_sourceï¼Œä¹Ÿå°±æ˜¯åŸå§‹çš„jsonæ–‡æ¡£æ•°æ®</li></ul></li></ul></li></ul><h3 id="4-2-3-å®Œæ•´ä»£ç "><a href="#4-2-3-å®Œæ•´ä»£ç " class="headerlink" title="4.2.3.å®Œæ•´ä»£ç "></a>4.2.3.å®Œæ•´ä»£ç </h3><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatchAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    request.source()</span><br><span class="line">        .query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">&quot;å…±æœç´¢åˆ°&quot;</span> + total + <span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-4-å°ç»“"><a href="#4-2-4-å°ç»“" class="headerlink" title="4.2.4.å°ç»“"></a>4.2.4.å°ç»“</h3><p>æŸ¥è¯¢çš„åŸºæœ¬æ­¥éª¤æ˜¯ï¼š</p><ol><li><p>åˆ›å»ºSearchRequestå¯¹è±¡</p></li><li><p>å‡†å¤‡Request.source()ï¼Œä¹Ÿå°±æ˜¯DSLã€‚</p><p>â‘  QueryBuildersæ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶</p><p>â‘¡ ä¼ å…¥Request.source() çš„ query() æ–¹æ³•</p></li><li><p>å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœ</p></li><li><p>è§£æç»“æœï¼ˆå‚è€ƒJSONç»“æœï¼Œä»å¤–åˆ°å†…ï¼Œé€å±‚è§£æï¼‰</p></li></ol><h2 id="4-2-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼ˆmatchæŸ¥è¯¢ï¼‰"><a href="#4-2-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼ˆmatchæŸ¥è¯¢ï¼‰" class="headerlink" title="4.2.å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼ˆmatchæŸ¥è¯¢ï¼‰"></a>4.2.å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼ˆmatchæŸ¥è¯¢ï¼‰</h2><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><img src="./assets/image-20251011164013690.png" alt=" " style="zoom:50%;" /><ul><li>å…¨æ–‡æ£€ç´¢çš„<code>match</code>å’Œ<code>multi_match</code>æŸ¥è¯¢ä¸match_allçš„APIåŸºæœ¬ä¸€è‡´ã€‚å·®åˆ«æ˜¯æŸ¥è¯¢æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯queryçš„éƒ¨åˆ†ã€‚</li></ul><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721215923060.png" alt="image-20210721215923060"> </p><p>å› æ­¤ï¼ŒJavaä»£ç ä¸Šçš„å·®å¼‚ä¸»è¦æ˜¯request.source().query()ä¸­çš„å‚æ•°äº†ã€‚åŒæ ·æ˜¯åˆ©ç”¨QueryBuildersæä¾›çš„æ–¹æ³•ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721215843099.png" alt="image-20210721215843099"> </p><p>è€Œç»“æœè§£æä»£ç åˆ™å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥æŠ½å–å¹¶å…±äº«ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    request.source()</span><br><span class="line">        .query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;å¦‚å®¶&quot;</span>));</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">testMultiMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">      <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">      <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">      request.source()</span><br><span class="line">              .query(QueryBuilders.multiMatchQuery(<span class="string">&quot;å¦‚å®¶&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;brand&quot;</span>));</span><br><span class="line">      <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">      <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">      <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">      handleResponse(response);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="4-3-ç²¾ç¡®æŸ¥è¯¢"><a href="#4-3-ç²¾ç¡®æŸ¥è¯¢" class="headerlink" title="4.3.ç²¾ç¡®æŸ¥è¯¢"></a>4.3.ç²¾ç¡®æŸ¥è¯¢</h2><p>ç²¾ç¡®æŸ¥è¯¢ä¸»è¦æ˜¯ä¸¤è€…ï¼š</p><ul><li>termï¼šè¯æ¡ç²¾ç¡®åŒ¹é…</li><li>rangeï¼šèŒƒå›´æŸ¥è¯¢</li></ul><p>ä¸ä¹‹å‰çš„æŸ¥è¯¢ç›¸æ¯”ï¼Œå·®å¼‚åŒæ ·åœ¨æŸ¥è¯¢æ¡ä»¶ï¼Œå…¶å®ƒéƒ½ä¸€æ ·ã€‚</p><p>æŸ¥è¯¢æ¡ä»¶æ„é€ çš„APIå¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721220305140.png" alt="image-20210721220305140"> </p><h2 id="4-4-å¸ƒå°”æŸ¥è¯¢"><a href="#4-4-å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="4.4.å¸ƒå°”æŸ¥è¯¢"></a>4.4.å¸ƒå°”æŸ¥è¯¢</h2><p>å¸ƒå°”æŸ¥è¯¢æ˜¯ç”¨mustã€must_notã€filterç­‰æ–¹å¼ç»„åˆå…¶å®ƒæŸ¥è¯¢ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721220927286.png" alt="image-20210721220927286"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒAPIä¸å…¶å®ƒæŸ¥è¯¢çš„å·®åˆ«åŒæ ·æ˜¯åœ¨æŸ¥è¯¢æ¡ä»¶çš„æ„å»ºï¼ŒQueryBuildersï¼Œç»“æœè§£æç­‰å…¶ä»–ä»£ç å®Œå…¨ä¸å˜ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBool</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.å‡†å¤‡BooleanQuery</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="comment">// 2.2.æ·»åŠ term</span></span><br><span class="line">    boolQuery.must(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;æ­å·&quot;</span>));</span><br><span class="line">    <span class="comment">// 2.3.æ·»åŠ range</span></span><br><span class="line">    boolQuery.filter(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).lte(<span class="number">250</span>));</span><br><span class="line"></span><br><span class="line">    request.source().query(boolQuery);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-5-åœ°ç†æŸ¥è¯¢"><a href="#4-5-åœ°ç†æŸ¥è¯¢" class="headerlink" title="4.5 åœ°ç†æŸ¥è¯¢"></a>4.5 åœ°ç†æŸ¥è¯¢</h2><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><img src="./assets/image-20251011173043748.png" alt=" " style="zoom:50%;" /><h3 id="geo-bounding-box"><a href="#geo-bounding-box" class="headerlink" title="geo_bounding_box"></a>geo_bounding_box</h3><img src="./assets/image-20251011173306958.png" alt=" " style="zoom:50%;" /><h3 id="geo-distance"><a href="#geo-distance" class="headerlink" title="geo_distance"></a>geo_distance</h3><ul><li>å¯ç”¨äºæŸ¥è¯¢é™„è¿‘çš„äººåŠŸèƒ½</li></ul><img src="./assets/image-20251011173430785.png" alt=" " style="zoom:50%;" /><p>DSLä»£ç </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># distance</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;geo_distance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;distance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;15km&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;31.21, 121.5&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="4-6-å¤åˆæŸ¥è¯¢"><a href="#4-6-å¤åˆæŸ¥è¯¢" class="headerlink" title="4.6 å¤åˆæŸ¥è¯¢"></a>4.6 å¤åˆæŸ¥è¯¢</h2><blockquote><p>ç›¸å…³æ€§è¶Šé«˜è¶Šæ’å‰é¢</p></blockquote><h3 id="ç›¸å…³æ€§ç®—åˆ†ï¼ˆé‡è¦ï¼‰"><a href="#ç›¸å…³æ€§ç®—åˆ†ï¼ˆé‡è¦ï¼‰" class="headerlink" title="ç›¸å…³æ€§ç®—åˆ†ï¼ˆé‡è¦ï¼‰"></a>ç›¸å…³æ€§ç®—åˆ†ï¼ˆé‡è¦ï¼‰</h3><img src="./assets/image-20251011174509686.png" alt=" " style="zoom:50%;" /><img src="./assets/image-20251011174550950.png" alt=" " style="zoom:33%;" /><h3 id="Function-Score-Query"><a href="#Function-Score-Query" class="headerlink" title="Function Score Query"></a>Function Score Query</h3><img src="./assets/image-20251011175007223.png" alt=" " style="zoom:50%;" /><p><strong>æ¡ˆä¾‹</strong>ï¼š</p><blockquote><p>æ•ˆæœ</p><p>æœç´¢å¤–æ»©é™„è¿‘é…’åº—ï¼Œç»™å¦‚å®¶+10åˆ†ï¼Œæ’åœ¨ç¬¬ä¸€å</p></blockquote><img src="./assets/image-20251011175137542.png" alt=" " style="zoom:43%;" /><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># function score</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;function_score&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;all&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¤–æ»©&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;functions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¦‚å®¶&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;boost_mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Boolean-Query"><a href="#Boolean-Query" class="headerlink" title="Boolean Query"></a>Boolean Query</h3><blockquote><ul><li>ä½¿ç”¨åœºæ™¯<ul><li>ç”¨äºæœç´¢æ¡†æœç´¢ï¼Œå¹¶ä¸”è¿‡æ»¤æŒ‡å®šä¿¡æ¯</li></ul></li><li>ä¾‹å­<ul><li>å¿…é¡»åœ¨ä¸Šæµ·</li><li>é…’åº—å“ç‰Œä¸ºçš‡å† å‡æ—¥ æˆ–è€… åç¾è¾¾ å…¶ä¸­ä¸€ä¸ª</li><li>ä»·æ ¼å¤§äº500ï¼š <code>must_not</code> ä¸èƒ½å°äºç­‰äº500</li><li>ç”¨æˆ·æ‰“åˆ†åœ¨45åˆ†ä»¥ä¸Šçš„</li></ul></li></ul></blockquote><img src="./assets/image-20251011180400987.png" alt=" " style="zoom:50%;" /><p>æ¡ˆä¾‹ï¼š</p><img src="./assets/image-20251011180527598.png" alt=" " style="zoom:50%;" /><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># bool</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¦‚å®¶&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gt&quot;</span><span class="punctuation">:</span> <span class="number">400</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;geo_distance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;distance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10km&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;lat&quot;</span><span class="punctuation">:</span> <span class="number">31.21</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lon&quot;</span><span class="punctuation">:</span> <span class="number">121.5</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="4-7æ’åº"><a href="#4-7æ’åº" class="headerlink" title="4.7æ’åº"></a>4.7æ’åº</h2><img src="./assets/image-20251012132608280.png" alt=" " style="zoom:50%;" /><p><strong>æ¡ˆä¾‹</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># sort å¯¹scoreè¯„åˆ†é™åºï¼Œ ä»·æ ¼å‡åº</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"># è·ç¦»å½“å‰åæ ‡è·ç¦»æ’åº</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_geo_distance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;lat&quot;</span><span class="punctuation">:</span> <span class="number">31.034661</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;lon&quot;</span><span class="punctuation">:</span> <span class="number">121.612282</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;unit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;km&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="4-8-åˆ†é¡µ"><a href="#4-8-åˆ†é¡µ" class="headerlink" title="4.8 åˆ†é¡µ"></a>4.8 åˆ†é¡µ</h2><blockquote><ul><li>ä»990å¼€å§‹  è·å–10æ¡æ•°æ®ï¼š990~1000<ul><li>è·å–å‰1000æ¡ï¼Œæ’åº</li><li>æˆªå–990~1000</li><li>è¿™æ ·åšå¯¹äºé›†ç¾¤æœ‰é—®é¢˜ï¼Œæ’åºæ—¶æ‰€æœ‰é›†ç¾¤æ•°æ®æ€»å’Œæ’åº</li></ul></li></ul></blockquote><img src="./assets/image-20251012132947996.png" alt=" " style="zoom:50%;" /><h3 id="æ·±åº¦åˆ†é¡µé—®é¢˜"><a href="#æ·±åº¦åˆ†é¡µé—®é¢˜" class="headerlink" title="æ·±åº¦åˆ†é¡µé—®é¢˜"></a>æ·±åº¦åˆ†é¡µé—®é¢˜</h3><blockquote><ul><li>esè§„å®šæŸ¥è¯¢ä¸Šé™æ˜¯10000</li><li>ä½¿ç”¨ <code>search after</code>è§£å†³  ä¿å­˜ä¹‹å‰æŸ¥è¯¢çš„æ¸¸æ ‡</li></ul></blockquote><img src="./assets/image-20251012133636363.png" alt=" " style="zoom:50%;" /><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><img src="./assets/image-20251012134155944.png" alt=" " style="zoom:50%;" /><h2 id="4-9-æ’åº-åˆ†é¡µå®ä¾‹"><a href="#4-9-æ’åº-åˆ†é¡µå®ä¾‹" class="headerlink" title="4.9.æ’åº+åˆ†é¡µå®ä¾‹"></a>4.9.æ’åº+åˆ†é¡µå®ä¾‹</h2><p>æœç´¢ç»“æœçš„æ’åºå’Œåˆ†é¡µæ˜¯ä¸queryåŒçº§çš„å‚æ•°ï¼Œå› æ­¤åŒæ ·æ˜¯ä½¿ç”¨request.source()æ¥è®¾ç½®ã€‚</p><p>å¯¹åº”çš„APIå¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721221121266.png" alt="image-20210721221121266"></p><p>å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPageAndSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// é¡µç ï¼Œæ¯é¡µå¤§å°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> <span class="number">1</span>, size = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">// 2.2.æ’åº sort</span></span><br><span class="line">    request.source().sort(<span class="string">&quot;price&quot;</span>, SortOrder.ASC);</span><br><span class="line">    <span class="comment">// 2.3.åˆ†é¡µ fromã€size</span></span><br><span class="line">    request.source().from((page - <span class="number">1</span>) * size).size(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-10-é«˜äº®"><a href="#4-10-é«˜äº®" class="headerlink" title="4.10.é«˜äº®"></a>4.10.é«˜äº®</h2><p>é«˜äº®çš„ä»£ç ä¸ä¹‹å‰ä»£ç å·®å¼‚è¾ƒå¤§ï¼Œæœ‰ä¸¤ç‚¹ï¼š</p><ul><li>æŸ¥è¯¢çš„DSLï¼šå…¶ä¸­é™¤äº†æŸ¥è¯¢æ¡ä»¶ï¼Œè¿˜éœ€è¦æ·»åŠ é«˜äº®æ¡ä»¶ï¼ŒåŒæ ·æ˜¯ä¸queryåŒçº§ã€‚</li><li>ç»“æœè§£æï¼šç»“æœé™¤äº†è¦è§£æ_sourceæ–‡æ¡£æ•°æ®ï¼Œè¿˜è¦è§£æé«˜äº®ç»“æœ</li><li><code>é»˜è®¤æƒ…å†µä¸‹ matchå­æ®µå’Œfieldså­æ®µç›¸åŒæ‰é«˜äº®</code></li></ul><img src="./assets/image-20251012134552364.png" alt=" " style="zoom:50%;" /><p><strong>æ¡ˆä¾‹</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># é«˜äº®</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;all&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¦‚å®¶&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">,</span> <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;require_field_match&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;pre_tags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;em&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_tags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;/em&gt;&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251012135149242.png" alt="image-20251012135149242"></p><h3 id="4-10-1-é«˜äº®è¯·æ±‚æ„å»º"><a href="#4-10-1-é«˜äº®è¯·æ±‚æ„å»º" class="headerlink" title="4.10.1.é«˜äº®è¯·æ±‚æ„å»º"></a>4.10.1.é«˜äº®è¯·æ±‚æ„å»º</h3><p>é«˜äº®è¯·æ±‚çš„æ„å»ºAPIå¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721221744883.png" alt="image-20210721221744883"></p><p>ä¸Šè¿°ä»£ç çœç•¥äº†æŸ¥è¯¢æ¡ä»¶éƒ¨åˆ†ï¼Œä½†æ˜¯å¤§å®¶ä¸è¦å¿˜äº†ï¼šé«˜äº®æŸ¥è¯¢å¿…é¡»ä½¿ç”¨å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œå¹¶ä¸”è¦æœ‰æœç´¢å…³é”®å­—ï¼Œå°†æ¥æ‰å¯ä»¥å¯¹å…³é”®å­—é«˜äº®ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHighlight</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;å¦‚å®¶&quot;</span>));</span><br><span class="line">    <span class="comment">// 2.2.é«˜äº®</span></span><br><span class="line">    request.source().highlighter(<span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>().field(<span class="string">&quot;name&quot;</span>).requireFieldMatch(<span class="literal">false</span>));</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-10-2-é«˜äº®ç»“æœè§£æ"><a href="#4-10-2-é«˜äº®ç»“æœè§£æ" class="headerlink" title="4.10.2.é«˜äº®ç»“æœè§£æ"></a>4.10.2.é«˜äº®ç»“æœè§£æ</h3><p>é«˜äº®çš„ç»“æœä¸æŸ¥è¯¢çš„æ–‡æ¡£ç»“æœé»˜è®¤æ˜¯åˆ†ç¦»çš„ï¼Œå¹¶ä¸åœ¨ä¸€èµ·ã€‚</p><p>å› æ­¤è§£æé«˜äº®çš„ä»£ç éœ€è¦é¢å¤–å¤„ç†ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721222057212.png" alt="image-20210721222057212"></p><p>ä»£ç è§£è¯»ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šä»ç»“æœä¸­è·å–sourceã€‚hit.getSourceAsString()ï¼Œè¿™éƒ¨åˆ†æ˜¯éé«˜äº®ç»“æœï¼Œjsonå­—ç¬¦ä¸²ã€‚è¿˜éœ€è¦ååºåˆ—ä¸ºHotelDocå¯¹è±¡</li><li>ç¬¬äºŒæ­¥ï¼šè·å–é«˜äº®ç»“æœã€‚hit.getHighlightFields()ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªMapï¼Œkeyæ˜¯é«˜äº®å­—æ®µåç§°ï¼Œå€¼æ˜¯HighlightFieldå¯¹è±¡ï¼Œä»£è¡¨é«˜äº®å€¼</li><li>ç¬¬ä¸‰æ­¥ï¼šä»mapä¸­æ ¹æ®é«˜äº®å­—æ®µåç§°ï¼Œè·å–é«˜äº®å­—æ®µå€¼å¯¹è±¡HighlightField</li><li>ç¬¬å››æ­¥ï¼šä»HighlightFieldä¸­è·å–Fragmentsï¼Œå¹¶ä¸”è½¬ä¸ºå­—ç¬¦ä¸²ã€‚è¿™éƒ¨åˆ†å°±æ˜¯çœŸæ­£çš„é«˜äº®å­—ç¬¦ä¸²äº†</li><li>ç¬¬äº”æ­¥ï¼šç”¨é«˜äº®çš„ç»“æœæ›¿æ¢HotelDocä¸­çš„éé«˜äº®ç»“æœ</li></ul><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">&quot;å…±æœç´¢åˆ°&quot;</span> + total + <span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        <span class="comment">// è·å–é«˜äº®ç»“æœ</span></span><br><span class="line">        Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(highlightFields)) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å­—æ®µåè·å–é«˜äº®ç»“æœ</span></span><br><span class="line">            <span class="type">HighlightField</span> <span class="variable">highlightField</span> <span class="operator">=</span> highlightFields.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (highlightField != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// è·å–é«˜äº®å€¼</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> highlightField.getFragments()[<span class="number">0</span>].string();</span><br><span class="line">                <span class="comment">// è¦†ç›–éé«˜äº®ç»“æœ</span></span><br><span class="line">                hotelDoc.setName(name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-11-æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰"><a href="#4-11-æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="4.11 æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰"></a>4.11 æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰</h2><img src="./assets/image-20251012135318122.png" alt=" " style="zoom:50%;" /><p><code>source å¯¹åº”å¤§çš„jsonï¼Œ ä¸‹é¢çš„apiæ˜¯jsonä¸€çº§åŒ…å«  query æ’åº åˆ†é¡µ é«˜äº®</code>ï¼š</p><img src="./assets/image-20251012140531044.png" alt=" " style="zoom:50%;" /><p><code>QueryBuilders æ„å»ºäºŒçº§å‚æ•° bool range term</code>ï¼š</p><img src="./assets/image-20251012140710624.png" alt=" " style="zoom:50%;" /><h1 id="5-æ—…æ¸¸æ¡ˆä¾‹"><a href="#5-æ—…æ¸¸æ¡ˆä¾‹" class="headerlink" title="5.æ—…æ¸¸æ¡ˆä¾‹"></a>5.æ—…æ¸¸æ¡ˆä¾‹</h1><p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡é»‘é©¬æ—…æ¸¸çš„æ¡ˆä¾‹æ¥å®æˆ˜æ¼”ç»ƒä¸‹ä¹‹å‰å­¦ä¹ çš„çŸ¥è¯†ã€‚</p><p>æˆ‘ä»¬å®ç°å››éƒ¨åˆ†åŠŸèƒ½ï¼š</p><ul><li>é…’åº—æœç´¢å’Œåˆ†é¡µ</li><li>é…’åº—ç»“æœè¿‡æ»¤</li><li>æˆ‘å‘¨è¾¹çš„é…’åº—</li><li>é…’åº—ç«ä»·æ’å</li></ul><p>å¯åŠ¨æˆ‘ä»¬æä¾›çš„hotel-demoé¡¹ç›®ï¼Œå…¶é»˜è®¤ç«¯å£æ˜¯8089ï¼Œè®¿é—®<a href="http://localhost:8090ï¼Œå°±èƒ½çœ‹åˆ°é¡¹ç›®é¡µé¢äº†ï¼š">http://localhost:8090ï¼Œå°±èƒ½çœ‹åˆ°é¡¹ç›®é¡µé¢äº†ï¼š</a></p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721223159598.png" alt=" "></p><h2 id="5-1-é…’åº—æœç´¢å’Œåˆ†é¡µ"><a href="#5-1-é…’åº—æœç´¢å’Œåˆ†é¡µ" class="headerlink" title="5.1.é…’åº—æœç´¢å’Œåˆ†é¡µ"></a>5.1.é…’åº—æœç´¢å’Œåˆ†é¡µ</h2><p>æ¡ˆä¾‹éœ€æ±‚ï¼šå®ç°é»‘é©¬æ—…æ¸¸çš„é…’åº—æœç´¢åŠŸèƒ½ï¼Œå®Œæˆå…³é”®å­—æœç´¢å’Œåˆ†é¡µ</p><h3 id="5-1-1-éœ€æ±‚åˆ†æ"><a href="#5-1-1-éœ€æ±‚åˆ†æ" class="headerlink" title="5.1.1.éœ€æ±‚åˆ†æ"></a>5.1.1.éœ€æ±‚åˆ†æ</h3><p>åœ¨é¡¹ç›®çš„é¦–é¡µï¼Œæœ‰ä¸€ä¸ªå¤§å¤§çš„æœç´¢æ¡†ï¼Œè¿˜æœ‰åˆ†é¡µæŒ‰é’®ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721223859419.png" alt="image-20210721223859419"></p><p>ç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ§åˆ¶å°å‘å‡ºäº†è¯·æ±‚ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721224033789.png" alt="image-20210721224033789"></p><p>è¯·æ±‚å‚æ•°å¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721224112708.png" alt="image-20210721224112708"></p><p>ç”±æ­¤å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬è¿™ä¸ªè¯·æ±‚çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><ul><li>è¯·æ±‚æ–¹å¼ï¼šPOST</li><li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;hotel&#x2F;list</li><li>è¯·æ±‚å‚æ•°ï¼šJSONå¯¹è±¡ï¼ŒåŒ…å«4ä¸ªå­—æ®µï¼š<ul><li>keyï¼šæœç´¢å…³é”®å­—</li><li>pageï¼šé¡µç </li><li>sizeï¼šæ¯é¡µå¤§å°</li><li>sortByï¼šæ’åºï¼Œç›®å‰æš‚ä¸å®ç°</li></ul></li><li>è¿”å›å€¼ï¼šåˆ†é¡µæŸ¥è¯¢ï¼Œéœ€è¦è¿”å›åˆ†é¡µç»“æœPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼š<ul><li><code>total</code>ï¼šæ€»æ¡æ•°</li><li><code>List&lt;HotelDoc&gt;</code>ï¼šå½“å‰é¡µçš„æ•°æ®</li></ul></li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬å®ç°ä¸šåŠ¡çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ­¥éª¤ä¸€ï¼šå®šä¹‰å®ä½“ç±»ï¼Œæ¥æ”¶è¯·æ±‚å‚æ•°çš„JSONå¯¹è±¡</li><li>æ­¥éª¤äºŒï¼šç¼–å†™controllerï¼Œæ¥æ”¶é¡µé¢çš„è¯·æ±‚</li><li>æ­¥éª¤ä¸‰ï¼šç¼–å†™ä¸šåŠ¡å®ç°ï¼Œåˆ©ç”¨RestHighLevelClientå®ç°æœç´¢ã€åˆ†é¡µ</li></ul><h3 id="5-1-2-å®šä¹‰å®ä½“ç±»"><a href="#5-1-2-å®šä¹‰å®ä½“ç±»" class="headerlink" title="5.1.2.å®šä¹‰å®ä½“ç±»"></a>5.1.2.å®šä¹‰å®ä½“ç±»</h3><p>å®ä½“ç±»æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å‰ç«¯çš„è¯·æ±‚å‚æ•°å®ä½“ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯åº”è¯¥è¿”å›çš„å“åº”ç»“æœå®ä½“ã€‚</p><p>1ï¼‰è¯·æ±‚å‚æ•°</p><p>å‰ç«¯è¯·æ±‚çš„jsonç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœç´¢å…³é”®å­—&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sortBy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹å®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer size;</span><br><span class="line">    <span class="keyword">private</span> String sortBy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ï¼‰è¿”å›å€¼</p><p>åˆ†é¡µæŸ¥è¯¢ï¼Œéœ€è¦è¿”å›åˆ†é¡µç»“æœPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§ï¼š</p><ul><li><code>total</code>ï¼šæ€»æ¡æ•°</li><li><code>List&lt;HotelDoc&gt;</code>ï¼šå½“å‰é¡µçš„æ•°æ®</li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.pojo</code>ä¸­å®šä¹‰è¿”å›ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line">    <span class="keyword">private</span> List&lt;HotelDoc&gt; hotels;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PageResult</span><span class="params">(Long total, List&lt;HotelDoc&gt; hotels)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.total = total;</span><br><span class="line">        <span class="built_in">this</span>.hotels = hotels;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-1-3-å®šä¹‰controller"><a href="#5-1-3-å®šä¹‰controller" class="headerlink" title="5.1.3.å®šä¹‰controller"></a>5.1.3.å®šä¹‰controller</h3><p>å®šä¹‰ä¸€ä¸ªHotelControllerï¼Œå£°æ˜æŸ¥è¯¢æ¥å£ï¼Œæ»¡è¶³ä¸‹åˆ—è¦æ±‚ï¼š</p><ul><li>è¯·æ±‚æ–¹å¼ï¼šPost</li><li>è¯·æ±‚è·¯å¾„ï¼š&#x2F;hotel&#x2F;list</li><li>è¯·æ±‚å‚æ•°ï¼šå¯¹è±¡ï¼Œç±»å‹ä¸ºRequestParam</li><li>è¿”å›å€¼ï¼šPageResultï¼ŒåŒ…å«ä¸¤ä¸ªå±æ€§<ul><li><code>Long total</code>ï¼šæ€»æ¡æ•°</li><li><code>List&lt;HotelDoc&gt; hotels</code>ï¼šé…’åº—æ•°æ®</li></ul></li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>cn.itcast.hotel.web</code>ä¸­å®šä¹‰HotelControllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hotel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IHotelService hotelService;</span><br><span class="line"><span class="comment">// æœç´¢é…’åº—æ•°æ®</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(<span class="meta">@RequestBody</span> RequestParams params)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hotelService.search(params);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-1-4-å®ç°æœç´¢ä¸šåŠ¡"><a href="#5-1-4-å®ç°æœç´¢ä¸šåŠ¡" class="headerlink" title="5.1.4.å®ç°æœç´¢ä¸šåŠ¡"></a>5.1.4.å®ç°æœç´¢ä¸šåŠ¡</h3><p>æˆ‘ä»¬åœ¨controllerè°ƒç”¨äº†IHotelServiceï¼Œå¹¶æ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œå› æ­¤ä¸‹é¢æˆ‘ä»¬å°±åœ¨IHotelServiceä¸­å®šä¹‰æ–¹æ³•ï¼Œå¹¶ä¸”å»å®ç°ä¸šåŠ¡é€»è¾‘ã€‚</p><p>1ï¼‰åœ¨<code>cn.itcast.hotel.service</code>ä¸­çš„<code>IHotelService</code>æ¥å£ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®å…³é”®å­—æœç´¢é…’åº—ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params è¯·æ±‚å‚æ•°å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·è¾“å…¥çš„å…³é”®å­— </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> é…’åº—æ–‡æ¡£åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span>;</span><br></pre></td></tr></table></figure><p>2ï¼‰å®ç°æœç´¢ä¸šåŠ¡ï¼Œè‚¯å®šç¦»ä¸å¼€RestHighLevelClientï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒæ³¨å†Œåˆ°Springä¸­ä½œä¸ºä¸€ä¸ªBeanã€‚åœ¨ <code>config</code> åŒ…ä¸‹ä¾èµ–æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EsConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestHighLevelClient <span class="title function_">client</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                HttpHost.create(<span class="string">&quot;http://localhost:9200&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰åœ¨<code>cn.itcast.hotel.service.impl</code>ä¸­çš„<code>HotelService</code>ä¸­å®ç°searchæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">        <span class="comment">// 2.1.query</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">            request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2.åˆ†é¡µ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> params.getPage();</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> params.getSize();</span><br><span class="line">        request.source().from((page - <span class="number">1</span>) * size).size(size);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">        <span class="keyword">return</span> handleResponse(response);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœè§£æ</span></span><br><span class="line"><span class="keyword">private</span> PageResult <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    List&lt;HotelDoc&gt; hotels = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line"><span class="comment">// æ”¾å…¥é›†åˆ</span></span><br><span class="line">        hotels.add(hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.4.å°è£…è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total, hotels);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-2-é…’åº—ç»“æœè¿‡æ»¤"><a href="#5-2-é…’åº—ç»“æœè¿‡æ»¤" class="headerlink" title="5.2.é…’åº—ç»“æœè¿‡æ»¤"></a>5.2.é…’åº—ç»“æœè¿‡æ»¤</h2><p>éœ€æ±‚ï¼šæ·»åŠ å“ç‰Œã€åŸå¸‚ã€æ˜Ÿçº§ã€ä»·æ ¼ç­‰è¿‡æ»¤åŠŸèƒ½</p><h3 id="5-2-1-éœ€æ±‚åˆ†æ"><a href="#5-2-1-éœ€æ±‚åˆ†æ" class="headerlink" title="5.2.1.éœ€æ±‚åˆ†æ"></a>5.2.1.éœ€æ±‚åˆ†æ</h3><p>åœ¨é¡µé¢æœç´¢æ¡†ä¸‹é¢ï¼Œä¼šæœ‰ä¸€äº›è¿‡æ»¤é¡¹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722091940726.png" alt="image-20210722091940726"></p><p>ä¼ é€’çš„å‚æ•°å¦‚å›¾ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722092051994.png" alt="image-20210722092051994"> </p><p>åŒ…å«çš„è¿‡æ»¤æ¡ä»¶æœ‰ï¼š</p><ul><li>brandï¼šå“ç‰Œå€¼</li><li>cityï¼šåŸå¸‚</li><li>minPrice~maxPriceï¼šä»·æ ¼èŒƒå›´</li><li>starNameï¼šæ˜Ÿçº§</li></ul><p>æˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</p><ul><li>ä¿®æ”¹è¯·æ±‚å‚æ•°çš„å¯¹è±¡RequestParamsï¼Œæ¥æ”¶ä¸Šè¿°å‚æ•°</li><li>ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨æœç´¢æ¡ä»¶ä¹‹å¤–ï¼Œæ·»åŠ ä¸€äº›è¿‡æ»¤æ¡ä»¶</li></ul><h3 id="5-2-2-ä¿®æ”¹å®ä½“ç±»"><a href="#5-2-2-ä¿®æ”¹å®ä½“ç±»" class="headerlink" title="5.2.2.ä¿®æ”¹å®ä½“ç±»"></a>5.2.2.ä¿®æ”¹å®ä½“ç±»</h3><p>ä¿®æ”¹åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„å®ä½“ç±»RequestParamsï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer size;</span><br><span class="line">    <span class="keyword">private</span> String sortBy;</span><br><span class="line">    <span class="comment">// ä¸‹é¢æ˜¯æ–°å¢çš„è¿‡æ»¤æ¡ä»¶å‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> Integer minPrice;</span><br><span class="line">    <span class="keyword">private</span> Integer maxPrice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-3-ä¿®æ”¹æœç´¢ä¸šåŠ¡"><a href="#5-2-3-ä¿®æ”¹æœç´¢ä¸šåŠ¡" class="headerlink" title="5.2.3.ä¿®æ”¹æœç´¢ä¸šåŠ¡"></a>5.2.3.ä¿®æ”¹æœç´¢ä¸šåŠ¡</h3><p>åœ¨HotelServiceçš„searchæ–¹æ³•ä¸­ï¼Œåªæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼šrequet.source().query( â€¦ )å…¶ä¸­çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p><p>åœ¨ä¹‹å‰çš„ä¸šåŠ¡ä¸­ï¼Œåªæœ‰matchæŸ¥è¯¢ï¼Œæ ¹æ®å…³é”®å­—æœç´¢ï¼Œç°åœ¨è¦æ·»åŠ æ¡ä»¶è¿‡æ»¤ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å“ç‰Œè¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li><li>æ˜Ÿçº§è¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li><li>ä»·æ ¼è¿‡æ»¤ï¼šæ˜¯æ•°å€¼ç±»å‹ï¼Œç”¨rangeæŸ¥è¯¢</li><li>åŸå¸‚è¿‡æ»¤ï¼šæ˜¯keywordç±»å‹ï¼Œç”¨termæŸ¥è¯¢</li></ul><p>å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ç»„åˆï¼Œè‚¯å®šæ˜¯booleanæŸ¥è¯¢æ¥ç»„åˆï¼š</p><ul><li>å…³é”®å­—æœç´¢æ”¾åˆ°mustä¸­ï¼Œå‚ä¸ç®—åˆ†</li><li>å…¶å®ƒè¿‡æ»¤æ¡ä»¶æ”¾åˆ°filterä¸­ï¼Œä¸å‚ä¸ç®—åˆ†</li></ul><p>å› ä¸ºæ¡ä»¶æ„å»ºçš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå…ˆå°è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722092935453.png" alt="image-20210722092935453"></p><p>buildBasicQueryçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildBasicQuery</span><span class="params">(RequestParams params, SearchRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ„å»ºBooleanQuery</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="comment">// 2.å…³é”®å­—æœç´¢</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">        boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åŸå¸‚æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getCity() != <span class="literal">null</span> &amp;&amp; !params.getCity().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, params.getCity()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.å“ç‰Œæ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getBrand() != <span class="literal">null</span> &amp;&amp; !params.getBrand().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, params.getBrand()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.æ˜Ÿçº§æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getStarName() != <span class="literal">null</span> &amp;&amp; !params.getStarName().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;starName&quot;</span>, params.getStarName()));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 6.ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">if</span> (params.getMinPrice() != <span class="literal">null</span> &amp;&amp; params.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders</span><br><span class="line">                         .rangeQuery(<span class="string">&quot;price&quot;</span>)</span><br><span class="line">                         .gte(params.getMinPrice())</span><br><span class="line">                         .lte(params.getMaxPrice())</span><br><span class="line">                        );</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 7.æ”¾å…¥source</span></span><br><span class="line">    request.source().query(boolQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-3-æˆ‘å‘¨è¾¹çš„é…’åº—"><a href="#5-3-æˆ‘å‘¨è¾¹çš„é…’åº—" class="headerlink" title="5.3.æˆ‘å‘¨è¾¹çš„é…’åº—"></a>5.3.æˆ‘å‘¨è¾¹çš„é…’åº—</h2><p>éœ€æ±‚ï¼šæˆ‘é™„è¿‘çš„é…’åº—</p><h3 id="5-3-1-éœ€æ±‚åˆ†æ"><a href="#5-3-1-éœ€æ±‚åˆ†æ" class="headerlink" title="5.3.1.éœ€æ±‚åˆ†æ"></a>5.3.1.éœ€æ±‚åˆ†æ</h3><p>åœ¨é…’åº—åˆ—è¡¨é¡µçš„å³ä¾§ï¼Œæœ‰ä¸€ä¸ªå°åœ°å›¾ï¼Œç‚¹å‡»åœ°å›¾çš„å®šä½æŒ‰é’®ï¼Œåœ°å›¾ä¼šæ‰¾åˆ°ä½ æ‰€åœ¨çš„ä½ç½®ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722093414542.png" alt="image-20210722093414542"> </p><p>å¹¶ä¸”ï¼Œåœ¨å‰ç«¯ä¼šå‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œå°†ä½ çš„åæ ‡å‘é€åˆ°æœåŠ¡ç«¯ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722093642382.png" alt="image-20210722093642382"> </p><p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯åŸºäºè¿™ä¸ªlocationåæ ‡ï¼Œç„¶åæŒ‰ç…§è·ç¦»å¯¹å‘¨å›´é…’åº—æ’åºã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>ä¿®æ”¹RequestParamså‚æ•°ï¼Œæ¥æ”¶locationå­—æ®µ</li><li>ä¿®æ”¹searchæ–¹æ³•ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœlocationæœ‰å€¼ï¼Œæ·»åŠ æ ¹æ®geo_distanceæ’åºçš„åŠŸèƒ½</li></ul><h3 id="5-3-2-ä¿®æ”¹å®ä½“ç±»"><a href="#5-3-2-ä¿®æ”¹å®ä½“ç±»" class="headerlink" title="5.3.2.ä¿®æ”¹å®ä½“ç±»"></a>5.3.2.ä¿®æ”¹å®ä½“ç±»</h3><p>ä¿®æ”¹åœ¨<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„å®ä½“ç±»RequestParamsï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestParams</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line">    <span class="keyword">private</span> Integer page;</span><br><span class="line">    <span class="keyword">private</span> Integer size;</span><br><span class="line">    <span class="keyword">private</span> String sortBy;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> Integer minPrice;</span><br><span class="line">    <span class="keyword">private</span> Integer maxPrice;</span><br><span class="line">    <span class="comment">// æˆ‘å½“å‰çš„åœ°ç†åæ ‡</span></span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-3-3-è·ç¦»æ’åºAPI"><a href="#5-3-3-è·ç¦»æ’åºAPI" class="headerlink" title="5.3.3.è·ç¦»æ’åºAPI"></a>5.3.3.è·ç¦»æ’åºAPI</h3><p>æˆ‘ä»¬ä»¥å‰å­¦ä¹ è¿‡æ’åºåŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>æ™®é€šå­—æ®µæ’åº</li><li>åœ°ç†åæ ‡æ’åº</li></ul><p>æˆ‘ä»¬åªè®²äº†æ™®é€šå­—æ®µæ’åºå¯¹åº”çš„javaå†™æ³•ã€‚åœ°ç†åæ ‡æ’åºåªå­¦è¿‡DSLè¯­æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GETÂ /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">Â Â <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> Â <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span>Â <span class="punctuation">[</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span>Â Â </span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â <span class="attr">&quot;_geo_distance&quot;</span>Â <span class="punctuation">:</span>Â <span class="punctuation">&#123;</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;FIELD&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;çº¬åº¦ï¼Œç»åº¦&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;order&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="attr">&quot;unit&quot;</span>Â <span class="punctuation">:</span>Â <span class="string">&quot;km&quot;</span></span><br><span class="line">Â Â Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â Â Â <span class="punctuation">&#125;</span></span><br><span class="line">Â Â <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„javaä»£ç ç¤ºä¾‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722095227059.png" alt="image-20210722095227059"></p><h3 id="5-3-4-æ·»åŠ è·ç¦»æ’åº"><a href="#5-3-4-æ·»åŠ è·ç¦»æ’åº" class="headerlink" title="5.3.4.æ·»åŠ è·ç¦»æ’åº"></a>5.3.4.æ·»åŠ è·ç¦»æ’åº</h3><p>åœ¨<code>cn.itcast.hotel.service.impl</code>çš„<code>HotelService</code>çš„<code>search</code>æ–¹æ³•ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ’åºåŠŸèƒ½ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722095902314.png" alt="image-20210722095902314"></p><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">        <span class="comment">// 2.1.query</span></span><br><span class="line">        buildBasicQuery(params, request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2.åˆ†é¡µ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> params.getPage();</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> params.getSize();</span><br><span class="line">        request.source().from((page - <span class="number">1</span>) * size).size(size);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.3.æ’åº</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">location</span> <span class="operator">=</span> params.getLocation();</span><br><span class="line">        <span class="keyword">if</span> (location != <span class="literal">null</span> &amp;&amp; !location.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            request.source().sort(SortBuilders</span><br><span class="line">                                  .geoDistanceSort(<span class="string">&quot;location&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoPoint</span>(location))</span><br><span class="line">                                  .order(SortOrder.ASC)</span><br><span class="line">                                  .unit(DistanceUnit.KILOMETERS)</span><br><span class="line">                                 );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">        <span class="keyword">return</span> handleResponse(response);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-5-æ’åºè·ç¦»æ˜¾ç¤º-é‡ç‚¹"><a href="#5-3-5-æ’åºè·ç¦»æ˜¾ç¤º-é‡ç‚¹" class="headerlink" title="5.3.5.æ’åºè·ç¦»æ˜¾ç¤º(é‡ç‚¹)"></a>5.3.5.æ’åºè·ç¦»æ˜¾ç¤º(é‡ç‚¹)</h3><p>é‡å¯æœåŠ¡åï¼Œæµ‹è¯•æˆ‘çš„é…’åº—åŠŸèƒ½ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722100040674.png" alt="image-20210722100040674"></p><p>å‘ç°ç¡®å®å¯ä»¥å®ç°å¯¹æˆ‘é™„è¿‘é…’åº—çš„æ’åºï¼Œä¸è¿‡å¹¶æ²¡æœ‰çœ‹åˆ°é…’åº—åˆ°åº•è·ç¦»æˆ‘å¤šè¿œï¼Œè¿™è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>æ’åºå®Œæˆåï¼Œé¡µé¢è¿˜è¦è·å–æˆ‘é™„è¿‘æ¯ä¸ªé…’åº—çš„å…·ä½“<strong>è·ç¦»</strong>å€¼ï¼Œè¿™ä¸ªå€¼åœ¨å“åº”ç»“æœä¸­æ˜¯ç‹¬ç«‹çš„ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722095648542.png" alt="image-20210722095648542"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç»“æœè§£æé˜¶æ®µï¼Œé™¤äº†è§£æsourceéƒ¨åˆ†ä»¥å¤–ï¼Œè¿˜è¦å¾—åˆ°sortéƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æ’åºçš„è·ç¦»ï¼Œç„¶åæ”¾åˆ°å“åº”ç»“æœä¸­ã€‚</p><p>æˆ‘ä»¬è¦åšä¸¤ä»¶äº‹ï¼š</p><ul><li>ä¿®æ”¹HotelDocï¼Œæ·»åŠ æ’åºè·ç¦»å­—æ®µï¼Œç”¨äºé¡µé¢æ˜¾ç¤º</li><li>ä¿®æ”¹HotelServiceç±»ä¸­çš„handleResponseæ–¹æ³•ï¼Œæ·»åŠ å¯¹sortå€¼çš„è·å–</li></ul><p>1ï¼‰ä¿®æ”¹HotelDocç±»ï¼Œæ·»åŠ è·ç¦»å­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.hotel.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelDoc</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer score;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String starName;</span><br><span class="line">    <span class="keyword">private</span> String business;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> String pic;</span><br><span class="line">    <span class="comment">// æ’åºæ—¶çš„ è·ç¦»å€¼</span></span><br><span class="line">    <span class="keyword">private</span> Object distance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HotelDoc</span><span class="params">(Hotel hotel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = hotel.getId();</span><br><span class="line">        <span class="built_in">this</span>.name = hotel.getName();</span><br><span class="line">        <span class="built_in">this</span>.address = hotel.getAddress();</span><br><span class="line">        <span class="built_in">this</span>.price = hotel.getPrice();</span><br><span class="line">        <span class="built_in">this</span>.score = hotel.getScore();</span><br><span class="line">        <span class="built_in">this</span>.brand = hotel.getBrand();</span><br><span class="line">        <span class="built_in">this</span>.city = hotel.getCity();</span><br><span class="line">        <span class="built_in">this</span>.starName = hotel.getStarName();</span><br><span class="line">        <span class="built_in">this</span>.business = hotel.getBusiness();</span><br><span class="line">        <span class="built_in">this</span>.location = hotel.getLatitude() + <span class="string">&quot;, &quot;</span> + hotel.getLongitude();</span><br><span class="line">        <span class="built_in">this</span>.pic = hotel.getPic();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2ï¼‰ä¿®æ”¹HotelServiceä¸­çš„handleResponseæ–¹æ³•</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722100613966.png" alt="image-20210722100613966"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object[] sortValues = hit.getSortValues();</span><br><span class="line">           <span class="keyword">if</span>(sortValues.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">               <span class="type">Object</span> <span class="variable">sortValue</span> <span class="operator">=</span> sortValues[<span class="number">0</span>];</span><br><span class="line">               hotelDoc.setDistance(sortValue);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><p>é‡å¯åæµ‹è¯•ï¼Œå‘ç°é¡µé¢èƒ½æˆåŠŸæ˜¾ç¤ºè·ç¦»äº†ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251012160015829.png" alt="image-20251012160015829"></p><h2 id="5-4-é…’åº—ç«ä»·æ’å"><a href="#5-4-é…’åº—ç«ä»·æ’å" class="headerlink" title="5.4.é…’åº—ç«ä»·æ’å"></a>5.4.é…’åº—ç«ä»·æ’å</h2><p>éœ€æ±‚ï¼šè®©æŒ‡å®šçš„é…’åº—åœ¨æœç´¢ç»“æœä¸­æ’åç½®é¡¶</p><h3 id="5-4-1-éœ€æ±‚åˆ†æ"><a href="#5-4-1-éœ€æ±‚åˆ†æ" class="headerlink" title="5.4.1.éœ€æ±‚åˆ†æ"></a>5.4.1.éœ€æ±‚åˆ†æ</h3><p>è¦è®©æŒ‡å®šé…’åº—åœ¨æœç´¢ç»“æœä¸­æ’åç½®é¡¶ï¼Œæ•ˆæœå¦‚å›¾ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722100947292.png" alt="image-20210722100947292"></p><p>é¡µé¢ä¼šç»™æŒ‡å®šçš„é…’åº—æ·»åŠ <strong>å¹¿å‘Š</strong>æ ‡è®°ã€‚</p><p>é‚£æ€æ ·æ‰èƒ½è®©æŒ‡å®šçš„é…’åº—æ’åç½®é¡¶å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡çš„function_scoreæŸ¥è¯¢å¯ä»¥å½±å“ç®—åˆ†ï¼Œç®—åˆ†é«˜äº†ï¼Œè‡ªç„¶æ’åä¹Ÿå°±é«˜äº†ã€‚è€Œfunction_scoreåŒ…å«3ä¸ªè¦ç´ ï¼š</p><ul><li>è¿‡æ»¤æ¡ä»¶ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ†</li><li>ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®—function score</li><li>åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query scoreå¦‚ä½•è¿ç®—</li></ul><p>è¿™é‡Œçš„éœ€æ±‚æ˜¯ï¼šè®©<strong>æŒ‡å®šé…’åº—</strong>æ’åé å‰ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ç»™è¿™äº›é…’åº—æ·»åŠ ä¸€ä¸ªæ ‡è®°ï¼Œè¿™æ ·åœ¨è¿‡æ»¤æ¡ä»¶ä¸­å°±å¯ä»¥<strong>æ ¹æ®è¿™ä¸ªæ ‡è®°æ¥åˆ¤æ–­ï¼Œæ˜¯å¦è¦æé«˜ç®—åˆ†</strong>ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»™é…’åº—æ·»åŠ ä¸€ä¸ªå­—æ®µï¼šisADï¼ŒBooleanç±»å‹ï¼š</p><ul><li>trueï¼šæ˜¯å¹¿å‘Š</li><li>falseï¼šä¸æ˜¯å¹¿å‘Š</li></ul><p>è¿™æ ·function_scoreåŒ…å«3ä¸ªè¦ç´ å°±å¾ˆå¥½ç¡®å®šäº†ï¼š</p><ul><li>è¿‡æ»¤æ¡ä»¶ï¼šåˆ¤æ–­isAD æ˜¯å¦ä¸ºtrue</li><li>ç®—åˆ†å‡½æ•°ï¼šæˆ‘ä»¬å¯ä»¥ç”¨æœ€ç®€å•æš´åŠ›çš„weightï¼Œå›ºå®šåŠ æƒå€¼</li><li>åŠ æƒæ–¹å¼ï¼šå¯ä»¥ç”¨é»˜è®¤çš„ç›¸ä¹˜ï¼Œå¤§å¤§æé«˜ç®—åˆ†</li></ul><p>å› æ­¤ï¼Œä¸šåŠ¡çš„å®ç°æ­¥éª¤åŒ…æ‹¬ï¼š</p><ol><li><p>ç»™HotelDocç±»æ·»åŠ isADå­—æ®µï¼ŒBooleanç±»å‹</p></li><li><p>æŒ‘é€‰å‡ ä¸ªä½ å–œæ¬¢çš„é…’åº—ï¼Œç»™å®ƒçš„æ–‡æ¡£æ•°æ®æ·»åŠ isADå­—æ®µï¼Œå€¼ä¸ºtrue</p></li><li><p>ä¿®æ”¹searchæ–¹æ³•ï¼Œæ·»åŠ function scoreåŠŸèƒ½ï¼Œç»™isADå€¼ä¸ºtrueçš„é…’åº—å¢åŠ æƒé‡</p></li></ol><h3 id="5-4-2-ä¿®æ”¹HotelDocå®ä½“"><a href="#5-4-2-ä¿®æ”¹HotelDocå®ä½“" class="headerlink" title="5.4.2.ä¿®æ”¹HotelDocå®ä½“"></a>5.4.2.ä¿®æ”¹HotelDocå®ä½“</h3><p>ç»™<code>cn.itcast.hotel.pojo</code>åŒ…ä¸‹çš„HotelDocç±»æ·»åŠ isADå­—æ®µï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722101908062.png" alt="image-20210722101908062"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Boolean isAD;</span><br></pre></td></tr></table></figure><h3 id="5-4-3-æ·»åŠ å¹¿å‘Šæ ‡è®°"><a href="#5-4-3-æ·»åŠ å¹¿å‘Šæ ‡è®°" class="headerlink" title="5.4.3.æ·»åŠ å¹¿å‘Šæ ‡è®°"></a>5.4.3.æ·»åŠ å¹¿å‘Šæ ‡è®°</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‘å‡ ä¸ªé…’åº—ï¼Œæ·»åŠ isADå­—æ®µï¼Œè®¾ç½®ä¸ºtrueï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST /hotel/_update/<span class="number">1902197537</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST /hotel/_update/<span class="number">2056126831</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST /hotel/_update/<span class="number">1989806195</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">POST /hotel/_update/<span class="number">2056105938</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;isAD&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="5-4-4-æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢"><a href="#5-4-4-æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢" class="headerlink" title="5.4.4.æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢"></a>5.4.4.æ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦ä¿®æ”¹æŸ¥è¯¢æ¡ä»¶äº†ã€‚ä¹‹å‰æ˜¯ç”¨çš„boolean æŸ¥è¯¢ï¼Œç°åœ¨è¦æ”¹æˆfunction_socreæŸ¥è¯¢ã€‚</p><p>function_scoreæŸ¥è¯¢ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210721191544750.png" alt="image-20210721191544750|950"></p><p>å¯¹åº”çš„JavaAPIå¦‚ä¸‹ï¼š</p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20210722102850818.png" alt="image-20210722102850818|950"></p><p>æˆ‘ä»¬å¯ä»¥å°†ä¹‹å‰å†™çš„booleanæŸ¥è¯¢ä½œä¸º<strong>åŸå§‹æŸ¥è¯¢</strong>æ¡ä»¶æ”¾åˆ°queryä¸­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ·»åŠ <strong>è¿‡æ»¤æ¡ä»¶</strong>ã€<strong>ç®—åˆ†å‡½æ•°</strong>ã€<strong>åŠ æƒæ¨¡å¼</strong>äº†ã€‚æ‰€ä»¥åŸæ¥çš„ä»£ç ä¾ç„¶å¯ä»¥æ²¿ç”¨ã€‚</p><p>ä¿®æ”¹<code>cn.itcast.hotel.service.impl</code>åŒ…ä¸‹çš„<code>HotelService</code>ç±»ä¸­çš„<code>buildBasicQuery</code>æ–¹æ³•ï¼Œæ·»åŠ ç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildBasicQuery</span><span class="params">(RequestParams params, SearchRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ„å»ºBooleanQuery</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="comment">// å…³é”®å­—æœç´¢</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">        boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŸå¸‚æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getCity() != <span class="literal">null</span> &amp;&amp; !params.getCity().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, params.getCity()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å“ç‰Œæ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getBrand() != <span class="literal">null</span> &amp;&amp; !params.getBrand().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, params.getBrand()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ˜Ÿçº§æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (params.getStarName() != <span class="literal">null</span> &amp;&amp; !params.getStarName().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;starName&quot;</span>, params.getStarName()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">if</span> (params.getMinPrice() != <span class="literal">null</span> &amp;&amp; params.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">        boolQuery.filter(QueryBuilders</span><br><span class="line">                         .rangeQuery(<span class="string">&quot;price&quot;</span>)</span><br><span class="line">                         .gte(params.getMinPrice())</span><br><span class="line">                         .lte(params.getMaxPrice())</span><br><span class="line">                        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ç®—åˆ†æ§åˆ¶</span></span><br><span class="line">    <span class="type">FunctionScoreQueryBuilder</span> <span class="variable">functionScoreQuery</span> <span class="operator">=</span></span><br><span class="line">        QueryBuilders.functionScoreQuery(</span><br><span class="line">        <span class="comment">// åŸå§‹æŸ¥è¯¢ï¼Œç›¸å…³æ€§ç®—åˆ†çš„æŸ¥è¯¢</span></span><br><span class="line">        boolQuery,</span><br><span class="line">        <span class="comment">// function scoreçš„æ•°ç»„</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder[]&#123;</span><br><span class="line">            <span class="comment">// å…¶ä¸­çš„ä¸€ä¸ªfunction score å…ƒç´ </span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(</span><br><span class="line">                <span class="comment">// è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">                QueryBuilders.termQuery(<span class="string">&quot;isAD&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">                <span class="comment">// ç®—åˆ†å‡½æ•°</span></span><br><span class="line">                ScoreFunctionBuilders.weightFactorFunction(<span class="number">10</span>)</span><br><span class="line">            )</span><br><span class="line">        &#125;);</span><br><span class="line">    request.source().query(functionScoreQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251012161053074.png" alt="image-20251012161053074"></p><h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotelService</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;HotelMapper, Hotel&gt; <span class="keyword">implements</span> <span class="title class_">IHotelService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildBasicQuery</span><span class="params">(RequestParams params, SearchRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.æ„å»ºBooleanQuery</span></span><br><span class="line">        <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">        <span class="comment">// 2.å…³é”®å­—æœç´¢</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> params.getKey();</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="literal">null</span> || <span class="string">&quot;&quot;</span>.equals(key)) &#123;</span><br><span class="line">            boolQuery.must(QueryBuilders.matchAllQuery());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            boolQuery.must(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, key));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.åŸå¸‚æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (params.getCity() != <span class="literal">null</span> &amp;&amp; !params.getCity().isEmpty()) &#123;</span><br><span class="line">            boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, params.getCity()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.å“ç‰Œæ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (params.getBrand() != <span class="literal">null</span> &amp;&amp; !params.getBrand().isEmpty()) &#123;</span><br><span class="line">            boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;brand&quot;</span>, params.getBrand()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.æ˜Ÿçº§æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (params.getStarName() != <span class="literal">null</span> &amp;&amp; !params.getStarName().isEmpty()) &#123;</span><br><span class="line">            boolQuery.filter(QueryBuilders.termQuery(<span class="string">&quot;starName&quot;</span>, params.getStarName()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.ä»·æ ¼</span></span><br><span class="line">        <span class="keyword">if</span> (params.getMinPrice() != <span class="literal">null</span> &amp;&amp; params.getMaxPrice() != <span class="literal">null</span>) &#123;</span><br><span class="line">            boolQuery.filter(QueryBuilders</span><br><span class="line">                    .rangeQuery(<span class="string">&quot;price&quot;</span>)</span><br><span class="line">                    .gte(params.getMinPrice())</span><br><span class="line">                    .lte(params.getMaxPrice())</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç®—åˆ†æ§åˆ¶</span></span><br><span class="line">        <span class="type">FunctionScoreQueryBuilder</span> <span class="variable">functionScoreQuery</span> <span class="operator">=</span></span><br><span class="line">                QueryBuilders.functionScoreQuery(boolQuery,</span><br><span class="line">                        <span class="comment">// æ•°ç»„</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder[]&#123;</span><br><span class="line">                                <span class="comment">// æ•°ç»„å¯¹è±¡å…ƒç´ </span></span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(</span><br><span class="line">                                        QueryBuilders.termQuery(<span class="string">&quot;isAD&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">                                        ScoreFunctionBuilders.weightFactorFunction(<span class="number">10</span>)</span><br><span class="line">                                )</span><br><span class="line">                        &#125;);</span><br><span class="line">        <span class="comment">// 7.æ”¾å…¥source</span></span><br><span class="line">        request.source().query(functionScoreQuery);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">search</span><span class="params">(RequestParams params)</span> &#123;</span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸºæœ¬æŸ¥è¯¢</span></span><br><span class="line">        buildBasicQuery(params, request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ†é¡µ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> params.getPage();</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> params.getSize();</span><br><span class="line">        request.source().from((page - <span class="number">1</span>) * size).size(size);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½ç½®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">location</span> <span class="operator">=</span> params.getLocation();</span><br><span class="line">        <span class="keyword">if</span> (location != <span class="literal">null</span> &amp;&amp; !location.isEmpty()) &#123;</span><br><span class="line">            request.source().sort(SortBuilders.</span><br><span class="line">                    geoDistanceSort(<span class="string">&quot;location&quot;</span>, <span class="keyword">new</span> <span class="title class_">GeoPoint</span>(location)).</span><br><span class="line">                    order(SortOrder.ASC).</span><br><span class="line"></span><br><span class="line">                    unit(DistanceUnit.KILOMETERS));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢</span></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">res</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            res = client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> handleResponse(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PageResult <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">        <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">        <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">        <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (searchHits.getTotalHits() != <span class="literal">null</span>) &#123;</span><br><span class="line">            total = searchHits.getTotalHits().value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">        SearchHit[] hits = searchHits.getHits();</span><br><span class="line">        <span class="comment">// 4.3.éå†</span></span><br><span class="line">        ArrayList&lt;HotelDoc&gt; hotels = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">            <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">            <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">            <span class="comment">// è·å–æ’åºå€¼</span></span><br><span class="line">            Object[] sortValues = hit.getSortValues();</span><br><span class="line">            <span class="keyword">if</span> (sortValues.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">sortValue</span> <span class="operator">=</span> sortValues[<span class="number">0</span>];</span><br><span class="line">                hotelDoc.setDistance(sortValue);</span><br><span class="line">            &#125;</span><br><span class="line">            hotels.add(hotelDoc);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>();</span><br><span class="line">        res.setTotal(total);</span><br><span class="line">        res.setHotels(hotels);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é«˜çº§ç¯‡"><a href="#é«˜çº§ç¯‡" class="headerlink" title="é«˜çº§ç¯‡"></a>é«˜çº§ç¯‡</h1><h2 id="æ•°æ®èšåˆ"><a href="#æ•°æ®èšåˆ" class="headerlink" title="æ•°æ®èšåˆ"></a>æ•°æ®èšåˆ</h2><h3 id="èšåˆåˆ†ç±»"><a href="#èšåˆåˆ†ç±»" class="headerlink" title="èšåˆåˆ†ç±»"></a>èšåˆåˆ†ç±»</h3><h4 id="aggregation"><a href="#aggregation" class="headerlink" title="aggregation"></a>aggregation</h4><img src="./assets/image-20251013163231602.png" alt=" " style="zoom:50%;" />### DSLå®ç°èšåˆ#### DSL-bucketè¿˜å¯ç”¨queryé™åˆ¶èšåˆèŒƒå›´<p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251013174547431.png" alt="image-20251013174547431|908x598|850"><br><strong>æ¡ˆä¾‹</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># èšåˆ </span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;brandAgg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;brand&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="metricsèšåˆ"><a href="#metricsèšåˆ" class="headerlink" title="metricsèšåˆ"></a>metricsèšåˆ</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251013180942296.png" alt="image-20251013180942296|1072x601|925"></p><h4 id="RestAPI"><a href="#RestAPI" class="headerlink" title="RestAPI"></a>RestAPI</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251013181733154.png" alt="image-20251013181733154|1171x557|1100"><br><strong>è§£æ</strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251013182652752.png" alt="image-20251013182652752|1166x622|875"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAggregation</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);  </span><br><span class="line">    <span class="comment">// ä¸æŸ¥çœ‹æ–‡æ¡£æ•°æ®  </span></span><br><span class="line">    request.source().size(<span class="number">0</span>);  </span><br><span class="line">    request.source().aggregation(AggregationBuilders  </span><br><span class="line">            .terms(<span class="string">&quot;brandAgg&quot;</span>)  </span><br><span class="line">            .field(<span class="string">&quot;brand&quot;</span>)  </span><br><span class="line">            .size(<span class="number">10</span>));  </span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">res</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);  </span><br><span class="line">    <span class="comment">// è§£æç»“æœ  </span></span><br><span class="line">    System.out.println(res);  </span><br><span class="line">    SolveAgg(res);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">SolveAgg</span><span class="params">(SearchResponse response)</span> &#123;  </span><br><span class="line">    <span class="type">Aggregations</span> <span class="variable">aggregations</span> <span class="operator">=</span> response.getAggregations();  </span><br><span class="line">    <span class="comment">// æ ¹æ®ä¹‹å‰å®šä¹‰çš„åç§°è·å–èšåˆç»“æœ  </span></span><br><span class="line">    <span class="type">Terms</span> <span class="variable">brandTerms</span> <span class="operator">=</span> aggregations.get(<span class="string">&quot;brandAgg&quot;</span>);  </span><br><span class="line">    <span class="comment">// è·å–æ¡¶  </span></span><br><span class="line">    List&lt;? <span class="keyword">extends</span> <span class="title class_">Terms</span>.Bucket&gt; buckets = brandTerms.getBuckets();  </span><br><span class="line">    <span class="keyword">for</span> (Terms.Bucket bucket : buckets) &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">brandName</span> <span class="operator">=</span> bucket.getKeyAsString();  </span><br><span class="line">        System.out.println(brandName);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¤šæ¡ä»¶èšåˆ"><a href="#å¤šæ¡ä»¶èšåˆ" class="headerlink" title="å¤šæ¡ä»¶èšåˆ"></a>å¤šæ¡ä»¶èšåˆ</h4><pre><code> ä½¿ç”¨åœºæ™¯ æ ‡ç­¾åç§°ï¼šæ•°ç»„å€¼</code></pre><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251013183138903.png" alt="image-20251013183138903|950x601"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">filters</span><span class="params">(RequestParams params)</span> <span class="keyword">throws</span> IOException &#123;  </span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);  </span><br><span class="line">    buildBasicQuery(params, request);  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ä¸æŸ¥çœ‹æ–‡æ¡£æ•°æ®  </span></span><br><span class="line">    request.source().size(<span class="number">0</span>);  </span><br><span class="line">    buildAggregation(request);  </span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);  </span><br><span class="line">  </span><br><span class="line">    <span class="type">Aggregations</span> <span class="variable">aggregations</span> <span class="operator">=</span> response.getAggregations();  </span><br><span class="line">    <span class="comment">// æ ¹æ®ä¹‹å‰å®šä¹‰çš„åç§°è·å–èšåˆç»“æœ  </span></span><br><span class="line">    Map&lt;String, List&lt;String&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    List&lt;String&gt; brandList = getAggByName(aggregations, <span class="string">&quot;brandAgg&quot;</span>);  </span><br><span class="line">    res.put(<span class="string">&quot;å“ç‰Œ&quot;</span>, brandList);  </span><br><span class="line">    List&lt;String&gt; cityList = getAggByName(aggregations, <span class="string">&quot;cityAgg&quot;</span>);  </span><br><span class="line">    res.put(<span class="string">&quot;åŸå¸‚&quot;</span>, cityList);  </span><br><span class="line">    List&lt;String&gt; starAgg = getAggByName(aggregations, <span class="string">&quot;starAgg&quot;</span>);  </span><br><span class="line">    res.put(<span class="string">&quot;æ˜Ÿçº§&quot;</span>, starAgg);  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> res;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; <span class="title function_">getAggByName</span><span class="params">(Aggregations aggregations, String aggName)</span> &#123;  </span><br><span class="line">    <span class="type">Terms</span> <span class="variable">brandTerms</span> <span class="operator">=</span> aggregations.get(aggName);  </span><br><span class="line">    List&lt;? <span class="keyword">extends</span> <span class="title class_">Terms</span>.Bucket&gt; buckets = brandTerms.getBuckets();  </span><br><span class="line">    <span class="comment">// è·å–æ¡¶  </span></span><br><span class="line">  </span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">    <span class="keyword">for</span> (Terms.Bucket bucket : buckets) &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> bucket.getKeyAsString();  </span><br><span class="line">        list.add(key);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> list;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">buildAggregation</span><span class="params">(SearchRequest request)</span> &#123;  </span><br><span class="line">    request.source().aggregation(AggregationBuilders  </span><br><span class="line">            .terms(<span class="string">&quot;brandAgg&quot;</span>)  </span><br><span class="line">            .field(<span class="string">&quot;brand&quot;</span>)  </span><br><span class="line">            .size(<span class="number">100</span>));  </span><br><span class="line">    request.source().aggregation(AggregationBuilders  </span><br><span class="line">            .terms(<span class="string">&quot;cityAgg&quot;</span>)  </span><br><span class="line">            .field(<span class="string">&quot;city&quot;</span>)  </span><br><span class="line">            .size(<span class="number">100</span>));  </span><br><span class="line">    request.source().aggregation(AggregationBuilders  </span><br><span class="line">            .terms(<span class="string">&quot;starAgg&quot;</span>)  </span><br><span class="line">            .field(<span class="string">&quot;starName&quot;</span>)  </span><br><span class="line">            .size(<span class="number">100</span>));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è‡ªåŠ¨è¡¥å…¨ï¼ˆé‡ç‚¹ï¼‰"><a href="#è‡ªåŠ¨è¡¥å…¨ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨ï¼ˆé‡ç‚¹ï¼‰"></a>è‡ªåŠ¨è¡¥å…¨ï¼ˆé‡ç‚¹ï¼‰</h2><ul><li>æœç´¢æ¡†æç¤º</li></ul><h3 id="æ‹¼éŸ³åˆ†è¯å™¨"><a href="#æ‹¼éŸ³åˆ†è¯å™¨" class="headerlink" title="æ‹¼éŸ³åˆ†è¯å™¨"></a>æ‹¼éŸ³åˆ†è¯å™¨</h3><blockquote><ul><li>ä¸‹è½½é“¾æ¥ <ul><li><a href="https://release.infinilabs.com/analysis-pinyin/stable/">https://release.infinilabs.com/analysis-pinyin/stable/</a></li><li><a href="https://github.com/medcl/elasticsearch-analysis-pinyin">https://github.com/medcl/elasticsearch-analysis-pinyin</a></li><li>ä½¿ç”¨7.12.1</li></ul></li><li>è§£å‹åˆ°æ–‡ä»¶å¤¹ä¸‹ï¼š<ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020172829173.png" alt="|600"></li></ul></li><li>ä¸€ä¸ªå‘ï¼š<ul><li>es pluginæ–‡ä»¶å¤¹ä¸‹åªèƒ½æœ‰æ–‡ä»¶å¤¹ ä¸èƒ½æœ‰ä»»ä½•æ–‡ä»¶</li><li>ä¸å°å¿ƒå¤åˆ¶äº† <code>.Ds_store</code> éšè—æ–‡ä»¶å¯¼è‡´ä¸èƒ½å¯åŠ¨es</li></ul></li><li>æµ‹è¯•ï¼š</li></ul></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°æ¯•è¶…&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span><span class="string">&quot;pinyin&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨"><a href="#è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨" class="headerlink" title="è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨"></a>è‡ªå®šä¹‰æ‹¼éŸ³åˆ†è¯å™¨</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020173623595.png" alt="|975"></p><h3 id="åˆ†å¼€ä½¿ç”¨åˆ†è¯å™¨"><a href="#åˆ†å¼€ä½¿ç”¨åˆ†è¯å™¨" class="headerlink" title="åˆ†å¼€ä½¿ç”¨åˆ†è¯å™¨"></a>åˆ†å¼€ä½¿ç”¨åˆ†è¯å™¨</h3><ul><li>åœºæ™¯ è¾“å…¥è¯­å¥ <code>æ‰åˆ°ç‹®å­ç¬¼å’‹åŠã€‚ã€‚ã€‚ã€‚</code><ul><li>åˆ†è¯ <code>ç‹®å­</code></li><li>æ­¤æ—¶åº”è¯¥ç”¨ä¸­æ–‡å€’æ’ç´¢å¼•æœç´¢</li><li>è€Œä¸æ˜¯ç”¨ <code>shizi</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020182105700.png"><br><strong>è§£å†³ï¼š</strong><br>ä½¿ç”¨mappingï¼šåŠ å…¥ <code>search_analyzer</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020182220691.png"></li></ul></li></ul><h3 id="DCLå®ç°è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢"><a href="#DCLå®ç°è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢" class="headerlink" title="DCLå®ç°è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢"></a>DCLå®ç°è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020183013507.png"></p><p><strong>è¯­æ³•ï¼š</strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020183937494.png" alt="|450"></p><h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020184016903.png" alt="|850"></p><h2 id="æ•°æ®åŒæ­¥ï¼ˆé‡ç‚¹ï¼‰"><a href="#æ•°æ®åŒæ­¥ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="æ•°æ®åŒæ­¥ï¼ˆé‡ç‚¹ï¼‰"></a>æ•°æ®åŒæ­¥ï¼ˆé‡ç‚¹ï¼‰</h2><h3 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020184916822.png"></p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p><strong>åŒæ­¥è°ƒç”¨</strong>ï¼š<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020185149209.png"><br><strong>å¼‚æ­¥é€šçŸ¥</strong>ï¼š<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020185230306.png"></p><p><strong>ç›‘å¬binlog</strong>ï¼š</p><ul><li>ä½¿ç”¨canalä¸­é—´ä»¶ç›‘å¬ binlog<ul><li>å®Œå…¨è§£é™¤è€¦åˆ</li><li>ä½†æ˜¯mysqlå‹åŠ›å¤§<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020185256200.png"></li></ul></li></ul><h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020190023488.png" alt="|400"></p><h3 id="é›†ç¾¤ç»“æ„"><a href="#é›†ç¾¤ç»“æ„" class="headerlink" title="é›†ç¾¤ç»“æ„"></a>é›†ç¾¤ç»“æ„</h3><ul><li>ä¸»åˆ†ç‰‡shard å’Œ å¤åˆ¶åˆ†ç‰‡ä¸èƒ½å†ä¸€ä¸ªèŠ‚ç‚¹nodeä¸Š<ul><li>é˜²æ­¢æœºå™¨æŒ‚æ‰<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020190355066.png"></li></ul></li></ul><h3 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h3><ul><li><a href="https://blog.csdn.net/Monster_song/article/details/148666194?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522aa4a0c50fa370400f46a0c228903402e%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=aa4a0c50fa370400f46a0c228903402e&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-148666194-null-null.142%5Ev102%5Epc_search_result_base8&utm_term=%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98%E5%AE%89%E8%A3%85es%E9%9B%86%E7%BE%A4&spm=1018.2226.3001.4187">https://blog.csdn.net/Monster_song/article/details/148666194?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522aa4a0c50fa370400f46a0c228903402e%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=aa4a0c50fa370400f46a0c228903402e&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-148666194-null-null.142^v102^pc_search_result_base8&amp;utm_term=%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98%E5%AE%89%E8%A3%85es%E9%9B%86%E7%BE%A4&amp;spm=1018.2226.3001.4187</a></li><li>ç¼–å†™dockercompose<ul><li>ä¸ºäº†æ–¹ä¾¿ï¼šå®¹å™¨åå’ŒèŠ‚ç‚¹åä¿æŒä¸€è‡´es01</li><li><code>container_name: es01</code>  <code>node.name=es01</code></li><li>é›†ç¾¤åç§°ï¼š<code>cluster.name=es-docker-cluster</code> ä¸€è‡´åˆ™è‡ªåŠ¨é›†ç¾¤</li><li><code>discovery.seed_hosts</code> å¦å¤–ä¸¤ä¸ªé›†ç¾¤</li><li><code>cluster.initial_master_nodes</code> å€™é€‰ä¸»èŠ‚ç‚¹</li><li><code>data01</code> æ•°æ®å·</li><li><code>port</code> 9200 9201 9202 æœ¬æœºç«¯å£ï¼Œéƒ½æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨9200</li></ul></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2.2&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">es01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.12.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es01</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data01:/Users/cyt/huanjing/dockerData/es/es-data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9201</span><span class="string">:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line">  <span class="attr">es02:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.12.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es02</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es01,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data02:/Users/cyt/huanjing/dockerData/es/es-data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9202</span><span class="string">:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line">  <span class="attr">es03:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.12.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es03</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es01,es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data03:/Users/cyt/huanjing/dockerData/es/es-data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9203</span><span class="string">:9200</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">data01:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data02:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data03:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">elastic:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>esè¿è¡Œéœ€è¦ä¿®æ”¹ä¸€äº›linuxç³»ç»Ÿæƒé™ï¼Œä¿®æ”¹<code>/etc/sysctl.conf</code>æ–‡ä»¶</p><ul><li>&#96;vi &#x2F;etc&#x2F;sysctl.conf</li></ul></li><li><p>æ·»åŠ ä¸‹é¢çš„å†…å®¹</p><ul><li>&#96;vm.max_map_count&#x3D;262144</li></ul></li><li><p>ç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œè®©é…ç½®ç”Ÿæ•ˆï¼š</p><ul><li>&#96;sysctl -p</li></ul></li><li><p>é€šè¿‡docker-composeå¯åŠ¨é›†ç¾¤ï¼š</p><ul><li>&#96;docker-compose up -d</li></ul></li><li><p>æ—¥å¿—ï¼š <code>docker logs -f es01</code></p></li><li><p>ç»“æœï¼š<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020191927994.png"></p></li><li><p>desktopï¼š<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251020192018519.png"></p></li></ul><h3 id="é›†ç¾¤èŒè´£åŠè„‘è£‚"><a href="#é›†ç¾¤èŒè´£åŠè„‘è£‚" class="headerlink" title="é›†ç¾¤èŒè´£åŠè„‘è£‚"></a>é›†ç¾¤èŒè´£åŠè„‘è£‚</h3><p><strong>èŠ‚ç‚¹è§’è‰²</strong></p><ul><li>é»˜è®¤æƒ…å†µä¸‹èŠ‚ç‚¹åŒæ—¶å…·æœ‰å¦‚ä¸‹å››ç§èŒè´£<ul><li>æœ€å¥½æ¯ä¸ªèŠ‚ç‚¹èŒè´£æ‹†åˆ†<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021161826649.png"><br><strong>æ¶æ„ä¸¾ä¾‹</strong>ï¼š<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021162023367.png"></li></ul></li></ul><p><strong>è„‘è£‚</strong>ï¼š</p><ul><li>å‡ ä¸ªé›†ç¾¤æœ‰ä¸¤ä¸ª <code>ä¸»èŠ‚ç‚¹</code></li><li>ç½‘ç»œæ•…éšœ<ul><li>æ¢å¤ç½‘ç»œåæ•°æ®ä¸ä¸€è‡´</li><li>7.0ä¹‹åé»˜è®¤è§£å†³<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021162358647.png"></li></ul></li></ul><h3 id="åˆ†å¸ƒå¼æ–°å¢å’ŒæŸ¥è¯¢æµç¨‹"><a href="#åˆ†å¸ƒå¼æ–°å¢å’ŒæŸ¥è¯¢æµç¨‹" class="headerlink" title="åˆ†å¸ƒå¼æ–°å¢å’ŒæŸ¥è¯¢æµç¨‹"></a>åˆ†å¸ƒå¼æ–°å¢å’ŒæŸ¥è¯¢æµç¨‹</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021162900970.png"></p><p><strong>æ–°å¢</strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021163333684.png"><br><strong>æŸ¥è¯¢</strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021163505744.png"></p><h2 id="æ•…éšœè½¬ç§»"><a href="#æ•…éšœè½¬ç§»" class="headerlink" title="æ•…éšœè½¬ç§»"></a>æ•…éšœè½¬ç§»</h2><ul><li>masterå®•æœºåï¼ŒEligibleMasteré€‰ä¸¾ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li><li>masterèŠ‚ç‚¹ç›‘æ§åˆ†ç‰‡ã€èŠ‚ç‚¹çŠ¶æ€ï¼Œå°†æ•…éšœèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡è½¬ç§»<br>åˆ°æ­£å¸¸èŠ‚ç‚¹ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚<br> <img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251021163954286.png"></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
            <tag> ElasticSearch </tag>
            
            <tag> es </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°åœŸå †pytorchæ•™ç¨‹</title>
      <link href="//post/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/3%E5%B0%8F%E5%9C%9F%E5%A0%86pytorch.html"/>
      <url>//post/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/3%E5%B0%8F%E5%9C%9F%E5%A0%86pytorch.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>è§†é¢‘åœ°å€ï¼š<a href="https://www.bilibili.com/video/BV1hE411t7RN">https://www.bilibili.com/video/BV1hE411t7RN</a></p></blockquote><h1 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h1><blockquote><ul><li><code>Dataset</code> è·å–æ•°æ®å¹¶ç¼–å·</li><li><code>Dataloader</code> å¯¹æ•°æ®æ‰“åŒ…<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016132400209.png" alt="|875"></li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset, DataLoader  </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms  </span><br><span class="line"><span class="keyword">from</span> torchvision.utils <span class="keyword">import</span> make_grid  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDataset</span>(<span class="title class_ inherited__">Dataset</span>):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, root_dir,  label_dir</span>):  </span><br><span class="line">        self.root_dir = root_dir  </span><br><span class="line">        self.label_dir = label_dir  </span><br><span class="line">        self.path = os.path.join(self.root_dir, self.label_dir)  </span><br><span class="line">        self.img_path = os.listdir(self.path)  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>):  </span><br><span class="line">        img_name = self.img_path[idx]  </span><br><span class="line">        img_item_path = os.path.join(self.root_dir, self.label_dir, img_name)  </span><br><span class="line">        img = Image.<span class="built_in">open</span>(img_item_path)  </span><br><span class="line">        label = self.label_dir  </span><br><span class="line">        <span class="comment"># img.show()  </span></span><br><span class="line">        <span class="keyword">return</span> img, label  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.img_path)  </span><br><span class="line">  </span><br><span class="line">root_dir = <span class="string">&quot;../dataset/train&quot;</span>  </span><br><span class="line">ants_label_dir = <span class="string">&quot;ants&quot;</span>  </span><br><span class="line">ants_dataset = MyDataset(root_dir, ants_label_dir)  </span><br><span class="line"><span class="built_in">print</span>(ants_dataset.__getitem__(<span class="number">1</span>))</span><br></pre></td></tr></table></figure><h1 id="Tensorboard"><a href="#Tensorboard" class="headerlink" title="Tensorboard"></a>Tensorboard</h1><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016140752930.png"></p><blockquote><ul><li>æ‰“å¼€log<ul><li><code>tensorboard --logdir=logs --port=</code></li><li>logs: æ–‡ä»¶å¤¹å</li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016143704056.png"></li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016143716474.png" alt="|625"></li></ul></li></ul></blockquote><h1 id="Transform"><a href="#Transform" class="headerlink" title="Transform"></a>Transform</h1><blockquote><ul><li>ä½œç”¨ï¼š<ul><li>pythonçš„ç”¨æ³• -&gt; tensoræ•°æ®ç±»å‹</li><li><code>å°±æ˜¯ç¥ç»ç½‘ç»œä¸“ç”¨çš„æ•°æ®ç±»å‹ï¼ŒåŒ…å«äº†è®¸å¤šç¥ç»ç½‘ç»œéœ€è¦çš„å‚æ•°</code></li><li><code>&quot;&quot;&quot;Convert a PIL Image or ndarray to tensor and scale the values accordingly.</code></li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016150804219.png" alt="|700"></li></ul></li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image  </span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter  </span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms  </span><br><span class="line">  </span><br><span class="line">img_path= <span class="string">&quot;../data/train/ants_image/0013035.jpg&quot;</span>  </span><br><span class="line">img  = Image.<span class="built_in">open</span>(img_path)  </span><br><span class="line"><span class="built_in">print</span>(img)  </span><br><span class="line">tensor_trans = transforms.ToTensor()  </span><br><span class="line">tensor_img = tensor_trans(img)  </span><br><span class="line"><span class="built_in">print</span>(tensor_img)  </span><br><span class="line">  </span><br><span class="line">writer = SummaryWriter(log_dir=<span class="string">&#x27;./logs&#x27;</span>)  </span><br><span class="line"><span class="comment"># ä½¿ç”¨tensoræ•°æ®ç±»å‹</span></span><br><span class="line">writer.add_image(<span class="string">&quot;Tensor_img&quot;</span>, tensor_img)  </span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§çš„Transform"><a href="#å¸¸è§çš„Transform" class="headerlink" title="å¸¸è§çš„Transform"></a>å¸¸è§çš„Transform</h2><p> <img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016151804553.png" alt="|500"><br> <strong>Normalize</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image  </span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms  </span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter  </span><br><span class="line">  </span><br><span class="line">writer = SummaryWriter(log_dir=<span class="string">&#x27;./logs&#x27;</span>)  </span><br><span class="line">img_path = <span class="string">&quot;../data/train/ants_image/0013035.jpg&quot;</span>  </span><br><span class="line">img = Image.<span class="built_in">open</span>(img_path)  </span><br><span class="line">  </span><br><span class="line">trans_tensor = transforms.ToTensor()  </span><br><span class="line">img_tensor = trans_tensor(img)  </span><br><span class="line">writer.add_image(<span class="string">&quot;ToTenser&quot;</span>, img_tensor)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Normalizeå½’ä¸€åŒ–  </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å½’ä¸€åŒ–ä¹‹å‰ï¼š&quot;</span>, img_tensor[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]) <span class="comment"># 0.3137  </span></span><br><span class="line">trans_norm = transforms.Normalize([<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>], [<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>])  </span><br><span class="line">img_norm = trans_norm(img_tensor)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å½’ä¸€åŒ–ä¹‹åï¼š&quot;</span>, img_norm[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]) <span class="comment"># 2 * 0.3137 - 1  </span></span><br><span class="line">writer.add_image(<span class="string">&quot;Normalize&quot;</span>, img_norm)  </span><br><span class="line">  </span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure><p><strong>Resize</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Resize  </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Resize&quot;</span> * <span class="number">10</span>)  </span><br><span class="line"><span class="built_in">print</span>(img.size)  </span><br><span class="line">trans_resize = transforms.Resize((<span class="number">512</span>, <span class="number">512</span>))  </span><br><span class="line"><span class="comment"># img PIL ----&gt; resize ---&gt; img_resize PIL  </span></span><br><span class="line">img_resize = trans_resize(img)  </span><br><span class="line"><span class="comment"># img PIL ----&gt; tensor ---&gt; img_resize PIL  </span></span><br><span class="line">img_resize = trans_tensor(img_resize)  </span><br><span class="line">writer.add_image(<span class="string">&quot;Resize&quot;</span>, img_resize)  </span><br><span class="line"><span class="built_in">print</span>(img_resize)</span><br></pre></td></tr></table></figure><p><strong>Compose</strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016155114157.png" alt="|550"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Compose  </span></span><br><span class="line">trans_resize_2 = transforms.Resize(<span class="number">512</span>)  </span><br><span class="line">trans_compose = transforms.Compose([trans_resize_2  </span><br><span class="line">img_resize_2 = trans_compose(img)  </span><br><span class="line">writer.add_image(<span class="string">&quot;Compose&quot;</span>, img_resize_2)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#  </span></span><br><span class="line">trans_random = transforms.RandomCrop((<span class="number">256</span>, <span class="number">128</span>))  </span><br><span class="line">trans_compose_2 = transforms.Compose([trans_random  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):  </span><br><span class="line">    img_crop = trans_compose_2(img)  </span><br><span class="line">    writer.add_image(<span class="string">&quot;RandomCrop&quot;</span>, img_crop, i)</span><br></pre></td></tr></table></figure><h1 id="torchvisionä¸­çš„æ•°æ®é›†ä½¿ç”¨"><a href="#torchvisionä¸­çš„æ•°æ®é›†ä½¿ç”¨" class="headerlink" title="torchvisionä¸­çš„æ•°æ®é›†ä½¿ç”¨"></a>torchvisionä¸­çš„æ•°æ®é›†ä½¿ç”¨</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter  </span><br><span class="line">  </span><br><span class="line">dataset_transform = torchvision.transforms.Compose([  </span><br><span class="line">    torchvision.transforms.ToTensor()  </span><br><span class="line">])  </span><br><span class="line">  </span><br><span class="line">train_set = torchvision.datasets.CIFAR10(root=<span class="string">&#x27;./dataset&#x27;</span>,  </span><br><span class="line">                                         train=<span class="literal">True</span>,  </span><br><span class="line">                                         transform=dataset_transform,  </span><br><span class="line">                                         download=<span class="literal">True</span>)  </span><br><span class="line">test_set = torchvision.datasets.CIFAR10(root=<span class="string">&#x27;./dataset&#x27;</span>,  </span><br><span class="line">                                        train=<span class="literal">False</span>,  </span><br><span class="line">                                        transform=dataset_transform,  </span><br><span class="line">                                        download=<span class="literal">True</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(test_set[<span class="number">0</span>])  </span><br><span class="line"><span class="built_in">print</span>((test_set.classes))  <span class="comment"># [&#x27;airplane&#x27;, &#x27;automobile&#x27;, &#x27;bird&#x27;, &#x27;cat&#x27;, &#x27;deer&#x27;, &#x27;dog&#x27;, &#x27;frog&#x27;, &#x27;horse&#x27;, &#x27;ship&#x27;, &#x27;truck&#x27;]  </span></span><br><span class="line">  </span><br><span class="line">img, target = test_set[<span class="number">0</span>]  </span><br><span class="line"><span class="built_in">print</span>(img)  </span><br><span class="line"><span class="built_in">print</span>(target)  <span class="comment"># 3  </span></span><br><span class="line"><span class="built_in">print</span>(test_set.classes[target])  <span class="comment"># cat  </span></span><br><span class="line">img.show()  </span><br><span class="line">  </span><br><span class="line">writer = SummaryWriter(<span class="string">&quot;4_dataset_transform&quot;</span>)  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):  </span><br><span class="line">    img, target = test_set[i]  </span><br><span class="line">    writer.add_image(<span class="string">&quot;test_set&quot;</span>, img, i)  </span><br><span class="line">  </span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure><h1 id="DataLoader"><a href="#DataLoader" class="headerlink" title="DataLoader"></a>DataLoader</h1><blockquote><ul><li><code>batch_size</code> æ‰“åŒ…æˆç»„<ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016164734233.png" alt="|625"></li></ul></li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader  </span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æµ‹è¯•æ•°æ®é›†  </span></span><br><span class="line">test_data = torchvision.datasets.CIFAR10(root=<span class="string">&#x27;./dataset&#x27;</span>, train=<span class="literal">False</span>, download=<span class="literal">True</span>,  </span><br><span class="line">                                         transform=torchvision.transforms.ToTensor())  </span><br><span class="line">  </span><br><span class="line">test_loader = DataLoader(dataset=test_data, batch_size=<span class="number">4</span>, shuffle=<span class="literal">True</span>, num_workers=<span class="number">0</span>, drop_last=<span class="literal">False</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æµ‹è¯•æ•°æ®é›†ä¸­ç¬¬ä¸€å¼ å›¾ç‰‡åŠtarget  </span></span><br><span class="line">img, target = test_data[<span class="number">0</span>] <span class="comment"># torch.Size([3, 32, 32]) 3é€šé“  </span></span><br><span class="line"><span class="built_in">print</span>(img.shape)  </span><br><span class="line"><span class="built_in">print</span>(target)  </span><br><span class="line">  </span><br><span class="line">writer = SummaryWriter(<span class="string">&quot;dataloader&quot;</span>)  </span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):  </span><br><span class="line">    step = <span class="number">0</span>  </span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> test_loader:  </span><br><span class="line">        imgs, targets = data  </span><br><span class="line">        <span class="built_in">print</span>(imgs.shape)  </span><br><span class="line">        <span class="built_in">print</span>(targets)  </span><br><span class="line">        writer.add_images(<span class="string">&quot;Epoch: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(epoch), imgs, step)  </span><br><span class="line">        step = step + <span class="number">1</span>  </span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure><p><em>board</em>:<br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016165343033.png" alt="|266"></p><h1 id="ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶ï¼ˆnn-Moduleï¼‰"><a href="#ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶ï¼ˆnn-Moduleï¼‰" class="headerlink" title="ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶ï¼ˆnn.Moduleï¼‰"></a>ç¥ç»ç½‘ç»œåŸºæœ¬éª¨æ¶ï¼ˆnn.Moduleï¼‰</h1><h2 id="nn-model"><a href="#nn-model" class="headerlink" title="nn.model"></a>nn.model</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.printing.pytorch <span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyNet</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(MyNet, self).__init__()  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, <span class="built_in">input</span></span>):  </span><br><span class="line">        output = <span class="built_in">input</span> + <span class="number">1</span>  </span><br><span class="line">        <span class="keyword">return</span> output  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">my_net = MyNet()  </span><br><span class="line">x = torch.tensor([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])  </span><br><span class="line">output = my_net(x)  </span><br><span class="line"><span class="built_in">print</span>(output)</span><br></pre></td></tr></table></figure><h2 id="nn-cov"><a href="#nn-cov" class="headerlink" title="nn.cov"></a>nn.cov</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251016180032904.png"></p><h2 id="å·ç§¯å±‚"><a href="#å·ç§¯å±‚" class="headerlink" title="å·ç§¯å±‚"></a>å·ç§¯å±‚</h2><ul><li>ä¸­æ–‡æ–‡æ¡£<ul><li><a href="https://docs.pytorch.ac.cn/docs/stable/generated/torch.nn.Conv2d.html">https://docs.pytorch.ac.cn/docs/stable/generated/torch.nn.Conv2d.html</a></li></ul></li><li><h2 id="å®˜æ–¹æ–‡æ¡£-https-docs-pytorch-org-docs-2-8-generated-torch-nn-Conv2d-html"><a href="#å®˜æ–¹æ–‡æ¡£-https-docs-pytorch-org-docs-2-8-generated-torch-nn-Conv2d-html" class="headerlink" title="å®˜æ–¹æ–‡æ¡£  - https://docs.pytorch.org/docs/2.8/generated/torch.nn.Conv2d.html"></a>å®˜æ–¹æ–‡æ¡£<br>  - <a href="https://docs.pytorch.org/docs/2.8/generated/torch.nn.Conv2d.html">https://docs.pytorch.org/docs/2.8/generated/torch.nn.Conv2d.html</a></h2></li><li><strong>in_channels</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>) â€“ è¾“å…¥å›¾åƒä¸­çš„é€šé“æ•°</li><li><strong>out_channels</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>) â€“ å·ç§¯äº§ç”Ÿçš„é€šé“æ•°</li><li><strong>kernel_size</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>Â <em>æˆ–</em>Â <a href="https://docs.pythonlang.cn/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a>) â€“ å·ç§¯æ ¸çš„å¤§å°</li><li><strong>stride</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>Â <em>æˆ–</em>Â <a href="https://docs.pythonlang.cn/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a><em>,</em>Â <em>å¯é€‰</em>) â€“ å·ç§¯çš„æ­¥é•¿ã€‚é»˜è®¤å€¼ï¼š1</li><li><strong>padding</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>,</em>Â <a href="https://docs.pythonlang.cn/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a>Â <em>æˆ–</em>Â <a href="https://docs.pythonlang.cn/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>,</em>Â <em>å¯é€‰</em>) â€“ æ·»åŠ åˆ°è¾“å…¥æ‰€æœ‰å››è¾¹çš„å¡«å……ã€‚é»˜è®¤å€¼ï¼š0</li><li><strong>dilation</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>Â <em>æˆ–</em>Â <a href="https://docs.pythonlang.cn/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a><em>,</em>Â <em>å¯é€‰</em>) â€“ æ ¸å…ƒç´ ä¹‹é—´çš„é—´è·ã€‚é»˜è®¤å€¼ï¼š1</li><li><strong>groups</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>,</em>Â <em>å¯é€‰</em>) â€“ ä»è¾“å…¥é€šé“åˆ°è¾“å‡ºé€šé“çš„é˜»å¡è¿æ¥æ•°ã€‚é»˜è®¤å€¼ï¼š1</li><li><strong>bias</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em>,</em>Â <em>å¯é€‰</em>) â€“ å¦‚æœä¸ºÂ <code>True</code>ï¼Œåˆ™åœ¨è¾“å‡ºä¸­æ·»åŠ å¯å­¦ä¹ çš„åå·®ã€‚é»˜è®¤å€¼ï¼š<code>True</code></li><li><strong>padding_mode</strong>Â (<a href="https://docs.pythonlang.cn/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>,</em>Â <em>å¯é€‰</em>) â€“Â <code>&#39;zeros&#39;</code>,Â <code>&#39;reflect&#39;</code>,Â <code>&#39;replicate&#39;</code>Â æˆ–Â <code>&#39;circular&#39;</code>ã€‚é»˜è®¤å€¼ï¼š<code>&#39;zeros&#39;</code><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017111439077.png"></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader  </span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Conv2d  </span><br><span class="line">  </span><br><span class="line">dataset = torchvision.datasets.CIFAR10(<span class="string">&quot;../dataset&quot;</span>, train=<span class="literal">False</span>, transform=torchvision.transforms.ToTensor(),  </span><br><span class="line">                                       download=<span class="literal">True</span>)  </span><br><span class="line">dataloader = DataLoader(dataset, batch_size=<span class="number">64</span>)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">testConv2d</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(testConv2d, self).__init__()  </span><br><span class="line">        <span class="comment"># å½©è‰²å›¾ 3é€šé“ è¾“å‡º6é€šé“ æ ¸3x3  </span></span><br><span class="line">        self.conv1 = nn.Conv2d(in_channels=<span class="number">3</span>, out_channels=<span class="number">6</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):  </span><br><span class="line">        x = self.conv1(x)  </span><br><span class="line">        <span class="keyword">return</span> x  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">testConv = testConv2d()  </span><br><span class="line"><span class="built_in">print</span>(testConv)  </span><br><span class="line"><span class="comment"># testConv2d(  </span></span><br><span class="line"><span class="comment">#   (conv1): Conv2d(3, 6, kernel_size=(3, 3), stride=(1, 1))  </span></span><br><span class="line"><span class="comment"># )  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:  </span><br><span class="line">    imgs, targets = data  </span><br><span class="line">    output = testConv(imgs)  </span><br><span class="line">    <span class="built_in">print</span>(imgs.shape)   <span class="comment"># torch.Size([64, 3, 32, 32])  </span></span><br><span class="line">    <span class="built_in">print</span>(output.shape) <span class="comment"># torch.Size([64, 6, 30, 30]) batch_size=64</span></span><br></pre></td></tr></table></figure><h2 id="æ± åŒ–å±‚"><a href="#æ± åŒ–å±‚" class="headerlink" title="æ± åŒ–å±‚"></a>æ± åŒ–å±‚</h2><ul><li><a href="https://docs.pytorch.ac.cn/docs/stable/nn.html#pooling-layers">https://docs.pytorch.ac.cn/docs/stable/nn.html#pooling-layers</a></li><li><code>MaxPool2d</code> å¸¸ç”¨<ul><li><ul><li><strong>kernel_size</strong> â€“ è¿›è¡Œæœ€å¤§å€¼è®¡ç®—çš„çª—å£å¤§å°</li></ul></li></ul><ul><li><strong>stride</strong>Â  â€“ çª—å£çš„æ­¥å¹…ã€‚é»˜è®¤å€¼ä¸ºÂ <code>kernel_size</code></li><li><strong>padding</strong>â€“ åœ¨ä¸¤ä¾§æ·»åŠ çš„éšå¼è´Ÿæ— ç©·å¤§å¡«å……</li><li><strong>dilation</strong>Â â€“ æ§åˆ¶çª—å£ä¸­å…ƒç´ æ­¥å¹…çš„å‚æ•°</li><li><strong>return_indices</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>) â€“ å¦‚æœä¸ºÂ <code>True</code>ï¼Œå°†è¿”å›æœ€å¤§å€¼çš„ç´¢å¼•ä»¥åŠè¾“å‡ºã€‚å¯¹åç»­çš„Â <a href="https://docs.pytorch.ac.cn/docs/stable/generated/torch.nn.MaxUnpool2d.html#torch.nn.MaxUnpool2d" title="torch.nn.MaxUnpool2d"><code>torch.nn.MaxUnpool2d</code></a>Â æœ‰ç”¨</li><li><strong>ceil_mode</strong>Â (<a href="https://docs.pythonlang.cn/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>) â€“ å¦‚æœä¸º Trueï¼Œå°†ä½¿ç”¨Â ceilÂ è€Œä¸æ˜¯Â floorÂ æ¥è®¡ç®—è¾“å‡ºå½¢çŠ¶</li></ul><ul><li><code>dilation</code> æ§åˆ¶å…ƒç´ é—´éš”  ç©ºæ´å·ç§¯</li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017111824518.png" alt="|475"></li><li><strong>ceil_mode</strong></li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017112339964.png" alt="|600"></li><li>ä½¿ç”¨<ul><li><code>self.maxpool1 = MaxPool2d(kernel_size=3, ceil_mode=False)</code></li></ul></li></ul></li></ul><h2 id="éçº¿æ€§æ¿€æ´»"><a href="#éçº¿æ€§æ¿€æ´»" class="headerlink" title="éçº¿æ€§æ¿€æ´»"></a>éçº¿æ€§æ¿€æ´»</h2><ul><li>&#96;self.relu1 &#x3D; ReLU()  </li><li><code>self.sigmoid1 = Sigmoid()</code></li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017113446668.png" alt="|300"></li></ul><h2 id="çº¿æ€§å±‚å’Œå…¶ä»–å±‚"><a href="#çº¿æ€§å±‚å’Œå…¶ä»–å±‚" class="headerlink" title="çº¿æ€§å±‚å’Œå…¶ä»–å±‚"></a>çº¿æ€§å±‚å’Œå…¶ä»–å±‚</h2><h3 id="æ­£åˆ™åŒ–ï¼ˆå½’ä¸€åŒ–ï¼‰"><a href="#æ­£åˆ™åŒ–ï¼ˆå½’ä¸€åŒ–ï¼‰" class="headerlink" title="æ­£åˆ™åŒ–ï¼ˆå½’ä¸€åŒ–ï¼‰"></a>æ­£åˆ™åŒ–ï¼ˆå½’ä¸€åŒ–ï¼‰</h3><ul><li><a href="https://docs.pytorch.ac.cn/docs/stable/generated/torch.nn.BatchNorm2d.html#torch.nn.BatchNorm2d">https://docs.pytorch.ac.cn/docs/stable/generated/torch.nn.BatchNorm2d.html#torch.nn.BatchNorm2d</a></li></ul><h3 id="çº¿æ€§å±‚ï¼ˆå…¨è¿æ¥å±‚ï¼‰"><a href="#çº¿æ€§å±‚ï¼ˆå…¨è¿æ¥å±‚ï¼‰" class="headerlink" title="çº¿æ€§å±‚ï¼ˆå…¨è¿æ¥å±‚ï¼‰"></a>çº¿æ€§å±‚ï¼ˆå…¨è¿æ¥å±‚ï¼‰</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017114500330.png" alt="|575"></p><ul><li>å°†[64, 3, 32, 32] å›¾ç‰‡å¹³å±•</li><li><code>å¾—åˆ°196608x1</code></li><li>çº¿æ€§å±‚å¾—åˆ° <code>10x1</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Linear  </span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader  </span><br><span class="line">  </span><br><span class="line">dataset = torchvision.datasets.CIFAR10(<span class="string">&quot;../dataset&quot;</span>, train=<span class="literal">False</span>, transform=torchvision.transforms.ToTensor(),  </span><br><span class="line">                                       download=<span class="literal">True</span>)  </span><br><span class="line">  </span><br><span class="line">dataloader = DataLoader(dataset, batch_size=<span class="number">64</span>, drop_last=<span class="literal">True</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tudui</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(Tudui, self).__init__()  </span><br><span class="line">        self.linear1 = Linear(<span class="number">196608</span>, <span class="number">10</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, <span class="built_in">input</span></span>):  </span><br><span class="line">        output = self.linear1(<span class="built_in">input</span>)  </span><br><span class="line">        <span class="keyword">return</span> output  </span><br><span class="line">  </span><br><span class="line">tudui = Tudui()  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:  </span><br><span class="line">    imgs, targets = data  </span><br><span class="line">    <span class="built_in">print</span>(imgs.shape) <span class="comment"># torch.Size([64, 3, 32, 32])  </span></span><br><span class="line">    output = torch.flatten(imgs)  </span><br><span class="line">    <span class="built_in">print</span>(output.shape) <span class="comment"># torch.Size([196608]) 64*3*32*32=196608  </span></span><br><span class="line">    output = tudui(output)  </span><br><span class="line">    <span class="built_in">print</span>(output.shape) <span class="comment"># torch.Size([10])</span></span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017114355688.png"><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017114333266.png"></p><h2 id="æ­å»ºå®æˆ˜å’Œsequential"><a href="#æ­å»ºå®æˆ˜å’Œsequential" class="headerlink" title="æ­å»ºå®æˆ˜å’Œsequential"></a>æ­å»ºå®æˆ˜å’Œsequential</h2><ul><li>ç®€åŒ–ä»£ç <br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017122112945.png" alt="|750"></li></ul><h3 id="æ¨¡å‹å›¾"><a href="#æ¨¡å‹å›¾" class="headerlink" title="æ¨¡å‹å›¾"></a>æ¨¡å‹å›¾</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017122444229.png"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="comment"># ä½œè€…ï¼šå°åœŸå †  </span></span><br><span class="line"><span class="comment"># å…¬ä¼—å·ï¼šåœŸå †ç¢å¿µ  </span></span><br><span class="line"><span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Conv2d, MaxPool2d, Flatten, Linear, Sequential  </span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tudui</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(Tudui, self).__init__()  </span><br><span class="line">        self.model1 = Sequential(  </span><br><span class="line">            Conv2d(<span class="number">3</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Flatten(),  </span><br><span class="line">            Linear(<span class="number">1024</span>, <span class="number">64</span>),  </span><br><span class="line">            Linear(<span class="number">64</span>, <span class="number">10</span>)  </span><br><span class="line">        )  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):  </span><br><span class="line">        x = self.model1(x)  </span><br><span class="line">        <span class="keyword">return</span> x  </span><br><span class="line">  </span><br><span class="line">tudui = Tudui()  </span><br><span class="line"><span class="built_in">print</span>(tudui)  </span><br><span class="line"><span class="built_in">input</span> = torch.ones((<span class="number">64</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>))   <span class="comment"># batch é€šé“ w h</span></span><br><span class="line">output = tudui(<span class="built_in">input</span>)  </span><br><span class="line"><span class="built_in">print</span>(output.shape)  </span><br><span class="line">  </span><br><span class="line">writer = SummaryWriter(<span class="string">&quot;../logs_seq&quot;</span>)  </span><br><span class="line">writer.add_graph(tudui, <span class="built_in">input</span>)  </span><br><span class="line">writer.close()</span><br></pre></td></tr></table></figure><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017123252534.png"><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017123410172.png"></p><h1 id="æŸå¤±å‡½æ•°å’Œåå‘ä¼ æ’­"><a href="#æŸå¤±å‡½æ•°å’Œåå‘ä¼ æ’­" class="headerlink" title="æŸå¤±å‡½æ•°å’Œåå‘ä¼ æ’­"></a>æŸå¤±å‡½æ•°å’Œåå‘ä¼ æ’­</h1><h2 id="äº¤å‰å•†"><a href="#äº¤å‰å•†" class="headerlink" title="äº¤å‰å•†"></a>äº¤å‰å•†</h2><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017135511647.png" alt="|675"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="comment"># ä½œè€…ï¼šå°åœŸå †  </span></span><br><span class="line"><span class="comment"># å…¬ä¼—å·ï¼šåœŸå †ç¢å¿µ  </span></span><br><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Sequential, Conv2d, MaxPool2d, Flatten, Linear  </span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader  </span><br><span class="line">  </span><br><span class="line">dataset = torchvision.datasets.CIFAR10(<span class="string">&quot;../dataset&quot;</span>, train=<span class="literal">False</span>, transform=torchvision.transforms.ToTensor(),  </span><br><span class="line">                                       download=<span class="literal">True</span>)  </span><br><span class="line">  </span><br><span class="line">dataloader = DataLoader(dataset, batch_size=<span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tudui</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(Tudui, self).__init__()  </span><br><span class="line">        self.model1 = Sequential(  </span><br><span class="line">            Conv2d(<span class="number">3</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Flatten(),  </span><br><span class="line">            Linear(<span class="number">1024</span>, <span class="number">64</span>),  </span><br><span class="line">            Linear(<span class="number">64</span>, <span class="number">10</span>)  </span><br><span class="line">        )  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):  </span><br><span class="line">        x = self.model1(x)  </span><br><span class="line">        <span class="keyword">return</span> x  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">loss = nn.CrossEntropyLoss()  </span><br><span class="line">tudui = Tudui()  </span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:  </span><br><span class="line">    imgs, targets = data  </span><br><span class="line">    outputs = tudui(imgs)  </span><br><span class="line">    result_loss = loss(outputs, targets)  </span><br><span class="line">    result_loss.backward()  </span><br><span class="line">    <span class="built_in">print</span>(result_loss.item())  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ok&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="ä¼˜åŒ–å™¨"><a href="#ä¼˜åŒ–å™¨" class="headerlink" title="ä¼˜åŒ–å™¨"></a>ä¼˜åŒ–å™¨</h1><ul><li><a href="https://docs.pytorch.ac.cn/docs/stable/optim.html#google_vignette">https://docs.pytorch.ac.cn/docs/stable/optim.html#google_vignette</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="comment"># ä½œè€…ï¼šå°åœŸå †  </span></span><br><span class="line"><span class="comment"># å…¬ä¼—å·ï¼šåœŸå †ç¢å¿µ  </span></span><br><span class="line"><span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Sequential, Conv2d, MaxPool2d, Flatten, Linear  </span><br><span class="line"><span class="keyword">from</span> torch.optim.lr_scheduler <span class="keyword">import</span> StepLR  </span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader  </span><br><span class="line">  </span><br><span class="line">dataset = torchvision.datasets.CIFAR10(<span class="string">&quot;../dataset&quot;</span>, train=<span class="literal">False</span>, transform=torchvision.transforms.ToTensor(),  </span><br><span class="line">                                       download=<span class="literal">True</span>)  </span><br><span class="line">  </span><br><span class="line">dataloader = DataLoader(dataset, batch_size=<span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tudui</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(Tudui, self).__init__()  </span><br><span class="line">        self.model1 = Sequential(  </span><br><span class="line">            Conv2d(<span class="number">3</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Flatten(),  </span><br><span class="line">            Linear(<span class="number">1024</span>, <span class="number">64</span>),  </span><br><span class="line">            Linear(<span class="number">64</span>, <span class="number">10</span>)  </span><br><span class="line">        )  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):  </span><br><span class="line">        x = self.model1(x)  </span><br><span class="line">        <span class="keyword">return</span> x  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">loss = nn.CrossEntropyLoss()  </span><br><span class="line">tudui = Tudui()  </span><br><span class="line"><span class="comment"># æ¨¡å‹å‚æ•° lrï¼šå­¦ä¹ ç‡  </span></span><br><span class="line">optim = torch.optim.SGD(tudui.parameters(), lr=<span class="number">0.01</span>) <span class="comment"># éšæœºæ¢¯åº¦ä¸‹é™  </span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>): <span class="comment"># 20è½®  </span></span><br><span class="line">    running_loss = <span class="number">0.0</span>  </span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> dataloader:  </span><br><span class="line">        imgs, targets = data <span class="comment"># æ•°æ®x çœŸå®å€¼y  </span></span><br><span class="line">        outputs = tudui(imgs) <span class="comment"># é¢„æµ‹è¾“å‡º  </span></span><br><span class="line">        result_loss = loss(outputs, targets)  </span><br><span class="line">        optim.zero_grad() <span class="comment"># æ¢¯åº¦æ¸…é›¶ å¿…å†™  </span></span><br><span class="line">        result_loss.backward() <span class="comment"># åå‘ä¼ æ’­  </span></span><br><span class="line">        optim.step() <span class="comment"># å¯¹æ¯ä¸ªå‚æ•°è°ƒä¼˜  </span></span><br><span class="line">        running_loss = running_loss + result_loss  </span><br><span class="line">    <span class="built_in">print</span>(running_loss)</span><br></pre></td></tr></table></figure><p><strong>debugæŸ¥çœ‹æ¢¯åº¦</strong><br><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017143139180.png"></p><h1 id="ç°æœ‰æ¨¡å‹ä½¿ç”¨å’Œä¿®æ”¹"><a href="#ç°æœ‰æ¨¡å‹ä½¿ç”¨å’Œä¿®æ”¹" class="headerlink" title="ç°æœ‰æ¨¡å‹ä½¿ç”¨å’Œä¿®æ”¹"></a>ç°æœ‰æ¨¡å‹ä½¿ç”¨å’Œä¿®æ”¹</h1><ul><li><a href="https://docs.pytorch.org/vision/0.9/models.html">https://docs.pytorch.org/vision/0.9/models.html</a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="comment"># ä½œè€…ï¼šå°åœŸå †  </span></span><br><span class="line"><span class="comment"># å…¬ä¼—å·ï¼šåœŸå †ç¢å¿µ  </span></span><br><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line">  </span><br><span class="line">train_data = torchvision.datasets.ImageNet(<span class="string">&quot;../data_image_net&quot;</span>, split=<span class="string">&#x27;train&#x27;</span>, download=<span class="literal">True</span>,  </span><br><span class="line">                                           transform=torchvision.transforms.ToTensor())  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line">  </span><br><span class="line">vgg16_false = torchvision.models.vgg16(pretrained=<span class="literal">False</span>)  </span><br><span class="line">vgg16_true = torchvision.models.vgg16(pretrained=<span class="literal">True</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(vgg16_true)  </span><br><span class="line">  </span><br><span class="line">train_data = torchvision.datasets.CIFAR10(<span class="string">&#x27;./dataset&#x27;</span>, train=<span class="literal">True</span>, transform=torchvision.transforms.ToTensor(),  </span><br><span class="line">                                          download=<span class="literal">True</span>)  </span><br><span class="line">  </span><br><span class="line">vgg16_true.classifier.add_module(<span class="string">&#x27;add_linear&#x27;</span>, nn.Linear(<span class="number">1000</span>, <span class="number">10</span>))  </span><br><span class="line"><span class="built_in">print</span>(vgg16_true)  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(vgg16_false)  </span><br><span class="line">vgg16_false.classifier[<span class="number">6</span>] = nn.Linear(<span class="number">4096</span>, <span class="number">10</span>)  </span><br><span class="line"><span class="built_in">print</span>(vgg16_false)</span><br></pre></td></tr></table></figure><h1 id="æ¨¡å‹ä¿å­˜å’ŒåŠ è½½"><a href="#æ¨¡å‹ä¿å­˜å’ŒåŠ è½½" class="headerlink" title="æ¨¡å‹ä¿å­˜å’ŒåŠ è½½"></a>æ¨¡å‹ä¿å­˜å’ŒåŠ è½½</h1><h2 id="ä¿å­˜"><a href="#ä¿å­˜" class="headerlink" title="ä¿å­˜"></a>ä¿å­˜</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="comment"># ä½œè€…ï¼šå°åœŸå †  </span></span><br><span class="line"><span class="comment"># å…¬ä¼—å·ï¼šåœŸå †ç¢å¿µ  </span></span><br><span class="line"><span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line">  </span><br><span class="line">vgg16 = torchvision.models.vgg16(pretrained=<span class="literal">False</span>)  </span><br><span class="line"><span class="comment"># ä¿å­˜æ–¹å¼1,æ¨¡å‹ç»“æ„+æ¨¡å‹å‚æ•°  </span></span><br><span class="line">torch.save(vgg16, <span class="string">&quot;vgg16_method1.pth&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># ä¿å­˜æ–¹å¼2ï¼Œæ¨¡å‹å‚æ•°ï¼ˆå®˜æ–¹æ¨èï¼‰  </span></span><br><span class="line">torch.save(vgg16.state_dict(), <span class="string">&quot;vgg16_method2.pth&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># é™·é˜±  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tudui</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(Tudui, self).__init__()  </span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">3</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):  </span><br><span class="line">        x = self.conv1(x)  </span><br><span class="line">        <span class="keyword">return</span> x  </span><br><span class="line">  </span><br><span class="line">tudui = Tudui()  </span><br><span class="line">torch.save(tudui, <span class="string">&quot;tudui_method1.pth&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"><span class="comment"># ä½œè€…ï¼šå°åœŸå †  </span></span><br><span class="line"><span class="comment"># å…¬ä¼—å·ï¼šåœŸå †ç¢å¿µ  </span></span><br><span class="line"><span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">from</span> model_save <span class="keyword">import</span> *   <span class="comment"># å¼•å…¥æ¨¡å‹</span></span><br><span class="line"><span class="comment"># æ–¹å¼1-ã€‹ä¿å­˜æ–¹å¼1ï¼ŒåŠ è½½æ¨¡å‹  </span></span><br><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line">  </span><br><span class="line">model = torch.load(<span class="string">&quot;vgg16_method1.pth&quot;</span>)  </span><br><span class="line"><span class="comment"># print(model)  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼ŒåŠ è½½æ¨¡å‹  </span></span><br><span class="line">vgg16 = torchvision.models.vgg16(pretrained=<span class="literal">False</span>)  </span><br><span class="line">vgg16.load_state_dict(torch.load(<span class="string">&quot;vgg16_method2.pth&quot;</span>))  </span><br><span class="line"><span class="comment"># model = torch.load(&quot;vgg16_method2.pth&quot;)  </span></span><br><span class="line"><span class="comment"># print(vgg16)  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># é™·é˜±1  å¿…é¡»è¦æŠŠæ¨¡å‹ç±»å‹æ”¾åœ¨è¯¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tudui</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(Tudui, self).__init__()  </span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">3</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):  </span><br><span class="line">        x = self.conv1(x)  </span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">  </span><br><span class="line">model = torch.load(<span class="string">&#x27;tudui_method1.pth&#x27;</span>)  </span><br><span class="line"><span class="built_in">print</span>(model)</span><br></pre></td></tr></table></figure><h1 id="æ¨¡å‹è®­ç»ƒå¥—è·¯"><a href="#æ¨¡å‹è®­ç»ƒå¥—è·¯" class="headerlink" title="æ¨¡å‹è®­ç»ƒå¥—è·¯"></a>æ¨¡å‹è®­ç»ƒå¥—è·¯</h1><ul><li>ä»¥ <code>CIFAR10</code>è®­ç»ƒé›†ä¸ºä¾‹</li></ul><h2 id="ç»“æœè½¬æ¢"><a href="#ç»“æœè½¬æ¢" class="headerlink" title="ç»“æœè½¬æ¢"></a>ç»“æœè½¬æ¢</h2><ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251017164927329.png" alt="|500"></li><li><code>outputs</code> æ¯è¡Œè¡¨ç¤ºè¯¥ç»„æ•°æ®è¾“å‡ºæ¯ä¸ªåˆ†ç±»çš„æ¦‚ç‡</li><li><code>argmax</code> è¯¥ç»„æ•°æ®æœ€å¤§çš„é‚£ä¸ªæ¦‚ç‡<code>ä¸‹æ ‡</code> ï¼ˆä½œä¸ºé¢„æµ‹ç»“æœï¼‰<ul><li>å‚æ•°1 æ¨ªå‘çœ‹</li><li>å‚æ•°0 çºµå‘çœ‹</li><li>å¾—åˆ° <code>preds</code> é¢„æµ‹ç»“æ„</li></ul></li><li><code>target</code> çœŸå®ç»“æœ</li><li><code>preds å’Œ target å¯¹æ¯”</code> <ul><li>ä¸€æ ·åˆ™sum + 1</li><li>å¦åˆ™sum + 0</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">import</span> torchvision  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader  </span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> MyModel  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ•°æ®é›†  </span></span><br><span class="line">train_data = torchvision.datasets.CIFAR10(root=<span class="string">&quot;./dataset&quot;</span>,  </span><br><span class="line">                                          train=<span class="literal">True</span>,  </span><br><span class="line">                                          transform=torchvision.transforms.ToTensor(),  </span><br><span class="line">                                          download=<span class="literal">False</span>)  </span><br><span class="line">  </span><br><span class="line">test_data = torchvision.datasets.CIFAR10(root=<span class="string">&quot;./dataset&quot;</span>,  </span><br><span class="line">                                         train=<span class="literal">False</span>,  </span><br><span class="line">                                         transform=torchvision.transforms.ToTensor(),  </span><br><span class="line">                                         download=<span class="literal">False</span>)  </span><br><span class="line">  </span><br><span class="line">train_data_size = <span class="built_in">len</span>(train_data)  </span><br><span class="line">test_data_size = <span class="built_in">len</span>(test_data)  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è®­ç»ƒæ•°æ®é›†çš„é•¿åº¦ä¸ºï¼š&#123;&#125;&quot;</span>.<span class="built_in">format</span>(train_data_size))  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æµ‹è¯•æ•°æ®é›†çš„é•¿åº¦ä¸ºï¼š&#123;&#125;&quot;</span>.<span class="built_in">format</span>(test_data_size))  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># åˆ©ç”¨dataloaderåŠ è½½æ•°æ®é›†  </span></span><br><span class="line">train_dataloader = DataLoader(train_data, batch_size=<span class="number">64</span>)  </span><br><span class="line">test_dataloader = DataLoader(test_data, batch_size=<span class="number">64</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ­å»ºç¥ç»ç½‘ç»œ  </span></span><br><span class="line">mymodel = MyModel()  </span><br><span class="line"><span class="built_in">print</span>(mymodel)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æŸå¤±å‡½æ•°  </span></span><br><span class="line">loss_fn = nn.CrossEntropyLoss()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># ä¼˜åŒ–å™¨  </span></span><br><span class="line">learning_rate = <span class="number">1e-2</span> <span class="comment"># 0.01  </span></span><br><span class="line">optimizer = torch.optim.SGD(mymodel.parameters(), lr=learning_rate, momentum=<span class="number">0.9</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># è®¾ç½®è®­ç»ƒç½‘ç»œçš„ä¸€äº›å‚æ•°  </span></span><br><span class="line"><span class="comment"># è®­ç»ƒæ¬¡æ•°  </span></span><br><span class="line">total_train_step = <span class="number">0</span>  </span><br><span class="line"><span class="comment"># æµ‹è¯•æ¬¡æ•°  </span></span><br><span class="line">total_test_step = <span class="number">0</span>  </span><br><span class="line"><span class="comment"># è®­ç»ƒè½®æ¬¡  </span></span><br><span class="line">epoch = <span class="number">5</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ·»åŠ tensorboard  </span></span><br><span class="line">writer = SummaryWriter(log_dir=<span class="string">&#x27;../mymodel_logs&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(epoch):  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----ç¬¬ &#123;&#125;è½® è®­ç»ƒå¼€å§‹-------&quot;</span>.<span class="built_in">format</span>(i))  </span><br><span class="line">    <span class="comment"># è®­ç»ƒå¼€å§‹  </span></span><br><span class="line">    mymodel.train() <span class="comment"># å¼€å¯è®­ç»ƒæ¨¡å¼ å¯ä»¥ä¸å†™  </span></span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> train_dataloader:  </span><br><span class="line">        imgs, targets = data  </span><br><span class="line">        outputs = mymodel(imgs)  </span><br><span class="line">        loss = loss_fn(outputs, targets)  </span><br><span class="line">  </span><br><span class="line">        optimizer.zero_grad() <span class="comment"># æ¢¯åº¦æ¸…é›¶  </span></span><br><span class="line">        loss.backward() <span class="comment"># åå‘ä¼ æ’­  </span></span><br><span class="line">        optimizer.step() <span class="comment"># ä¼˜åŒ–å™¨  </span></span><br><span class="line">        total_train_step += <span class="number">1</span>  </span><br><span class="line">        <span class="keyword">if</span> total_train_step % <span class="number">100</span> == <span class="number">0</span>: <span class="comment"># é˜²æ­¢ä¿¡æ¯è¿‡å¤š  </span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;è®­ç»ƒæ¬¡æ•°ï¼š&#123;&#125;ï¼ŒæŸå¤±lossï¼š&#123;&#125;&quot;</span>.<span class="built_in">format</span>(total_train_step, loss.item()))  </span><br><span class="line">            writer.add_scalar(<span class="string">&#x27;train_loss&#x27;</span>, loss.item(), total_train_step) <span class="comment"># è®°å½•è®­ç»ƒæŸå¤±  </span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># æµ‹è¯•æ­¥éª¤å¼€å§‹  </span></span><br><span class="line">    mymodel.<span class="built_in">eval</span>() <span class="comment"># å¼€å¯æµ‹è¯•æ¨¡å¼ å¯ä»¥ä¸å†™  </span></span><br><span class="line">    total_test_loss = <span class="number">0</span> <span class="comment"># æµ‹è¯•é›†çš„æŸå¤±  </span></span><br><span class="line">    total_accuracy = <span class="number">0</span> <span class="comment"># æ­£ç¡®ç»¿  </span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad(): <span class="comment"># å…³é—­æ¢¯åº¦è®¡ç®—  </span></span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> test_dataloader:  </span><br><span class="line">            imgs, targets = data  </span><br><span class="line">            outputs = mymodel(imgs)  </span><br><span class="line">            loss = loss_fn(outputs, targets)  </span><br><span class="line">            <span class="comment"># print(&quot;æµ‹è¯•æ¬¡æ•°ï¼š&#123;&#125;ï¼ŒæŸå¤±lossï¼š&#123;&#125;&quot;.format(total_test_step, loss.item()))  </span></span><br><span class="line">            total_test_loss += loss.item()  </span><br><span class="line">            accuracy = (outputs.argmax(<span class="number">1</span>) == targets).<span class="built_in">sum</span>()  </span><br><span class="line">            total_accuracy += accuracy  </span><br><span class="line">  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ•´ä½“æµ‹è¯•é›†çš„æŸå¤±lossï¼š&#123;&#125;&quot;</span>.<span class="built_in">format</span>(total_test_loss))  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ•´ä½“æµ‹è¯•é›†ä¸Šçš„æ­£ç¡®ç‡: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(total_accuracy/test_data_size))  </span><br><span class="line">    writer.add_scalar(<span class="string">&#x27;test_loss&#x27;</span>, total_test_loss, total_test_step) <span class="comment"># è®°å½•æµ‹è¯•æŸå¤±  </span></span><br><span class="line">    writer.add_scalar(<span class="string">&quot;test_accuracy&quot;</span>, total_accuracy/test_data_size, total_test_step) <span class="comment"># æµ‹è¯•æ­£ç¡®ç‡  </span></span><br><span class="line">    total_test_step += <span class="number">1</span>  </span><br><span class="line">  </span><br><span class="line">    torch.save(mymodel, <span class="string">&quot;mymodel_&#123;&#125;.pth&quot;</span>.<span class="built_in">format</span>(i)) <span class="comment"># ä¿å­˜æ¨¡å‹å‚æ•°  </span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ¨¡å‹å‚æ•°ä¿å­˜æˆåŠŸï¼&quot;</span>)  </span><br><span class="line">  </span><br><span class="line">writer.close() <span class="comment"># å…³é—­tensorboard</span></span><br></pre></td></tr></table></figure><h1 id="æ¨¡å‹éªŒè¯ï¼ˆæµ‹è¯•ï¼‰"><a href="#æ¨¡å‹éªŒè¯ï¼ˆæµ‹è¯•ï¼‰" class="headerlink" title="æ¨¡å‹éªŒè¯ï¼ˆæµ‹è¯•ï¼‰"></a>æ¨¡å‹éªŒè¯ï¼ˆæµ‹è¯•ï¼‰</h1><ul><li>ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹</li><li>ç»™ä»–æä¾›è¾“å…¥</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision.transforms  </span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image  </span><br><span class="line"><span class="keyword">from</span> sympy.printing.pytorch <span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn  </span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Sequential, Conv2d, MaxPool2d, Flatten, Linear  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">image_path = <span class="string">&quot;../imgs/dog.png&quot;</span>  </span><br><span class="line">image = Image.<span class="built_in">open</span>(image_path)  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span>(image)  </span><br><span class="line"><span class="comment"># &lt;PIL.PngImagePlugin.PngImageFile image mode=RGB size=456x336 at 0x10314CFD0&gt;  </span></span><br><span class="line">  </span><br><span class="line">image = image.convert(<span class="string">&#x27;RGB&#x27;</span>)  <span class="comment"># pngæ˜¯å››é€šé“  </span></span><br><span class="line">transform = torchvision.transforms.Compose([  </span><br><span class="line">    torchvision.transforms.Resize((<span class="number">32</span>, <span class="number">32</span>)),  </span><br><span class="line">    torchvision.transforms.ToTensor(),  </span><br><span class="line">])  </span><br><span class="line">  </span><br><span class="line">image = transform(image)  </span><br><span class="line"><span class="built_in">print</span>(image.shape) <span class="comment"># torch.Size([3, 32, 32])  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyModel</span>(nn.Module):  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):  </span><br><span class="line">        <span class="built_in">super</span>(MyModel, self).__init__()  </span><br><span class="line">        self.model1 = Sequential(  </span><br><span class="line">            Conv2d(<span class="number">3</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),  </span><br><span class="line">            MaxPool2d(<span class="number">2</span>),  </span><br><span class="line">            Flatten(),  </span><br><span class="line">            Linear(<span class="number">1024</span>, <span class="number">64</span>),  </span><br><span class="line">            Linear(<span class="number">64</span>, <span class="number">10</span>)  </span><br><span class="line">        )  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):  </span><br><span class="line">        x = self.model1(x)  </span><br><span class="line">        <span class="keyword">return</span> x  </span><br><span class="line">  </span><br><span class="line">model = MyModel()  </span><br><span class="line">model.load_state_dict(torch.load(<span class="string">&#x27;../model_mps/mymodel_9.pth&#x27;</span>))  </span><br><span class="line"><span class="built_in">print</span>(model)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># ç»è¿‡ unsqueeze(0) æ“ä½œåï¼Œimage çš„å½¢çŠ¶å˜ä¸º 1x3x32x32ã€‚  </span></span><br><span class="line"><span class="comment"># è¿™ä¸ªæ–°å¢çš„ç»´åº¦ä»£è¡¨æ‰¹æ¬¡å¤§å°ï¼ˆbatch sizeï¼‰ï¼Œ  </span></span><br><span class="line"><span class="comment"># åœ¨è¿™é‡Œè¡¨ç¤ºæœ‰ä¸€ä¸ªåŒ…å«å•å¼ å›¾åƒçš„æ‰¹æ¬¡ã€‚  </span></span><br><span class="line"><span class="comment"># image = image.unsqueeze(0)  </span></span><br><span class="line">image = torch.reshape(image, (<span class="number">1</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>))  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;torch.reshape&quot;</span>, image.shape)  </span><br><span class="line"><span class="keyword">with</span> torch.no_grad():  </span><br><span class="line">    output = model(image)  </span><br><span class="line"><span class="built_in">print</span>(output)  </span><br><span class="line"><span class="comment"># tensor([[-0.0300,  0.1362,  0.1201, -0.1339,  0.0189, -0.0951,  0.0431,  0.0677, -0.0523,  0.1262]])  </span></span><br><span class="line"><span class="built_in">print</span>(output.argmax(<span class="number">1</span>)) <span class="comment"># ç»“æœï¼š tensor([5]) å±äºç¬¬5ä¸ªç±»åˆ«  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># CIFAR-10 ç±»åˆ«æ ‡ç­¾  </span></span><br><span class="line">classes = (<span class="string">&#x27;plane&#x27;</span>, <span class="string">&#x27;car&#x27;</span>, <span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;deer&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;frog&#x27;</span>, <span class="string">&#x27;horse&#x27;</span>, <span class="string">&#x27;ship&#x27;</span>, <span class="string">&#x27;truck&#x27;</span>)  </span><br><span class="line">predicted_class = classes[output.argmax(<span class="number">1</span>).item()]  </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;é¢„æµ‹ç»“æœ: <span class="subst">&#123;predicted_class&#125;</span>&quot;</span>) <span class="comment"># é¢„æµ‹ç»“æœ: dog</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rocketMQç¬”è®°</title>
      <link href="//post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMQ%E7%AC%94%E8%AE%B0.html"/>
      <url>//post/java%E5%AD%A6%E4%B9%A0/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMQ%E7%AC%94%E8%AE%B0.html</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li>æ•™å­¦åœ°å€ï¼šbç«™<ul><li><a href="https://www.bilibili.com/video/BV1AU4y157LX">https://www.bilibili.com/video/BV1AU4y157LX</a></li></ul></li><li>æœ¬åœ°ä½¿ç”¨mq<ul><li><code>cd /Users/cyt/huanjing/java/middle/rocketmq-all-4.8.0-bin-release</code></li><li><code>sh start.sh</code>  å¼€å¯mq</li><li><code>sh close.sh</code> å…³é—­mq</li><li><code>cd ../web</code> </li><li><code>java -jar rocketmq-console-ng-2.0.0.jar</code> å¼€å¯mqæ§åˆ¶å°</li></ul></li><li>åç»­ä½¿ç”¨dockeræ­å»ºmq</li></ul></blockquote><h1 id="åŸºæœ¬çŸ¥è¯†"><a href="#åŸºæœ¬çŸ¥è¯†" class="headerlink" title="åŸºæœ¬çŸ¥è¯†"></a>åŸºæœ¬çŸ¥è¯†</h1><h2 id="MQä»‹ç»"><a href="#MQä»‹ç»" class="headerlink" title="MQä»‹ç»"></a>MQä»‹ç»</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929162722815.png" alt=" " style="zoom:50%;" /><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929165657863.png" alt=" " style="zoom:33%;" /><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929170014361.png" alt=" " style="zoom:50%;" /><h2 id="ä¼˜åŠ¿å’ŒåŠ£åŠ¿"><a href="#ä¼˜åŠ¿å’ŒåŠ£åŠ¿" class="headerlink" title="ä¼˜åŠ¿å’ŒåŠ£åŠ¿"></a>ä¼˜åŠ¿å’ŒåŠ£åŠ¿</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929162828669.png" alt=" " style="zoom:50%;" /><h2 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h2><h3 id="åº”ç”¨è§£è€¦"><a href="#åº”ç”¨è§£è€¦" class="headerlink" title="åº”ç”¨è§£è€¦"></a>åº”ç”¨è§£è€¦</h3><blockquote><ul><li><code>æé«˜ç³»ç»Ÿå®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§</code></li><li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°MQ</li><li>mqå¯ä»¥å¤åˆ¶å¤šä»½åˆ°å…¶ä»–ç³»ç»Ÿ</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929163814688.png" alt=" " style="zoom:50%;" /><h3 id="å¼‚æ­¥æé€Ÿ"><a href="#å¼‚æ­¥æé€Ÿ" class="headerlink" title="å¼‚æ­¥æé€Ÿ"></a>å¼‚æ­¥æé€Ÿ</h3><blockquote><ul><li><p><code>æå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡</code></p></li><li><p>ä»ä¸‹å•åˆ°ç»“æœåªéœ€è¦100ms</p><ul><li><p>å…ˆå‘ç»™mq</p></li><li><p>å­˜å…¥mysql</p></li><li><p>åé¢çš„200msä¸ç”¨ç®¡</p></li></ul></li></ul></blockquote>  <img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929164238705.png" alt=" " style="zoom:50%;" /><h3 id="å‰Šå³°å¡«è°·"><a href="#å‰Šå³°å¡«è°·" class="headerlink" title="å‰Šå³°å¡«è°·"></a>å‰Šå³°å¡«è°·</h3><blockquote><ol><li><code>æé«˜ç³»ç»Ÿç¨³å®šæ€§</code></li><li>æŠŠmqå½“åšç¼“å­˜</li><li>10wä¸ªè¯·æ±‚ï¼Œä»mqé‡Œé¢å–æ•°æ®ï¼Œæ”¾å…¥mysql</li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929164559659.png" alt=" " style="zoom:50%;" /><h4 id="ç¤ºæ„å›¾"><a href="#ç¤ºæ„å›¾" class="headerlink" title="ç¤ºæ„å›¾"></a>ç¤ºæ„å›¾</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929164830897.png" alt=" " style="zoom:50%;" /><h2 id="åŠ£åŠ¿"><a href="#åŠ£åŠ¿" class="headerlink" title="åŠ£åŠ¿"></a>åŠ£åŠ¿</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929165326298.png" alt=" " style="zoom:50%;" /><h2 id="å·¥ä½œåŸç†ï¼ˆé‡ç‚¹ï¼‰"><a href="#å·¥ä½œåŸç†ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="å·¥ä½œåŸç†ï¼ˆé‡ç‚¹ï¼‰"></a>å·¥ä½œåŸç†ï¼ˆé‡ç‚¹ï¼‰</h2><blockquote><ul><li>ç”Ÿäº§è€… æ¶ˆè´¹è€… æœåŠ¡å™¨ä¸‰å¤§é›†ç¾¤éƒ½è¦å» <code>å‘½åæœåŠ¡å™¨</code> æ³¨å†Œè‡ªå·±çš„ipä¿¡æ¯</li><li>æ¶ˆè´¹è€…å¯¹æœåŠ¡å™¨é›†ç¾¤è·å–æ¶ˆæ¯æœ‰ä¸¤ç§æ–¹å¼<ul><li><code>ä¸»åŠ¨æ‹‰å»æ¶ˆæ¯</code></li><li><code>ç”¨ç›‘å¬å™¨</code></li></ul></li><li>ä¸ºäº†åˆ¤æ–­ä¸‰å¤§é›†ç¾¤æ˜¯å¦æŒ‚æ‰<ul><li>ä¸‰å¤§é›†ç¾¤è®¾ç½®å¿ƒè·³</li></ul></li><li>æ¶ˆæ¯ä¿¡æ¯<ul><li>ä¸€çº§ <code>ä¸»é¢˜Topic</code></li><li>äºŒçº§åˆ†ç±»ï¼š<code>æ ‡é¢˜tag</code></li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250929171632722.png" alt=" " style="zoom:50%;" /><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><blockquote><ul><li><p><a href="https://blog.csdn.net/qq_46111881/article/details/127110518?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522b3f9dadfe714d8126d35743d4131786e%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=b3f9dadfe714d8126d35743d4131786e&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-127110518-null-null.142%5Ev102%5Epc_search_result_base8&utm_term=mac%20%E5%AE%89%E8%A3%85rocketmq&spm=1018.2226.3001.4187">https://blog.csdn.net/qq_46111881/article/details/127110518?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522b3f9dadfe714d8126d35743d4131786e%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=b3f9dadfe714d8126d35743d4131786e&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-127110518-null-null.142^v102^pc_search_result_base8&amp;utm_term=mac%20%E5%AE%89%E8%A3%85rocketmq&amp;spm=1018.2226.3001.4187</a></p></li><li><pre><code class="language-shell">#è¿™ä¸ªè·¯å¾„æ˜¯ä½ rocketmqè§£å‹åçš„æ–‡ä»¶å¤¹è·¯å¾„export rocketMq_home=/Users/cyt/huanjing/java/middle/rocketmq-all-4.8.0-bin-release#è¿™ä¸ªè·¯å¾„æ˜¯ä½ å®‰è£…çš„jdkç‰ˆæœ¬çš„è·¯å¾„ï¼Œä½ éœ€è¦æŸ¥çœ‹ä½ çš„jdkç‰ˆæœ¬ï¼Œæ”¹å˜export JAVA_HOME=&quot;/Library/Java/JavaVirtualMachines/jdk1.8.0_321.jdk/Contents/Home&quot;  export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Homeexport JAVA_HOME=/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* https://blog.csdn.net/qq_41833935/article/details/125315386?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522b3f9dadfe714d8126d35743d4131786e%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=b3f9dadfe714d8126d35743d4131786e&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-125315386-null-null.142^v102^pc_search_result_base8&amp;utm_term=mac%20%E5%AE%89%E8%A3%85rocketmq&amp;spm=1018.2226.3001.4187</span><br><span class="line"></span><br><span class="line">#  æ¶ˆæ¯å‘é€ï¼ˆé‡ç‚¹ï¼‰</span><br><span class="line"></span><br><span class="line">1. åŸºäºJavaç¯å¢ƒæ„å»ºæ¶ˆæ¯å‘é€ä¸æ¶ˆæ¯æ¥æ”¶åŸºç¡€ç¨‹åº</span><br><span class="line"></span><br><span class="line">   * å•ç”Ÿäº§è€…å•æ¶ˆè´¹è€…</span><br><span class="line"></span><br><span class="line">   * å•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…</span><br><span class="line"></span><br><span class="line">   * å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…</span><br><span class="line"></span><br><span class="line">2. å‘é€ä¸åŒç±»å‹çš„æ¶ˆæ¯</span><br><span class="line">   1. åŒæ­¥æ¶ˆæ¯</span><br><span class="line">   2. å¼‚æ­¥æ¶ˆæ¯</span><br><span class="line">   3. å•å‘æ¶ˆæ¯</span><br><span class="line">3. ç‰¹æ®Šçš„æ¶ˆæ¯å‘é€</span><br><span class="line">   1. å»¶æ—¶æ¶ˆæ¯</span><br><span class="line">   2. æ‰¹é‡æ¶ˆæ¯</span><br><span class="line">4. ç‰¹æ®Šçš„æ¶ˆæ¯æ¥æ”¶</span><br><span class="line">   1.  æ¶ˆæ¯è¿‡æ»¤</span><br><span class="line">5. æ¶ˆæ¯å‘é€ä¸æ¥æ”¶é¡ºåºæ§åˆ¶</span><br><span class="line">6. äº‹åŠ¡æ¶ˆæ¯</span><br><span class="line"></span><br><span class="line">## å•ç”Ÿäº§è€…å•æ¶ˆè´¹è€…æ¶ˆæ¯å‘é€ï¼ˆOneToOneï¼‰</span><br><span class="line"></span><br><span class="line">### ç”Ÿäº§è€…</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">public class Producer &#123;</span><br><span class="line">   public static void main(String[] args) throws Exception &#123;</span><br><span class="line">       // 1.è°æ¥å‘ï¼Ÿ</span><br><span class="line">       DefaultMQProducer producer = new DefaultMQProducer(&quot;group&quot;);</span><br><span class="line">       // 2.å‘ç»™è°</span><br><span class="line">       producer.setNamesrvAddr(&quot;localhost:9876&quot;);</span><br><span class="line">       producer.start();</span><br><span class="line">       // 3.æ€ä¹ˆå‘</span><br><span class="line">       // 4.å‘ä»€ä¹ˆ</span><br><span class="line">       String msg = &quot;hello word!&quot;;</span><br><span class="line">       Message message = new Message(&quot;topic1&quot;, &quot;tag1&quot;, msg.getBytes());</span><br><span class="line">       SendResult sendResult = producer.send(message);</span><br><span class="line">       // 5.å‘çš„ç»“æœæ˜¯ä»€ä¹ˆ</span><br><span class="line">       System.out.println(sendResult);</span><br><span class="line">       // 6.æ‰“æ‰«æˆ˜åœº</span><br><span class="line">       producer.shutdown();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul></blockquote><h3 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1. è°æ¥å‘ï¼Ÿ</span></span><br><span class="line"><span class="comment">         * 2. å‘ç»™è°ï¼Ÿ</span></span><br><span class="line"><span class="comment">         * 3. æ€ä¹ˆå‘ï¼Ÿ</span></span><br><span class="line"><span class="comment">         * 4. å‘ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="comment">         * 5. å‘çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="comment">         * 6. æ‰“æ‰«æˆ˜åœº</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        <span class="comment">//1.åˆ›å»ºä¸€ä¸ªæ¥æ”¶æ¶ˆæ¯çš„å¯¹è±¡Consumer</span></span><br><span class="line">        <span class="type">DefaultMQPushConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQPushConsumer</span>(<span class="string">&quot;group1&quot;</span>);</span><br><span class="line">        <span class="comment">//2.è®¾å®šæ¥æ”¶çš„å‘½åæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">        consumer.setNamesrvAddr(<span class="string">&quot;localhost:9876&quot;</span>);</span><br><span class="line">        <span class="comment">//3.è®¾ç½®æ¥æ”¶æ¶ˆæ¯å¯¹åº”çš„topic,å¯¹åº”çš„subæ ‡ç­¾ä¸ºä»»æ„</span></span><br><span class="line">        consumer.subscribe(<span class="string">&quot;topic1&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//4.å¼€å¯ç›‘å¬ï¼Œç”¨äºæ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        consumer.registerMessageListener(<span class="keyword">new</span> <span class="title class_">MessageListenerConcurrently</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title function_">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> &#123;</span><br><span class="line">                <span class="comment">// å†™ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                <span class="keyword">for</span> (MessageExt msg : msgs) &#123;</span><br><span class="line">                    System.out.println(msg);</span><br><span class="line">                    <span class="type">byte</span>[] body = msg.getBody();</span><br><span class="line">                    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(body));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//5.å¯åŠ¨æ¥æ”¶æ¶ˆæ¯çš„æœåŠ¡</span></span><br><span class="line">        consumer.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¥å—æ¶ˆæ¯æœåŠ¡å·²ç»å¼€å¯ï¼&quot;</span>);</span><br><span class="line">        <span class="comment">//6 ä¸è¦å…³é—­æ¶ˆè´¹è€…ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…æ¶ˆæ¯å‘é€ï¼ˆOneToManyï¼‰"><a href="#å•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…æ¶ˆæ¯å‘é€ï¼ˆOneToManyï¼‰" class="headerlink" title="å•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…æ¶ˆæ¯å‘é€ï¼ˆOneToManyï¼‰"></a>å•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…æ¶ˆæ¯å‘é€ï¼ˆOneToManyï¼‰</h2><h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><ul><li>forå¾ªç¯å‘é€åæ¡æ¶ˆæ¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.è°æ¥å‘ï¼Ÿ</span></span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;group&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‘ç»™è°</span></span><br><span class="line">        producer.setNamesrvAddr(<span class="string">&quot;localhost:9876&quot;</span>);</span><br><span class="line">        producer.start();</span><br><span class="line">        <span class="comment">// 3.æ€ä¹ˆå‘</span></span><br><span class="line">        <span class="comment">// 4.å‘ä»€ä¹ˆ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello word!&quot;</span> + i;</span><br><span class="line">            <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;topic2&quot;</span>, <span class="string">&quot;tag1&quot;</span>, msg.getBytes());</span><br><span class="line">            <span class="type">SendResult</span> <span class="variable">sendResult</span> <span class="operator">=</span> producer.send(message);</span><br><span class="line">            <span class="comment">// 5.å‘çš„ç»“æœæ˜¯ä»€ä¹ˆ</span></span><br><span class="line">            System.out.println(sendResult);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.æ‰“æ‰«æˆ˜åœº</span></span><br><span class="line">        producer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹è€…-è´Ÿè½½å‡è¡¡ï¼ˆ-é»˜è®¤ï¼‰"><a href="#æ¶ˆè´¹è€…-è´Ÿè½½å‡è¡¡ï¼ˆ-é»˜è®¤ï¼‰" class="headerlink" title="æ¶ˆè´¹è€…-è´Ÿè½½å‡è¡¡ï¼ˆ é»˜è®¤ï¼‰"></a>æ¶ˆè´¹è€…-è´Ÿè½½å‡è¡¡ï¼ˆ é»˜è®¤ï¼‰</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930173309893.png" alt=" " style="zoom:50%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºä¸€ä¸ªæ¥æ”¶æ¶ˆæ¯çš„å¯¹è±¡Consumer</span></span><br><span class="line">        <span class="type">DefaultMQPushConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQPushConsumer</span>(<span class="string">&quot;group1&quot;</span>);</span><br><span class="line">        <span class="comment">//2.è®¾å®šæ¥æ”¶çš„å‘½åæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">        consumer.setNamesrvAddr(<span class="string">&quot;localhost:9876&quot;</span>);</span><br><span class="line">        <span class="comment">//3.è®¾ç½®æ¥æ”¶æ¶ˆæ¯å¯¹åº”çš„topic,å¯¹åº”çš„subæ ‡ç­¾ä¸ºä»»æ„</span></span><br><span class="line">        consumer.subscribe(<span class="string">&quot;topic2&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//4.å¼€å¯ç›‘å¬ï¼Œç”¨äºæ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        consumer.registerMessageListener(<span class="keyword">new</span> <span class="title class_">MessageListenerConcurrently</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title function_">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> &#123;</span><br><span class="line">                <span class="comment">// å†™ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                <span class="keyword">for</span> (MessageExt msg : msgs) &#123;</span><br><span class="line">                    System.out.println(msg);</span><br><span class="line">                    <span class="type">byte</span>[] body = msg.getBody();</span><br><span class="line">                    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(body));</span><br><span class="line">                    System.out.println(<span class="string">&quot;================================&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//5.å¯åŠ¨æ¥æ”¶æ¶ˆæ¯çš„æœåŠ¡</span></span><br><span class="line">        consumer.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¥å—æ¶ˆæ¯æœåŠ¡å·²ç»å¼€å¯ï¼&quot;</span>);</span><br><span class="line">        <span class="comment">//6 ä¸è¦å…³é—­æ¶ˆè´¹è€…ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¾‘å¯åŠ¨ç±»"><a href="#ç¼–è¾‘å¯åŠ¨ç±»" class="headerlink" title="ç¼–è¾‘å¯åŠ¨ç±»"></a>ç¼–è¾‘å¯åŠ¨ç±»</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930171120696.png" alt="image-20250930171120696"></p><h4 id="å…è®¸å¤šä¸ªå®ä¾‹"><a href="#å…è®¸å¤šä¸ªå®ä¾‹" class="headerlink" title="å…è®¸å¤šä¸ªå®ä¾‹"></a>å…è®¸å¤šä¸ªå®ä¾‹</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930171319403.png" alt=" " style="zoom:50%;" /><h4 id="è¿è¡Œä¸¤ä¸ªæ¶ˆè´¹è€…ç±»ï¼ˆä¸åŒå®ä¾‹ï¼‰"><a href="#è¿è¡Œä¸¤ä¸ªæ¶ˆè´¹è€…ç±»ï¼ˆä¸åŒå®ä¾‹ï¼‰" class="headerlink" title="è¿è¡Œä¸¤ä¸ªæ¶ˆè´¹è€…ç±»ï¼ˆä¸åŒå®ä¾‹ï¼‰"></a>è¿è¡Œä¸¤ä¸ªæ¶ˆè´¹è€…ç±»ï¼ˆä¸åŒå®ä¾‹ï¼‰</h4><blockquote><ul><li>å‘ç°mqé»˜è®¤ä½¿ç”¨è´Ÿè½½å‡è¡¡<ul><li>ç”Ÿäº§è€…å‘é€10ä¸ªæ¶ˆæ¯</li><li>ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…éšæœºæ¶ˆè´¹104598</li><li>ç¬¬äºŒä¸ªéšæœºæ¶ˆè´¹2367</li></ul></li></ul></blockquote><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930171418561.png" alt="image-20250930171418561"></p><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930171431879.png" alt="image-20250930171431879"></p><h3 id="æ¶ˆè´¹è€…-å¹¿æ’­æ¨¡å¼"><a href="#æ¶ˆè´¹è€…-å¹¿æ’­æ¨¡å¼" class="headerlink" title="æ¶ˆè´¹è€…-å¹¿æ’­æ¨¡å¼"></a>æ¶ˆè´¹è€…-å¹¿æ’­æ¨¡å¼</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930173436258.png" alt=" " style="zoom:50%;" /><blockquote><ol><li>ç”Ÿäº§è€…å‘é€ <code>group1 topic3 tag1</code></li><li>æ¶ˆè´¹è€…<ol><li>1å· <code>group1 topic3 </code></li><li>2å· <code>group2 topic3 </code></li></ol></li><li>æ­¤æ—¶å‘ç°æ¶ˆè´¹è€…éƒ½æ¶ˆè´¹äº†10æ¡æ¶ˆæ¯</li><li>ä½¿ç”¨ <code>consumer.setMessageModel(MessageModel.BROADCASTING);</code> ä¿®æ”¹é…ç½®</li></ol></blockquote><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930172543062.png" alt="image-20250930172543062"></p><h2 id="æ¶ˆæ¯ç±»åˆ«"><a href="#æ¶ˆæ¯ç±»åˆ«" class="headerlink" title="æ¶ˆæ¯ç±»åˆ«"></a>æ¶ˆæ¯ç±»åˆ«</h2><h3 id="åŒæ­¥æ¶ˆæ¯"><a href="#åŒæ­¥æ¶ˆæ¯" class="headerlink" title="åŒæ­¥æ¶ˆæ¯"></a>åŒæ­¥æ¶ˆæ¯</h3> <img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930175452322.png" alt=" " style="zoom:50%;" /><h3 id="å¼‚æ­¥æ¶ˆæ¯"><a href="#å¼‚æ­¥æ¶ˆæ¯" class="headerlink" title="å¼‚æ­¥æ¶ˆæ¯"></a>å¼‚æ­¥æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.è°æ¥å‘ï¼Ÿ</span></span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;group1&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‘ç»™è°</span></span><br><span class="line">        producer.setNamesrvAddr(<span class="string">&quot;localhost:9876&quot;</span>);</span><br><span class="line">        producer.start();</span><br><span class="line">        <span class="comment">// 3.æ€ä¹ˆå‘</span></span><br><span class="line">        <span class="comment">// 4.å‘ä»€ä¹ˆ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello word!&quot;</span> + i;</span><br><span class="line">            <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;topic5&quot;</span>, <span class="string">&quot;tag1&quot;</span>, msg.getBytes());</span><br><span class="line">            producer.send(message, <span class="keyword">new</span> <span class="title class_">SendCallback</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult sendResult)</span> &#123;</span><br><span class="line">                    System.out.println(sendResult);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onException</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">                    <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                    System.out.println(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.ä¸è¦å…³é—­ï¼</span></span><br><span class="line"><span class="comment">//        producer.shutdown();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>å¦‚è®¢å•æ¶ˆæ¯ å¯ä»¥è¿‡ä¸€å°æ—¶æ‰è·å–æ¶ˆæ¯ç»“æœ</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930175541638.png" alt=" " style="zoom:50%;" /><h3 id="å•å‘æ¶ˆæ¯"><a href="#å•å‘æ¶ˆæ¯" class="headerlink" title="å•å‘æ¶ˆæ¯"></a>å•å‘æ¶ˆæ¯</h3><ul><li><code>producer.sendOneway(message);</code></li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930181331115.png" alt=" " style="zoom:50%;" /><h3 id="å»¶æ—¶æ¶ˆæ¯"><a href="#å»¶æ—¶æ¶ˆæ¯" class="headerlink" title="å»¶æ—¶æ¶ˆæ¯"></a>å»¶æ—¶æ¶ˆæ¯</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930182401887.png" alt=" " style="zoom:50%;" /><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930182415566.png" alt=" " style="zoom:44%;" /><h3 id="æ‰¹é‡æ¶ˆæ¯"><a href="#æ‰¹é‡æ¶ˆæ¯" class="headerlink" title="æ‰¹é‡æ¶ˆæ¯"></a>æ‰¹é‡æ¶ˆæ¯</h3><blockquote><p>æ‰¹é‡æ¶ˆæ¯<br>æ³¨æ„ç‚¹ï¼š</p><ol><li><p>è¿™äº›æ‰¹é‡æ¶ˆæ¯åº”è¯¥æœ‰ç›¸åŒçš„topic<br>2ç›¸åŒçš„waitStoreMsgOK<br>3ä¸èƒ½æ˜¯å»¶æ—¶æ¶ˆæ¯<br>4æ¶ˆæ¯å†…å®¹æ€»é•¿åº¦ä¸è¶…è¿‡4M<br>æ¶ˆæ¯å†…å®¹æ€»é•¿åº¦åŒ…å«å¦‚ä¸‹ï¼š</p></li><li><p>topicï¼ˆå­—ç¬¦ä¸²å­—èŠ‚æ•°ï¼‰</p></li><li><p>bodyï¼ˆå­—èŠ‚æ•°ç»„é•¿åº¦ï¼‰</p></li><li><p>æ¶ˆæ¯è¿½åŠ çš„å±æ€§ï¼ˆkeyä¸valueå¯¹åº”å­—ç¬¦ä¸²å­—èŠ‚æ•°ï¼‰</p></li><li><p>æ—¥å¿—ï¼ˆå›ºå®š20å­—èŠ‚ï¼‰</p></li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250930182708566.png" alt=" " style="zoom:50%;" /><h2 id="æ¶ˆæ¯è¿‡æ»¤"><a href="#æ¶ˆæ¯è¿‡æ»¤" class="headerlink" title="æ¶ˆæ¯è¿‡æ»¤"></a>æ¶ˆæ¯è¿‡æ»¤</h2><h3 id="tagè¿‡æ»¤"><a href="#tagè¿‡æ»¤" class="headerlink" title="tagè¿‡æ»¤"></a>tagè¿‡æ»¤</h3><blockquote><ul><li><code>consumer.subscribe(&quot;topic8&quot;, &quot;tag1&quot;);</code> è¿‡æ»¤tag1çš„æ¶ˆæ¯</li><li><code>consumer.subscribe(&quot;topic8&quot;, &quot;tag1 || vip&quot;);</code>  è¿‡æ»¤tag1æˆ–è€…vipçš„</li></ul></blockquote><h3 id="sqlè¿‡æ»¤-å±æ€§è¿‡æ»¤"><a href="#sqlè¿‡æ»¤-å±æ€§è¿‡æ»¤" class="headerlink" title="sqlè¿‡æ»¤ (å±æ€§è¿‡æ»¤)"></a>sqlè¿‡æ»¤ (å±æ€§è¿‡æ»¤)</h3><ol><li><strong>ç”Ÿäº§è€…è®¾ç½®å±æ€§</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">message.putUserProperty(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">message.putUserProperty(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;22&quot;</span>);</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>æ¶ˆè´¹è€…è®¾ç½®è¡¨è¾¾å¼è¿‡æ»¤</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consumer.subscribe(<span class="string">&quot;topic8&quot;</span>, MessageSelector.bySql(<span class="string">&quot;age &gt; 18&quot;</span>));</span><br></pre></td></tr></table></figure><ol start="3"><li>åœ¨ <code>broker.conf</code> æ–‡ä»¶ä¸‹è®¾ç½®  å¼€å¯sqlè¿‡æ»¤</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enablePropertyFilter=true</span><br></pre></td></tr></table></figure><h1 id="SpringBootæ•´åˆ"><a href="#SpringBootæ•´åˆ" class="headerlink" title="SpringBootæ•´åˆ"></a>SpringBootæ•´åˆ</h1><h2 id="1-å¯¼åŒ…"><a href="#1-å¯¼åŒ…" class="headerlink" title="1. å¯¼åŒ…"></a>1. å¯¼åŒ…</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.rocketmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rocketmq-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-é…ç½®æ–‡ä»¶"><a href="#2-é…ç½®æ–‡ä»¶" class="headerlink" title="2 é…ç½®æ–‡ä»¶"></a>2 é…ç½®æ–‡ä»¶</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rocketmq:</span></span><br><span class="line">  <span class="attr">name-server:</span> <span class="string">localhost:9876</span></span><br><span class="line">  <span class="attr">producer:</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">group1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#rocketmq.name-server=localhost:9876</span></span><br><span class="line"><span class="comment">#rocketmq.producer.group=demo_producer</span></span><br></pre></td></tr></table></figure><h2 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    String userName;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;userName=&#x27;&quot;</span> + userName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserName</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String userName, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-ç”Ÿäº§è€…"><a href="#3-ç”Ÿäº§è€…" class="headerlink" title="3 ç”Ÿäº§è€…"></a>3 ç”Ÿäº§è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æœ¬ç±» å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RocketMQTemplate rocketMqTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/send&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">cyt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;cyt&quot;</span>, <span class="number">23</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        rocketMqTemplate.convertAndSend(&quot;topic10&quot;, cyt);</span></span><br><span class="line">        rocketMqTemplate.convertAndSend(<span class="string">&quot;topic10&quot;</span>, msg);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-æ¶ˆè´¹è€…"><a href="#4-æ¶ˆè´¹è€…" class="headerlink" title="4 æ¶ˆè´¹è€…"></a>4 æ¶ˆè´¹è€…</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RocketMQMessageListener(topic = &quot;topic10&quot;, consumerGroup = &quot;group1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">RocketMQListener</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-å…¶ä»–æ¶ˆæ¯"><a href="#5-å…¶ä»–æ¶ˆæ¯" class="headerlink" title="5 å…¶ä»–æ¶ˆæ¯"></a>5 å…¶ä»–æ¶ˆæ¯</h2><h3 id="åŒæ­¥æ¶ˆæ¯-1"><a href="#åŒæ­¥æ¶ˆæ¯-1" class="headerlink" title="åŒæ­¥æ¶ˆæ¯"></a>åŒæ­¥æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥æ¶ˆæ¯</span></span><br><span class="line">rocketMqTemplate.syncSend(<span class="string">&quot;topic10&quot;</span>, <span class="string">&quot;åŒæ­¥æ¶ˆæ¯&quot;</span> + cyt);</span><br></pre></td></tr></table></figure><h3 id="å¼‚æ­¥æ¶ˆæ¯-1"><a href="#å¼‚æ­¥æ¶ˆæ¯-1" class="headerlink" title="å¼‚æ­¥æ¶ˆæ¯"></a>å¼‚æ­¥æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼‚æ­¥æ¶ˆæ¯</span></span><br><span class="line">rocketMqTemplate.asyncSend(<span class="string">&quot;topic10&quot;</span>, <span class="string">&quot;å¼‚æ­¥æ¶ˆæ¯&quot;</span> + cyt, <span class="keyword">new</span> <span class="title class_">SendCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult sendResult)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SendCallback&quot;</span> + sendResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onException</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;onException&quot;</span> + throwable);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¶…æ—¶</span></span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure><h3 id="å•å‘æ¶ˆæ¯-1"><a href="#å•å‘æ¶ˆæ¯-1" class="headerlink" title="å•å‘æ¶ˆæ¯"></a>å•å‘æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•å‘æ¶ˆæ¯</span></span><br><span class="line">rocketMqTemplate.sendOneWay(<span class="string">&quot;topic10&quot;</span>, <span class="string">&quot;å•å‘æ¶ˆæ¯&quot;</span> + cyt);</span><br></pre></td></tr></table></figure><h3 id="å»¶è¿Ÿæ¶ˆæ¯"><a href="#å»¶è¿Ÿæ¶ˆæ¯" class="headerlink" title="å»¶è¿Ÿæ¶ˆæ¯"></a>å»¶è¿Ÿæ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»¶è¿Ÿæ¶ˆæ¯ 2000è¶…æ—¶æ—¶é—´ 3ï¼šç­‰çº§3 10såå»¶è¿Ÿ</span></span><br><span class="line">rocketMqTemplate.syncSend(<span class="string">&quot;topic10&quot;</span>, MessageBuilder.withPayload(<span class="string">&quot;å»¶è¿Ÿæ¶ˆæ¯&quot;</span> + msg).build(), <span class="number">2000</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><h3 id="æ‰¹é‡æ¶ˆæ¯-1"><a href="#æ‰¹é‡æ¶ˆæ¯-1" class="headerlink" title="æ‰¹é‡æ¶ˆæ¯"></a>æ‰¹é‡æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰¹é‡æ¶ˆæ¯</span></span><br><span class="line">List&lt;Message&gt; msgList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">msgList.add(<span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;topic6&quot;</span>, <span class="string">&quot;tag1&quot;</span>, <span class="string">&quot;msg1&quot;</span>.getBytes()));</span><br><span class="line">msgList.add(<span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;topic6&quot;</span>, <span class="string">&quot;tag1&quot;</span>, <span class="string">&quot;msg2&quot;</span>.getBytes()));</span><br><span class="line">msgList.add(<span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;topic6&quot;</span>, <span class="string">&quot;tag1&quot;</span>, <span class="string">&quot;msg3&quot;</span>.getBytes()));</span><br><span class="line">rocketMQTemplate.syncSend(<span class="string">&quot;topic8&quot;</span>, msgList, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h2 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">// tagè¿‡æ»¤</span></span><br><span class="line"><span class="comment">//@RocketMQMessageListener(topic = &quot;topic10&quot;, consumerGroup = &quot;group1&quot;, selectorExpression = &quot;tag1 || tag2&quot;)</span></span><br><span class="line"><span class="comment">// sql è¿‡æ»¤ + å¹¿æ’­æ¨¡å¼</span></span><br><span class="line"><span class="meta">@RocketMQMessageListener(topic = &quot;topic10&quot;,</span></span><br><span class="line"><span class="meta">        consumerGroup = &quot;group1&quot;,</span></span><br><span class="line"><span class="meta">        selectorType = SelectorType.SQL92, selectorExpression = &quot;age &gt; 18&quot;,</span></span><br><span class="line"><span class="meta">        messageModel = MessageModel.BROADCASTING)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">RocketMQListener</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¶ˆæ¯ç‰¹æ®Šå¤„ç†"><a href="#æ¶ˆæ¯ç‰¹æ®Šå¤„ç†" class="headerlink" title="æ¶ˆæ¯ç‰¹æ®Šå¤„ç†"></a>æ¶ˆæ¯ç‰¹æ®Šå¤„ç†</h1><h2 id="æ¶ˆæ¯é¡ºåº"><a href="#æ¶ˆæ¯é¡ºåº" class="headerlink" title="æ¶ˆæ¯é¡ºåº"></a>æ¶ˆæ¯é¡ºåº</h2><h3 id="é”™ä¹±çš„é¡ºåºåŸå› "><a href="#é”™ä¹±çš„é¡ºåºåŸå› " class="headerlink" title="é”™ä¹±çš„é¡ºåºåŸå› "></a>é”™ä¹±çš„é¡ºåºåŸå› </h3><blockquote><ul><li><p>åŸå› : </p><ul><li><p>æ¶ˆæ¯æœ‰åºæŒ‡çš„æ˜¯å¯ä»¥æŒ‰ç…§æ¶ˆæ¯çš„å‘é€é¡ºåºæ¥æ¶ˆè´¹(FIFO)ã€‚RocketMQå¯ä»¥ä¸¥æ ¼çš„ä¿è¯æ¶ˆæ¯æœ‰åºï¼Œå¯ä»¥åˆ†ä¸º åˆ†åŒºæœ‰åºæˆ–è€…å…¨å±€æœ‰åºã€‚ </p></li><li><p>é¡ºåºæ¶ˆè´¹çš„åŸç†è§£æï¼Œåœ¨é»˜è®¤çš„æƒ…å†µä¸‹æ¶ˆæ¯å‘é€ä¼šé‡‡å–Round Robinè½®è¯¢æ–¹å¼æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„ queue(åˆ†åŒºé˜Ÿåˆ—)ï¼›è€Œæ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ä»å¤šä¸ªqueueä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œè¿™ç§æƒ…å†µå‘é€å’Œæ¶ˆè´¹æ˜¯ä¸èƒ½ä¿è¯é¡ºåºã€‚ ä½†æ˜¯å¦‚æœæ§åˆ¶å‘é€çš„é¡ºåºæ¶ˆæ¯åªä¾æ¬¡å‘é€åˆ°åŒä¸€ä¸ªqueueä¸­ï¼Œæ¶ˆè´¹çš„æ—¶å€™åªä»è¿™ä¸ªqueueä¸Šä¾æ¬¡æ‹‰å–ï¼Œ åˆ™å°±ä¿è¯äº†é¡ºåºã€‚å½“å‘é€å’Œæ¶ˆè´¹å‚ä¸çš„queueåªæœ‰ä¸€ä¸ªï¼Œåˆ™æ˜¯å…¨å±€æœ‰åºï¼›å¦‚æœå¤šä¸ªqueueå‚ä¸ï¼Œåˆ™ä¸ºåˆ† åŒºæœ‰åºï¼Œå³ç›¸å¯¹æ¯ä¸ªqueueï¼Œæ¶ˆæ¯éƒ½æ˜¯æœ‰åºçš„ã€‚ </p></li><li><p>ä¸‹é¢ç”¨è®¢å•è¿›è¡Œåˆ†åŒºæœ‰åºçš„ç¤ºä¾‹ã€‚ä¸€ä¸ªè®¢å•çš„é¡ºåºæµç¨‹æ˜¯ï¼šåˆ›å»ºã€ä»˜æ¬¾ã€æ¨é€ã€å®Œæˆã€‚è®¢å•å·ç›¸åŒçš„æ¶ˆ æ¯ä¼šè¢«å…ˆåå‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹æ—¶ï¼ŒåŒä¸€ä¸ªOrderIdè·å–åˆ°çš„è‚¯å®šæ˜¯åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚</p></li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251008152701960.png" alt=" " style="zoom:50%;" /><h3 id="æƒ³è¦çš„æ•ˆæœ"><a href="#æƒ³è¦çš„æ•ˆæœ" class="headerlink" title="æƒ³è¦çš„æ•ˆæœ"></a>æƒ³è¦çš„æ•ˆæœ</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251008152832270.png" alt=" " style="zoom:50%;" /><h3 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">List&lt;OrderStep&gt; orderList = <span class="keyword">new</span> <span class="title class_">Producer</span>().buildOrders();</span><br><span class="line"><span class="comment">//è®¾ç½®æ¶ˆæ¯è¿›å…¥åˆ°æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">final</span> OrderStep order : orderList) &#123;</span><br><span class="line">    <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;topic1&quot;</span>, order.toString().getBytes());</span><br><span class="line">    <span class="comment">//å‘é€æ—¶è¦æŒ‡å®šå¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©å™¨</span></span><br><span class="line">    <span class="type">SendResult</span> <span class="variable">result</span> <span class="operator">=</span> producer.send(msg, <span class="keyword">new</span> <span class="title class_">MessageQueueSelector</span>() &#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®å½“å‰æ¶ˆæ¯å‘é€æ—¶ä½¿ç”¨å“ªä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">public</span> MessageQueue <span class="title function_">select</span><span class="params">(List&lt;MessageQueue&gt; list, Message</span></span><br><span class="line"><span class="params">                message, Object o)</span> &#123;</span><br><span class="line">            <span class="comment">//æ ¹æ®å‘é€çš„ä¿¡æ¯ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">            <span class="comment">//æ ¹æ®idæ¥é€‰æ‹©ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„å¯¹è±¡ï¼Œå¹¶è¿”å›-&gt;idå¾—åˆ°intå€¼</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> order.getOrderId();</span><br><span class="line">            <span class="type">long</span> <span class="variable">mqIndex</span> <span class="operator">=</span> orderId % list.size();</span><br><span class="line">            <span class="keyword">return</span> list.get((<span class="type">int</span>) mqIndex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="literal">null</span>);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br><span class="line">producer.shutdown();</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯äº‹åŠ¡"><a href="#æ¶ˆæ¯äº‹åŠ¡" class="headerlink" title="æ¶ˆæ¯äº‹åŠ¡"></a>æ¶ˆæ¯äº‹åŠ¡</h2><h3 id="äº‹åŠ¡æ¶ˆæ¯æ¦‚å¿µ"><a href="#äº‹åŠ¡æ¶ˆæ¯æ¦‚å¿µ" class="headerlink" title="äº‹åŠ¡æ¶ˆæ¯æ¦‚å¿µ"></a>äº‹åŠ¡æ¶ˆæ¯æ¦‚å¿µ</h3><blockquote><ul><li>çº¢è‰²ä¸ºæ­£å¸¸äº‹åŠ¡è¿‡ç¨‹</li><li>è“è‰²ä¸ºäº‹åŠ¡è¡¥å¿è¿‡ç¨‹</li><li>ç†è§£æ¡ˆä¾‹ï¼š ç”Ÿäº§è€…æ˜¯æˆ‘  brokerå…„å¼Ÿ  æœ¬åœ°äº‹åŠ¡ <code>è€å©†ç®¡é’±</code></li></ul><ol><li>æˆ‘åŒæ„å€Ÿé’±</li><li>å…„å¼Ÿå›å¤ok</li><li>é—®è€å©†æ„æ„¿æ˜¯å¦å€Ÿé’±</li><li>æäº¤æˆ–å›å½’  å€Ÿæˆ–è€…ä¸å€Ÿ</li></ol><ul><li>è¡¥å¿</li></ul><ol start="5"><li>æœ¬åœ°äº‹åŠ¡å‡ºé—®é¢˜</li><li>æ£€æµ‹æœ¬åœ°äº‹åŠ¡</li><li>æäº¤æˆ–è€…å›æ»š</li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251008162649671.png" alt=" " style="zoom:50%;" /><h3 id="äº‹åŠ¡æ¶ˆæ¯çŠ¶æ€"><a href="#äº‹åŠ¡æ¶ˆæ¯çŠ¶æ€" class="headerlink" title="äº‹åŠ¡æ¶ˆæ¯çŠ¶æ€"></a>äº‹åŠ¡æ¶ˆæ¯çŠ¶æ€</h3><blockquote><ol><li>æäº¤çŠ¶æ€ï¼šå…è®¸è¿›å…¥é˜Ÿåˆ—ï¼Œæ­¤æ¶ˆæ¯ä¸éäº‹åŠ¡æ¶ˆæ¯æ— åŒºåˆ« </li><li>å›æ»šçŠ¶æ€ï¼šä¸å…è®¸è¿›å…¥é˜Ÿåˆ—ï¼Œæ­¤æ¶ˆæ¯ç­‰åŒäºæœªå‘é€è¿‡</li><li>ä¸­é—´çŠ¶æ€ï¼šå®Œæˆäº†halfæ¶ˆæ¯çš„å‘é€ï¼Œæœªå¯¹MQè¿›è¡ŒäºŒæ¬¡çŠ¶æ€ç¡®è®¤</li></ol><ul><li>æ³¨æ„ï¼šäº‹åŠ¡æ¶ˆæ¯ä»…ä¸ç”Ÿäº§è€…æœ‰å…³ï¼Œä¸æ¶ˆè´¹è€…æ— å…³</li></ul></blockquote><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="äº‹åŠ¡æäº¤"><a href="#äº‹åŠ¡æäº¤" class="headerlink" title="äº‹åŠ¡æäº¤"></a>äº‹åŠ¡æäº¤</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.è°æ¥å‘ï¼Ÿ äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…</span></span><br><span class="line">        <span class="type">TransactionMQProducer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransactionMQProducer</span>(<span class="string">&quot;group1&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.å‘ç»™è°</span></span><br><span class="line">        producer.setNamesrvAddr(<span class="string">&quot;localhost:9876&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®äº‹åŠ¡ç›‘å¬</span></span><br><span class="line">        producer.setTransactionListener(<span class="keyword">new</span> <span class="title class_">TransactionListener</span>() &#123;</span><br><span class="line">            <span class="comment">// æ­£å¸¸äº‹åŠ¡è¿‡ç¨‹</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> LocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message message, Object o)</span> &#123;</span><br><span class="line">                <span class="comment">// æŠŠæ¶ˆæ¯æŠ¥é”™åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line">                <span class="comment">// sql insert</span></span><br><span class="line">                System.out.println(<span class="string">&quot;æ‰§è¡Œäº†æ­£å¸¸çš„äº‹åŠ¡è¿‡ç¨‹&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE; <span class="comment">// æäº¤</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// äº‹åŠ¡è¡¥å¿è¿‡ç¨‹</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> LocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(MessageExt messageExt)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 4.å‘ä»€ä¹ˆ</span></span><br><span class="line">        producer.start();</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;hello word!&quot;</span>;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;topic13&quot;</span>, <span class="string">&quot;tag1&quot;</span>, msg.getBytes());</span><br><span class="line">        <span class="comment">// å‘é€äº‹åŠ¡æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">TransactionSendResult</span> <span class="variable">transactionSendResult</span> <span class="operator">=</span> producer.sendMessageInTransaction(message, <span class="literal">null</span>);</span><br><span class="line">        System.out.println(transactionSendResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äº‹åŠ¡å›æ»š"><a href="#äº‹åŠ¡å›æ»š" class="headerlink" title="äº‹åŠ¡å›æ»š"></a>äº‹åŠ¡å›æ»š</h4><ul><li><code>return LocalTransactionState.ROLLBACK_MESSAGE;</code></li></ul><h4 id="äº‹åŠ¡è¡¥å¿"><a href="#äº‹åŠ¡è¡¥å¿" class="headerlink" title="äº‹åŠ¡è¡¥å¿"></a>äº‹åŠ¡è¡¥å¿</h4><ul><li>å¦‚æœäº‹åŠ¡è¡¥å¿ä»è¿”å› <code>UNKNOW</code> åˆ™äººå·¥æ’æŸ¥</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">producer.setTransactionListener(<span class="keyword">new</span> <span class="title class_">TransactionListener</span>() &#123;</span><br><span class="line">    <span class="comment">// æ­£å¸¸äº‹åŠ¡è¿‡ç¨‹</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message message, Object o)</span> &#123;</span><br><span class="line">        <span class="comment">// æŠŠæ¶ˆæ¯æŠ¥é”™åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line">        <span class="comment">// sql insert</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†æ­£å¸¸çš„äº‹åŠ¡è¿‡ç¨‹&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> LocalTransactionState.UNKNOW;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº‹åŠ¡è¡¥å¿è¿‡ç¨‹</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(MessageExt messageExt)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº‹åŠ¡è¡¥å¿è¿‡ç¨‹&quot;</span>);</span><br><span class="line">        <span class="comment">// sql ä¸šåŠ¡</span></span><br><span class="line">        <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h1><h2 id="é›†ç¾¤åˆ†ç±»"><a href="#é›†ç¾¤åˆ†ç±»" class="headerlink" title="é›†ç¾¤åˆ†ç±»"></a>é›†ç¾¤åˆ†ç±»</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009151206667.png" alt=" " style="zoom:50%;" /><h2 id="é›†ç¾¤ç‰¹å¾"><a href="#é›†ç¾¤ç‰¹å¾" class="headerlink" title="é›†ç¾¤ç‰¹å¾"></a>é›†ç¾¤ç‰¹å¾</h2><blockquote><ul><li>ä¸»ä»broker<ul><li>è§„å®š <code>id=0</code> çš„ä¸ºä¸»èŠ‚ç‚¹</li><li><code>brokerName=bs</code> çš„ä¸ºä¸€ä¸ªé›†ç¾¤</li><li>æ¯ä¸ªbrokeréœ€è¦å†æ¯ä¸ª <code>nameserver</code> æ³¨å†Œtopicç­‰ä¿¡æ¯</li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009152319186.png" alt=" " style="zoom:50%;" /><h2 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009152746056.png" alt=" " style="zoom:50%;" /><h2 id="ä¸¤ä¸»ä¸¤ä»é›†ç¾¤"><a href="#ä¸¤ä¸»ä¸¤ä»é›†ç¾¤" class="headerlink" title="ä¸¤ä¸»ä¸¤ä»é›†ç¾¤"></a>ä¸¤ä¸»ä¸¤ä»é›†ç¾¤</h2><blockquote><ul><li><a href="https://blog.csdn.net/u014624123/article/details/125016137?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522db1ec47fe5ba29ec17803406410d7b2f%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=db1ec47fe5ba29ec17803406410d7b2f&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-125016137-null-null.142%5Ev102%5Epc_search_result_base8&utm_term=docker%E6%90%AD%E5%BB%BArocketmq%E9%9B%86%E7%BE%A4&spm=1018.2226.3001.4187">https://blog.csdn.net/u014624123/article/details/125016137?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522db1ec47fe5ba29ec17803406410d7b2f%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=db1ec47fe5ba29ec17803406410d7b2f&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-125016137-null-null.142^v102^pc_search_result_base8&amp;utm_term=docker%E6%90%AD%E5%BB%BArocketmq%E9%9B%86%E7%BE%A4&amp;spm=1018.2226.3001.4187</a></li><li><code>Ip3 å‰¯æœ¬ ip5</code> ä¸¤ä¸ªåœ¨ä¸åŒçš„ç‰©ç†æœºå™¨ä¸Š</li><li><code>Ip4 å‰¯æœ¬ ip6</code> ä¸¤ä¸ªåœ¨ä¸åŒçš„ç‰©ç†æœºå™¨ä¸Š</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009160234891.png" alt=" " style="zoom:50%;" /><h1 id="5-é«˜çº§ç‰¹æ€§ï¼ˆé‡ç‚¹ï¼‰"><a href="#5-é«˜çº§ç‰¹æ€§ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="5 é«˜çº§ç‰¹æ€§ï¼ˆé‡ç‚¹ï¼‰"></a>5 é«˜çº§ç‰¹æ€§ï¼ˆé‡ç‚¹ï¼‰</h1><h2 id="5-1-æ¶ˆæ¯çš„å­˜å‚¨"><a href="#5-1-æ¶ˆæ¯çš„å­˜å‚¨" class="headerlink" title="5.1 æ¶ˆæ¯çš„å­˜å‚¨"></a>5.1 æ¶ˆæ¯çš„å­˜å‚¨</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009165755628.png" alt=" " style="zoom:50%;" /><h2 id="5-2-æ¶ˆæ¯çš„å­˜å‚¨ä»‹è´¨"><a href="#5-2-æ¶ˆæ¯çš„å­˜å‚¨ä»‹è´¨" class="headerlink" title="5.2 æ¶ˆæ¯çš„å­˜å‚¨ä»‹è´¨"></a>5.2 æ¶ˆæ¯çš„å­˜å‚¨ä»‹è´¨</h2><blockquote><ul><li>ç›´æ¥å‘æ•°æ®åº“çš„æ–‡ä»¶æ”¾æ•°æ® ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰<ul><li>é€Ÿåº¦å¿«</li><li>é˜²æ­¢DBæŒ‚æ‰</li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009170109113.png" alt=" " style="zoom:50%;" /><h2 id="5-3-é«˜æ•ˆçš„æ¶ˆæ¯å­˜å‚¨ä¸è¯»å†™æ–¹å¼"><a href="#5-3-é«˜æ•ˆçš„æ¶ˆæ¯å­˜å‚¨ä¸è¯»å†™æ–¹å¼" class="headerlink" title="5.3 é«˜æ•ˆçš„æ¶ˆæ¯å­˜å‚¨ä¸è¯»å†™æ–¹å¼"></a>5.3 é«˜æ•ˆçš„æ¶ˆæ¯å­˜å‚¨ä¸è¯»å†™æ–¹å¼</h2><h3 id="éšæœºå†™ï¼ˆ100k-sï¼‰"><a href="#éšæœºå†™ï¼ˆ100k-sï¼‰" class="headerlink" title="éšæœºå†™ï¼ˆ100k&#x2F;sï¼‰"></a>éšæœºå†™ï¼ˆ100k&#x2F;sï¼‰</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009170647015.png" alt=" " style="zoom:50%;" /><h3 id="é¡ºåºå†™-ï¼ˆ600MB-sï¼‰"><a href="#é¡ºåºå†™-ï¼ˆ600MB-sï¼‰" class="headerlink" title="é¡ºåºå†™ ï¼ˆ600MB&#x2F;sï¼‰"></a>é¡ºåºå†™ ï¼ˆ600MB&#x2F;sï¼‰</h3><ul><li><code>1ç§’1éƒ¨ç”µå½±</code></li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009170750523.png" alt=" " style="zoom:50%;" /><h3 id="mqæ–¹å¼"><a href="#mqæ–¹å¼" class="headerlink" title="mqæ–¹å¼"></a>mqæ–¹å¼</h3><blockquote><ul><li>é¢„å…ˆç”³è¯·ç©ºé—´ï¼ˆå¦‚1GBï¼‰</li><li><code>é¡ºåºè¯»å†™</code></li><li>é…ç½®æ–‡ä»¶å¯ä»¥ä¿®æ”¹</li></ul></blockquote><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009171229997.png" alt="image-20251009171229997"></p><h3 id="é›¶æ‹·è´æŠ€æœ¯"><a href="#é›¶æ‹·è´æŠ€æœ¯" class="headerlink" title="é›¶æ‹·è´æŠ€æœ¯"></a>é›¶æ‹·è´æŠ€æœ¯</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009172014886.png" alt=" " style="zoom:50%;" /><h2 id="5-4-æ¶ˆæ¯å­˜å‚¨ç»“æ„"><a href="#5-4-æ¶ˆæ¯å­˜å‚¨ç»“æ„" class="headerlink" title="5.4 æ¶ˆæ¯å­˜å‚¨ç»“æ„"></a>5.4 æ¶ˆæ¯å­˜å‚¨ç»“æ„</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009172958133.png" alt=" " style="zoom:50%;" /><blockquote><ul><li><code>commitlog</code> ç›®å½•ä¸‹å­˜æ”¾æ¶ˆæ¯çš„ä¿¡æ¯  å„ä¸ªé˜Ÿåˆ—queue<ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009173044520.png" alt=" " style="zoom:33%;" /></li></ul></li><li><code>consumequeue</code> æ¶ˆè´¹é€»è¾‘é˜Ÿåˆ—<ul><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009172817973.png" alt=" " style="zoom:33%;" /></li><li>æ¶ˆè´¹è€…é‡å¯å  å¯ä»¥å®šä½ä¸Šæ¬¡è¯»å†™çš„ä½ç½®</li><li>åŒ…å«åç§»é‡ä¿¡æ¯</li></ul></li><li><code>index</code> ç´¢å¼•<ul><li>å­˜æ”¾é˜Ÿåˆ—ç´¢å¼•</li><li>æ—¶é—´</li><li>è¯»åˆ°ç¬¬å‡ ä¸ªé˜Ÿåˆ—</li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009173225891.png" alt=" " style="zoom:50%;" /><h2 id="5-5-åˆ·ç›˜æœºåˆ¶"><a href="#5-5-åˆ·ç›˜æœºåˆ¶" class="headerlink" title="5.5 åˆ·ç›˜æœºåˆ¶"></a>5.5 åˆ·ç›˜æœºåˆ¶</h2><ul><li>brokeræŠŠæ•°æ®å­˜æ”¾åˆ° <code>commitlog</code> æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œ æ­¤æ—¶é‡‡ç”¨ <code>åˆ·ç›˜æœºåˆ¶</code></li></ul><h3 id="åŒæ­¥åˆ·ç›˜"><a href="#åŒæ­¥åˆ·ç›˜" class="headerlink" title="åŒæ­¥åˆ·ç›˜"></a>åŒæ­¥åˆ·ç›˜</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009173657990.png" alt=" " style="zoom:50%;" /><h3 id="å¼‚æ­¥åˆ·ç›˜"><a href="#å¼‚æ­¥åˆ·ç›˜" class="headerlink" title="å¼‚æ­¥åˆ·ç›˜"></a>å¼‚æ­¥åˆ·ç›˜</h3><blockquote><ul><li>åªåŒ…å«1ï¼Œ3, 7ä¸‰æ­¥</li><li>ç”Ÿäº§è€…ç»™broker</li><li>brokerç«‹å³è¿”å›ACK  ä¿å­˜æˆåŠŸ<ul><li>æ­¤æ—¶æ•°æ®åœ¨å†…å­˜</li></ul></li><li>å½“æ•°æ®è¾¾åˆ°ä¸€å®šé‡å†™å…¥ç£ç›˜æŒä¹…åŒ–</li></ul></blockquote><h3 id="å¯¹æ¯”-é…ç½®"><a href="#å¯¹æ¯”-é…ç½®" class="headerlink" title="å¯¹æ¯”&amp;é…ç½®"></a>å¯¹æ¯”&amp;é…ç½®</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009174027864.png" alt=" " style="zoom:43%;" /><h2 id="5-6-é«˜å¯ç”¨æ€§"><a href="#5-6-é«˜å¯ç”¨æ€§" class="headerlink" title="5.6 é«˜å¯ç”¨æ€§"></a>5.6 é«˜å¯ç”¨æ€§</h2><blockquote><ul><li><code>nameserver</code> éƒ¨ç½²å¤šå°  æ•°æ®ä¸å…±äº«</li><li><code>broker</code>  ä¸»ä»æ¶æ„</li><li><code>producer</code> topicåˆ°ä¸åŒçš„å¤šä¸ªgroupç»„</li><li><code>consumer</code> è¯»å†™åˆ†ç¦»</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009180358585.png" alt=" " style="zoom:50%;" /> <h2 id="5-7-è´Ÿè½½å‡è¡¡"><a href="#5-7-è´Ÿè½½å‡è¡¡" class="headerlink" title="5.7 è´Ÿè½½å‡è¡¡"></a>5.7 è´Ÿè½½å‡è¡¡</h2><h3 id="producer"><a href="#producer" class="headerlink" title="producer"></a>producer</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009181122441.png" alt=" " style="zoom:50%;" /><h3 id="consumer"><a href="#consumer" class="headerlink" title="consumer"></a>consumer</h3><blockquote><p>å¾ªç¯å¹³å‡åˆ†é…ï¼š</p><p>å½“broker-bæŒ‚äº†ï¼Œæ­¤æ—¶ä¸‰ä¸ªæ¶ˆè´¹è€…ä»æ˜¯å¹³å‡åœ°ä» <code>broker-a</code>ä¸­å–æ•°æ®</p></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009181017525.png" alt=" " style="zoom:50%;" /><h2 id="5-8-æ¶ˆæ¯é‡è¯•"><a href="#5-8-æ¶ˆæ¯é‡è¯•" class="headerlink" title="5.8 æ¶ˆæ¯é‡è¯•"></a>5.8 æ¶ˆæ¯é‡è¯•</h2><h3 id="é¡ºåºæ¶ˆæ¯é‡è¯•"><a href="#é¡ºåºæ¶ˆæ¯é‡è¯•" class="headerlink" title="é¡ºåºæ¶ˆæ¯é‡è¯•"></a>é¡ºåºæ¶ˆæ¯é‡è¯•</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009181414370.png" alt=" " style="zoom:50%;" /><h3 id="æ— åºæ¶ˆæ¯é‡è¯•"><a href="#æ— åºæ¶ˆæ¯é‡è¯•" class="headerlink" title="æ— åºæ¶ˆæ¯é‡è¯•"></a>æ— åºæ¶ˆæ¯é‡è¯•</h3><blockquote><ul><li>æ¯éš”ä¸€å®šæ—¶é—´è‡ªåŠ¨é‡å‘<ul><li>é—´éš”æ—¶é—´é€’å¢</li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009181748466.png" alt=" " style="zoom:50%;" /> <h2 id="5-9-æ­»ä¿¡é˜Ÿåˆ—"><a href="#5-9-æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="5.9 æ­»ä¿¡é˜Ÿåˆ—"></a>5.9 æ­»ä¿¡é˜Ÿåˆ—</h2><blockquote><ol><li>å½“æ¶ˆæ¯æ¶ˆè´¹é‡è¯•åˆ°è¾¾äº†æŒ‡å®šæ¬¡æ•°ï¼ˆé»˜è®¤16æ¬¡ï¼‰åï¼ŒMQå°†æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯ç§°ä¸ºæ­»ä¿¡æ¶ˆæ¯ ï¼ˆDead-Letter Messageï¼‰</li><li>æ­»ä¿¡æ¶ˆæ¯ä¸ä¼šè¢«ç›´æ¥æŠ›å¼ƒï¼Œè€Œæ˜¯ä¿å­˜åˆ°äº†ä¸€ä¸ªå…¨æ–°çš„é˜Ÿåˆ—ä¸­ï¼Œè¯¥é˜Ÿåˆ—ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead-Letter Queueï¼‰</li><li>æ­»ä¿¡é˜Ÿåˆ—ç‰¹å¾<ol><li>å½’å±æŸä¸€ä¸ªç»„ï¼ˆGourp Idï¼‰ï¼Œè€Œä¸å½’å±Topicï¼Œä¹Ÿä¸å½’å±æ¶ˆè´¹è€… </li><li>ä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—ä¸­å¯ä»¥åŒ…å«åŒä¸€ä¸ªç»„ä¸‹çš„å¤šä¸ªTopicä¸­çš„æ­»ä¿¡æ¶ˆæ¯ </li><li>æ­»ä¿¡é˜Ÿåˆ—ä¸ä¼šè¿›è¡Œé»˜è®¤åˆå§‹åŒ–ï¼Œå½“ç¬¬ä¸€ä¸ªæ­»ä¿¡å‡ºç°åï¼Œæ­¤é˜Ÿåˆ—é¦–æ¬¡åˆå§‹åŒ–</li></ol></li><li>æ­»ä¿¡é˜Ÿåˆ—ä¸­æ¶ˆæ¯ç‰¹å¾<ol><li>ä¸ä¼šè¢«å†æ¬¡é‡å¤æ¶ˆè´¹  </li><li>æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æœ‰æ•ˆæœŸä¸º3å¤©ï¼Œè¾¾åˆ°æ—¶é™åå°†è¢«æ¸…é™¤</li></ol></li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009182032101.png" alt=" " style="zoom:43%;" /><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009182131118.png" alt=" " style="zoom:50%;" /><h2 id="5-10-æ¶ˆæ¯é‡å¤æ¶ˆè´¹ä¸æ¶ˆæ¯å¹‚ç­‰"><a href="#5-10-æ¶ˆæ¯é‡å¤æ¶ˆè´¹ä¸æ¶ˆæ¯å¹‚ç­‰" class="headerlink" title="5.10 æ¶ˆæ¯é‡å¤æ¶ˆè´¹ä¸æ¶ˆæ¯å¹‚ç­‰"></a>5.10 æ¶ˆæ¯é‡å¤æ¶ˆè´¹ä¸æ¶ˆæ¯å¹‚ç­‰</h2><h3 id="åŸå› é‡å¤åŸå› "><a href="#åŸå› é‡å¤åŸå› " class="headerlink" title="åŸå› é‡å¤åŸå› "></a>åŸå› é‡å¤åŸå› </h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009182514631.png" alt=" " style="zoom:50%;" /><h3 id="æ¶ˆæ¯å¹‚ç­‰"><a href="#æ¶ˆæ¯å¹‚ç­‰" class="headerlink" title="æ¶ˆæ¯å¹‚ç­‰"></a>æ¶ˆæ¯å¹‚ç­‰</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20251009183002433.png" alt=" " style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> rocketMQ </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ -ç‚®å“¥å¸¦ä½ å­¦å…¥é—¨</title>
      <link href="//post/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%82%AE%E5%93%A5%E5%B8%A6%E4%BD%A0%E5%AD%A6%E5%85%A5%E9%97%A8.html"/>
      <url>//post/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%82%AE%E5%93%A5%E5%B8%A6%E4%BD%A0%E5%AD%A6%E5%85%A5%E9%97%A8.html</url>
      
        <content type="html"><![CDATA[<blockquote><p> æ•™ç¨‹åœ°å€ï¼š</p><ol><li><strong>up</strong>ï¼šç‚®å“¥å¸¦ä½ å­¦</li></ol><p>è¯¾ç¨‹åå­—ï¼š[æ‰‹æŠŠæ‰‹æ•™å­¦]å¿«é€Ÿå¸¦ä½ å…¥é—¨æ·±åº¦å­¦ä¹ ä¸å®æˆ˜</p><p>ç®€ä»‹ï¼šå…¥é—¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ </p><p>ç½‘å€ï¼š</p><p><a href="https://www.bilibili.com/video/BV1eP411w7Re/?spm_id_from=333.1387.homepage.video_card.click&vd_source=f8d1f5518d3f58b48b5c428323f8d3bf">https://www.bilibili.com/video/BV1eP411w7Re/?spm_id_from=333.1387.homepage.video_card.click&amp;vd_source=f8d1f5518d3f58b48b5c428323f8d3bf</a></p><ol start="2"><li><strong>up</strong>ï¼šç‚®å“¥å¸¦ä½ å­¦</li></ol><p>è¯¾ç¨‹åå­—ï¼šPytorchæ¡†æ¶ä¸ç»å…¸å·ç§¯ç¥ç»ç½‘ç»œä¸å®æˆ˜    </p><p>ç®€ä»‹ï¼šå…¥é—¨æ·±åº¦å­¦ä¹ å’Œpytorch</p><p>ç½‘å€ï¼š</p><p><a href="https://www.bilibili.com/video/BV1e34y1M7wR/?spm_id_from=333.1387.homepage.video_card.click&vd_source=f8d1f5518d3f58b48b5c428323f8d3bf">https://www.bilibili.com/video/BV1e34y1M7wR/?spm_id_from=333.1387.homepage.video_card.click&amp;vd_source=f8d1f5518d3f58b48b5c428323f8d3bf</a></p></blockquote><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote><p>æ·±åº¦å­¦ä¹ ä»¥ç¥ç»ç½‘ç»œä¸ºåŸºç¡€</p></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918122048971.png" alt=" " style="zoom:33%;" /><h2 id="ç¥ç»ç½‘ç»œ"><a href="#ç¥ç»ç½‘ç»œ" class="headerlink" title="ç¥ç»ç½‘ç»œ"></a>ç¥ç»ç½‘ç»œ</h2><ul><li>å¹¶ééšè—å±‚è¶Šå¤šè¶Šå¥½ å¯èƒ½è¿‡æ‹Ÿåˆ</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918123432656.png" alt=" " style="zoom:33%;" /><h2 id="å…¨è¿æ¥ç¥ç»ç½‘ç»œ"><a href="#å…¨è¿æ¥ç¥ç»ç½‘ç»œ" class="headerlink" title="å…¨è¿æ¥ç¥ç»ç½‘ç»œ"></a>å…¨è¿æ¥ç¥ç»ç½‘ç»œ</h2><blockquote><p>é€šè¿‡è®­ç»ƒwå’Œbï¼ˆæƒé‡å’Œåç½®ï¼‰</p><ul><li>æ³¨ï¼šæœºå™¨å­¦ä¹ å†…å®¹</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918123705231.png" alt=" " style="zoom:33%;" /><h2 id="ç¥ç»ç½‘ç»œä½œç”¨"><a href="#ç¥ç»ç½‘ç»œä½œç”¨" class="headerlink" title="ç¥ç»ç½‘ç»œä½œç”¨"></a>ç¥ç»ç½‘ç»œä½œç”¨</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918124059476.png" alt=" " style="zoom:33%;" /><h2 id="æ·±åº¦å­¦ä¹ æ¡†æ¶ä»‹ç»"><a href="#æ·±åº¦å­¦ä¹ æ¡†æ¶ä»‹ç»" class="headerlink" title="&#x3D;&#x3D;æ·±åº¦å­¦ä¹ æ¡†æ¶ä»‹ç»&#x3D;&#x3D;"></a>&#x3D;&#x3D;æ·±åº¦å­¦ä¹ æ¡†æ¶ä»‹ç»&#x3D;&#x3D;</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918124423733.png" alt=" " style="zoom:33%;" /><h2 id="ç¯å¢ƒä»‹ç»"><a href="#ç¯å¢ƒä»‹ç»" class="headerlink" title="ç¯å¢ƒä»‹ç»"></a>ç¯å¢ƒä»‹ç»</h2><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918124512049.png" alt=" " style="zoom:33%;" /><h1 id="æœºå™¨å­¦ä¹ çŸ¥è¯†å›é¡¾"><a href="#æœºå™¨å­¦ä¹ çŸ¥è¯†å›é¡¾" class="headerlink" title="æœºå™¨å­¦ä¹ çŸ¥è¯†å›é¡¾"></a>æœºå™¨å­¦ä¹ çŸ¥è¯†å›é¡¾</h1><h2 id="2-çº¿æ€§å›å½’æ¨¡å‹ä¸æ¢¯åº¦ä¸‹é™"><a href="#2-çº¿æ€§å›å½’æ¨¡å‹ä¸æ¢¯åº¦ä¸‹é™" class="headerlink" title="2. çº¿æ€§å›å½’æ¨¡å‹ä¸æ¢¯åº¦ä¸‹é™"></a>2. çº¿æ€§å›å½’æ¨¡å‹ä¸æ¢¯åº¦ä¸‹é™</h2><h3 id="2-2-å®šä¹‰"><a href="#2-2-å®šä¹‰" class="headerlink" title="2.2 å®šä¹‰"></a>2.2 å®šä¹‰</h3><ul><li>xæ˜¯ç‰¹å¾ yæ˜¯æ ‡ç­¾</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918133416585.png" alt=" " style="zoom:33%;" /><h4 id="æŸå¤±å‡½æ•°-ï¼ˆè¯¯å·®å‡½æ•°ï¼‰"><a href="#æŸå¤±å‡½æ•°-ï¼ˆè¯¯å·®å‡½æ•°ï¼‰" class="headerlink" title="æŸå¤±å‡½æ•° ï¼ˆè¯¯å·®å‡½æ•°ï¼‰"></a>æŸå¤±å‡½æ•° ï¼ˆè¯¯å·®å‡½æ•°ï¼‰</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918134408006.png" alt=" " style="zoom:33%;" /><h4 id="ç©·ä¸¾æ³•"><a href="#ç©·ä¸¾æ³•" class="headerlink" title="ç©·ä¸¾æ³•"></a>ç©·ä¸¾æ³•</h4><ul><li>è¿‡äºåƒåœ¾ çœ‹åé¢æœ€å°äºŒä¹˜æ³•</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918134858646.png" alt="image-20250918134858646" style="zoom:33%;" /><h3 id="2-3-æœ€å°äºŒä¹˜æ³•"><a href="#2-3-æœ€å°äºŒä¹˜æ³•" class="headerlink" title="2.3 æœ€å°äºŒä¹˜æ³•"></a>2.3 æœ€å°äºŒä¹˜æ³•</h3><blockquote><p>å¯¹xæ±‚åå¯¼</p></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918135512644.png" alt=" " style="zoom:33%;" /><h4 id="å‘é‡ç‰ˆæœ¬"><a href="#å‘é‡ç‰ˆæœ¬" class="headerlink" title="å‘é‡ç‰ˆæœ¬"></a>å‘é‡ç‰ˆæœ¬</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918140908789.png" alt=" " style="zoom:33%;" /><ul><li>æŸå¤±å‡½æ•°</li><li>æ›´æ­£ æ­¤å¤„Jï¼ˆWï¼‰ä¸ºfï¼ˆxï¼‰</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918140931108.png"  style="zoom:30%;" ><ul><li>å¯¹æŸå¤±å‡½æ•°æ±‚å¯¼</li><li><code>å¹¶éæ‰€æœ‰çŸ©é˜µæœ‰å¯é€†çŸ©é˜µï¼Œå› æ­¤å¼•å…¥æŸå¤±å‡½æ•°</code></li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918141656527.png" alt="image-20250918141656527" style="zoom:33%;" /><h2 id="2-3-æ¢¯åº¦ä¸‹é™"><a href="#2-3-æ¢¯åº¦ä¸‹é™" class="headerlink" title="&#x3D;&#x3D;2.3 æ¢¯åº¦ä¸‹é™&#x3D;&#x3D;"></a>&#x3D;&#x3D;2.3 æ¢¯åº¦ä¸‹é™&#x3D;&#x3D;</h2><h3 id="ç†è§£"><a href="#ç†è§£" class="headerlink" title="ç†è§£"></a>ç†è§£</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918151145564.png" alt=" " style="zoom:33%;" />  <h3 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h3><p>$$<br>w&#x3D;w-a \frac{\partial J(w)}{\partial w}<br>$$</p><ul><li>å¯¹å¤šä¸ªwé‡å¤è®¡ç®—</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918151609827.png" alt=" " style="zoom:33%;" /><ul><li><p>ç®€åŒ–ç‰ˆæœ¬</p></li><li><p>$$<br>\begin{array}{l}<br>\text { repeat until convergence { }\<br>\begin{aligned}<br>w &amp; &#x3D;w-\alpha \frac{1}{m} \sum_{i&#x3D;1}^{m}\left(f_{w, b}\left(x^{(i)}\right)-y^{(i)}\right) x^{(i)} \<br>b &amp; &#x3D;b-\alpha \frac{1}{m} \sum_{i&#x3D;1}^{m}\left(f_{w, b}\left(x^{(i)}\right)-y^{(i)}\right)<br>\end{aligned}<br>\end{array}<br>$$</p></li></ul><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918153859855.png" alt="image-20250918153859855"></p><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918152726195.png" alt=" " style="zoom:33%;" /><h3 id="å®æˆ˜æ¡ˆä¾‹"><a href="#å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹"></a>å®æˆ˜æ¡ˆä¾‹</h3><blockquote><p>æ­¥éª¤ï¼š</p><ol><li>æ•°æ®</li><li>æ¨¡å‹</li><li>æŸå¤±å‡½æ•°</li><li>æ¢¯åº¦æ±‚å¯¼</li><li>åˆ©ç”¨æ¢¯åº¦æ›´æ–°å‚æ•°</li><li>è®¾ç½®è®­ç»ƒè½®æ¬¡</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ•°æ®é›†</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ•°æ®ç‰¹å¾</span></span><br><span class="line">x_data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ•°æ®æ ‡ç­¾</span></span><br><span class="line">y_data = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–wå‚æ•°</span></span><br><span class="line">w = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰çº¿æ€§å›å½’çš„æ¨¡å‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forword</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x * w</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æŸå¤±å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">xs, ys</span>):</span><br><span class="line">    costvalue = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(xs, ys):</span><br><span class="line">        y_pred = forword(x)</span><br><span class="line">        costvalue += (y_pred - y) ** <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> costvalue / <span class="built_in">len</span>(xs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è®¡ç®—æ¢¯åº¦çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradient</span>(<span class="params">xs, ys</span>):</span><br><span class="line">    grad = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(xs, ys):</span><br><span class="line">        grad += <span class="number">2</span> * x * (forword(x) - y)</span><br><span class="line">    <span class="keyword">return</span> grad / <span class="built_in">len</span>(xs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­¦ä¹ ç‡</span></span><br><span class="line">aa = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    cost_val = cost(x_data, y_data)</span><br><span class="line">    gra_val = gradient(x_data, y_data)</span><br><span class="line">    w = w - aa * gra_val</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;è®­ç»ƒè½®æ¬¡ï¼š&#x27;</span>, epoch, <span class="string">&#x27;w=&#x27;</span>, w, <span class="string">&#x27;loss:&#x27;</span>, cost_val)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;100è½®åwå·²ç»è®­ç»ƒå¥½äº†&#x27;</span>, <span class="string">&#x27;w=&#x27;</span>, w)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å­¦ä¹ 4å°æ—¶æœ€ç»ˆå¾—åˆ†ä¸ºï¼š&quot;</span>, forword(<span class="number">4</span>))</span><br></pre></td></tr></table></figure><h2 id="3-é€»è¾‘å›å½’"><a href="#3-é€»è¾‘å›å½’" class="headerlink" title="&#x3D;&#x3D;3.é€»è¾‘å›å½’&#x3D;&#x3D;"></a>&#x3D;&#x3D;3.é€»è¾‘å›å½’&#x3D;&#x3D;</h2><h3 id="3-1-å›å½’å’Œåˆ†ç±»çš„åŒºåˆ«"><a href="#3-1-å›å½’å’Œåˆ†ç±»çš„åŒºåˆ«" class="headerlink" title="3.1 å›å½’å’Œåˆ†ç±»çš„åŒºåˆ«"></a>3.1 å›å½’å’Œåˆ†ç±»çš„åŒºåˆ«</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918202130240.png" alt=" " style="zoom:33%;" /><h3 id="3-2-sigmoidå‡½æ•°"><a href="#3-2-sigmoidå‡½æ•°" class="headerlink" title="3.2 sigmoidå‡½æ•°"></a>3.2 sigmoidå‡½æ•°</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250918202418798.png" alt=" " style="zoom:33%;" /><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919120620532.png" alt=" " style="zoom:33%;" /><h4 id="æ±‚å¯¼"><a href="#æ±‚å¯¼" class="headerlink" title="æ±‚å¯¼"></a>æ±‚å¯¼</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919123351303.png" alt="image-20250919123351303"></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="3-3-æŸå¤±å‡½æ•°"><a href="#3-3-æŸå¤±å‡½æ•°" class="headerlink" title="&#x3D;&#x3D;3.3 æŸå¤±å‡½æ•°&#x3D;&#x3D;"></a>&#x3D;&#x3D;3.3 æŸå¤±å‡½æ•°&#x3D;&#x3D;</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919124534217.png" alt=" " style="zoom:50%;" /><h4 id="è¡¨è¾¾å¼"><a href="#è¡¨è¾¾å¼" class="headerlink" title="è¡¨è¾¾å¼"></a>è¡¨è¾¾å¼</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919121328314.png" alt=" " style="zoom:33%;" /> <h3 id="3-4-æ¢¯åº¦ä¸‹é™"><a href="#3-4-æ¢¯åº¦ä¸‹é™" class="headerlink" title="&#x3D;&#x3D;3.4 æ¢¯åº¦ä¸‹é™&#x3D;&#x3D;"></a>&#x3D;&#x3D;3.4 æ¢¯åº¦ä¸‹é™&#x3D;&#x3D;</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919124419231.png" alt="image-20250919124419231" style="zoom:50%;" /> <h4 id="å‚æ•°wæ›´æ–°"><a href="#å‚æ•°wæ›´æ–°" class="headerlink" title="å‚æ•°wæ›´æ–°"></a>å‚æ•°wæ›´æ–°</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919123454850.png" alt=" " style="zoom:50%;" /><blockquote><ul><li>å‘é‡æ±‚å¯¼</li><li>å¸¦å…¥å‡½æ•°å¸¸è§„æ±‚å¯¼æ¨å¯¼ï¼š</li><li><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919122348745.png" alt=" " style="zoom:33%;" /></li></ul></blockquote><h4 id="å‚æ•°bæ›´æ–°"><a href="#å‚æ•°bæ›´æ–°" class="headerlink" title="å‚æ•°bæ›´æ–°"></a>å‚æ•°bæ›´æ–°</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919123742565.png" alt=" " style="zoom:33%;" /><h3 id="3-5-å›å½’æ¨¡å‹è¯„ä»·æŒ‡æ ‡"><a href="#3-5-å›å½’æ¨¡å‹è¯„ä»·æŒ‡æ ‡" class="headerlink" title="3.5 å›å½’æ¨¡å‹è¯„ä»·æŒ‡æ ‡"></a>3.5 å›å½’æ¨¡å‹è¯„ä»·æŒ‡æ ‡</h3><h4 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919131152077.png" alt=" " style="zoom:50%;" /><h4 id="å‡†ç¡®ç‡"><a href="#å‡†ç¡®ç‡" class="headerlink" title="å‡†ç¡®ç‡"></a>å‡†ç¡®ç‡</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919130241465.png" alt=" " style="zoom:50%;" /><h4 id="ç²¾ç¡®ç‡"><a href="#ç²¾ç¡®ç‡" class="headerlink" title="ç²¾ç¡®ç‡"></a>ç²¾ç¡®ç‡</h4> <img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919130429109.png" alt=" " style="zoom:50%;" /><h4 id="å¬å›ç‡"><a href="#å¬å›ç‡" class="headerlink" title="å¬å›ç‡"></a>å¬å›ç‡</h4><p> <img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919130814009.png" alt=" "></p><h4 id="F1å€¼"><a href="#F1å€¼" class="headerlink" title="F1å€¼"></a>F1å€¼</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919130914372.png" alt="image-20250919130914372"></p><h3 id="3-6-åˆ†ç±»æ¨¡å‹è¯„ä»·æŒ‡æ ‡"><a href="#3-6-åˆ†ç±»æ¨¡å‹è¯„ä»·æŒ‡æ ‡" class="headerlink" title="3.6 åˆ†ç±»æ¨¡å‹è¯„ä»·æŒ‡æ ‡"></a>3.6 åˆ†ç±»æ¨¡å‹è¯„ä»·æŒ‡æ ‡</h3><h4 id="å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰å’Œ-å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰"><a href="#å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰å’Œ-å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰" class="headerlink" title="å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰å’Œ&#x3D;&#x3D;å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰&#x3D;&#x3D;"></a>å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰å’Œ&#x3D;&#x3D;å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰&#x3D;&#x3D;</h4><blockquote><p>MSE å°±æ˜¯å‰é¢çš„LOSS æŸå¤±å‡½æ•°</p></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919131715054.png" alt=" " style="zoom:50%;" /> <h4 id="å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰"><a href="#å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰" class="headerlink" title="å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰"></a>å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919131915415.png" alt=" " style="zoom:67%;" /><h4 id="å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰"><a href="#å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰" class="headerlink" title="å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰"></a>å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919131947140.png" alt=" " style="zoom:67%;" /><h3 id="3-7-å®æˆ˜æ¡ˆä¾‹"><a href="#3-7-å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="3.7 å®æˆ˜æ¡ˆä¾‹"></a>3.7 å®æˆ˜æ¡ˆä¾‹</h3><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><blockquote><ol><li>å½’ä¸€åŒ–å…¬å¼ï¼š(X-min)&#x2F;(max-min)ï¼Œæ¶ˆé™¤é‡çº²å’Œæ•°å€¼å¤§å°å¯¹ç»“æœçš„å½±å“</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. è¯»å–æ•°æ®</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;breast_cancer_data.csv&quot;</span>)</span><br><span class="line"><span class="comment"># print(dataset)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æå–ç‰¹å¾x</span></span><br><span class="line">X = dataset.iloc[:, :-<span class="number">1</span>]  <span class="comment"># é™¤äº†æœ€åä¸€åˆ—</span></span><br><span class="line"><span class="comment"># print(x)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æå–æ•°æ®ä¸­çš„æ ‡ç­¾</span></span><br><span class="line">Y = dataset[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line"><span class="comment"># print(y)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ’åˆ†æ•°æ®é›†å’Œæµ‹è¯•é›† å…«ä»½è®­ç»ƒé›† äºŒä»½æµ‹è¯•é›† éšæœºæŠ½å–</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. æ•°æ®å½’ä¸€åŒ– ä½¿æ•°æ®åœ¨0~1ä¹‹é—´ æ¶ˆé™¤é‡çº²å½±å“</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">x_train = sc.fit_transform(x_train)</span><br><span class="line">x_test = sc.transform(x_test)</span><br><span class="line"><span class="comment"># print(x_train)</span></span><br><span class="line"><span class="comment"># print(x_test)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.é€»è¾‘å›å½’æ¨¡å‹æ­å»º</span></span><br><span class="line">lr = LogisticRegression()</span><br><span class="line">lr.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.æ‰“å°å‚æ•°wå’Œb</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;w&quot;</span>, lr.coef_)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b&quot;</span>, lr.intercept_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹æ¨ç†æµ‹è¯•</span></span><br><span class="line">pre_result = lr.predict(x_test)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;é¢„æµ‹ç»“æœï¼š&quot;</span>, pre_result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.æ‰“å°é¢„æµ‹ç»“æœçš„æ¦‚ç‡</span></span><br><span class="line">pre_result_proba = lr.predict_proba(x_test)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ¦‚ç‡ï¼š&quot;</span>, pre_result_proba)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.è·å–æ¶æ€§è‚¿ç˜¤çš„æ¦‚ç‡</span></span><br><span class="line">pre_list = pre_result_proba[:, <span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(pre_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11. è®¾ç½®ä¿å­˜ç»“æœçš„åˆ—è¡¨</span></span><br><span class="line">result = []</span><br><span class="line">result_name = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é˜ˆå€¼</span></span><br><span class="line">thresholds = <span class="number">0.3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(pre_list)):</span><br><span class="line">    <span class="keyword">if</span> pre_list[i] &gt; thresholds:</span><br><span class="line">        result.append(<span class="number">1</span>)</span><br><span class="line">        result_name.append(<span class="string">&quot;æ¶æ€§&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result.append(<span class="number">0</span>)</span><br><span class="line">        result_name.append(<span class="string">&quot;è‰¯æ€§&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°é˜ˆå€¼è°ƒæ•´åç»“æœ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ‰“å°é˜ˆå€¼è°ƒæ•´åç»“æœ:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="built_in">print</span>(result_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœçš„ç²¾ç¡®ç‡å’Œå¬å›è¿˜æœ‰f1å€¼</span></span><br><span class="line"><span class="built_in">print</span>(y_test)</span><br><span class="line">report = classification_report(y_test, result, labels=[<span class="number">0</span>, <span class="number">1</span>], target_names=[<span class="string">&#x27;è‰¯æ€§è‚¿ç˜¤&#x27;</span>, <span class="string">&#x27;æ¶æ€§è‚¿ç˜¤&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è¾“å‡ºç»“æœçš„ç²¾ç¡®ç‡å’Œå¬å›è¿˜æœ‰f1å€¼--&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(report)</span><br></pre></td></tr></table></figure><h4 id="ç»“æœæ‰“å°"><a href="#ç»“æœæ‰“å°" class="headerlink" title="ç»“æœæ‰“å°"></a>ç»“æœæ‰“å°</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920140956489.png" alt=" "></p><h1 id="æ·±åº¦å­¦ä¹ "><a href="#æ·±åº¦å­¦ä¹ " class="headerlink" title="æ·±åº¦å­¦ä¹ "></a>æ·±åº¦å­¦ä¹ </h1><h2 id="å…¨è¿æ¥ç¥ç»ç½‘ç»œ-1"><a href="#å…¨è¿æ¥ç¥ç»ç½‘ç»œ-1" class="headerlink" title="å…¨è¿æ¥ç¥ç»ç½‘ç»œ"></a>å…¨è¿æ¥ç¥ç»ç½‘ç»œ</h2><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920142239542.png" alt=" " style="zoom:33%;" /><h3 id="ç»“æ„å•å…ƒ"><a href="#ç»“æ„å•å…ƒ" class="headerlink" title="ç»“æ„å•å…ƒ"></a>ç»“æ„å•å…ƒ</h3><ul><li>ç±»æ¯”æœºå™¨å­¦ä¹ å›å½’æ¨¡å‹</li></ul><blockquote><ol><li>x è¾“å…¥</li><li>b åç½®</li><li>wæƒé‡</li><li>æ±‚å’Œï¼šéšè—å±‚</li><li>æ¿€æ´»å‡½æ•°ï¼šéçº¿æ€§ &#x3D;&#x3D;ï¼ˆå¯¹æ¯”é€»è¾‘å›å½’æ¿€æ´»å‡½æ•°æ˜¯æ±‚å’Œ  é€»è¾‘å›å½’æ¿€æ´»å‡½æ•°æ˜¯sigmoidï¼‰&#x3D;&#x3D;</li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920142542669.png" alt=" " style="zoom:30%;" /> <h4 id="å¯¹æ¯”æœºå™¨å­¦ä¹ æ¿€æ´»å‡½æ•°"><a href="#å¯¹æ¯”æœºå™¨å­¦ä¹ æ¿€æ´»å‡½æ•°" class="headerlink" title="å¯¹æ¯”æœºå™¨å­¦ä¹ æ¿€æ´»å‡½æ•°"></a>å¯¹æ¯”æœºå™¨å­¦ä¹ æ¿€æ´»å‡½æ•°</h4><ul><li><code>å¯¹æ¯”é€»è¾‘å›å½’æ¿€æ´»å‡½æ•°æ˜¯æ±‚å’Œ  é€»è¾‘å›å½’æ¿€æ´»å‡½æ•°æ˜¯sigmoidï¼‰</code></li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920143445569.png" alt=" " style="zoom:30%;" /><h3 id="æ¿€æ´»å‡½æ•°ä½œç”¨"><a href="#æ¿€æ´»å‡½æ•°ä½œç”¨" class="headerlink" title="æ¿€æ´»å‡½æ•°ä½œç”¨"></a>æ¿€æ´»å‡½æ•°ä½œç”¨</h3><ul><li>éçº¿æ€§ï¼š<code>è¿™æ ·æœ€åå°±ä¸ä¼šå¾—åˆ°cçš„ä¸‰æ¬¡æ–¹ä¸ºå¸¸æ•°</code></li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920145410062.png" alt=" " style="zoom:50%;" /><h3 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="æ¿€æ´»å‡½æ•°"></a>æ¿€æ´»å‡½æ•°</h3><blockquote><p>CSDN: æ¿€æ´»å‡½æ•°å›¾åƒå¤§å…¨</p><p><a href="https://blog.csdn.net/hy592070616/article/details/120617490">https://blog.csdn.net/hy592070616/article/details/120617490</a></p></blockquote><h4 id="sigmoidå‡½æ•°"><a href="#sigmoidå‡½æ•°" class="headerlink" title="sigmoidå‡½æ•°"></a>sigmoidå‡½æ•°</h4><ul><li>æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œå€’æ•°å›¾åƒå·¦å³æ¶ˆå¤±å¤ªå¿«  w<code>ç´¯è®¡ä¹˜æ³•åå°æ•°ç´¯æˆ</code> è¶‹è¿‘äº0</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920150050570.png" alt=" " style="zoom:50%;" /><h4 id="Tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰"><a href="#Tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰" class="headerlink" title="Tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰"></a>Tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920151852835.png" alt=" " style="zoom:50%;" /><h5 id="æ•°å­¦çŸ¥è¯†"><a href="#æ•°å­¦çŸ¥è¯†" class="headerlink" title="æ•°å­¦çŸ¥è¯†"></a>æ•°å­¦çŸ¥è¯†</h5><blockquote><p>çŸ¥ä¹ï¼š<a href="https://zhuanlan.zhihu.com/p/563840693">https://zhuanlan.zhihu.com/p/563840693</a></p></blockquote><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/v2-1cdfb54914199e4d75baa6b82adf3809_1440w.png" alt="åŒæ›²æ­£å¼¦ã€åŒæ›²ä½™å¼¦ã€åŒæ›²æ­£åˆ‡åŸºç¡€çŸ¥è¯†æ•´ç†"></p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920151416777.png" alt=" " style="zoom:70%;" /> <h4 id="ReLUå‡½æ•°"><a href="#ReLUå‡½æ•°" class="headerlink" title="ReLUå‡½æ•°"></a>ReLUå‡½æ•°</h4><ul><li>ç¥ç»å…ƒæ­»äº¡ï¼š<code>z&lt;0 å€’æ•°ä¸º0  wåœæ­¢æ›´æ–°</code></li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920152401714.png" alt=" " style="zoom:50%;" /><h4 id="Leaky-ReLU"><a href="#Leaky-ReLU" class="headerlink" title="Leaky ReLU"></a>Leaky ReLU</h4><ul><li>æ²¡æœ‰æœ€å¥½çš„æ¿€æ´»å‡½æ•° åªæœ‰ç¬¦åˆçš„æ¿€æ´»å‡½æ•°</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920152831211.png" alt=" " style="zoom:50%;" /><h4 id="SoftMax"><a href="#SoftMax" class="headerlink" title="SoftMax"></a>SoftMax</h4><ul><li><code>ç”¨äºå¤šåˆ†ç±»ä»»åŠ¡</code></li><li><code>ç”¨äºè¾“å‡ºå±‚</code></li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920153112554.png" alt=" " style="zoom:50%;" /><h3 id="å‰å‘ä¼ æ’­"><a href="#å‰å‘ä¼ æ’­" class="headerlink" title="å‰å‘ä¼ æ’­"></a>å‰å‘ä¼ æ’­</h3><blockquote><ol><li><code>å‰å‘ä¼ æ’­è®¡ç®—</code>  é¢„è®¾wå’Œb æ ¹æ®æ•°æ®é›†è®¡ç®—</li><li><code>è®¡ç®—è¯¯å·®</code>  ç±»æ¯”æŸå¤±å‡½æ•°</li><li><code>è®¡ç®—æ¢¯åº¦</code> æ¢¯åº¦æ›´æ–° æ±‚æŸå¤±å‡½æ•°åå¯¼</li><li><code>åå‘ä¼ æ’­</code> åå‘æ›´æ–°wå’Œb</li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920155006380.png" alt=" " style="zoom:50%;" /><h4 id="å…·ä½“è¿‡ç¨‹"><a href="#å…·ä½“è¿‡ç¨‹" class="headerlink" title="å…·ä½“è¿‡ç¨‹"></a>å…·ä½“è¿‡ç¨‹</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920155736406.png" alt=" " style="zoom:30%;" /><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><ul><li><p>å›¾åƒè§£é‡Šï¼šå‰é¢costå€¼é€æ¸å‡å°ï¼Œwï¼Œbé€æ¸å»åˆï¼Œå‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œç”¨çš„trainè®­ç»ƒé›†</p></li><li><p>åé¢è¶‹è¿‘äº0  å¯èƒ½æ˜¯æµ‹è¯•é›†test</p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920160537963.png" alt=" " style="zoom:50%;" /></li></ul><h3 id="é“¾å¼æ³•åˆ™ï¼ˆæ•°å­¦è¡¥å……ï¼‰"><a href="#é“¾å¼æ³•åˆ™ï¼ˆæ•°å­¦è¡¥å……ï¼‰" class="headerlink" title="é“¾å¼æ³•åˆ™ï¼ˆæ•°å­¦è¡¥å……ï¼‰"></a>é“¾å¼æ³•åˆ™ï¼ˆæ•°å­¦è¡¥å……ï¼‰</h3><h4 id="å•å˜é‡é“¾å¼æ³•åˆ™"><a href="#å•å˜é‡é“¾å¼æ³•åˆ™" class="headerlink" title="å•å˜é‡é“¾å¼æ³•åˆ™"></a>å•å˜é‡é“¾å¼æ³•åˆ™</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920160952252.png" alt=" " style="zoom:50%;" /><h4 id="å¤šå˜é‡é“¾å¼å‘å±•"><a href="#å¤šå˜é‡é“¾å¼å‘å±•" class="headerlink" title="å¤šå˜é‡é“¾å¼å‘å±•"></a>å¤šå˜é‡é“¾å¼å‘å±•</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920161017509.png" alt=" " style="zoom:50%;" /> <h3 id="åå‘ä¼ æ’­"><a href="#åå‘ä¼ æ’­" class="headerlink" title="&#x3D;&#x3D;åå‘ä¼ æ’­&#x3D;&#x3D;"></a>&#x3D;&#x3D;åå‘ä¼ æ’­&#x3D;&#x3D;</h3><h4 id="æ¡ˆä¾‹-2"><a href="#æ¡ˆä¾‹-2" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920164607945.png" alt=" " style="zoom:50%;" /><h4 id="æ±‚è§£å‚æ•°æ¢¯åº¦"><a href="#æ±‚è§£å‚æ•°æ¢¯åº¦" class="headerlink" title="æ±‚è§£å‚æ•°æ¢¯åº¦"></a>æ±‚è§£å‚æ•°æ¢¯åº¦</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920165308026.png" alt=" " style="zoom:50%;" /><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920170603094.png" alt=" " style="zoom:50%;" /><h4 id="åˆ©ç”¨æ¢¯åº¦å‚æ•°æ›´æ–°"><a href="#åˆ©ç”¨æ¢¯åº¦å‚æ•°æ›´æ–°" class="headerlink" title="åˆ©ç”¨æ¢¯åº¦å‚æ•°æ›´æ–°"></a>åˆ©ç”¨æ¢¯åº¦å‚æ•°æ›´æ–°</h4><ul><li>è®¾ç½®å­¦ä¹ ç‡ä¸º0.1</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920170906045.png" alt=" " style="zoom:50%;" /><h4 id="æ–°å‚æ•°å‰å‘ä¼ æ’­"><a href="#æ–°å‚æ•°å‰å‘ä¼ æ’­" class="headerlink" title="æ–°å‚æ•°å‰å‘ä¼ æ’­"></a>æ–°å‚æ•°å‰å‘ä¼ æ’­</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250920171725470.png" alt=" " style="zoom:50%;" /><h3 id="æ¡ˆä¾‹ï¼ˆé¢„æµ‹ä¹³è…ºç™Œ-åˆ†ç±»ï¼‰"><a href="#æ¡ˆä¾‹ï¼ˆé¢„æµ‹ä¹³è…ºç™Œ-åˆ†ç±»ï¼‰" class="headerlink" title="æ¡ˆä¾‹ï¼ˆé¢„æµ‹ä¹³è…ºç™Œ åˆ†ç±»ï¼‰"></a>æ¡ˆä¾‹ï¼ˆé¢„æµ‹ä¹³è…ºç™Œ åˆ†ç±»ï¼‰</h3><blockquote><ul><li>ç”¨å…¨è¿æ¥ç¥ç»ç½‘ç»œé¢„æµ‹ä¹³è…ºç™Œ</li><li>å¯¹æ¯”æœºå™¨å­¦ä¹ </li></ul></blockquote><h4 id="model-train"><a href="#model-train" class="headerlink" title="model_train"></a>model_train</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense  <span class="comment"># ç¨ å¯†å±‚</span></span><br><span class="line"><span class="keyword">from</span> keras.utils.np_utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report  <span class="comment"># éªŒè¯</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.font_manager <span class="keyword">as</span> font_manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜</span></span><br><span class="line"><span class="comment"># font_path = &#x27;../SimHei.ttf&#x27;  # å°†æ­¤è·¯å¾„æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ SimHei å­—ä½“æ–‡ä»¶çš„å®é™…è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšç¬¬äºŒæ­¥å¾—åˆ°çš„é‚£ä¸ªè·¯å¾„</span></span><br><span class="line"><span class="comment"># font_manager.fontManager.addfont(font_path)</span></span><br><span class="line"><span class="comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;]</span></span><br><span class="line"><span class="comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 111111111111111111111111 æ•°æ®é¢„å¤„ç† 1111111111111111111111111111111111111111111111</span></span><br><span class="line"><span class="comment"># åŠ è½½æ•°æ®é›†</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;breast_cancer_data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–ç‰¹å¾å’Œæ ‡ç­¾</span></span><br><span class="line">X = dataset.iloc[:, :-<span class="number">1</span>]</span><br><span class="line">Y = dataset[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›† random_stateéšæœºç§å­å›ºå®š ä¿è¯æ¯æ¬¡æ•°æ®éšæœºä¸€æ ·</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®æ ‡ç­¾è½¬ä¸ºone-hot ç‹¬çƒ­å‘é‡æ ¼å¼</span></span><br><span class="line">y_train_one = to_categorical(y_train, <span class="number">2</span>)  <span class="comment"># 2ä¸ªç±»åˆ«</span></span><br><span class="line">y_test_one = to_categorical(y_test, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># print(y_train_one)  # [1. 0.]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®ç‰¹å¾å½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">x_train = sc.fit_transform(x_train)</span><br><span class="line">x_test = sc.fit_transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 22222222222222222222 ç”¨kerasæ¡†æ¶æ­å»ºæ·±åº¦å­¦ä¹ ç¥ç»ç½‘ç»œæ¨¡å‹ 22222222222222222222222222222222222222222222</span></span><br><span class="line">model = keras.Sequential()</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">2</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç¥ç»ç½‘ç»œè¿›è¡Œç¼–è¯‘ æŸå¤±å‡½æ•°+è¯„ä»·æŒ‡æ ‡</span></span><br><span class="line"><span class="comment">#  categorical_crossentropyï¼šäº¤å‰ç†µ</span></span><br><span class="line"><span class="comment">#  optimizerä¼˜åŒ–å™¨:SGDéšæœºæ¢¯åº¦å‘é‡æ³•</span></span><br><span class="line"><span class="comment">#  metricsï¼šè¯„ä»·æŒ‡æ ‡ å‡†ç¡®ç‡</span></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>, optimizer=<span class="string">&#x27;SGD&#x27;</span>, metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># epochsè½®æ•°</span></span><br><span class="line"><span class="comment"># batch_sizeä¸€æ¬¡å¤šå°‘ä¸ªä¸€èµ· å¹¶è¡Œ</span></span><br><span class="line"><span class="comment"># verbose 2è¡¨ç¤ºæ§åˆ¶å°å¯è§‚å¯Ÿ</span></span><br><span class="line"><span class="comment"># validation_dataéªŒè¯æ•°æ® ç”¨æµ‹è¯•é›†éªŒè¯ æ¡†æ¶ç”¨äºåˆ¤æ–­æ˜¯å¦è¿‡æ‹Ÿåˆ</span></span><br><span class="line">history = model.fit(x_train, y_train_one, epochs=<span class="number">120</span>, batch_size=<span class="number">64</span>, verbose=<span class="number">2</span>, validation_data=(x_test, y_test_one))</span><br><span class="line">model.save(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 333333333333333333333 ç»˜å›¾ 333333333333333333333333333333</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;loss&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>) <span class="comment"># è®­ç»ƒé›†losså€¼</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_loss&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>) <span class="comment"># éªŒè¯é›†losså€¼</span></span><br><span class="line">plt.title(<span class="string">&quot;å…¨è¿æ¥ç¥ç»ç½‘ç»œlosså€¼å›¾&quot;</span>)</span><br><span class="line">plt.legend() <span class="comment"># å›¾ä¾‹</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜åˆ¶è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„å‡†ç¡®ç‡å¯¹æ¯”å›¾</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;accuracy&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>) <span class="comment"># è®­ç»ƒé›†å‡†ç¡®ç‡</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_accuracy&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>) <span class="comment"># éªŒè¯é›†å‡†ç¡®ç‡</span></span><br><span class="line">plt.title(<span class="string">&quot;å…¨è¿æ¥ç¥ç»ç½‘ç»œaccuracyå€¼å›¾&quot;</span>)</span><br><span class="line">plt.legend() <span class="comment"># å›¾ä¾‹</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="model-test"><a href="#model-test" class="headerlink" title="model_test"></a>model_test</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cProfile <span class="keyword">import</span> label</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense  <span class="comment"># ç¨ å¯†å±‚</span></span><br><span class="line"><span class="keyword">from</span> keras.utils.np_utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report  <span class="comment"># éªŒè¯</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.font_manager <span class="keyword">as</span> font_manager</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"></span><br><span class="line"><span class="comment"># 111111111111111111111111 æ•°æ®é¢„å¤„ç† 1111111111111111111111111111111111111111111111</span></span><br><span class="line"><span class="comment"># åŠ è½½æ•°æ®é›†</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;breast_cancer_data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–ç‰¹å¾å’Œæ ‡ç­¾</span></span><br><span class="line">X = dataset.iloc[:, :-<span class="number">1</span>]</span><br><span class="line">Y = dataset[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›† random_stateéšæœºç§å­å›ºå®š ä¿è¯æ¯æ¬¡æ•°æ®éšæœºä¸€æ ·</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®æ ‡ç­¾è½¬ä¸ºone-hot ç‹¬çƒ­å‘é‡æ ¼å¼</span></span><br><span class="line">y_test_one = to_categorical(y_test, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># print(y_train_one)  # [1. 0.]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®ç‰¹å¾å½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">x_test = sc.fit_transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥æ¨¡å‹</span></span><br><span class="line">model = load_model(<span class="string">&quot;model.h5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">predict = model.predict(x_test)</span><br><span class="line"><span class="comment"># print(predict)</span></span><br><span class="line"></span><br><span class="line">y_pred = np.argmax(predict, axis=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(y_pred)  <span class="comment"># [0,1,0]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬ä¸ºæ±‰å­—</span></span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y_pred)):</span><br><span class="line">    <span class="keyword">if</span> y_pred[i] == <span class="number">0</span>:</span><br><span class="line">        result.append(<span class="string">&quot;è‰¯æ€§&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result.append(<span class="string">&quot;æ¶æ€§&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æ¨¡å‹ç²¾ç¡®åˆ° å¬å›ç‡</span></span><br><span class="line">report = classification_report(y_test, y_pred, labels=[<span class="number">0</span>, <span class="number">1</span>], target_names=[<span class="string">&quot;è‰¯æ€§&quot;</span>, <span class="string">&quot;æ¶æ€§&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(report)</span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°å›¾åƒ"><a href="#å‡½æ•°å›¾åƒ" class="headerlink" title="å‡½æ•°å›¾åƒ"></a>å‡½æ•°å›¾åƒ</h4><h5 id="loss"><a href="#loss" class="headerlink" title="loss"></a>loss</h5><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/plot_2025-09-21%2016-31-23_0.png" alt="plot_2025-09-21 16-31-23_0"></p><h5 id="accuracy"><a href="#accuracy" class="headerlink" title="accuracy"></a>accuracy</h5><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/plot_2025-09-21%2016-31-23_1.png" alt="plot_2025-09-21 16-31-23_1"></p><h4 id="é¢„æµ‹æŠ¥å‘Š"><a href="#é¢„æµ‹æŠ¥å‘Š" class="headerlink" title="é¢„æµ‹æŠ¥å‘Š"></a>é¢„æµ‹æŠ¥å‘Š</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250921165430933.png" alt="image-20250921165430933"></p><h3 id="æ¡ˆä¾‹ï¼ˆç©ºæ°”è´¨é‡-çº¿æ€§å›å½’ï¼‰"><a href="#æ¡ˆä¾‹ï¼ˆç©ºæ°”è´¨é‡-çº¿æ€§å›å½’ï¼‰" class="headerlink" title="æ¡ˆä¾‹ï¼ˆç©ºæ°”è´¨é‡ çº¿æ€§å›å½’ï¼‰"></a>æ¡ˆä¾‹ï¼ˆç©ºæ°”è´¨é‡ çº¿æ€§å›å½’ï¼‰</h3><h4 id="model-train-1"><a href="#model-train-1" class="headerlink" title="model_train"></a>model_train</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense  <span class="comment"># ç¨ å¯†å±‚</span></span><br><span class="line"><span class="keyword">from</span> keras.utils.np_utils <span class="keyword">import</span> to_categorical</span><br><span class="line"></span><br><span class="line"><span class="comment">#  11111111111111111111111111 æ•°æ®å¤„ç† 1111111111111111111111</span></span><br><span class="line"><span class="comment"># å¯¼å…¥æ•°æ®</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®å½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">scaled = sc.fit_transform(dataset)  <span class="comment"># æ•°åˆ—å½¢å¼ æ²¡æœ‰åˆ—å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½’ä¸€åŒ–æ•°æ®è½¬ä¸ºdataframeæ ¼å¼ï¼Œæ–¹ä¾¿åç»­å¤„ç†</span></span><br><span class="line">dataset_sc = pd.DataFrame(scaled)  <span class="comment"># æœ‰ç±»å åŒdataset</span></span><br><span class="line"><span class="built_in">print</span>(dataset_sc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾å‡ºç‰¹å¾å€¼å’Œæ ‡ç­¾</span></span><br><span class="line">X = dataset_sc.iloc[:, :-<span class="number">1</span>]  <span class="comment"># æ‰€æœ‰è¡Œé™¤äº†æœ€åä¸€åˆ—</span></span><br><span class="line">Y = dataset_sc.iloc[:, -<span class="number">1</span>]  <span class="comment"># æ‰€æœ‰è¡Œ æœ€åä¸€åˆ—</span></span><br><span class="line"></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 22222222222222222222222 åˆ©ç”¨kerasæ¨¡å‹æ­å»º 2222222222222222222222222222222222</span></span><br><span class="line">model = keras.Sequential()</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>))  <span class="comment"># è¾“å‡ºå±‚ ä¸è¦æ¿€æ´»å‡½æ•° ä½†è¦åå½’ä¸€åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç¥ç»ç½‘ç»œè¿›è¡Œç¼–è¯‘</span></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;mse&#x27;</span>, optimizer=<span class="string">&#x27;SGD&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹è®­ç»ƒ</span></span><br><span class="line">history = model.fit(x_train, y_train, epochs=<span class="number">100</span>, batch_size=<span class="number">32</span>, verbose=<span class="number">2</span>, validation_data=(x_test, y_test))</span><br><span class="line">model.save(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 333333333333333333 å¯è§†åŒ– 3333333333333333</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;loss&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_loss&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;å…¨è¿æ¥ç¥ç»ç½‘ç»œlosså€¼å›¾&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="model-test-1"><a href="#model-test-1" class="headerlink" title="model_test"></a>model_test</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> scipy.ndimage <span class="keyword">import</span> label</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense  <span class="comment"># ç¨ å¯†å±‚</span></span><br><span class="line"><span class="keyword">from</span> keras.utils.np_utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> concatenate</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"></span><br><span class="line"><span class="comment">#  11111111111111111111111111 æ•°æ®å¤„ç† 1111111111111111111111</span></span><br><span class="line"><span class="comment"># å¯¼å…¥æ•°æ®</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®å½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">scaled = sc.fit_transform(dataset)  <span class="comment"># æ•°åˆ—å½¢å¼ æ²¡æœ‰åˆ—å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½’ä¸€åŒ–æ•°æ®è½¬ä¸ºdataframeæ ¼å¼ï¼Œæ–¹ä¾¿åç»­å¤„ç†</span></span><br><span class="line">dataset_sc = pd.DataFrame(scaled)  <span class="comment"># æœ‰ç±»å åŒdataset</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾å‡ºç‰¹å¾å€¼å’Œæ ‡ç­¾</span></span><br><span class="line">X = dataset_sc.iloc[:, :-<span class="number">1</span>]  <span class="comment"># æ‰€æœ‰è¡Œé™¤äº†æœ€åä¸€åˆ—</span></span><br><span class="line">Y = dataset_sc.iloc[:, -<span class="number">1</span>]  <span class="comment"># æ‰€æœ‰è¡Œ æœ€åä¸€åˆ—</span></span><br><span class="line"></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.05</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2222222222222 åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹ 222222222222222222</span></span><br><span class="line">model = load_model(<span class="string">&quot;model.h5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¢„æµ‹</span></span><br><span class="line">yhat = model.predict(x_test)</span><br><span class="line"><span class="comment"># print(yhat) # [0.1681547 ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¢„æµ‹å€¼åå½’ä¸€åŒ–</span></span><br><span class="line">inv_yhat = concatenate((x_test, yhat), axis=<span class="number">1</span>) <span class="comment"># è¿æ¥ä¸¤ä¸ªNumpyæ•°æ®</span></span><br><span class="line"><span class="comment"># print(inv_yhat) # å½’ä¸€æ•°æ® [0.05119454 0.09076175 0.06796117 ... 0.14107884 0.56149733 0.13507885]</span></span><br><span class="line">inv_yhat = sc.inverse_transform(inv_yhat) <span class="comment"># åå½’ä¸€åŒ–</span></span><br><span class="line"><span class="comment"># print(inv_yhat)  [ 12.          24.           5.         ...   1.57         7.</span></span><br><span class="line"><span class="comment">#    82.83994955]</span></span><br><span class="line">prediction = inv_yhat[:, <span class="number">6</span>]</span><br><span class="line"><span class="comment"># print(prediction)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†y_testç»´åº¦è½¬æ¢ äºŒç»´</span></span><br><span class="line"><span class="comment"># 2396    0.117073</span></span><br><span class="line"><span class="comment"># 1407    0.146341</span></span><br><span class="line">y_test = np.array(y_test) <span class="comment"># [0.11707317 0.14634146]</span></span><br><span class="line">y_test = np.reshape(y_test, (y_test.shape[<span class="number">0</span>], <span class="number">1</span>)) <span class="comment"># [[0.11707317 0.14634146]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åå‘ç¼©æ”¾çœŸå®å€¼</span></span><br><span class="line"><span class="comment"># print(x_test) # 2396  0.051195  0.090762  0.067961  0.172414  0.141079  0.561497</span></span><br><span class="line">inv_y = concatenate((x_test, y_test), axis=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(inv_y)</span><br><span class="line">inv_y = sc.inverse_transform(inv_y)</span><br><span class="line">real = inv_y[:, <span class="number">6</span>]</span><br><span class="line"><span class="built_in">print</span>(real)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 333333333333333 è¯„ä»· 333333333333333333</span></span><br><span class="line"><span class="comment"># è®¡ç®—rmseå’ŒMAPE</span></span><br><span class="line">remse = sqrt(mean_squared_error(real, prediction))</span><br><span class="line">mape = np.mean(np.<span class="built_in">abs</span>(real - prediction) / real)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;remse&quot;</span>, remse)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;mape&quot;</span>, mape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”»å‡ºçœŸå®å€¼å’Œé¢„æµ‹å€¼å¯¹æ¯”å›¾</span></span><br><span class="line">plt.plot(prediction, label=<span class="string">&quot;é¢„æµ‹å€¼&quot;</span>)</span><br><span class="line">plt.plot(real, label=<span class="string">&quot;çœŸå®å€¼&quot;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;å…¨è¿æ¥ç¥ç»ç½‘ç»œç©ºæ°”è´¨é‡é¢„æµ‹å¯¹æ¯”å›¾&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="losså›¾åƒ"><a href="#losså›¾åƒ" class="headerlink" title="losså›¾åƒ"></a>losså›¾åƒ</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/loss.png" alt="loss"></p><h4 id="çœŸå®å€¼é¢„æµ‹å€¼å¯¹æ¯”å›¾"><a href="#çœŸå®å€¼é¢„æµ‹å€¼å¯¹æ¯”å›¾" class="headerlink" title="çœŸå®å€¼é¢„æµ‹å€¼å¯¹æ¯”å›¾"></a>çœŸå®å€¼é¢„æµ‹å€¼å¯¹æ¯”å›¾</h4><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/%E5%AF%B9%E6%AF%94%E5%9B%BE.png" alt="å¯¹æ¯”å›¾"></p><h2 id="å·ç§¯ç¥ç»ç½‘ç»œCNN"><a href="#å·ç§¯ç¥ç»ç½‘ç»œCNN" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œCNN"></a>å·ç§¯ç¥ç»ç½‘ç»œCNN</h2><h3 id="è®¡ç®—æœºå›¾ç‰‡æœ¬è´¨ï¼ˆå¼•å…¥ï¼‰"><a href="#è®¡ç®—æœºå›¾ç‰‡æœ¬è´¨ï¼ˆå¼•å…¥ï¼‰" class="headerlink" title="è®¡ç®—æœºå›¾ç‰‡æœ¬è´¨ï¼ˆå¼•å…¥ï¼‰"></a>è®¡ç®—æœºå›¾ç‰‡æœ¬è´¨ï¼ˆå¼•å…¥ï¼‰</h3><p><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922170116085.png" alt="image-20250922170116085"></p><h3 id="æ•´ä½“ç»“æ„"><a href="#æ•´ä½“ç»“æ„" class="headerlink" title="æ•´ä½“ç»“æ„"></a>æ•´ä½“ç»“æ„</h3><blockquote><ul><li>å·ç§¯å±‚ï¼šå¯ä»¥æ”¹å˜å±‚æ•°</li><li>æ± åŒ–å±‚ï¼šå¯ä»¥æ”¹å˜é«˜åº¦</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922172523151.png" alt=" " style="zoom:40%;" /> <h3 id="å·ç§¯è¿ç®—å’Œæƒé‡å…±äº«"><a href="#å·ç§¯è¿ç®—å’Œæƒé‡å…±äº«" class="headerlink" title="å·ç§¯è¿ç®—å’Œæƒé‡å…±äº«"></a>å·ç§¯è¿ç®—å’Œæƒé‡å…±äº«</h3><blockquote><ul><li>å¯¹åº”ä½ç½®ç›¸ä¹˜<ul><li>å¦‚ç¬¬ä¸€è¡Œï¼š<code>0*0 + 1 * 1+ 3*2+3*4</code></li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922173835328.png" alt=" " style="zoom:50%;" /><blockquote><ul><li>åŠ å…¥åç½®</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922174019684.png" style="zoom:50%;" /><blockquote><ul><li>&#x3D;&#x3D;æƒé‡å…±äº«&#x3D;&#x3D;<ul><li>çŸ©é˜µä¸­çš„æ•°å­—æœ‰é‡å wçš„æƒ…å†µ</li><li>ä¹ä¸ªæ•°æ®åœ¨å…¨è¿æ¥ç¥ç»ç½‘ç»œæœ‰36ä¸ªwï¼Œåœ¨å·ç§¯ç¥ç»ç½‘ç»œæœ‰4ä¸ªwï¼Œæœ‰æ•ˆè§£å†³è¿‡æ‹Ÿåˆé—®é¢˜</li><li>åœ¨å¾ªç¯ç¥ç»ç½‘ç»œRNNä¹Ÿè®¾è®¡æƒé‡å…±äº«</li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922174541569.png" alt=" " style="zoom:50%;" /><h3 id="å¡«å……è¿ç®—å’Œæ­¥å¹…è¿ç®—"><a href="#å¡«å……è¿ç®—å’Œæ­¥å¹…è¿ç®—" class="headerlink" title="å¡«å……è¿ç®—å’Œæ­¥å¹…è¿ç®—"></a>å¡«å……è¿ç®—å’Œæ­¥å¹…è¿ç®—</h3><blockquote><ol><li>å¡«å……è¿ç®—<ol><li>åŸæœ¬çŸ©é˜µ<code>3*3</code></li><li>åœ¨å¤–é¢ä¸€å±‚æ‰©å……0åƒç´  <code>5*5</code></li><li>å¯¹ <code>5*5</code> åƒç´ åšä¹˜æ³•å¾—åˆ° <code>4*4</code></li></ol></li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922175013311.png" alt=" " style="zoom:50%;" /><blockquote><ol start="2"><li>æ­¥å¹…<ol><li>ä¸Šé¢çš„è®¡ç®—é»˜è®¤æ­¥å¹…ä¸º1</li><li>å¯ä»¥è°ƒæ•´æ­¥å¹…ï¼Œå¦‚æ­¤æ—¶è°ƒæ•´ä¸º2</li><li><code>4*4</code> * <code>2*2</code> å¾—åˆ° <code>2*2</code> ï¼ˆæ­¥å¹…ä¸º2ï¼‰</li></ol></li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922175424667.png" alt=" " style="zoom:50%;" /><blockquote><ol start="3"><li>å…¬å¼<ol><li>H é«˜</li><li>P å¡«å……é«˜åº¦</li><li>FH æ ¸çš„é«˜åº¦</li><li>S æ­¥å¹…</li><li>OH è¾“å‡ºé«˜åº¦</li><li>OW è¾“å‡ºå®½åº¦</li></ol></li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922180917621.png" alt=" " style="zoom:33%;" /><h3 id="å¤šé€šé“å·ç§¯è¿ç®—"><a href="#å¤šé€šé“å·ç§¯è¿ç®—" class="headerlink" title="å¤šé€šé“å·ç§¯è¿ç®—"></a>å¤šé€šé“å·ç§¯è¿ç®—</h3><blockquote><ul><li>å¯¹åº”çš„å·ç§¯ç›¸ä¹˜</li><li>å†ç›¸åŠ </li><li>é€šé“æ•°ï¼ˆç‰¹å¾å›¾æ•°é‡ï¼‰ç›¸åŒæ‰èƒ½ç›¸ä¹˜</li><li>æœ€åå¾—åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€å¼ ç‰¹å¾å›¾<ul><li>è‹¥è¦å¾—åˆ°nå¼ ç‰¹å¾å›¾  éœ€è¦nä»½æ ¸å›¾</li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922182358303.png" alt=" " style="zoom:50%;" /><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922182328011.png" alt=" " style="zoom:50%;" /><h3 id="æ± åŒ–è¿ç®—"><a href="#æ± åŒ–è¿ç®—" class="headerlink" title="æ± åŒ–è¿ç®—"></a>æ± åŒ–è¿ç®—</h3><h4 id="æœ€å¤§æ± åŒ–"><a href="#æœ€å¤§æ± åŒ–" class="headerlink" title="æœ€å¤§æ± åŒ–"></a>æœ€å¤§æ± åŒ–</h4><ul><li>æœ¬è´¨ï¼š åœ¨æ¯ç»„ä¸­å–ç‰¹æ®Šå€¼</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922200351328.png" alt=" " style="zoom:50%;" /><h4 id="å¹³å‡æ± åŒ–"><a href="#å¹³å‡æ± åŒ–" class="headerlink" title="å¹³å‡æ± åŒ–"></a>å¹³å‡æ± åŒ–</h4><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œæœ€å¤§æ± åŒ–æ¯”å¹³å‡æ± åŒ–ç”¨çš„å¤š</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922200459310.png" alt=" " style="zoom:50%;" /><h4 id="æ± åŒ–å…¬å¼"><a href="#æ± åŒ–å…¬å¼" class="headerlink" title="æ± åŒ–å…¬å¼"></a>æ± åŒ–å…¬å¼</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250922200951800.png" alt=" " style="zoom:50%;" /><h3 id="å®æˆ˜ï¼ˆLENETï¼‰-ç›®æ ‡ç¼ºé™·æ£€æµ‹"><a href="#å®æˆ˜ï¼ˆLENETï¼‰-ç›®æ ‡ç¼ºé™·æ£€æµ‹" class="headerlink" title="å®æˆ˜ï¼ˆLENETï¼‰ ç›®æ ‡ç¼ºé™·æ£€æµ‹"></a>å®æˆ˜ï¼ˆLENETï¼‰ ç›®æ ‡ç¼ºé™·æ£€æµ‹</h3><blockquote><ol><li><code>maps6@28x28</code>  6ä¸ªç‰¹å¾å›¾  æ¯å¼ å›¾28*28</li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/9905efc25e3b7d98c23e56bee4930730.png" alt=" " style="zoom:50%;" /><h4 id="model-train-2"><a href="#model-train-2" class="headerlink" title="model_train"></a>model_train</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Dense, Flatten, Conv2D, MaxPool2D</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–è®­ç»ƒé›†æ•°æ®</span></span><br><span class="line">data_train = <span class="string">&#x27;./data/train/&#x27;</span></span><br><span class="line">data_train = pathlib.Path(data_train)</span><br><span class="line"></span><br><span class="line">data_val = <span class="string">&#x27;./data/val/&#x27;</span></span><br><span class="line">data_val = pathlib.Path(data_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™å‡ºå±€ç±»åˆ«æ”¾ç½®åˆ°åˆ—è¡¨æ•°æ®ä¸­</span></span><br><span class="line">CLASS_NAMES = np.array([<span class="string">&#x27;Cr&#x27;</span>, <span class="string">&#x27;In&#x27;</span>, <span class="string">&#x27;Pa&#x27;</span>, <span class="string">&#x27;PS&#x27;</span>, <span class="string">&#x27;Rs&#x27;</span>, <span class="string">&#x27;Sc&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å›¾ç‰‡å¤§å°å’Œæ‰¹æ¬¡æ•°</span></span><br><span class="line">BATCH_SIZE = <span class="number">64</span>  <span class="comment"># æ¯æ¬¡è®­ç»ƒä¸€æ‰¹æ•°æ®é‡</span></span><br><span class="line"><span class="comment"># ä¸€å¼ å›¾ç‰‡å¤§å°</span></span><br><span class="line">IMG_HEIGHT = <span class="number">32</span></span><br><span class="line">IMG_WIDTH = <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†</span></span><br><span class="line">image_generator = keras.preprocessing.image.ImageDataGenerator(rescale=<span class="number">1.0</span> / <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒé›†ç”Ÿæˆå™¨ ç”Ÿæˆä¸€æ‰¹æ•°æ®</span></span><br><span class="line">train_data_gen = image_generator.flow_from_directory(directory=<span class="built_in">str</span>(data_train),</span><br><span class="line">                                                     batch_size=BATCH_SIZE,</span><br><span class="line">                                                     shuffle=<span class="literal">True</span>,</span><br><span class="line">                                                     target_size=(IMG_HEIGHT, IMG_WIDTH),  <span class="comment"># å‹ç¼©</span></span><br><span class="line">                                                     classes=<span class="built_in">list</span>(CLASS_NAMES)</span><br><span class="line">                                                     )</span><br><span class="line"><span class="comment"># éªŒè¯é›†ç”Ÿæˆå™¨</span></span><br><span class="line">val_data_gen = image_generator.flow_from_directory(directory=<span class="built_in">str</span>(data_val),</span><br><span class="line">                                                   batch_size=BATCH_SIZE,</span><br><span class="line">                                                   shuffle=<span class="literal">True</span>,</span><br><span class="line">                                                   target_size=(IMG_HEIGHT, IMG_WIDTH),</span><br><span class="line">                                                   classes=<span class="built_in">list</span>(CLASS_NAMES)</span><br><span class="line">                                                   )</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨kerasæ­å»ºå·ç§¯ç¥ç»ç½‘ç»œ</span></span><br><span class="line">model = keras.Sequential()</span><br><span class="line">model.add(Conv2D(filters=<span class="number">6</span>, kernel_size=<span class="number">5</span>, input_shape=(<span class="number">32</span>, <span class="number">32</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))  <span class="comment"># å·ç§¯</span></span><br><span class="line">model.add(MaxPool2D(pool_size=(<span class="number">2</span>, <span class="number">2</span>), strides=(<span class="number">2</span>, <span class="number">2</span>)))  <span class="comment"># æ± åŒ–</span></span><br><span class="line">model.add(Conv2D(filters=<span class="number">16</span>, kernel_size=<span class="number">5</span>, activation=<span class="string">&#x27;relu&#x27;</span>))  <span class="comment"># å·ç§¯</span></span><br><span class="line">model.add(MaxPool2D(pool_size=(<span class="number">2</span>, <span class="number">2</span>), strides=(<span class="number">2</span>, <span class="number">2</span>)))  <span class="comment"># æ± åŒ–</span></span><br><span class="line">model.add(Conv2D(filters=<span class="number">120</span>, kernel_size=<span class="number">5</span>, activation=<span class="string">&#x27;relu&#x27;</span>))  <span class="comment"># å·ç§¯</span></span><br><span class="line">model.add(Flatten())  <span class="comment"># å¹³å±•æ›¾</span></span><br><span class="line">model.add(Dense(<span class="number">84</span>, activation=<span class="string">&#x27;relu&#x27;</span>))  <span class="comment"># å…¨è¿æ¥å±‚</span></span><br><span class="line">model.add(Dense(<span class="number">6</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))  <span class="comment"># è¾“å‡ºå±‚ 6åˆ†ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘å·ç§¯ç¥ç»ç½‘ç»œ</span></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, optimizer=<span class="string">&#x27;Adam&#x27;</span>, metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ å…¥æ•°æ®é›†è¿›è¡Œè®­ç»ƒ</span></span><br><span class="line">history = model.fit(train_data_gen, validation_data=val_data_gen, epochs=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹</span></span><br><span class="line">model.save(<span class="string">&quot;model.h5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜åˆ¶losså›¾</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;loss&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_loss&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;CNNç¥ç»ç½‘ç»œlosså€¼&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜åˆ¶å‡†ç¡®ç‡</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;accuracy&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_accuracy&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;CNNç¥ç»ç½‘ç»œaccuracyå€¼&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="model-test-2"><a href="#model-test-2" class="headerlink" title="model_test"></a>model_test</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™æ•°æ®ç±»åˆ«æ”¾ç½®åˆ°åˆ—è¡¨æ•°æ®ä¸­</span></span><br><span class="line">CLASS_NAMES = np.array([<span class="string">&#x27;Cr&#x27;</span>, <span class="string">&#x27;In&#x27;</span>, <span class="string">&#x27;Pa&#x27;</span>, <span class="string">&#x27;PS&#x27;</span>, <span class="string">&#x27;Rs&#x27;</span>, <span class="string">&#x27;Sc&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å›¾ç‰‡å¤§å°</span></span><br><span class="line">IMG_HEIGHT = <span class="number">32</span></span><br><span class="line">IM_WIDTH = <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½æ¨¡å‹</span></span><br><span class="line">model = load_model(<span class="string">&quot;model.h5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®è¯»å–ä¸é¢„å¤„ç†</span></span><br><span class="line">src = cv2.imread(<span class="string">&quot;data/val/Cr/Cr_48.bmp&quot;</span>) <span class="comment"># æŒ‘å–ä¸€å¼ å›¾ç‰‡</span></span><br><span class="line">src = cv2.resize(src, (<span class="number">32</span>, <span class="number">32</span>)) <span class="comment"># å‹ç¼©å›¾ç‰‡32*32</span></span><br><span class="line">src = src.astype(<span class="string">&quot;int32&quot;</span>) <span class="comment"># è½¬ä¸ºintå‹</span></span><br><span class="line">src = src / <span class="number">255</span> <span class="comment"># å½’ä¸€åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰©å……æ•°æ®çš„ç»´åº¦</span></span><br><span class="line">test_img = tf.expand_dims(src, <span class="number">0</span>)</span><br><span class="line"><span class="comment"># print(test_img.shape)</span></span><br><span class="line"></span><br><span class="line">preds = model.predict(test_img)</span><br><span class="line"><span class="comment"># print(preds)</span></span><br><span class="line">score = preds[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># print(score)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;æ¨¡å‹é¢„æµ‹çš„ç»“æœä¸º&#123;&#125;ï¼Œ æ¦‚ç‡ä¸º&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(CLASS_NAMES[np.argmax(score)], np.<span class="built_in">max</span>(score)))</span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œ"></a>å¾ªç¯ç¥ç»ç½‘ç»œ</h2><h3 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h3><h4 id="RNNåŸºæœ¬ç»“æ„"><a href="#RNNåŸºæœ¬ç»“æ„" class="headerlink" title="RNNåŸºæœ¬ç»“æ„"></a>RNNåŸºæœ¬ç»“æ„</h4><blockquote><ol><li>h0ä¸ä»…ä½œä¸ºç¬¬ä¸€ä¸ªéšè—å±‚è¾“å‡º ä¹Ÿä½œä¸ºç¬¬äºŒä¸ªéšè—å±‚è¾“å…¥</li><li>å…ˆè®¡ç®—t0æ—¶åˆ»ï¼Œæ¥ç€t1ã€‚æœ‰å…ˆåé¡ºåº<ol><li>CNNåˆ™æ˜¯åŒæ—¶è¾“å…¥ åªæœ‰ç©ºé—´ç»´åº¦</li><li>RNNåŠ å…¥æ—¶é—´ç»´åº¦ï¼Œå—ä¹‹å‰æ•°æ®å½±å“</li></ol></li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923165209952.png" alt=" " style="zoom:50%;" /> <h4 id="RNNå’Œå…¨è¿æ¥ç¥ç»ç½‘ç»œåŒºåˆ«"><a href="#RNNå’Œå…¨è¿æ¥ç¥ç»ç½‘ç»œåŒºåˆ«" class="headerlink" title="RNNå’Œå…¨è¿æ¥ç¥ç»ç½‘ç»œåŒºåˆ«"></a>RNNå’Œå…¨è¿æ¥ç¥ç»ç½‘ç»œåŒºåˆ«</h4><blockquote><ol><li>å»æ‰Wå’Œå…¨è¿æ¥ç¥ç»ç½‘ç»œä¸€æ ·</li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923165756247.png" alt=" " style="zoom:50%;" /><h5 id="å…¨è¿æ¥å±•å¼€"><a href="#å…¨è¿æ¥å±•å¼€" class="headerlink" title="å…¨è¿æ¥å±•å¼€"></a>å…¨è¿æ¥å±•å¼€</h5><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923172607753.png" alt=" " style="zoom:50%;" /><h5 id="RNNå±•å¼€"><a href="#RNNå±•å¼€" class="headerlink" title="RNNå±•å¼€"></a>RNNå±•å¼€</h5><blockquote><ul><li>å‰ä¸€ä¸ªæ—¶åˆ»h<em>w + åé¢æ—¶åˆ»</em>hU</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923173120333.png" alt=" " style="zoom:50%;" /><h4 id="æ•°å­¦æ¨¡å‹åŠæƒé‡å…±äº«"><a href="#æ•°å­¦æ¨¡å‹åŠæƒé‡å…±äº«" class="headerlink" title="æ•°å­¦æ¨¡å‹åŠæƒé‡å…±äº«"></a>æ•°å­¦æ¨¡å‹åŠæƒé‡å…±äº«</h4><blockquote><ul><li>æ¯ä¸ªæ—¶åˆ»å¯¹åº”çš„æƒé‡wå’Œvç›¸åŒ</li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923190611609.png" alt=" " style="zoom:50%;" /><h4 id="å‰å‘ä¼ æ’­æ¡ˆä¾‹"><a href="#å‰å‘ä¼ æ’­æ¡ˆä¾‹" class="headerlink" title="å‰å‘ä¼ æ’­æ¡ˆä¾‹"></a>å‰å‘ä¼ æ’­æ¡ˆä¾‹</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923191156932.png" alt=" " style="zoom:50%;" /><h5 id="ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥"><a href="#ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥" class="headerlink" title="ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥"></a>ç¬¬ä¸€ä¸ªæ—¶é—´æ­¥</h5><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923191512980.png" alt=" " style="zoom:50%;" /><h5 id="ç¬¬äºŒä¸ªæ—¶é—´æ­¥"><a href="#ç¬¬äºŒä¸ªæ—¶é—´æ­¥" class="headerlink" title="ç¬¬äºŒä¸ªæ—¶é—´æ­¥"></a>ç¬¬äºŒä¸ªæ—¶é—´æ­¥</h5><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923191643933.png" alt=" " style="zoom:50%;" /><h4 id="åå‘ä¼ æ’­-1"><a href="#åå‘ä¼ æ’­-1" class="headerlink" title="åå‘ä¼ æ’­"></a>åå‘ä¼ æ’­</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923193333045.png" alt=" " style="zoom:50%;" /><h4 id="æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸"><a href="#æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸"></a>æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸</h4><h5 id="å…¬å¼-1"><a href="#å…¬å¼-1" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h5><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923193733331.png" alt=" " style="zoom:50%;" /><h5 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h5><blockquote><ol><li>å‡è®¾è¿™é‡Œä½¿ç”¨sigmoidå‡½æ•°</li><li>æ±‚å¯¼åä¸º <code>f*ï¼ˆ1-fï¼‰</code></li><li>f&#x3D;0.5 æœ‰æœ€å¤§å€¼1&#x2F;4</li><li>wå…±äº«ï¼š<ol><li>æ‰€ä»¥å½“w&lt;4 ç¬¬ä¸€ä¸ªhå€’æ•°å°äº1 ç´¯æˆ æ¢¯åº¦æ¶ˆå¤± ï¼ˆå¾ˆéš¾å­¦åˆ°å‰é¢å¾ˆé•¿æ—¶é—´çš„æƒé‡ LSTMæœ‰ç¼“è§£ï¼‰</li><li>æ‰€ä»¥å½“w&gt;4 ç¬¬ä¸€ä¸ªhå€’æ•°å¤§äº1 ç´¯æˆ æ¢¯åº¦çˆ†ç‚¸ğŸ’¥</li></ol></li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250919123351303.png" alt=" " style="zoom:43%;" /><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250923195005459.png" alt=" " style="zoom:50%;" /><h3 id="LSTM"><a href="#LSTM" class="headerlink" title="&#x3D;&#x3D;LSTM&#x3D;&#x3D;"></a>&#x3D;&#x3D;LSTM&#x3D;&#x3D;</h3><h4 id="å’ŒRNNå¯¹æ¯”"><a href="#å’ŒRNNå¯¹æ¯”" class="headerlink" title="å’ŒRNNå¯¹æ¯”"></a>å’ŒRNNå¯¹æ¯”</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924122924298.png" alt=" " style="zoom:50%;" /><h4 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924123306506.png" alt=" " style="zoom:50%;" /><h4 id="åŸºæœ¬è¿ç®—"><a href="#åŸºæœ¬è¿ç®—" class="headerlink" title="åŸºæœ¬è¿ç®—"></a>åŸºæœ¬è¿ç®—</h4><blockquote><ol><li>é»„è‰²æ–¹æ¡†éƒ½æ˜¯æ¿€æ´»å‡½æ•°<ol><li>æœ‰sigmoidå’ŒtanhååŒæ›²æ­£åˆ‡</li></ol></li></ol></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924123950455.png" alt=" " style="zoom:50%;" /><h4 id="é—å¿˜é—¨"><a href="#é—å¿˜é—¨" class="headerlink" title="é—å¿˜é—¨"></a>é—å¿˜é—¨</h4><blockquote><ul><li>ä½œç”¨ï¼šä¿å­˜æœ‰ç”¨ä¿¡æ¯ï¼Œæ‘’å¼ƒæ²¡ç”¨çš„ä¿¡æ¯<ul><li>ç”¨ <code>sigmoid</code> å‡½æ•°å°†å€¼åŸŸæ˜ å°„åœ¨0~1</li><li><code>Wf</code> æ˜¯æƒé‡</li></ul></li></ul></blockquote><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924124822056.png" alt=" " style="zoom:50%;" /><h4 id="è¾“å…¥é—¨"><a href="#è¾“å…¥é—¨" class="headerlink" title="è¾“å…¥é—¨"></a>è¾“å…¥é—¨</h4><h5 id="ç»“æ„-1"><a href="#ç»“æ„-1" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h5><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924125546079.png" alt=" " style="zoom:50%;" /><h5 id="ç»†èƒçŠ¶æ€æ›´æ–°"><a href="#ç»†èƒçŠ¶æ€æ›´æ–°" class="headerlink" title="ç»†èƒçŠ¶æ€æ›´æ–°"></a>ç»†èƒçŠ¶æ€æ›´æ–°</h5><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924130733645.png" alt=" " style="zoom:50%;" /><h4 id="è¾“å‡ºé—¨"><a href="#è¾“å‡ºé—¨" class="headerlink" title="è¾“å‡ºé—¨"></a>è¾“å‡ºé—¨</h4><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924132743321.png" alt=" " style="zoom:50%;" /><h4 id="å¦‚ä½•ç¼“è§£æ¢¯åº¦æ¶ˆå¤±"><a href="#å¦‚ä½•ç¼“è§£æ¢¯åº¦æ¶ˆå¤±" class="headerlink" title="å¦‚ä½•ç¼“è§£æ¢¯åº¦æ¶ˆå¤±"></a>å¦‚ä½•ç¼“è§£æ¢¯åº¦æ¶ˆå¤±</h4><h5 id="å…¬å¼å¯¹æ¯”"><a href="#å…¬å¼å¯¹æ¯”" class="headerlink" title="å…¬å¼å¯¹æ¯”"></a>å…¬å¼å¯¹æ¯”</h5><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924133015125.png" alt=" " style="zoom:50%;" /><h5 id="æ±‚å¯¼-1"><a href="#æ±‚å¯¼-1" class="headerlink" title="æ±‚å¯¼"></a>æ±‚å¯¼</h5><ul><li>å¯¹Ct-1 æ±‚å¯¼</li></ul><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250924133113115.png" alt=" " style="zoom:50%;" /><h4 id="å®æˆ˜ï¼ˆé»„é‡‘ä»·æ ¼é¢„æµ‹ï¼‰"><a href="#å®æˆ˜ï¼ˆé»„é‡‘ä»·æ ¼é¢„æµ‹ï¼‰" class="headerlink" title="å®æˆ˜ï¼ˆé»„é‡‘ä»·æ ¼é¢„æµ‹ï¼‰"></a>å®æˆ˜ï¼ˆé»„é‡‘ä»·æ ¼é¢„æµ‹ï¼‰</h4><blockquote><ol><li>å•ç‰¹å¾æƒ…å†µ<ol><li>æ—¶é—´ ä»·æ ¼å˜ä¸ºå¤šç‰¹å¾</li><li>å‰äº”å¤©é¢„æµ‹ç¬¬å…­å¤©  æ»šåŠ¨é¢„æµ‹</li><li>æ—¶é—´æ­¥ä¸º5</li></ol></li></ol></blockquote><h5 id="model-train-3"><a href="#model-train-3" class="headerlink" title="model_train"></a>model_train</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥åº“</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, LSTM, Flatten</span><br><span class="line"></span><br><span class="line"><span class="comment"># 111111111111111111111111111111111æ•°æ®å¤„ç†111111111111111111111111111111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½æ•°æ®é›† ç¬¬0åˆ—å½“åšç´¢å¼•</span></span><br><span class="line">dateset = pd.read_csv(<span class="string">&quot;LBMA-GOLD.csv&quot;</span>, index_col=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># print(dateset)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è®­ç»ƒé›†é•¿åº¦</span></span><br><span class="line">training_len = <span class="number">1265</span> - <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–è®­ç»ƒé›† ç¬¬é›¶è¡Œåˆ°è®­ç»ƒé›†  æ‰€æœ‰åˆ—</span></span><br><span class="line">training_set = dateset.iloc[:training_len, :]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æµ‹è¯•é›†æ•°æ®</span></span><br><span class="line">test_set = dateset.iloc[training_len:, :]</span><br><span class="line"><span class="comment"># print(training_set)</span></span><br><span class="line"><span class="comment"># print(test_set)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ•°æ®é›†è¿›è¡Œå½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">train_set_scaled = sc.fit_transform(training_set)</span><br><span class="line">test_set = sc.fit_transform(test_set)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è®­ç»ƒé›†ç‰¹å¾å’Œæ ‡ç­¾</span></span><br><span class="line">x_train = []</span><br><span class="line">y_train = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æµ‹è¯•é›†ç‰¹å¾å’Œæ ‡ç­¾</span></span><br><span class="line">x_test = []</span><br><span class="line">y_test = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨forå¾ªç¯ï¼Œéå†æ•´ä¸ªè®­ç»ƒé›†ï¼Œæå–è®­ç»ƒé›†ä¸­è¿ç»­5ä¸ªé‡‡æ ·ç‚¹çš„æ•°æ®ä½œä¸ºè¾“å…¥ç‰¹å¾x_trainï¼Œç¬¬6ä¸ªé‡‡æ ·ç‚¹çš„æ•°æ®ä½œä¸ºæ ‡ç­¾.</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>, <span class="built_in">len</span>(train_set_scaled)):</span><br><span class="line">    x_train.append(train_set_scaled[i - <span class="number">5</span>:i, <span class="number">0</span>]) <span class="comment"># [0~5) 1~6.....ç¬¬ä¸€åˆ—  ç‰¹å¾å€¼</span></span><br><span class="line">    y_train.append(train_set_scaled[i, <span class="number">0</span>]) <span class="comment"># [5]æ ‡ç­¾</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è®­ç»ƒé›†ç”±listæ ¼å¼å˜ä¸ºarrayæ ¼å¼</span></span><br><span class="line">x_train, y_train = np.array(x_train), np.array(y_train)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿x_trainç¬¦åˆè¾“å…¥è¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]ã€‚</span></span><br><span class="line"><span class="comment"># æ­¤å¤„æ•´ä¸ªæ•°æ®é›†é€å…¥ï¼Œé€å…¥æ ·æœ¬æ•°ä¸ºx_train.shape[0]å³è®­ç»ƒæ•°æ®çš„æ ·æœ¬ä¸ªæ•°ï¼› å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°å®šä½5</span></span><br><span class="line">x_train = np.reshape(x_train, (x_train.shape[<span class="number">0</span>], <span class="number">5</span>, <span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(x_train)</span><br><span class="line"><span class="comment"># [[[0.21126985]</span></span><br><span class="line"><span class="comment">#   [0.21026077]</span></span><br><span class="line"><span class="comment">#   [0.2082426 ]</span></span><br><span class="line"><span class="comment">#   [0.19661161]</span></span><br><span class="line"><span class="comment">#   [0.19400924]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒç†åˆ’åˆ†æµ‹è¯•é›†æ•°æ®</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>, <span class="built_in">len</span>(test_set)):</span><br><span class="line">    x_test.append(test_set[i - <span class="number">5</span>:i, <span class="number">0</span>])</span><br><span class="line">    y_test.append(test_set[i, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•é›†å˜arrayå¹¶reshapeä¸ºç¬¦åˆè¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]</span></span><br><span class="line">x_test, y_test = np.array(x_test), np.array(y_test)</span><br><span class="line">x_test = np.reshape(x_test, (x_test.shape[<span class="number">0</span>], <span class="number">5</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 22222222222222222222222222222222222222æ­å»ºç½‘ç»œ222222222222222222222222222222222</span></span><br><span class="line"><span class="comment"># # æ­å»ºç¥ç»ç½‘ç»œæ¨¡å‹</span></span><br><span class="line">model = keras.Sequential()</span><br><span class="line">model.add(LSTM(<span class="number">80</span>, return_sequences=<span class="literal">True</span>, activation=<span class="string">&quot;relu&quot;</span>))</span><br><span class="line">model.add(LSTM(<span class="number">100</span>, return_sequences=<span class="literal">False</span>, activation=<span class="string">&quot;relu&quot;</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&quot;relu&quot;</span>)) <span class="comment"># å…¨è¿æ¥å±‚</span></span><br><span class="line">model.add(Dense(<span class="number">1</span>)) <span class="comment"># è¾“å‡ºå±‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ¨¡å‹è¿›è¡Œç¼–è¯‘ï¼Œé€‰ç”¨å­¦ä¹ ç‡ä¸º0.01</span></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;mse&#x27;</span>, optimizer=keras.optimizers.SGD(<span class="number">0.01</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å°†è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ”¾å…¥ç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œæ¯æ‰¹æ¬¡é€å…¥çš„æ•°æ®ä¸º32ä¸ªæ•°æ®ï¼Œä¸€å…±è®­ç»ƒ50è½®ï¼Œå°†æµ‹è¯•é›†æ ·æœ¬æ”¾å…¥åˆ°ç¥ç»ç½‘ç»œä¸­æµ‹è¯•å…¶éªŒè¯é›†çš„losså€¼</span></span><br><span class="line">history = model.fit(x_train, y_train, batch_size=<span class="number">32</span>, epochs=<span class="number">100</span>, validation_data=(x_test, y_test))</span><br><span class="line">model.save(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3333333333333333333333333333333333ç”»å›¾33333333333333333333333333333333333333333333</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜åˆ¶è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„losså€¼å¯¹æ¯”å›¾</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;loss&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_loss&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;LSTMç¥ç»ç½‘ç»œlosså€¼&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h5 id="model-test-3"><a href="#model-test-3" class="headerlink" title="model_test"></a>model_test</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥åº“</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½å†å²æ•°æ®æ–‡ä»¶</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&#x27;LBMA-GOLD.csv&#x27;</span>, index_col=<span class="string">&#x27;Date&#x27;</span>)</span><br><span class="line"><span class="comment"># print(dataset)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è®­ç»ƒé›†çš„é•¿åº¦</span></span><br><span class="line">training_len = <span class="number">1256</span> -<span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æµ‹è¯•é›†æ•°æ®</span></span><br><span class="line">test_set = dataset.iloc[training_len:, [<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®é›†è¿›è¡Œå½’ä¸€åŒ–ï¼Œæ–¹ä¾¿ç¥ç»ç½‘ç»œçš„è®­ç»ƒ</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">test_set = sc.fit_transform(test_set)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ”¾ç½®æµ‹è¯•æ•°æ®ç‰¹å¾å’Œæµ‹è¯•æ•°æ®æ ‡ç­¾çš„åˆ—è¡¨</span></span><br><span class="line">x_test = []</span><br><span class="line">y_test = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒç†åˆ’åˆ†æµ‹è¯•é›†æ•°æ®</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>, <span class="built_in">len</span>(test_set)):</span><br><span class="line">    x_test.append(test_set[i - <span class="number">5</span>:i, <span class="number">0</span>])</span><br><span class="line">    y_test.append(test_set[i, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•é›†å˜arrayå¹¶reshapeä¸ºç¬¦åˆè¦æ±‚ï¼š[é€å…¥æ ·æœ¬æ•°ï¼Œ å¾ªç¯æ ¸æ—¶é—´å±•å¼€æ­¥æ•°ï¼Œ æ¯ä¸ªæ—¶é—´æ­¥è¾“å…¥ç‰¹å¾ä¸ªæ•°]</span></span><br><span class="line">x_test, y_test = np.array(x_test), np.array(y_test)</span><br><span class="line">x_test = np.reshape(x_test, (x_test.shape[<span class="number">0</span>], <span class="number">5</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥æ¨¡å‹</span></span><br><span class="line">model = load_model(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨æ¨¡å‹è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">predicted = model.predict(x_test)</span><br><span class="line"><span class="comment"># print(predicted.shape)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›è¡Œé¢„æµ‹å€¼çš„åå½’ä¸€åŒ–</span></span><br><span class="line">prediction = sc.inverse_transform(predicted)</span><br><span class="line"><span class="comment"># print(prediction)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æµ‹è¯•é›†çš„æ ‡ç­¾è¿›è¡Œåå½’ä¸€åŒ–</span></span><br><span class="line"></span><br><span class="line">real = sc.inverse_transform(test_set[<span class="number">5</span>:])</span><br><span class="line"><span class="comment"># print(real)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æ¨¡å‹çš„è¯„ä»·æŒ‡æ ‡</span></span><br><span class="line">rmse = sqrt(mean_squared_error(prediction, real))</span><br><span class="line">mape = np.mean(np.<span class="built_in">abs</span>((real-prediction)/prediction))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;rmse&#x27;</span>, rmse)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;mape&#x27;</span>, mape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜åˆ¶çœŸå®å€¼å’Œé¢„æµ‹å€¼çš„å¯¹æ¯”</span></span><br><span class="line">plt.plot(real, label=<span class="string">&#x27;çœŸå®å€¼&#x27;</span>)</span><br><span class="line">plt.plot(prediction, label=<span class="string">&#x27;é¢„æµ‹å€¼&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;åŸºäºLSTMç¥ç»ç½‘ç»œçš„é»„é‡‘ä»·æ ¼é¢„æµ‹&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><img src="https://picgo-1314714026.cos.ap-nanjing.myqcloud.com/img/image-20250925121244063.png" alt=" " style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> ç¥ç»ç½‘ç»œ </tag>
            
            <tag> RNN </tag>
            
            <tag> CNN </tag>
            
            <tag> LSTM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ -æ·±åº¦å­¦ä¹ å…¥é—¨</title>
      <link href="//post/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E7%82%AE%E5%93%A5%E5%B8%A6%E4%BD%A0%E5%AD%A6.html"/>
      <url>//post/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E7%82%AE%E5%93%A5%E5%B8%A6%E4%BD%A0%E5%AD%A6.html</url>
      
        <content type="html"><![CDATA[<blockquote><p> æ•™ç¨‹åœ°å€ï¼š</p><ol><li><strong>up</strong>**ï¼šç‚®å“¥å¸¦ä½ å­¦</li></ol><p>è¯¾ç¨‹åå­—ï¼š[æ‰‹æŠŠæ‰‹æ•™å­¦]å¿«é€Ÿå¸¦ä½ å…¥é—¨æ·±åº¦å­¦ä¹ ä¸å®æˆ˜</p><p>ç®€ä»‹ï¼šå…¥é—¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ </p><p>ç½‘å€ï¼š</p><p><a href="https://www.bilibili.com/video/BV1eP411w7Re/?spm_id_from=333.1387.homepage.video_card.click&vd_source=f8d1f5518d3f58b48b5c428323f8d3bf">https://www.bilibili.com/video/BV1eP411w7Re/?spm_id_from=333.1387.homepage.video_card.click&amp;vd_source=f8d1f5518d3f58b48b5c428323f8d3bf</a></p><ol start="2"><li><strong>up</strong>**ï¼šç‚®å“¥å¸¦ä½ å­¦</li></ol><p>è¯¾ç¨‹åå­—ï¼šPytorchæ¡†æ¶ä¸ç»å…¸å·ç§¯ç¥ç»ç½‘ç»œä¸å®æˆ˜    </p><p>ç®€ä»‹ï¼šå…¥é—¨æ·±åº¦å­¦ä¹ å’Œpytorch</p><p>ç½‘å€ï¼š</p><p><a href="https://www.bilibili.com/video/BV1e34y1M7wR/?spm_id_from=333.1387.homepage.video_card.click&vd_source=f8d1f5518d3f58b48b5c428323f8d3bf">https://www.bilibili.com/video/BV1e34y1M7wR/?spm_id_from=333.1387.homepage.video_card.click&amp;vd_source=f8d1f5518d3f58b48b5c428323f8d3bf</a></p></blockquote><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote><p>æ·±åº¦å­¦ä¹ ä»¥ç¥ç»ç½‘ç»œä¸ºåŸºç¡€</p></blockquote><img src="/img/assets/image-20250918122048971.png" alt=" " style="zoom:33%;" /><h2 id="ç¥ç»ç½‘ç»œ"><a href="#ç¥ç»ç½‘ç»œ" class="headerlink" title="ç¥ç»ç½‘ç»œ"></a>ç¥ç»ç½‘ç»œ</h2><ul><li>å¹¶ééšè—å±‚è¶Šå¤šè¶Šå¥½ å¯èƒ½è¿‡æ‹Ÿåˆ</li></ul><img src="/img/assets/image-20250918123432656.png" alt=" " style="zoom:33%;" /><h2 id="å…¨è¿æ¥ç¥ç»ç½‘ç»œ"><a href="#å…¨è¿æ¥ç¥ç»ç½‘ç»œ" class="headerlink" title="å…¨è¿æ¥ç¥ç»ç½‘ç»œ"></a>å…¨è¿æ¥ç¥ç»ç½‘ç»œ</h2><blockquote><p>é€šè¿‡è®­ç»ƒwå’Œbï¼ˆæƒé‡å’Œåç½®ï¼‰</p><ul><li>æ³¨ï¼šæœºå™¨å­¦ä¹ å†…å®¹</li></ul></blockquote><img src="/img/assets/image-20250918123705231.png" alt=" " style="zoom:33%;" /><h2 id="ç¥ç»ç½‘ç»œä½œç”¨"><a href="#ç¥ç»ç½‘ç»œä½œç”¨" class="headerlink" title="ç¥ç»ç½‘ç»œä½œç”¨"></a>ç¥ç»ç½‘ç»œä½œç”¨</h2><img src="/img/assets/image-20250918124059476.png" alt=" " style="zoom:33%;" /><h2 id="æ·±åº¦å­¦ä¹ æ¡†æ¶ä»‹ç»"><a href="#æ·±åº¦å­¦ä¹ æ¡†æ¶ä»‹ç»" class="headerlink" title="&#x3D;&#x3D;æ·±åº¦å­¦ä¹ æ¡†æ¶ä»‹ç»&#x3D;&#x3D;"></a>&#x3D;&#x3D;æ·±åº¦å­¦ä¹ æ¡†æ¶ä»‹ç»&#x3D;&#x3D;</h2><img src="/img/assets/image-20250918124423733.png" alt=" " style="zoom:33%;" /><h2 id="ç¯å¢ƒä»‹ç»"><a href="#ç¯å¢ƒä»‹ç»" class="headerlink" title="ç¯å¢ƒä»‹ç»"></a>ç¯å¢ƒä»‹ç»</h2><img src="/img/assets/image-20250918124512049.png" alt=" " style="zoom:33%;" /><h1 id="æœºå™¨å­¦ä¹ çŸ¥è¯†å›é¡¾"><a href="#æœºå™¨å­¦ä¹ çŸ¥è¯†å›é¡¾" class="headerlink" title="æœºå™¨å­¦ä¹ çŸ¥è¯†å›é¡¾"></a>æœºå™¨å­¦ä¹ çŸ¥è¯†å›é¡¾</h1><h2 id="2-çº¿æ€§å›å½’æ¨¡å‹ä¸æ¢¯åº¦ä¸‹é™"><a href="#2-çº¿æ€§å›å½’æ¨¡å‹ä¸æ¢¯åº¦ä¸‹é™" class="headerlink" title="2. çº¿æ€§å›å½’æ¨¡å‹ä¸æ¢¯åº¦ä¸‹é™"></a>2. çº¿æ€§å›å½’æ¨¡å‹ä¸æ¢¯åº¦ä¸‹é™</h2><h3 id="2-2-å®šä¹‰"><a href="#2-2-å®šä¹‰" class="headerlink" title="2.2 å®šä¹‰"></a>2.2 å®šä¹‰</h3><ul><li>xæ˜¯ç‰¹å¾ yæ˜¯æ ‡ç­¾</li></ul><img src="/img/assets/image-20250918133416585.png" alt=" " style="zoom:33%;" /><h4 id="æŸå¤±å‡½æ•°-ï¼ˆè¯¯å·®å‡½æ•°ï¼‰"><a href="#æŸå¤±å‡½æ•°-ï¼ˆè¯¯å·®å‡½æ•°ï¼‰" class="headerlink" title="æŸå¤±å‡½æ•° ï¼ˆè¯¯å·®å‡½æ•°ï¼‰"></a>æŸå¤±å‡½æ•° ï¼ˆè¯¯å·®å‡½æ•°ï¼‰</h4><img src="/img/assets/image-20250918134408006.png" alt=" " style="zoom:33%;" /><h4 id="ç©·ä¸¾æ³•"><a href="#ç©·ä¸¾æ³•" class="headerlink" title="ç©·ä¸¾æ³•"></a>ç©·ä¸¾æ³•</h4><ul><li>è¿‡äºåƒåœ¾ çœ‹åé¢æœ€å°äºŒä¹˜æ³•</li></ul><img src="/img/assets/image-20250918134858646.png" alt="image-20250918134858646" style="zoom:33%;" /><h3 id="2-3-æœ€å°äºŒä¹˜æ³•"><a href="#2-3-æœ€å°äºŒä¹˜æ³•" class="headerlink" title="2.3 æœ€å°äºŒä¹˜æ³•"></a>2.3 æœ€å°äºŒä¹˜æ³•</h3><blockquote><p>å¯¹xæ±‚åå¯¼</p></blockquote><img src="/img/assets/image-20250918135512644.png" alt=" " style="zoom:33%;" /><h4 id="å‘é‡ç‰ˆæœ¬"><a href="#å‘é‡ç‰ˆæœ¬" class="headerlink" title="å‘é‡ç‰ˆæœ¬"></a>å‘é‡ç‰ˆæœ¬</h4><img src="/img/assets/image-20250918140908789.png" alt=" " style="zoom:33%;" /><ul><li>æŸå¤±å‡½æ•°</li><li>æ›´æ­£ æ­¤å¤„Jï¼ˆWï¼‰ä¸ºfï¼ˆxï¼‰</li></ul><img src="/img/assets/image-20250918140931108.png"  style="zoom:30%;" ><ul><li>å¯¹æŸå¤±å‡½æ•°æ±‚å¯¼</li><li><code>å¹¶éæ‰€æœ‰çŸ©é˜µæœ‰å¯é€†çŸ©é˜µï¼Œå› æ­¤å¼•å…¥æŸå¤±å‡½æ•°</code></li></ul><img src="/img/assets/image-20250918141656527.png" alt="image-20250918141656527" style="zoom:33%;" /><h2 id="2-3-æ¢¯åº¦ä¸‹é™"><a href="#2-3-æ¢¯åº¦ä¸‹é™" class="headerlink" title="&#x3D;&#x3D;2.3 æ¢¯åº¦ä¸‹é™&#x3D;&#x3D;"></a>&#x3D;&#x3D;2.3 æ¢¯åº¦ä¸‹é™&#x3D;&#x3D;</h2><h3 id="ç†è§£"><a href="#ç†è§£" class="headerlink" title="ç†è§£"></a>ç†è§£</h3><img src="/img/assets/image-20250918151145564.png" alt=" " style="zoom:33%;" />  <h3 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h3><p>$$<br>w&#x3D;w-a \frac{\partial J(w)}{\partial w}<br>$$</p><ul><li>å¯¹å¤šä¸ªwé‡å¤è®¡ç®—</li></ul><img src="/img/assets/image-20250918151609827.png" alt=" " style="zoom:33%;" /><ul><li><p>ç®€åŒ–ç‰ˆæœ¬</p></li><li><p>$$<br>\begin{array}{l}<br>\text { repeat until convergence { }\<br>\begin{aligned}<br>w &amp; &#x3D;w-\alpha \frac{1}{m} \sum_{i&#x3D;1}^{m}\left(f_{w, b}\left(x^{(i)}\right)-y^{(i)}\right) x^{(i)} \<br>b &amp; &#x3D;b-\alpha \frac{1}{m} \sum_{i&#x3D;1}^{m}\left(f_{w, b}\left(x^{(i)}\right)-y^{(i)}\right)<br>\end{aligned}<br>\end{array}<br>$$</p></li></ul><p><img src="/img/assets/image-20250918153859855.png" alt="image-20250918153859855"></p><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><img src="/img/assets/image-20250918152726195.png" alt=" " style="zoom:33%;" /><h3 id="å®æˆ˜æ¡ˆä¾‹"><a href="#å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹"></a>å®æˆ˜æ¡ˆä¾‹</h3><blockquote><p>æ­¥éª¤ï¼š</p><ol><li>æ•°æ®</li><li>æ¨¡å‹</li><li>æŸå¤±å‡½æ•°</li><li>æ¢¯åº¦æ±‚å¯¼</li><li>åˆ©ç”¨æ¢¯åº¦æ›´æ–°å‚æ•°</li><li>è®¾ç½®è®­ç»ƒè½®æ¬¡</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ•°æ®é›†</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ•°æ®ç‰¹å¾</span></span><br><span class="line">x_data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æ•°æ®æ ‡ç­¾</span></span><br><span class="line">y_data = [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–wå‚æ•°</span></span><br><span class="line">w = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰çº¿æ€§å›å½’çš„æ¨¡å‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forword</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x * w</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æŸå¤±å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">xs, ys</span>):</span><br><span class="line">    costvalue = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(xs, ys):</span><br><span class="line">        y_pred = forword(x)</span><br><span class="line">        costvalue += (y_pred - y) ** <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> costvalue / <span class="built_in">len</span>(xs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è®¡ç®—æ¢¯åº¦çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradient</span>(<span class="params">xs, ys</span>):</span><br><span class="line">    grad = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(xs, ys):</span><br><span class="line">        grad += <span class="number">2</span> * x * (forword(x) - y)</span><br><span class="line">    <span class="keyword">return</span> grad / <span class="built_in">len</span>(xs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­¦ä¹ ç‡</span></span><br><span class="line">aa = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    cost_val = cost(x_data, y_data)</span><br><span class="line">    gra_val = gradient(x_data, y_data)</span><br><span class="line">    w = w - aa * gra_val</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;è®­ç»ƒè½®æ¬¡ï¼š&#x27;</span>, epoch, <span class="string">&#x27;w=&#x27;</span>, w, <span class="string">&#x27;loss:&#x27;</span>, cost_val)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;100è½®åwå·²ç»è®­ç»ƒå¥½äº†&#x27;</span>, <span class="string">&#x27;w=&#x27;</span>, w)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å­¦ä¹ 4å°æ—¶æœ€ç»ˆå¾—åˆ†ä¸ºï¼š&quot;</span>, forword(<span class="number">4</span>))</span><br></pre></td></tr></table></figure><h2 id="3-é€»è¾‘å›å½’"><a href="#3-é€»è¾‘å›å½’" class="headerlink" title="&#x3D;&#x3D;3.é€»è¾‘å›å½’&#x3D;&#x3D;"></a>&#x3D;&#x3D;3.é€»è¾‘å›å½’&#x3D;&#x3D;</h2><h3 id="3-1-å›å½’å’Œåˆ†ç±»çš„åŒºåˆ«"><a href="#3-1-å›å½’å’Œåˆ†ç±»çš„åŒºåˆ«" class="headerlink" title="3.1 å›å½’å’Œåˆ†ç±»çš„åŒºåˆ«"></a>3.1 å›å½’å’Œåˆ†ç±»çš„åŒºåˆ«</h3><img src="/img/assets/image-20250918202130240.png" alt=" " style="zoom:33%;" /><h3 id="3-2-sigmoidå‡½æ•°"><a href="#3-2-sigmoidå‡½æ•°" class="headerlink" title="3.2 sigmoidå‡½æ•°"></a>3.2 sigmoidå‡½æ•°</h3><img src="/img/assets/image-20250918202418798.png" alt=" " style="zoom:33%;" /><img src="/img/assets/image-20250919120620532.png" alt=" " style="zoom:33%;" /><h4 id="æ±‚å¯¼"><a href="#æ±‚å¯¼" class="headerlink" title="æ±‚å¯¼"></a>æ±‚å¯¼</h4><p><img src="/img/assets/image-20250919123351303.png" alt="image-20250919123351303"></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="3-3-æŸå¤±å‡½æ•°"><a href="#3-3-æŸå¤±å‡½æ•°" class="headerlink" title="&#x3D;&#x3D;3.3 æŸå¤±å‡½æ•°&#x3D;&#x3D;"></a>&#x3D;&#x3D;3.3 æŸå¤±å‡½æ•°&#x3D;&#x3D;</h3><img src="/img/assets/image-20250919124534217.png" alt=" " style="zoom:50%;" /><h4 id="è¡¨è¾¾å¼"><a href="#è¡¨è¾¾å¼" class="headerlink" title="è¡¨è¾¾å¼"></a>è¡¨è¾¾å¼</h4><img src="/img/assets/image-20250919121328314.png" alt=" " style="zoom:33%;" /> <h3 id="3-4-æ¢¯åº¦ä¸‹é™"><a href="#3-4-æ¢¯åº¦ä¸‹é™" class="headerlink" title="&#x3D;&#x3D;3.4 æ¢¯åº¦ä¸‹é™&#x3D;&#x3D;"></a>&#x3D;&#x3D;3.4 æ¢¯åº¦ä¸‹é™&#x3D;&#x3D;</h3><img src="/img/assets/image-20250919124419231.png" alt="image-20250919124419231" style="zoom:50%;" /> <h4 id="å‚æ•°wæ›´æ–°"><a href="#å‚æ•°wæ›´æ–°" class="headerlink" title="å‚æ•°wæ›´æ–°"></a>å‚æ•°wæ›´æ–°</h4><img src="/img/assets/image-20250919123454850.png" alt=" " style="zoom:50%;" /><blockquote><ul><li>å‘é‡æ±‚å¯¼</li><li><img src="/img/assets/image-20250919122348745.png" alt=" " style="zoom:33%;" /></li></ul></blockquote><h4 id="å‚æ•°bæ›´æ–°"><a href="#å‚æ•°bæ›´æ–°" class="headerlink" title="å‚æ•°bæ›´æ–°"></a>å‚æ•°bæ›´æ–°</h4><img src="/img/assets/image-20250919123742565.png" alt=" " style="zoom:33%;" /><h3 id="3-5-å›å½’æ¨¡å‹è¯„ä»·æŒ‡æ ‡"><a href="#3-5-å›å½’æ¨¡å‹è¯„ä»·æŒ‡æ ‡" class="headerlink" title="3.5 å›å½’æ¨¡å‹è¯„ä»·æŒ‡æ ‡"></a>3.5 å›å½’æ¨¡å‹è¯„ä»·æŒ‡æ ‡</h3><h4 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><img src="/img/assets/image-20250919131152077.png" alt=" " style="zoom:50%;" /><h4 id="å‡†ç¡®ç‡"><a href="#å‡†ç¡®ç‡" class="headerlink" title="å‡†ç¡®ç‡"></a>å‡†ç¡®ç‡</h4><img src="/img/assets/image-20250919130241465.png" alt=" " style="zoom:50%;" /><h4 id="ç²¾ç¡®ç‡"><a href="#ç²¾ç¡®ç‡" class="headerlink" title="ç²¾ç¡®ç‡"></a>ç²¾ç¡®ç‡</h4> <img src="/img/assets/image-20250919130429109.png" alt=" " style="zoom:50%;" /><h4 id="å¬å›ç‡"><a href="#å¬å›ç‡" class="headerlink" title="å¬å›ç‡"></a>å¬å›ç‡</h4><p> <img src="/img/assets/image-20250919130814009.png" alt=" "></p><h4 id="F1å€¼"><a href="#F1å€¼" class="headerlink" title="F1å€¼"></a>F1å€¼</h4><p><img src="/img/assets/image-20250919130914372.png" alt="image-20250919130914372"></p><h3 id="3-6-åˆ†ç±»æ¨¡å‹è¯„ä»·æŒ‡æ ‡"><a href="#3-6-åˆ†ç±»æ¨¡å‹è¯„ä»·æŒ‡æ ‡" class="headerlink" title="3.6 åˆ†ç±»æ¨¡å‹è¯„ä»·æŒ‡æ ‡"></a>3.6 åˆ†ç±»æ¨¡å‹è¯„ä»·æŒ‡æ ‡</h3><h4 id="å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰å’Œ-å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰"><a href="#å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰å’Œ-å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰" class="headerlink" title="å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰å’Œ&#x3D;&#x3D;å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰&#x3D;&#x3D;"></a>å¹³å‡ç»å¯¹è¯¯å·®ï¼ˆMAEï¼‰å’Œ&#x3D;&#x3D;å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰&#x3D;&#x3D;</h4><blockquote><p>MSE å°±æ˜¯å‰é¢çš„LOSS æŸå¤±å‡½æ•°</p></blockquote><img src="/img/assets/image-20250919131715054.png" alt=" " style="zoom:50%;" /> <h4 id="å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰"><a href="#å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰" class="headerlink" title="å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰"></a>å‡æ–¹æ ¹è¯¯å·®ï¼ˆRMSEï¼‰</h4><img src="/img/assets/image-20250919131915415.png" alt=" " style="zoom:67%;" /><h4 id="å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰"><a href="#å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰" class="headerlink" title="å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰"></a>å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®ï¼ˆMAPEï¼‰</h4><img src="/img/assets/image-20250919131947140.png" alt=" " style="zoom:67%;" /><h3 id="3-7-å®æˆ˜æ¡ˆä¾‹"><a href="#3-7-å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="3.7 å®æˆ˜æ¡ˆä¾‹"></a>3.7 å®æˆ˜æ¡ˆä¾‹</h3><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><blockquote><ol><li>å½’ä¸€åŒ–å…¬å¼ï¼š(X-min)&#x2F;(max-min)ï¼Œæ¶ˆé™¤é‡çº²å’Œæ•°å€¼å¤§å°å¯¹ç»“æœçš„å½±å“</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. è¯»å–æ•°æ®</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;breast_cancer_data.csv&quot;</span>)</span><br><span class="line"><span class="comment"># print(dataset)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æå–ç‰¹å¾x</span></span><br><span class="line">X = dataset.iloc[:, :-<span class="number">1</span>]  <span class="comment"># é™¤äº†æœ€åä¸€åˆ—</span></span><br><span class="line"><span class="comment"># print(x)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æå–æ•°æ®ä¸­çš„æ ‡ç­¾</span></span><br><span class="line">Y = dataset[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line"><span class="comment"># print(y)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ’åˆ†æ•°æ®é›†å’Œæµ‹è¯•é›† å…«ä»½è®­ç»ƒé›† äºŒä»½æµ‹è¯•é›† éšæœºæŠ½å–</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. æ•°æ®å½’ä¸€åŒ– ä½¿æ•°æ®åœ¨0~1ä¹‹é—´ æ¶ˆé™¤é‡çº²å½±å“</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">x_train = sc.fit_transform(x_train)</span><br><span class="line">x_test = sc.transform(x_test)</span><br><span class="line"><span class="comment"># print(x_train)</span></span><br><span class="line"><span class="comment"># print(x_test)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.é€»è¾‘å›å½’æ¨¡å‹æ­å»º</span></span><br><span class="line">lr = LogisticRegression()</span><br><span class="line">lr.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.æ‰“å°å‚æ•°wå’Œb</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;w&quot;</span>, lr.coef_)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b&quot;</span>, lr.intercept_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹æ¨ç†æµ‹è¯•</span></span><br><span class="line">pre_result = lr.predict(x_test)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;é¢„æµ‹ç»“æœï¼š&quot;</span>, pre_result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.æ‰“å°é¢„æµ‹ç»“æœçš„æ¦‚ç‡</span></span><br><span class="line">pre_result_proba = lr.predict_proba(x_test)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ¦‚ç‡ï¼š&quot;</span>, pre_result_proba)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.è·å–æ¶æ€§è‚¿ç˜¤çš„æ¦‚ç‡</span></span><br><span class="line">pre_list = pre_result_proba[:, <span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(pre_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11. è®¾ç½®ä¿å­˜ç»“æœçš„åˆ—è¡¨</span></span><br><span class="line">result = []</span><br><span class="line">result_name = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é˜ˆå€¼</span></span><br><span class="line">thresholds = <span class="number">0.3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(pre_list)):</span><br><span class="line">    <span class="keyword">if</span> pre_list[i] &gt; thresholds:</span><br><span class="line">        result.append(<span class="number">1</span>)</span><br><span class="line">        result_name.append(<span class="string">&quot;æ¶æ€§&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result.append(<span class="number">0</span>)</span><br><span class="line">        result_name.append(<span class="string">&quot;è‰¯æ€§&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°é˜ˆå€¼è°ƒæ•´åç»“æœ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ‰“å°é˜ˆå€¼è°ƒæ•´åç»“æœ:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="built_in">print</span>(result_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœçš„ç²¾ç¡®ç‡å’Œå¬å›è¿˜æœ‰f1å€¼</span></span><br><span class="line"><span class="built_in">print</span>(y_test)</span><br><span class="line">report = classification_report(y_test, result, labels=[<span class="number">0</span>, <span class="number">1</span>], target_names=[<span class="string">&#x27;è‰¯æ€§è‚¿ç˜¤&#x27;</span>, <span class="string">&#x27;æ¶æ€§è‚¿ç˜¤&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è¾“å‡ºç»“æœçš„ç²¾ç¡®ç‡å’Œå¬å›è¿˜æœ‰f1å€¼--&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(report)</span><br></pre></td></tr></table></figure><h4 id="ç»“æœæ‰“å°"><a href="#ç»“æœæ‰“å°" class="headerlink" title="ç»“æœæ‰“å°"></a>ç»“æœæ‰“å°</h4><p><img src="/img/assets/image-20250920140956489.png" alt=" "></p><h1 id="æ·±åº¦å­¦ä¹ "><a href="#æ·±åº¦å­¦ä¹ " class="headerlink" title="æ·±åº¦å­¦ä¹ "></a>æ·±åº¦å­¦ä¹ </h1><h2 id="å…¨è¿æ¥ç¥ç»ç½‘ç»œ-1"><a href="#å…¨è¿æ¥ç¥ç»ç½‘ç»œ-1" class="headerlink" title="å…¨è¿æ¥ç¥ç»ç½‘ç»œ"></a>å…¨è¿æ¥ç¥ç»ç½‘ç»œ</h2><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><img src="/img/assets/image-20250920142239542.png" alt=" " style="zoom:33%;" /><h3 id="ç»“æ„å•å…ƒ"><a href="#ç»“æ„å•å…ƒ" class="headerlink" title="ç»“æ„å•å…ƒ"></a>ç»“æ„å•å…ƒ</h3><ul><li>ç±»æ¯”æœºå™¨å­¦ä¹ å›å½’æ¨¡å‹</li></ul><blockquote><ol><li>x è¾“å…¥</li><li>b åç½®</li><li>wæƒé‡</li><li>æ±‚å’Œï¼šéšè—å±‚</li><li>æ¿€æ´»å‡½æ•°ï¼šéçº¿æ€§ &#x3D;&#x3D;ï¼ˆå¯¹æ¯”é€»è¾‘å›å½’æ¿€æ´»å‡½æ•°æ˜¯æ±‚å’Œ  é€»è¾‘å›å½’æ¿€æ´»å‡½æ•°æ˜¯sigmoidï¼‰&#x3D;&#x3D;</li></ol></blockquote><img src="/img/assets/image-20250920142542669.png" alt=" " style="zoom:30%;" /> <h4 id="å¯¹æ¯”æœºå™¨å­¦ä¹ æ¿€æ´»å‡½æ•°"><a href="#å¯¹æ¯”æœºå™¨å­¦ä¹ æ¿€æ´»å‡½æ•°" class="headerlink" title="å¯¹æ¯”æœºå™¨å­¦ä¹ æ¿€æ´»å‡½æ•°"></a>å¯¹æ¯”æœºå™¨å­¦ä¹ æ¿€æ´»å‡½æ•°</h4><ul><li><code>å¯¹æ¯”é€»è¾‘å›å½’æ¿€æ´»å‡½æ•°æ˜¯æ±‚å’Œ  é€»è¾‘å›å½’æ¿€æ´»å‡½æ•°æ˜¯sigmoidï¼‰</code></li></ul><img src="/img/assets/image-20250920143445569.png" alt=" " style="zoom:30%;" /><h3 id="æ¿€æ´»å‡½æ•°ä½œç”¨"><a href="#æ¿€æ´»å‡½æ•°ä½œç”¨" class="headerlink" title="æ¿€æ´»å‡½æ•°ä½œç”¨"></a>æ¿€æ´»å‡½æ•°ä½œç”¨</h3><ul><li>éçº¿æ€§ï¼š<code>è¿™æ ·æœ€åå°±ä¸ä¼šå¾—åˆ°cçš„ä¸‰æ¬¡æ–¹ä¸ºå¸¸æ•°</code></li></ul><img src="/img/assets/image-20250920145410062.png" alt=" " style="zoom:50%;" /><h3 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="æ¿€æ´»å‡½æ•°"></a>æ¿€æ´»å‡½æ•°</h3><blockquote><p>CSDN: æ¿€æ´»å‡½æ•°å›¾åƒå¤§å…¨</p><p><a href="https://blog.csdn.net/hy592070616/article/details/120617490">https://blog.csdn.net/hy592070616/article/details/120617490</a></p></blockquote><h4 id="sigmoidå‡½æ•°"><a href="#sigmoidå‡½æ•°" class="headerlink" title="sigmoidå‡½æ•°"></a>sigmoidå‡½æ•°</h4><ul><li>æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œå€’æ•°å›¾åƒå·¦å³æ¶ˆå¤±å¤ªå¿«  w<code>ç´¯è®¡ä¹˜æ³•åå°æ•°ç´¯æˆ</code> è¶‹è¿‘äº0</li></ul><img src="/img/assets/image-20250920150050570.png" alt=" " style="zoom:50%;" /><h4 id="Tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰"><a href="#Tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰" class="headerlink" title="Tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰"></a>Tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰</h4><img src="/img/assets/image-20250920151852835.png" alt=" " style="zoom:50%;" /><h5 id="æ•°å­¦çŸ¥è¯†"><a href="#æ•°å­¦çŸ¥è¯†" class="headerlink" title="æ•°å­¦çŸ¥è¯†"></a>æ•°å­¦çŸ¥è¯†</h5><blockquote><p>çŸ¥ä¹ï¼š<a href="https://zhuanlan.zhihu.com/p/563840693">https://zhuanlan.zhihu.com/p/563840693</a></p></blockquote><p><img src="/img/assets/v2-1cdfb54914199e4d75baa6b82adf3809_1440w.png" alt="åŒæ›²æ­£å¼¦ã€åŒæ›²ä½™å¼¦ã€åŒæ›²æ­£åˆ‡åŸºç¡€çŸ¥è¯†æ•´ç†"></p><img src="/img/assets/image-20250920151416777.png" alt=" " style="zoom:70%;" /> <h4 id="ReLUå‡½æ•°"><a href="#ReLUå‡½æ•°" class="headerlink" title="ReLUå‡½æ•°"></a>ReLUå‡½æ•°</h4><ul><li>ç¥ç»å…ƒæ­»äº¡ï¼š<code>z&lt;0 å€’æ•°ä¸º0  wåœæ­¢æ›´æ–°</code></li></ul><img src="/img/assets/image-20250920152401714.png" alt=" " style="zoom:50%;" /><h4 id="Leaky-ReLU"><a href="#Leaky-ReLU" class="headerlink" title="Leaky ReLU"></a>Leaky ReLU</h4><ul><li>æ²¡æœ‰æœ€å¥½çš„æ¿€æ´»å‡½æ•° åªæœ‰ç¬¦åˆçš„æ¿€æ´»å‡½æ•°</li></ul><img src="/img/assets/image-20250920152831211.png" alt=" " style="zoom:50%;" /><h4 id="SoftMax"><a href="#SoftMax" class="headerlink" title="SoftMax"></a>SoftMax</h4><ul><li><code>ç”¨äºå¤šåˆ†ç±»ä»»åŠ¡</code></li><li><code>ç”¨äºè¾“å‡ºå±‚</code></li></ul><img src="/img/assets/image-20250920153112554.png" alt=" " style="zoom:50%;" /><h3 id="å‰å‘ä¼ æ’­"><a href="#å‰å‘ä¼ æ’­" class="headerlink" title="å‰å‘ä¼ æ’­"></a>å‰å‘ä¼ æ’­</h3><blockquote><ol><li><code>å‰å‘ä¼ æ’­è®¡ç®—</code>  é¢„è®¾wå’Œb æ ¹æ®æ•°æ®é›†è®¡ç®—</li><li><code>è®¡ç®—è¯¯å·®</code>  ç±»æ¯”æŸå¤±å‡½æ•°</li><li><code>è®¡ç®—æ¢¯åº¦</code> æ¢¯åº¦æ›´æ–° æ±‚æŸå¤±å‡½æ•°åå¯¼</li><li><code>åå‘ä¼ æ’­</code> åå‘æ›´æ–°wå’Œb</li></ol></blockquote><img src="/img/assets/image-20250920155006380.png" alt=" " style="zoom:50%;" /><h4 id="å…·ä½“è¿‡ç¨‹"><a href="#å…·ä½“è¿‡ç¨‹" class="headerlink" title="å…·ä½“è¿‡ç¨‹"></a>å…·ä½“è¿‡ç¨‹</h4><img src="/img/assets/image-20250920155736406.png" alt=" " style="zoom:30%;" /><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><ul><li><p>å›¾åƒè§£é‡Šï¼šå‰é¢costå€¼é€æ¸å‡å°ï¼Œwï¼Œbé€æ¸å»åˆï¼Œå‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œç”¨çš„trainè®­ç»ƒé›†</p></li><li><p>åé¢è¶‹è¿‘äº0  å¯èƒ½æ˜¯æµ‹è¯•é›†test</p><img src="/img/assets/image-20250920160537963.png" alt=" " style="zoom:50%;" /></li></ul><h3 id="é“¾å¼æ³•åˆ™ï¼ˆæ•°å­¦è¡¥å……ï¼‰"><a href="#é“¾å¼æ³•åˆ™ï¼ˆæ•°å­¦è¡¥å……ï¼‰" class="headerlink" title="é“¾å¼æ³•åˆ™ï¼ˆæ•°å­¦è¡¥å……ï¼‰"></a>é“¾å¼æ³•åˆ™ï¼ˆæ•°å­¦è¡¥å……ï¼‰</h3><h4 id="å•å˜é‡é“¾å¼æ³•åˆ™"><a href="#å•å˜é‡é“¾å¼æ³•åˆ™" class="headerlink" title="å•å˜é‡é“¾å¼æ³•åˆ™"></a>å•å˜é‡é“¾å¼æ³•åˆ™</h4><img src="/img/assets/image-20250920160952252.png" alt=" " style="zoom:50%;" /><h4 id="å¤šå˜é‡é“¾å¼å‘å±•"><a href="#å¤šå˜é‡é“¾å¼å‘å±•" class="headerlink" title="å¤šå˜é‡é“¾å¼å‘å±•"></a>å¤šå˜é‡é“¾å¼å‘å±•</h4><img src="/img/assets/image-20250920161017509.png" alt=" " style="zoom:50%;" /> <h3 id="åå‘ä¼ æ’­"><a href="#åå‘ä¼ æ’­" class="headerlink" title="&#x3D;&#x3D;åå‘ä¼ æ’­&#x3D;&#x3D;"></a>&#x3D;&#x3D;åå‘ä¼ æ’­&#x3D;&#x3D;</h3><h4 id="æ¡ˆä¾‹-2"><a href="#æ¡ˆä¾‹-2" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><img src="/img/assets/image-20250920164607945.png" alt=" " style="zoom:50%;" /><h4 id="æ±‚è§£å‚æ•°æ¢¯åº¦"><a href="#æ±‚è§£å‚æ•°æ¢¯åº¦" class="headerlink" title="æ±‚è§£å‚æ•°æ¢¯åº¦"></a>æ±‚è§£å‚æ•°æ¢¯åº¦</h4><img src="/img/assets/image-20250920165308026.png" alt=" " style="zoom:50%;" /><img src="/img/assets/image-20250920170603094.png" alt=" " style="zoom:50%;" /><h4 id="åˆ©ç”¨æ¢¯åº¦å‚æ•°æ›´æ–°"><a href="#åˆ©ç”¨æ¢¯åº¦å‚æ•°æ›´æ–°" class="headerlink" title="åˆ©ç”¨æ¢¯åº¦å‚æ•°æ›´æ–°"></a>åˆ©ç”¨æ¢¯åº¦å‚æ•°æ›´æ–°</h4><ul><li>è®¾ç½®å­¦ä¹ ç‡ä¸º0.1</li></ul><img src="/img/assets/image-20250920170906045.png" alt=" " style="zoom:50%;" /><h4 id="æ–°å‚æ•°å‰å‘ä¼ æ’­"><a href="#æ–°å‚æ•°å‰å‘ä¼ æ’­" class="headerlink" title="æ–°å‚æ•°å‰å‘ä¼ æ’­"></a>æ–°å‚æ•°å‰å‘ä¼ æ’­</h4><img src="/img/assets/image-20250920171725470.png" alt=" " style="zoom:50%;" /><h3 id="æ¡ˆä¾‹ï¼ˆé¢„æµ‹ä¹³è…ºç™Œ-åˆ†ç±»ï¼‰"><a href="#æ¡ˆä¾‹ï¼ˆé¢„æµ‹ä¹³è…ºç™Œ-åˆ†ç±»ï¼‰" class="headerlink" title="æ¡ˆä¾‹ï¼ˆé¢„æµ‹ä¹³è…ºç™Œ åˆ†ç±»ï¼‰"></a>æ¡ˆä¾‹ï¼ˆé¢„æµ‹ä¹³è…ºç™Œ åˆ†ç±»ï¼‰</h3><blockquote><ul><li>ç”¨å…¨è¿æ¥ç¥ç»ç½‘ç»œé¢„æµ‹ä¹³è…ºç™Œ</li><li>å¯¹æ¯”æœºå™¨å­¦ä¹ </li></ul></blockquote><h4 id="model-train"><a href="#model-train" class="headerlink" title="model_train"></a>model_train</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense  <span class="comment"># ç¨ å¯†å±‚</span></span><br><span class="line"><span class="keyword">from</span> keras.utils.np_utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report  <span class="comment"># éªŒè¯</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.font_manager <span class="keyword">as</span> font_manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜</span></span><br><span class="line"><span class="comment"># font_path = &#x27;../SimHei.ttf&#x27;  # å°†æ­¤è·¯å¾„æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ SimHei å­—ä½“æ–‡ä»¶çš„å®é™…è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšç¬¬äºŒæ­¥å¾—åˆ°çš„é‚£ä¸ªè·¯å¾„</span></span><br><span class="line"><span class="comment"># font_manager.fontManager.addfont(font_path)</span></span><br><span class="line"><span class="comment"># plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;]</span></span><br><span class="line"><span class="comment"># plt.rcParams[&#x27;axes.unicode_minus&#x27;] = False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 111111111111111111111111 æ•°æ®é¢„å¤„ç† 1111111111111111111111111111111111111111111111</span></span><br><span class="line"><span class="comment"># åŠ è½½æ•°æ®é›†</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;breast_cancer_data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–ç‰¹å¾å’Œæ ‡ç­¾</span></span><br><span class="line">X = dataset.iloc[:, :-<span class="number">1</span>]</span><br><span class="line">Y = dataset[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›† random_stateéšæœºç§å­å›ºå®š ä¿è¯æ¯æ¬¡æ•°æ®éšæœºä¸€æ ·</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®æ ‡ç­¾è½¬ä¸ºone-hot ç‹¬çƒ­å‘é‡æ ¼å¼</span></span><br><span class="line">y_train_one = to_categorical(y_train, <span class="number">2</span>)  <span class="comment"># 2ä¸ªç±»åˆ«</span></span><br><span class="line">y_test_one = to_categorical(y_test, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># print(y_train_one)  # [1. 0.]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®ç‰¹å¾å½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">x_train = sc.fit_transform(x_train)</span><br><span class="line">x_test = sc.fit_transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 22222222222222222222 ç”¨kerasæ¡†æ¶æ­å»ºæ·±åº¦å­¦ä¹ ç¥ç»ç½‘ç»œæ¨¡å‹ 22222222222222222222222222222222222222222222</span></span><br><span class="line">model = keras.Sequential()</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">2</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç¥ç»ç½‘ç»œè¿›è¡Œç¼–è¯‘ æŸå¤±å‡½æ•°+è¯„ä»·æŒ‡æ ‡</span></span><br><span class="line"><span class="comment">#  categorical_crossentropyï¼šäº¤å‰ç†µ</span></span><br><span class="line"><span class="comment">#  optimizerä¼˜åŒ–å™¨:SGDéšæœºæ¢¯åº¦å‘é‡æ³•</span></span><br><span class="line"><span class="comment">#  metricsï¼šè¯„ä»·æŒ‡æ ‡ å‡†ç¡®ç‡</span></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>, optimizer=<span class="string">&#x27;SGD&#x27;</span>, metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># epochsè½®æ•°</span></span><br><span class="line"><span class="comment"># batch_sizeä¸€æ¬¡å¤šå°‘ä¸ªä¸€èµ· å¹¶è¡Œ</span></span><br><span class="line"><span class="comment"># verbose 2è¡¨ç¤ºæ§åˆ¶å°å¯è§‚å¯Ÿ</span></span><br><span class="line"><span class="comment"># validation_dataéªŒè¯æ•°æ® ç”¨æµ‹è¯•é›†éªŒè¯ æ¡†æ¶ç”¨äºåˆ¤æ–­æ˜¯å¦è¿‡æ‹Ÿåˆ</span></span><br><span class="line">history = model.fit(x_train, y_train_one, epochs=<span class="number">120</span>, batch_size=<span class="number">64</span>, verbose=<span class="number">2</span>, validation_data=(x_test, y_test_one))</span><br><span class="line">model.save(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 333333333333333333333 ç»˜å›¾ 333333333333333333333333333333</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;loss&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>) <span class="comment"># è®­ç»ƒé›†losså€¼</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_loss&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>) <span class="comment"># éªŒè¯é›†losså€¼</span></span><br><span class="line">plt.title(<span class="string">&quot;å…¨è¿æ¥ç¥ç»ç½‘ç»œlosså€¼å›¾&quot;</span>)</span><br><span class="line">plt.legend() <span class="comment"># å›¾ä¾‹</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜åˆ¶è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„å‡†ç¡®ç‡å¯¹æ¯”å›¾</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;accuracy&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>) <span class="comment"># è®­ç»ƒé›†å‡†ç¡®ç‡</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_accuracy&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>) <span class="comment"># éªŒè¯é›†å‡†ç¡®ç‡</span></span><br><span class="line">plt.title(<span class="string">&quot;å…¨è¿æ¥ç¥ç»ç½‘ç»œaccuracyå€¼å›¾&quot;</span>)</span><br><span class="line">plt.legend() <span class="comment"># å›¾ä¾‹</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="model-test"><a href="#model-test" class="headerlink" title="model_test"></a>model_test</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cProfile <span class="keyword">import</span> label</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense  <span class="comment"># ç¨ å¯†å±‚</span></span><br><span class="line"><span class="keyword">from</span> keras.utils.np_utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report  <span class="comment"># éªŒè¯</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.font_manager <span class="keyword">as</span> font_manager</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"></span><br><span class="line"><span class="comment"># 111111111111111111111111 æ•°æ®é¢„å¤„ç† 1111111111111111111111111111111111111111111111</span></span><br><span class="line"><span class="comment"># åŠ è½½æ•°æ®é›†</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;breast_cancer_data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æå–ç‰¹å¾å’Œæ ‡ç­¾</span></span><br><span class="line">X = dataset.iloc[:, :-<span class="number">1</span>]</span><br><span class="line">Y = dataset[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›† random_stateéšæœºç§å­å›ºå®š ä¿è¯æ¯æ¬¡æ•°æ®éšæœºä¸€æ ·</span></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®æ ‡ç­¾è½¬ä¸ºone-hot ç‹¬çƒ­å‘é‡æ ¼å¼</span></span><br><span class="line">y_test_one = to_categorical(y_test, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># print(y_train_one)  # [1. 0.]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®ç‰¹å¾å½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">x_test = sc.fit_transform(x_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥æ¨¡å‹</span></span><br><span class="line">model = load_model(<span class="string">&quot;model.h5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">predict = model.predict(x_test)</span><br><span class="line"><span class="comment"># print(predict)</span></span><br><span class="line"></span><br><span class="line">y_pred = np.argmax(predict, axis=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(y_pred)  <span class="comment"># [0,1,0]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬ä¸ºæ±‰å­—</span></span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y_pred)):</span><br><span class="line">    <span class="keyword">if</span> y_pred[i] == <span class="number">0</span>:</span><br><span class="line">        result.append(<span class="string">&quot;è‰¯æ€§&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result.append(<span class="string">&quot;æ¶æ€§&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°æ¨¡å‹ç²¾ç¡®åˆ° å¬å›ç‡</span></span><br><span class="line">report = classification_report(y_test, y_pred, labels=[<span class="number">0</span>, <span class="number">1</span>], target_names=[<span class="string">&quot;è‰¯æ€§&quot;</span>, <span class="string">&quot;æ¶æ€§&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(report)</span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°å›¾åƒ"><a href="#å‡½æ•°å›¾åƒ" class="headerlink" title="å‡½æ•°å›¾åƒ"></a>å‡½æ•°å›¾åƒ</h4><h5 id="loss"><a href="#loss" class="headerlink" title="loss"></a>loss</h5><p><img src="/img/assets/plot_2025-09-21%2016-31-23_0.png" alt="plot_2025-09-21 16-31-23_0"></p><h5 id="accuracy"><a href="#accuracy" class="headerlink" title="accuracy"></a>accuracy</h5><p><img src="/img/assets/plot_2025-09-21%2016-31-23_1.png" alt="plot_2025-09-21 16-31-23_1"></p><h4 id="é¢„æµ‹æŠ¥å‘Š"><a href="#é¢„æµ‹æŠ¥å‘Š" class="headerlink" title="é¢„æµ‹æŠ¥å‘Š"></a>é¢„æµ‹æŠ¥å‘Š</h4><p><img src="/img/assets/image-20250921165430933.png" alt="image-20250921165430933"></p><h3 id="æ¡ˆä¾‹ï¼ˆç©ºæ°”è´¨é‡-çº¿æ€§å›å½’ï¼‰"><a href="#æ¡ˆä¾‹ï¼ˆç©ºæ°”è´¨é‡-çº¿æ€§å›å½’ï¼‰" class="headerlink" title="æ¡ˆä¾‹ï¼ˆç©ºæ°”è´¨é‡ çº¿æ€§å›å½’ï¼‰"></a>æ¡ˆä¾‹ï¼ˆç©ºæ°”è´¨é‡ çº¿æ€§å›å½’ï¼‰</h3><h4 id="model-train-1"><a href="#model-train-1" class="headerlink" title="model_train"></a>model_train</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense  <span class="comment"># ç¨ å¯†å±‚</span></span><br><span class="line"><span class="keyword">from</span> keras.utils.np_utils <span class="keyword">import</span> to_categorical</span><br><span class="line"></span><br><span class="line"><span class="comment">#  11111111111111111111111111 æ•°æ®å¤„ç† 1111111111111111111111</span></span><br><span class="line"><span class="comment"># å¯¼å…¥æ•°æ®</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®å½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">scaled = sc.fit_transform(dataset)  <span class="comment"># æ•°åˆ—å½¢å¼ æ²¡æœ‰åˆ—å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½’ä¸€åŒ–æ•°æ®è½¬ä¸ºdataframeæ ¼å¼ï¼Œæ–¹ä¾¿åç»­å¤„ç†</span></span><br><span class="line">dataset_sc = pd.DataFrame(scaled)  <span class="comment"># æœ‰ç±»å åŒdataset</span></span><br><span class="line"><span class="built_in">print</span>(dataset_sc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾å‡ºç‰¹å¾å€¼å’Œæ ‡ç­¾</span></span><br><span class="line">X = dataset_sc.iloc[:, :-<span class="number">1</span>]  <span class="comment"># æ‰€æœ‰è¡Œé™¤äº†æœ€åä¸€åˆ—</span></span><br><span class="line">Y = dataset_sc.iloc[:, -<span class="number">1</span>]  <span class="comment"># æ‰€æœ‰è¡Œ æœ€åä¸€åˆ—</span></span><br><span class="line"></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 22222222222222222222222 åˆ©ç”¨kerasæ¨¡å‹æ­å»º 2222222222222222222222222222222222</span></span><br><span class="line">model = keras.Sequential()</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">10</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>))  <span class="comment"># è¾“å‡ºå±‚ ä¸è¦æ¿€æ´»å‡½æ•° ä½†è¦åå½’ä¸€åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç¥ç»ç½‘ç»œè¿›è¡Œç¼–è¯‘</span></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;mse&#x27;</span>, optimizer=<span class="string">&#x27;SGD&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹è®­ç»ƒ</span></span><br><span class="line">history = model.fit(x_train, y_train, epochs=<span class="number">100</span>, batch_size=<span class="number">32</span>, verbose=<span class="number">2</span>, validation_data=(x_test, y_test))</span><br><span class="line">model.save(<span class="string">&#x27;model.h5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 333333333333333333 å¯è§†åŒ– 3333333333333333</span></span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;loss&#x27;</span>], label=<span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">plt.plot(history.history[<span class="string">&#x27;val_loss&#x27;</span>], label=<span class="string">&#x27;val&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;å…¨è¿æ¥ç¥ç»ç½‘ç»œlosså€¼å›¾&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="model-test-1"><a href="#model-test-1" class="headerlink" title="model_test"></a>model_test</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> scipy.ndimage <span class="keyword">import</span> label</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense  <span class="comment"># ç¨ å¯†å±‚</span></span><br><span class="line"><span class="keyword">from</span> keras.utils.np_utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> load_model</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> concatenate</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"></span><br><span class="line"><span class="comment">#  11111111111111111111111111 æ•°æ®å¤„ç† 1111111111111111111111</span></span><br><span class="line"><span class="comment"># å¯¼å…¥æ•°æ®</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">&quot;data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®å½’ä¸€åŒ–</span></span><br><span class="line">sc = MinMaxScaler(feature_range=(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">scaled = sc.fit_transform(dataset)  <span class="comment"># æ•°åˆ—å½¢å¼ æ²¡æœ‰åˆ—å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å½’ä¸€åŒ–æ•°æ®è½¬ä¸ºdataframeæ ¼å¼ï¼Œæ–¹ä¾¿åç»­å¤„ç†</span></span><br><span class="line">dataset_sc = pd.DataFrame(scaled)  <span class="comment"># æœ‰ç±»å åŒdataset</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾å‡ºç‰¹å¾å€¼å’Œæ ‡ç­¾</span></span><br><span class="line">X = dataset_sc.iloc[:, :-<span class="number">1</span>]  <span class="comment"># æ‰€æœ‰è¡Œé™¤äº†æœ€åä¸€åˆ—</span></span><br><span class="line">Y = dataset_sc.iloc[:, -<span class="number">1</span>]  <span class="comment"># æ‰€æœ‰è¡Œ æœ€åä¸€åˆ—</span></span><br><span class="line"></span><br><span class="line">x_train, x_test, y_train, y_test = train_test_split(X, Y, test_size=<span class="number">0.05</span>, random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2222222222222 åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹ 222222222222222222</span></span><br><span class="line">model = load_model(<span class="string">&quot;model.h5&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¢„æµ‹</span></span><br><span class="line">yhat = model.predict(x_test)</span><br><span class="line"><span class="comment"># print(yhat) # [0.1681547 ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¢„æµ‹å€¼åå½’ä¸€åŒ–</span></span><br><span class="line">inv_yhat = concatenate((x_test, yhat), axis=<span class="number">1</span>) <span class="comment"># è¿æ¥ä¸¤ä¸ªNumpyæ•°æ®</span></span><br><span class="line"><span class="comment"># print(inv_yhat) # å½’ä¸€æ•°æ® [0.05119454 0.09076175 0.06796117 ... 0.14107884 0.56149733 0.13507885]</span></span><br><span class="line">inv_yhat = sc.inverse_transform(inv_yhat) <span class="comment"># åå½’ä¸€åŒ–</span></span><br><span class="line"><span class="comment"># print(inv_yhat)  [ 12.          24.           5.         ...   1.57         7.</span></span><br><span class="line"><span class="comment">#    82.83994955]</span></span><br><span class="line">prediction = inv_yhat[:, <span class="number">6</span>]</span><br><span class="line"><span class="comment"># print(prediction)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†y_testç»´åº¦è½¬æ¢ äºŒç»´</span></span><br><span class="line"><span class="comment"># 2396    0.117073</span></span><br><span class="line"><span class="comment"># 1407    0.146341</span></span><br><span class="line">y_test = np.array(y_test) <span class="comment"># [0.11707317 0.14634146]</span></span><br><span class="line">y_test = np.reshape(y_test, (y_test.shape[<span class="number">0</span>], <span class="number">1</span>)) <span class="comment"># [[0.11707317 0.14634146]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åå‘ç¼©æ”¾çœŸå®å€¼</span></span><br><span class="line"><span class="comment"># print(x_test) # 2396  0.051195  0.090762  0.067961  0.172414  0.141079  0.561497</span></span><br><span class="line">inv_y = concatenate((x_test, y_test), axis=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(inv_y)</span><br><span class="line">inv_y = sc.inverse_transform(inv_y)</span><br><span class="line">real = inv_y[:, <span class="number">6</span>]</span><br><span class="line"><span class="built_in">print</span>(real)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 333333333333333 è¯„ä»· 333333333333333333</span></span><br><span class="line"><span class="comment"># è®¡ç®—rmseå’ŒMAPE</span></span><br><span class="line">remse = sqrt(mean_squared_error(real, prediction))</span><br><span class="line">mape = np.mean(np.<span class="built_in">abs</span>(real - prediction) / real)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;remse&quot;</span>, remse)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;mape&quot;</span>, mape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”»å‡ºçœŸå®å€¼å’Œé¢„æµ‹å€¼å¯¹æ¯”å›¾</span></span><br><span class="line">plt.plot(prediction, label=<span class="string">&quot;é¢„æµ‹å€¼&quot;</span>)</span><br><span class="line">plt.plot(real, label=<span class="string">&quot;çœŸå®å€¼&quot;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;å…¨è¿æ¥ç¥ç»ç½‘ç»œç©ºæ°”è´¨é‡é¢„æµ‹å¯¹æ¯”å›¾&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="losså›¾åƒ"><a href="#losså›¾åƒ" class="headerlink" title="losså›¾åƒ"></a>losså›¾åƒ</h4><p><img src="/img/assets/loss.png" alt="loss"></p><h4 id="çœŸå®å€¼é¢„æµ‹å€¼å¯¹æ¯”å›¾"><a href="#çœŸå®å€¼é¢„æµ‹å€¼å¯¹æ¯”å›¾" class="headerlink" title="çœŸå®å€¼é¢„æµ‹å€¼å¯¹æ¯”å›¾"></a>çœŸå®å€¼é¢„æµ‹å€¼å¯¹æ¯”å›¾</h4><p><img src="/img/assets/%E5%AF%B9%E6%AF%94%E5%9B%BE.png" alt="å¯¹æ¯”å›¾"></p>]]></content>
      
      
      <categories>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
            <tag> ç¥ç»ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼Day1</title>
      <link href="//post/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-day01.html"/>
      <url>//post/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-day01.html</url>
      
        <content type="html"><![CDATA[<h1 id="1ï¼Œè®¾è®¡æ¨¡å¼æ¦‚è¿°"><a href="#1ï¼Œè®¾è®¡æ¨¡å¼æ¦‚è¿°" class="headerlink" title="1ï¼Œè®¾è®¡æ¨¡å¼æ¦‚è¿°"></a>1ï¼Œè®¾è®¡æ¨¡å¼æ¦‚è¿°</h1><h2 id="1-1-è½¯ä»¶è®¾è®¡æ¨¡å¼çš„äº§ç”ŸèƒŒæ™¯"><a href="#1-1-è½¯ä»¶è®¾è®¡æ¨¡å¼çš„äº§ç”ŸèƒŒæ™¯" class="headerlink" title="1.1 è½¯ä»¶è®¾è®¡æ¨¡å¼çš„äº§ç”ŸèƒŒæ™¯"></a>1.1 è½¯ä»¶è®¾è®¡æ¨¡å¼çš„äº§ç”ŸèƒŒæ™¯</h2><p>â€œè®¾è®¡æ¨¡å¼â€æœ€åˆå¹¶ä¸æ˜¯å‡ºç°åœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œè€Œæ˜¯è¢«ç”¨äºå»ºç­‘é¢†åŸŸçš„è®¾è®¡ä¸­ã€‚</p><p>1977å¹´ç¾å›½è‘—åå»ºç­‘å¤§å¸ˆã€åŠ åˆ©ç¦å°¼äºšå¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ç¯å¢ƒç»“æ„ä¸­å¿ƒä¸»ä»» <code>å…‹é‡Œæ–¯æ‰˜å¤«Â·äºšå†å±±å¤§ï¼ˆChristopher Alexanderï¼‰</code>åœ¨ä»–çš„è‘—ä½œã€Šå»ºç­‘æ¨¡å¼è¯­è¨€ï¼šåŸé•‡ã€å»ºç­‘ã€æ„é€ ã€‹ä¸­æè¿°äº†ä¸€äº›å¸¸è§çš„å»ºç­‘è®¾è®¡é—®é¢˜ï¼Œå¹¶æå‡ºäº† 253 ç§å…³äºå¯¹åŸé•‡ã€é‚»é‡Œã€ä½å®…ã€èŠ±å›­å’Œæˆ¿é—´ç­‰è¿›è¡Œè®¾è®¡çš„åŸºæœ¬æ¨¡å¼ã€‚</p><p>1990å¹´è½¯ä»¶å·¥ç¨‹ç•Œå¼€å§‹ç ”è®¨è®¾è®¡æ¨¡å¼çš„è¯é¢˜ï¼Œåæ¥å¬å¼€äº†å¤šæ¬¡å…³äºè®¾è®¡æ¨¡å¼çš„ç ”è®¨ä¼šã€‚ç›´åˆ°1995 å¹´ï¼Œè‰¾ç‘å…‹Â·ä¼½é©¬ï¼ˆErichGammaï¼‰ã€ç†æŸ»å¾·Â·æµ·å°”å§†ï¼ˆRichard Helmï¼‰ã€æ‹‰å°”å¤«Â·çº¦ç¿°æ£®ï¼ˆRalph Johnsonï¼‰ã€çº¦ç¿°Â·å¨åˆ©æ–¯è¿ªæ–¯ï¼ˆJohn Vlissidesï¼‰ç­‰ 4 ä½ä½œè€…åˆä½œå‡ºç‰ˆäº†ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦ï¼Œåœ¨æ­¤ä¹¦ä¸­æ”¶å½•äº† 23 ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¿™æ˜¯è®¾è®¡æ¨¡å¼é¢†åŸŸé‡Œç¨‹ç¢‘çš„äº‹ä»¶ï¼Œå¯¼è‡´äº†è½¯ä»¶è®¾è®¡æ¨¡å¼çš„çªç ´ã€‚è¿™ 4 ä½ä½œè€…åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸé‡Œä¹Ÿä»¥ä»–ä»¬çš„â€œå››äººç»„â€ï¼ˆGang of Fourï¼ŒGoFï¼‰è‘—ç§°ã€‚</p><h2 id="1-2-è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µ"><a href="#1-2-è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µ" class="headerlink" title="1.2 è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µ"></a>1.2 è½¯ä»¶è®¾è®¡æ¨¡å¼çš„æ¦‚å¿µ</h2><p>è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ˆSoftware Design Patternï¼‰ï¼Œåˆç§°è®¾è®¡æ¨¡å¼ï¼Œæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚å®ƒæè¿°äº†åœ¨è½¯ä»¶è®¾è®¡è¿‡ç¨‹ä¸­çš„ä¸€äº›ä¸æ–­é‡å¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠè¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„ä¸€ç³»åˆ—å¥—è·¯ï¼Œæ˜¯å‰è¾ˆä»¬çš„ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ï¼Œå…·æœ‰ä¸€å®šçš„æ™®éæ€§ï¼Œå¯ä»¥åå¤ä½¿ç”¨ã€‚</p><h2 id="1-3-å­¦ä¹ è®¾è®¡æ¨¡å¼çš„å¿…è¦æ€§"><a href="#1-3-å­¦ä¹ è®¾è®¡æ¨¡å¼çš„å¿…è¦æ€§" class="headerlink" title="1.3 å­¦ä¹ è®¾è®¡æ¨¡å¼çš„å¿…è¦æ€§"></a>1.3 å­¦ä¹ è®¾è®¡æ¨¡å¼çš„å¿…è¦æ€§</h2><p>è®¾è®¡æ¨¡å¼çš„æœ¬è´¨æ˜¯é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™çš„å®é™…è¿ç”¨ï¼Œæ˜¯å¯¹ç±»çš„å°è£…æ€§ã€ç»§æ‰¿æ€§å’Œå¤šæ€æ€§ä»¥åŠç±»çš„å…³è”å…³ç³»å’Œç»„åˆå…³ç³»çš„å……åˆ†ç†è§£ã€‚</p><p>æ­£ç¡®ä½¿ç”¨è®¾è®¡æ¨¡å¼å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚</p><ul><li>å¯ä»¥æé«˜ç¨‹åºå‘˜çš„æ€ç»´èƒ½åŠ›ã€ç¼–ç¨‹èƒ½åŠ›å’Œè®¾è®¡èƒ½åŠ›ã€‚</li><li>ä½¿ç¨‹åºè®¾è®¡æ›´åŠ æ ‡å‡†åŒ–ã€ä»£ç ç¼–åˆ¶æ›´åŠ å·¥ç¨‹åŒ–ï¼Œä½¿è½¯ä»¶å¼€å‘æ•ˆç‡å¤§å¤§æé«˜ï¼Œä»è€Œç¼©çŸ­è½¯ä»¶çš„å¼€å‘å‘¨æœŸã€‚</li><li>ä½¿è®¾è®¡çš„ä»£ç å¯é‡ç”¨æ€§é«˜ã€å¯è¯»æ€§å¼ºã€å¯é æ€§é«˜ã€çµæ´»æ€§å¥½ã€å¯ç»´æŠ¤æ€§å¼ºã€‚</li></ul><h2 id="1-4-è®¾è®¡æ¨¡å¼åˆ†ç±»"><a href="#1-4-è®¾è®¡æ¨¡å¼åˆ†ç±»" class="headerlink" title="1.4 è®¾è®¡æ¨¡å¼åˆ†ç±»"></a>1.4 è®¾è®¡æ¨¡å¼åˆ†ç±»</h2><ul><li><p><strong>åˆ›å»ºå‹æ¨¡å¼</strong></p><p>ç”¨äºæè¿°â€œæ€æ ·åˆ›å»ºå¯¹è±¡â€ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚GoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†å•ä¾‹ã€åŸå‹ã€å·¥å‚æ–¹æ³•ã€æŠ½è±¡å·¥å‚ã€å»ºé€ è€…ç­‰ 5 ç§åˆ›å»ºå‹æ¨¡å¼ã€‚</p></li><li><p><strong>ç»“æ„å‹æ¨¡å¼</strong></p><p>ç”¨äºæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ï¼ŒGoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†ä»£ç†ã€é€‚é…å™¨ã€æ¡¥æ¥ã€è£…é¥°ã€å¤–è§‚ã€äº«å…ƒã€ç»„åˆç­‰ 7 ç§ç»“æ„å‹æ¨¡å¼ã€‚</p></li><li><p><strong>è¡Œä¸ºå‹æ¨¡å¼</strong></p><p>ç”¨äºæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åŠæ€æ ·åˆ†é…èŒè´£ã€‚GoFï¼ˆå››äººç»„ï¼‰ä¹¦ä¸­æä¾›äº†æ¨¡æ¿æ–¹æ³•ã€ç­–ç•¥ã€å‘½ä»¤ã€èŒè´£é“¾ã€çŠ¶æ€ã€è§‚å¯Ÿè€…ã€ä¸­ä»‹è€…ã€è¿­ä»£å™¨ã€è®¿é—®è€…ã€å¤‡å¿˜å½•ã€è§£é‡Šå™¨ç­‰ 11 ç§è¡Œä¸ºå‹æ¨¡å¼ã€‚</p></li></ul><h1 id="2ï¼ŒUMLå›¾"><a href="#2ï¼ŒUMLå›¾" class="headerlink" title="2ï¼ŒUMLå›¾"></a>2ï¼ŒUMLå›¾</h1><p>ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUnified Modeling Languageï¼ŒUMLï¼‰æ˜¯ç”¨æ¥è®¾è®¡è½¯ä»¶çš„å¯è§†åŒ–å»ºæ¨¡è¯­è¨€ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ç®€å•ã€ç»Ÿä¸€ã€å›¾å½¢åŒ–ã€èƒ½è¡¨è¾¾è½¯ä»¶è®¾è®¡ä¸­çš„åŠ¨æ€ä¸é™æ€ä¿¡æ¯ã€‚</p><p>UML ä»ç›®æ ‡ç³»ç»Ÿçš„ä¸åŒè§’åº¦å‡ºå‘ï¼Œå®šä¹‰äº†ç”¨ä¾‹å›¾ã€ç±»å›¾ã€å¯¹è±¡å›¾ã€çŠ¶æ€å›¾ã€æ´»åŠ¨å›¾ã€æ—¶åºå›¾ã€åä½œå›¾ã€æ„ä»¶å›¾ã€éƒ¨ç½²å›¾ç­‰ 9 ç§å›¾ã€‚</p><h2 id="2-1-ç±»å›¾æ¦‚è¿°"><a href="#2-1-ç±»å›¾æ¦‚è¿°" class="headerlink" title="2.1 ç±»å›¾æ¦‚è¿°"></a>2.1 ç±»å›¾æ¦‚è¿°</h2><p>ç±»å›¾(Class diagram)æ˜¯æ˜¾ç¤ºäº†æ¨¡å‹çš„é™æ€ç»“æ„ï¼Œç‰¹åˆ«æ˜¯æ¨¡å‹ä¸­å­˜åœ¨çš„ç±»ã€ç±»çš„å†…éƒ¨ç»“æ„ä»¥åŠå®ƒä»¬ä¸å…¶ä»–ç±»çš„å…³ç³»ç­‰ã€‚ç±»å›¾ä¸æ˜¾ç¤ºæš‚æ—¶æ€§çš„ä¿¡æ¯ã€‚ç±»å›¾æ˜¯é¢å‘å¯¹è±¡å»ºæ¨¡çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚</p><h2 id="2-2-ç±»å›¾çš„ä½œç”¨"><a href="#2-2-ç±»å›¾çš„ä½œç”¨" class="headerlink" title="2.2 ç±»å›¾çš„ä½œç”¨"></a>2.2 ç±»å›¾çš„ä½œç”¨</h2><ul><li>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œç±»å›¾æ˜¯ä¸€ç§é™æ€çš„ç»“æ„å›¾ï¼Œæè¿°äº†ç³»ç»Ÿçš„ç±»çš„é›†åˆï¼Œç±»çš„å±æ€§å’Œç±»ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥ç®€åŒ–äº†äººä»¬å¯¹ç³»ç»Ÿçš„ç†è§£ï¼›</li><li>ç±»å›¾æ˜¯ç³»ç»Ÿåˆ†æå’Œè®¾è®¡é˜¶æ®µçš„é‡è¦äº§ç‰©ï¼Œæ˜¯ç³»ç»Ÿç¼–ç å’Œæµ‹è¯•çš„é‡è¦æ¨¡å‹ã€‚</li></ul><h2 id="2-3-ç±»å›¾è¡¨ç¤ºæ³•"><a href="#2-3-ç±»å›¾è¡¨ç¤ºæ³•" class="headerlink" title="2.3 ç±»å›¾è¡¨ç¤ºæ³•"></a>2.3 ç±»å›¾è¡¨ç¤ºæ³•</h2><h3 id="2-3-1-ç±»çš„è¡¨ç¤ºæ–¹å¼"><a href="#2-3-1-ç±»çš„è¡¨ç¤ºæ–¹å¼" class="headerlink" title="2.3.1 ç±»çš„è¡¨ç¤ºæ–¹å¼"></a>2.3.1 ç±»çš„è¡¨ç¤ºæ–¹å¼</h3><p>åœ¨UMLç±»å›¾ä¸­ï¼Œç±»ä½¿ç”¨åŒ…å«ç±»åã€å±æ€§(field) å’Œæ–¹æ³•(method) ä¸”å¸¦æœ‰åˆ†å‰²çº¿çš„çŸ©å½¢æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªEmployeeç±»ï¼Œå®ƒåŒ…å«name,ageå’Œaddressè¿™3ä¸ªå±æ€§ï¼Œä»¥åŠwork()æ–¹æ³•ã€‚</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Employee.jpg"></p><p>å±æ€§&#x2F;æ–¹æ³•åç§°å‰åŠ çš„åŠ å·å’Œå‡å·è¡¨ç¤ºäº†è¿™ä¸ªå±æ€§&#x2F;æ–¹æ³•çš„å¯è§æ€§ï¼ŒUMLç±»å›¾ä¸­è¡¨ç¤ºå¯è§æ€§çš„ç¬¦å·æœ‰ä¸‰ç§ï¼š</p><ul><li><code>+ï¼šè¡¨ç¤ºpublic</code></li><li><code>-ï¼šè¡¨ç¤ºprivate</code></li><li><code>#ï¼šè¡¨ç¤ºprotected</code></li></ul><p>å±æ€§çš„å®Œæ•´è¡¨ç¤ºæ–¹å¼æ˜¯ï¼š <strong>å¯è§æ€§  åç§° ï¼šç±»å‹ [ &#x3D; ç¼ºçœå€¼]</strong></p><p>æ–¹æ³•çš„å®Œæ•´è¡¨ç¤ºæ–¹å¼æ˜¯ï¼š <strong>å¯è§æ€§  åç§°(å‚æ•°åˆ—è¡¨) [ ï¼š è¿”å›ç±»å‹]</strong></p><blockquote><p>æ³¨æ„ï¼š</p><p>1ï¼Œä¸­æ‹¬å·ä¸­çš„å†…å®¹è¡¨ç¤ºæ˜¯å¯é€‰çš„</p><p>2ï¼Œä¹Ÿæœ‰å°†ç±»å‹æ”¾åœ¨å˜é‡åå‰é¢ï¼Œè¿”å›å€¼ç±»å‹æ”¾åœ¨æ–¹æ³•åå‰é¢</p></blockquote><p><strong>ä¸¾ä¸ªæ —å­ï¼š</strong></p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/demo.png"></p><p>ä¸Šå›¾Demoç±»å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li>method()æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸º <code>public</code>ï¼Œæ²¡æœ‰å‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</li><li>method1()æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸º <code>private</code>ï¼Œæ²¡æœ‰å‚æ•°ï¼Œè¿”å›å€¼ç±»å‹ä¸ºStringã€‚</li><li>method2()æ–¹æ³•ï¼šä¿®é¥°ç¬¦ä¸º <code>protected</code>ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹ä¸ºintï¼Œç¬¬äºŒä¸ªå‚æ•°ç±»å‹ä¸ºStringï¼Œè¿”å›å€¼ç±»å‹æ˜¯intã€‚</li></ul><h3 id="2-3-2-ç±»ä¸ç±»ä¹‹é—´å…³ç³»çš„è¡¨ç¤ºæ–¹å¼"><a href="#2-3-2-ç±»ä¸ç±»ä¹‹é—´å…³ç³»çš„è¡¨ç¤ºæ–¹å¼" class="headerlink" title="&#x3D;&#x3D;2.3.2 ç±»ä¸ç±»ä¹‹é—´å…³ç³»çš„è¡¨ç¤ºæ–¹å¼&#x3D;&#x3D;"></a>&#x3D;&#x3D;2.3.2 ç±»ä¸ç±»ä¹‹é—´å…³ç³»çš„è¡¨ç¤ºæ–¹å¼&#x3D;&#x3D;</h3><h4 id="2-3-2-1-å…³è”å…³ç³»"><a href="#2-3-2-1-å…³è”å…³ç³»" class="headerlink" title="2.3.2.1 å…³è”å…³ç³»"></a>2.3.2.1 å…³è”å…³ç³»</h4><p>å…³è”å…³ç³»æ˜¯å¯¹è±¡ä¹‹é—´çš„ä¸€ç§å¼•ç”¨å…³ç³»ï¼Œç”¨äºè¡¨ç¤ºä¸€ç±»å¯¹è±¡ä¸å¦ä¸€ç±»å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œå¦‚è€å¸ˆå’Œå­¦ç”Ÿã€å¸ˆå‚…å’Œå¾’å¼Ÿã€ä¸ˆå¤«å’Œå¦»å­ç­‰ã€‚å…³è”å…³ç³»æ˜¯ç±»ä¸ç±»ä¹‹é—´æœ€å¸¸ç”¨çš„ä¸€ç§å…³ç³»ï¼Œåˆ†ä¸ºä¸€èˆ¬å…³è”å…³ç³»ã€èšåˆå…³ç³»å’Œç»„åˆå…³ç³»ã€‚æˆ‘ä»¬å…ˆä»‹ç»ä¸€èˆ¬å…³è”ã€‚</p><p>å…³è”åˆå¯ä»¥åˆ†ä¸ºå•å‘å…³è”ï¼ŒåŒå‘å…³è”ï¼Œè‡ªå…³è”ã€‚</p><p><strong>1ï¼Œå•å‘å…³è”</strong></p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/customer_address.png"></p><p>åœ¨UMLç±»å›¾ä¸­å•å‘å…³è”ç”¨ä¸€ä¸ª&#x3D;&#x3D;å¸¦ç®­å¤´çš„å®çº¿è¡¨ç¤º&#x3D;&#x3D;ã€‚ä¸Šå›¾è¡¨ç¤ºæ¯ä¸ªé¡¾å®¢éƒ½æœ‰ä¸€ä¸ªåœ°å€ï¼Œè¿™é€šè¿‡è®©Customerç±»æŒæœ‰ä¸€ä¸ªç±»å‹ä¸ºAddressçš„æˆå‘˜å˜é‡ç±»å®ç°ã€‚</p><p><strong>2ï¼ŒåŒå‘å…³è”</strong></p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/customer_product.png"></p><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œæ‰€è°“çš„åŒå‘å…³è”å°±æ˜¯åŒæ–¹å„è‡ªæŒæœ‰å¯¹æ–¹ç±»å‹çš„æˆå‘˜å˜é‡ã€‚</p><p>åœ¨UMLç±»å›¾ä¸­ï¼ŒåŒå‘å…³è”ç”¨ä¸€ä¸ªä¸å¸¦ç®­å¤´çš„ç›´çº¿è¡¨ç¤ºã€‚ä¸Šå›¾ä¸­åœ¨Customerç±» ä¸­ç»´æŠ¤ä¸€ä¸ªList&lt;Product&gt;ï¼Œè¡¨ç¤ºä¸€ä¸ªé¡¾å®¢å¯ä»¥è´­ä¹°å¤šä¸ªå•†å“ï¼›åœ¨Productç±»ä¸­ç»´æŠ¤ä¸€ä¸ªCustomerç±»å‹çš„æˆå‘˜å˜é‡è¡¨ç¤ºè¿™ä¸ªäº§å“è¢«å“ªä¸ªé¡¾å®¢æ‰€è´­ä¹°ã€‚</p><p><strong>3ï¼Œè‡ªå…³è”</strong></p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/node.png"></p><p>è‡ªå…³è”åœ¨UMLç±»å›¾ä¸­ç”¨ä¸€ä¸ªå¸¦æœ‰ç®­å¤´ä¸”æŒ‡å‘è‡ªèº«çš„çº¿è¡¨ç¤ºã€‚ä¸Šå›¾çš„æ„æ€å°±æ˜¯Nodeç±»åŒ…å«ç±»å‹ä¸ºNodeçš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå°±æ˜¯â€œè‡ªå·±åŒ…å«è‡ªå·±â€ã€‚</p><h4 id="2-3-2-2-èšåˆå…³ç³»"><a href="#2-3-2-2-èšåˆå…³ç³»" class="headerlink" title="2.3.2.2 èšåˆå…³ç³»"></a>2.3.2.2 èšåˆå…³ç³»</h4><p>èšåˆå…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§ï¼Œæ˜¯å¼ºå…³è”å…³ç³»ï¼Œæ˜¯æ•´ä½“å’Œéƒ¨åˆ†ä¹‹é—´çš„å…³ç³»ã€‚</p><p>èšåˆå…³ç³»ä¹Ÿæ˜¯é€šè¿‡æˆå‘˜å¯¹è±¡æ¥å®ç°çš„ï¼Œå…¶ä¸­æˆå‘˜å¯¹è±¡æ˜¯æ•´ä½“å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æˆå‘˜å¯¹è±¡å¯ä»¥è„±ç¦»æ•´ä½“å¯¹è±¡è€Œç‹¬ç«‹å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œå­¦æ ¡ä¸è€å¸ˆçš„å…³ç³»ï¼Œå­¦æ ¡åŒ…å«è€å¸ˆï¼Œä½†å¦‚æœå­¦æ ¡åœåŠäº†ï¼Œè€å¸ˆä¾ç„¶å­˜åœ¨ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œèšåˆå…³ç³»å¯ä»¥ç”¨&#x3D;&#x3D;å¸¦ç©ºå¿ƒè±å½¢çš„å®çº¿&#x3D;&#x3D;æ¥è¡¨ç¤ºï¼Œè±å½¢æŒ‡å‘æ•´ä½“ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¤§å­¦å’Œæ•™å¸ˆçš„å…³ç³»å›¾ï¼š</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20191229173422328.png"></p><h4 id="2-3-2-3-ç»„åˆå…³ç³»"><a href="#2-3-2-3-ç»„åˆå…³ç³»" class="headerlink" title="2.3.2.3 ç»„åˆå…³ç³»"></a>2.3.2.3 ç»„åˆå…³ç³»</h4><p>ç»„åˆè¡¨ç¤ºç±»ä¹‹é—´çš„æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼Œä½†å®ƒæ˜¯ä¸€ç§æ›´å¼ºçƒˆçš„èšåˆå…³ç³»ã€‚</p><p>åœ¨ç»„åˆå…³ç³»ä¸­ï¼Œæ•´ä½“å¯¹è±¡å¯ä»¥æ§åˆ¶éƒ¨åˆ†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€æ—¦æ•´ä½“å¯¹è±¡ä¸å­˜åœ¨ï¼Œéƒ¨åˆ†å¯¹è±¡ä¹Ÿå°†ä¸å­˜åœ¨ï¼Œéƒ¨åˆ†å¯¹è±¡ä¸èƒ½è„±ç¦»æ•´ä½“å¯¹è±¡è€Œå­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œå¤´å’Œå˜´çš„å…³ç³»ï¼Œæ²¡æœ‰äº†å¤´ï¼Œå˜´ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œç»„åˆå…³ç³»ç”¨å¸¦&#x3D;&#x3D;å®å¿ƒè±å½¢&#x3D;&#x3D;çš„å®çº¿æ¥è¡¨ç¤ºï¼Œè±å½¢æŒ‡å‘æ•´ä½“ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¤´å’Œå˜´çš„å…³ç³»å›¾ï¼š</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20191229173455149.png"></p><h4 id="2-3-2-4-ä¾èµ–å…³ç³»"><a href="#2-3-2-4-ä¾èµ–å…³ç³»" class="headerlink" title="2.3.2.4 ä¾èµ–å…³ç³»"></a>2.3.2.4 ä¾èµ–å…³ç³»</h4><p>ä¾èµ–å…³ç³»æ˜¯ä¸€ç§ä½¿ç”¨å…³ç³»ï¼Œå®ƒæ˜¯å¯¹è±¡ä¹‹é—´ <code>è€¦åˆåº¦æœ€å¼±</code>çš„ä¸€ç§å…³è”æ–¹å¼ï¼Œæ˜¯ä¸´æ—¶æ€§çš„å…³è”ã€‚åœ¨ä»£ç ä¸­ï¼ŒæŸä¸ªç±»çš„æ–¹æ³•é€šè¿‡å±€éƒ¨å˜é‡ã€æ–¹æ³•çš„å‚æ•°æˆ–è€…å¯¹é™æ€æ–¹æ³•çš„è°ƒç”¨æ¥è®¿é—®å¦ä¸€ä¸ªç±»ï¼ˆè¢«ä¾èµ–ç±»ï¼‰ä¸­çš„æŸäº›æ–¹æ³•æ¥å®Œæˆä¸€äº›èŒè´£ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œä¾èµ–å…³ç³»ä½¿ç”¨&#x3D;&#x3D;å¸¦ç®­å¤´çš„è™šçº¿&#x3D;&#x3D;æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»ä½¿ç”¨ç±»æŒ‡å‘è¢«ä¾èµ–çš„ç±»ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯å¸æœºå’Œæ±½è½¦çš„å…³ç³»å›¾ï¼Œå¸æœºé©¾é©¶æ±½è½¦ï¼š</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20191229173518926.png"></p><h4 id="2-3-2-5-ç»§æ‰¿å…³ç³»"><a href="#2-3-2-5-ç»§æ‰¿å…³ç³»" class="headerlink" title="2.3.2.5 ç»§æ‰¿å…³ç³»"></a>2.3.2.5 ç»§æ‰¿å…³ç³»</h4><p>ç»§æ‰¿å…³ç³»æ˜¯å¯¹è±¡ä¹‹é—´è€¦åˆåº¦æœ€å¤§çš„ä¸€ç§å…³ç³»ï¼Œè¡¨ç¤ºä¸€èˆ¬ä¸ç‰¹æ®Šçš„å…³ç³»ï¼Œæ˜¯çˆ¶ç±»ä¸å­ç±»ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯ä¸€ç§ç»§æ‰¿å…³ç³»ã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œæ³›åŒ–å…³ç³»ç”¨å¸¦ç©ºå¿ƒä¸‰è§’ç®­å¤´çš„å®çº¿æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»å­ç±»æŒ‡å‘çˆ¶ç±»ã€‚åœ¨ä»£ç å®ç°æ—¶ï¼Œä½¿ç”¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿æœºåˆ¶æ¥å®ç°æ³›åŒ–å…³ç³»ã€‚ä¾‹å¦‚ï¼ŒStudent ç±»å’Œ Teacher ç±»éƒ½æ˜¯ Person ç±»çš„å­ç±»ï¼Œå…¶ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20191229173539838.png"></p><h4 id="2-3-2-6-å®ç°å…³ç³»"><a href="#2-3-2-6-å®ç°å…³ç³»" class="headerlink" title="2.3.2.6 å®ç°å…³ç³»"></a>2.3.2.6 å®ç°å…³ç³»</h4><p>å®ç°å…³ç³»æ˜¯æ¥å£ä¸å®ç°ç±»ä¹‹é—´çš„å…³ç³»ã€‚åœ¨è¿™ç§å…³ç³»ä¸­ï¼Œç±»å®ç°äº†æ¥å£ï¼Œç±»ä¸­çš„æ“ä½œå®ç°äº†æ¥å£ä¸­æ‰€å£°æ˜çš„æ‰€æœ‰çš„æŠ½è±¡æ“ä½œã€‚</p><p>åœ¨ UML ç±»å›¾ä¸­ï¼Œå®ç°å…³ç³»ä½¿ç”¨å¸¦ç©ºå¿ƒä¸‰è§’ç®­å¤´çš„è™šçº¿æ¥è¡¨ç¤ºï¼Œç®­å¤´ä»å®ç°ç±»æŒ‡å‘æ¥å£ã€‚ä¾‹å¦‚ï¼Œæ±½è½¦å’Œèˆ¹å®ç°äº†äº¤é€šå·¥å…·ï¼Œå…¶ç±»å›¾å¦‚å›¾ 9 æ‰€ç¤ºã€‚</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20191229173554296.png"></p><h1 id="3ï¼Œè½¯ä»¶è®¾è®¡åŸåˆ™"><a href="#3ï¼Œè½¯ä»¶è®¾è®¡åŸåˆ™" class="headerlink" title="3ï¼Œè½¯ä»¶è®¾è®¡åŸåˆ™"></a>3ï¼Œè½¯ä»¶è®¾è®¡åŸåˆ™</h1><p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œä¸ºäº†æé«˜è½¯ä»¶ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§ï¼Œå¢åŠ è½¯ä»¶çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œç¨‹åºå‘˜è¦å°½é‡æ ¹æ®6æ¡åŸåˆ™æ¥å¼€å‘ç¨‹åºï¼Œä»è€Œæé«˜è½¯ä»¶å¼€å‘æ•ˆç‡ã€èŠ‚çº¦è½¯ä»¶å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ã€‚</p><h2 id="3-1-å¼€é—­åŸåˆ™OCP"><a href="#3-1-å¼€é—­åŸåˆ™OCP" class="headerlink" title="3.1 å¼€é—­åŸåˆ™OCP"></a>3.1 å¼€é—­åŸåˆ™OCP</h2><p><strong>å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</strong>ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚ç®€è¨€ä¹‹ï¼Œæ˜¯ä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚</p><p>æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ã€‚</p><p>å› ä¸ºæŠ½è±¡çµæ´»æ€§å¥½ï¼Œé€‚åº”æ€§å¹¿ï¼Œåªè¦æŠ½è±¡çš„åˆç†ï¼Œå¯ä»¥åŸºæœ¬ä¿æŒè½¯ä»¶æ¶æ„çš„ç¨³å®šã€‚è€Œè½¯ä»¶ä¸­æ˜“å˜çš„ç»†èŠ‚å¯ä»¥ä»æŠ½è±¡æ´¾ç”Ÿæ¥çš„å®ç°ç±»æ¥è¿›è¡Œæ‰©å±•ï¼Œå½“è½¯ä»¶éœ€è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªéœ€è¦æ ¹æ®éœ€æ±‚é‡æ–°æ´¾ç”Ÿä¸€ä¸ªå®ç°ç±»æ¥æ‰©å±•å°±å¯ä»¥äº†ã€‚</p><p>ä¸‹é¢ä»¥ <code>æœç‹—è¾“å…¥æ³•</code> çš„çš®è‚¤ä¸ºä¾‹ä»‹ç»å¼€é—­åŸåˆ™çš„åº”ç”¨ã€‚</p><p>ã€ä¾‹ã€‘<code>æœç‹—è¾“å…¥æ³•</code> çš„çš®è‚¤è®¾è®¡ã€‚</p><p>åˆ†æï¼š<code>æœç‹—è¾“å…¥æ³•</code> çš„çš®è‚¤æ˜¯è¾“å…¥æ³•èƒŒæ™¯å›¾ç‰‡ã€çª—å£é¢œè‰²å’Œå£°éŸ³ç­‰å…ƒç´ çš„ç»„åˆã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œçˆ±æ›´æ¢è‡ªå·±çš„è¾“å…¥æ³•çš„çš®è‚¤ï¼Œä¹Ÿå¯ä»¥ä»ç½‘ä¸Šä¸‹è½½æ–°çš„çš®è‚¤ã€‚è¿™äº›çš®è‚¤æœ‰å…±åŒçš„ç‰¹ç‚¹ï¼Œå¯ä»¥ä¸ºå…¶å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆAbstractSkinï¼‰ï¼Œè€Œæ¯ä¸ªå…·ä½“çš„çš®è‚¤ï¼ˆDefaultSpecificSkinå’ŒHeimaSpecificSkinï¼‰æ˜¯å…¶å­ç±»ã€‚ç”¨æˆ·çª—ä½“å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©æˆ–è€…å¢åŠ æ–°çš„ä¸»é¢˜ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åŸä»£ç ï¼Œæ‰€ä»¥å®ƒæ˜¯æ»¡è¶³å¼€é—­åŸåˆ™çš„ã€‚</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/open-close.png"></p><h2 id="3-2-é‡Œæ°ä»£æ¢åŸåˆ™LSP"><a href="#3-2-é‡Œæ°ä»£æ¢åŸåˆ™LSP" class="headerlink" title="3.2 é‡Œæ°ä»£æ¢åŸåˆ™LSP"></a>3.2 é‡Œæ°ä»£æ¢åŸåˆ™LSP</h2><p>é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚</p><p>é‡Œæ°ä»£æ¢åŸåˆ™ï¼šä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚é€šä¿—ç†è§£ï¼š&#x3D;&#x3D;å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½&#x3D;&#x3D;ã€‚æ¢å¥è¯è¯´ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»æ—¶ï¼Œé™¤æ·»åŠ æ–°çš„æ–¹æ³•å®Œæˆæ–°å¢åŠŸèƒ½å¤–ï¼Œå°½é‡ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚</p><p>å¦‚æœé€šè¿‡é‡å†™çˆ¶ç±»çš„æ–¹æ³•æ¥å®Œæˆæ–°çš„åŠŸèƒ½ï¼Œè¿™æ ·å†™èµ·æ¥è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æ•´ä¸ªç»§æ‰¿ä½“ç³»çš„å¯å¤ç”¨æ€§ä¼šæ¯”è¾ƒå·®ï¼Œç‰¹åˆ«æ˜¯è¿ç”¨å¤šæ€æ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œç¨‹åºè¿è¡Œå‡ºé”™çš„æ¦‚ç‡ä¼šéå¸¸å¤§ã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªé‡Œæ°æ›¿æ¢åŸåˆ™ä¸­ç»å…¸çš„ä¸€ä¸ªä¾‹å­</p><p>ã€ä¾‹ã€‘æ­£æ–¹å½¢ä¸æ˜¯é•¿æ–¹å½¢ã€‚</p><p>åœ¨æ•°å­¦é¢†åŸŸé‡Œï¼Œæ­£æ–¹å½¢æ¯«æ— ç–‘é—®æ˜¯é•¿æ–¹å½¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªé•¿å®½ç›¸ç­‰çš„é•¿æ–¹å½¢ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¼€å‘çš„ä¸€ä¸ªä¸å‡ ä½•å›¾å½¢ç›¸å…³çš„è½¯ä»¶ç³»ç»Ÿï¼Œå°±å¯ä»¥é¡ºç†æˆç« çš„è®©æ­£æ–¹å½¢ç»§æ‰¿è‡ªé•¿æ–¹å½¢ã€‚</p><p><img src="/img/%E6%AD%A3%E6%96%B9%E5%BD%A2%E4%B8%8D%E6%98%AF%E9%95%BF%E6%96%B9%E5%BD%A2.png"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><p><strong>é•¿æ–¹å½¢ç±»ï¼ˆRectangleï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> length;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getLength</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(<span class="type">double</span> length)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.length = length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">double</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­£æ–¹å½¢ï¼ˆSquareï¼‰ï¼š</strong></p><p>ç”±äºæ­£æ–¹å½¢çš„é•¿å’Œå®½ç›¸åŒï¼Œæ‰€ä»¥åœ¨æ–¹æ³•setLengthå’ŒsetWidthä¸­ï¼Œå¯¹é•¿åº¦å’Œå®½åº¦éƒ½éœ€è¦èµ‹ç›¸åŒå€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWidth</span><span class="params">(<span class="type">double</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setLength(width);</span><br><span class="line">        <span class="built_in">super</span>.setWidth(width);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLength</span><span class="params">(<span class="type">double</span> length)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setLength(length);</span><br><span class="line">        <span class="built_in">super</span>.setWidth(length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»RectangleDemoæ˜¯æˆ‘ä»¬çš„è½¯ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæœ‰ä¸€ä¸ªresizeæ–¹æ³•ä¾èµ–åŸºç±»Rectangleï¼Œresizeæ–¹æ³•æ˜¯RectandleDemoç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥å®ç°å®½åº¦é€æ¸å¢é•¿çš„æ•ˆæœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RectangleDemo</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">resize</span><span class="params">(Rectangle rectangle)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (rectangle.getWidth() &lt;= rectangle.getLength()) &#123;</span><br><span class="line">            rectangle.setWidth(rectangle.getWidth() + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰“å°é•¿æ–¹å½¢çš„é•¿å’Œå®½</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printLengthAndWidth</span><span class="params">(Rectangle rectangle)</span> &#123;</span><br><span class="line">        System.out.println(rectangle.getLength());</span><br><span class="line">        System.out.println(rectangle.getWidth());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        rectangle.setLength(<span class="number">20</span>);</span><br><span class="line">        rectangle.setWidth(<span class="number">10</span>);</span><br><span class="line">        resize(rectangle);</span><br><span class="line">        printLengthAndWidth(rectangle);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;============&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Square</span>();</span><br><span class="line">        rectangle1.setLength(<span class="number">10</span>);</span><br><span class="line">        resize(rectangle1);</span><br><span class="line">        printLengthAndWidth(rectangle1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿è¡Œä¸€ä¸‹è¿™æ®µä»£ç å°±ä¼šå‘ç°ï¼Œå‡å¦‚æˆ‘ä»¬æŠŠä¸€ä¸ªæ™®é€šé•¿æ–¹å½¢ä½œä¸ºå‚æ•°ä¼ å…¥resizeæ–¹æ³•ï¼Œå°±ä¼šçœ‹åˆ°é•¿æ–¹å½¢å®½åº¦é€æ¸å¢é•¿çš„æ•ˆæœï¼Œå½“å®½åº¦å¤§äºé•¿åº¦,ä»£ç å°±ä¼šåœæ­¢ï¼Œè¿™ç§è¡Œä¸ºçš„ç»“æœç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼›å‡å¦‚æˆ‘ä»¬å†æŠŠä¸€ä¸ªæ­£æ–¹å½¢ä½œä¸ºå‚æ•°ä¼ å…¥resizeæ–¹æ³•åï¼Œå°±ä¼šçœ‹åˆ°æ­£æ–¹å½¢çš„å®½åº¦å’Œé•¿åº¦éƒ½åœ¨ä¸æ–­å¢é•¿ï¼Œä»£ç ä¼šä¸€ç›´è¿è¡Œä¸‹å»ï¼Œç›´è‡³ç³»ç»Ÿäº§ç”Ÿæº¢å‡ºé”™è¯¯ã€‚æ‰€ä»¥ï¼Œæ™®é€šçš„é•¿æ–¹å½¢æ˜¯é€‚åˆè¿™æ®µä»£ç çš„ï¼Œæ­£æ–¹å½¢ä¸é€‚åˆã€‚<br>æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šåœ¨resizeæ–¹æ³•ä¸­ï¼ŒRectangleç±»å‹çš„å‚æ•°æ˜¯ä¸èƒ½è¢«Squareç±»å‹çš„å‚æ•°æ‰€ä»£æ›¿ï¼Œå¦‚æœè¿›è¡Œäº†æ›¿æ¢å°±å¾—ä¸åˆ°é¢„æœŸç»“æœã€‚å› æ­¤ï¼ŒSquareç±»å’ŒRectangleç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»è¿åäº†é‡Œæ°ä»£æ¢åŸåˆ™ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ä¸æˆç«‹ï¼Œæ­£æ–¹å½¢ä¸æ˜¯é•¿æ–¹å½¢ã€‚</p><p>å¦‚ä½•æ”¹è¿›å‘¢ï¼Ÿæ­¤æ—¶æˆ‘ä»¬éœ€è¦é‡æ–°è®¾è®¡ä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€‚æŠ½è±¡å‡ºæ¥ä¸€ä¸ªå››è¾¹å½¢æ¥å£(Quadrilateral)ï¼Œè®©Rectangleç±»å’ŒSquareç±»å®ç°Quadrilateralæ¥å£</p><img src="/img/è®¾è®¡æ¨¡å¼/æ­£æ–¹å½¢ä¸æ˜¯é•¿æ–¹å½¢æ”¹è¿›.png" style="zoom:80%;" /><h2 id="3-3-ä¾èµ–å€’è½¬åŸåˆ™DIP"><a href="#3-3-ä¾èµ–å€’è½¬åŸåˆ™DIP" class="headerlink" title="3.3 ä¾èµ–å€’è½¬åŸåˆ™DIP"></a>3.3 ä¾èµ–å€’è½¬åŸåˆ™DIP</h2><p>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚ç®€å•çš„è¯´å°±æ˜¯è¦æ±‚å¯¹æŠ½è±¡è¿›è¡Œç¼–ç¨‹ï¼Œä¸è¦å¯¹å®ç°è¿›è¡Œç¼–ç¨‹ï¼Œè¿™æ ·å°±é™ä½äº†å®¢æˆ·ä¸å®ç°æ¨¡å—é—´çš„è€¦åˆã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£ä¾èµ–å€’è½¬åŸåˆ™</p><p>ã€ä¾‹ã€‘ç»„è£…ç”µè„‘</p><p>ç°è¦ç»„è£…ä¸€å°ç”µè„‘ï¼Œéœ€è¦é…ä»¶cpuï¼Œç¡¬ç›˜ï¼Œå†…å­˜æ¡ã€‚åªæœ‰è¿™äº›é…ç½®éƒ½æœ‰äº†ï¼Œè®¡ç®—æœºæ‰èƒ½æ­£å¸¸çš„è¿è¡Œã€‚é€‰æ‹©cpuæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚Intelï¼ŒAMDç­‰ï¼Œç¡¬ç›˜å¯ä»¥é€‰æ‹©å¸Œæ·ï¼Œè¥¿æ•°ç­‰ï¼Œå†…å­˜æ¡å¯ä»¥é€‰æ‹©é‡‘å£«é¡¿ï¼Œæµ·ç›—èˆ¹ç­‰ã€‚</p><p><strong>ç±»å›¾å¦‚ä¸‹ï¼š</strong></p><img src="/img/è®¾è®¡æ¨¡å¼/ä¾èµ–å€’è½¬åŸåˆ™.png" style="zoom:80%;" /><p>ä»£ç å¦‚ä¸‹ï¼š</p><p><strong>å¸Œæ·ç¡¬ç›˜ç±»ï¼ˆXiJieHardDiskï¼‰:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiJieHardDisk</span> <span class="keyword">implements</span> <span class="title class_">HardDisk</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨å¸Œæ·ç¡¬ç›˜å­˜å‚¨æ•°æ®&quot;</span> + data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨å¸Œæ·å¸Œæ·ç¡¬ç›˜å–æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ•°æ®&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Intelå¤„ç†å™¨ï¼ˆIntelCpuï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntelCpu</span> <span class="keyword">implements</span> <span class="title class_">Cpu</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨Intelå¤„ç†å™¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é‡‘å£«é¡¿å†…å­˜æ¡ï¼ˆKingstonMemoryï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KingstonMemory</span> <span class="keyword">implements</span> <span class="title class_">Memory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨é‡‘å£«é¡¿ä½œä¸ºå†…å­˜æ¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç”µè„‘ï¼ˆComputerï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> XiJieHardDisk hardDisk;</span><br><span class="line">    <span class="keyword">private</span> IntelCpu cpu;</span><br><span class="line">    <span class="keyword">private</span> KingstonMemory memory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> IntelCpu <span class="title function_">getCpu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCpu</span><span class="params">(IntelCpu cpu)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cpu = cpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> KingstonMemory <span class="title function_">getMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemory</span><span class="params">(KingstonMemory memory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memory = memory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> XiJieHardDisk <span class="title function_">getHardDisk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hardDisk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHardDisk</span><span class="params">(XiJieHardDisk hardDisk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hardDisk = hardDisk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¡ç®—æœºå·¥ä½œ&quot;</span>);</span><br><span class="line">        cpu.run();</span><br><span class="line">        memory.save();</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> hardDisk.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä»ç¡¬ç›˜ä¸­è·å–çš„æ•°æ®ä¸ºï¼š&quot;</span> + data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç±»ï¼ˆTestComputerï¼‰ï¼š</strong></p><p>æµ‹è¯•ç±»ç”¨æ¥ç»„è£…ç”µè„‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestComputer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span>();</span><br><span class="line">        computer.setHardDisk(<span class="keyword">new</span> <span class="title class_">XiJieHardDisk</span>());</span><br><span class="line">        computer.setCpu(<span class="keyword">new</span> <span class="title class_">IntelCpu</span>());</span><br><span class="line">        computer.setMemory(<span class="keyword">new</span> <span class="title class_">KingstonMemory</span>());</span><br><span class="line"></span><br><span class="line">        computer.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°å·²ç»ç»„è£…äº†ä¸€å°ç”µè„‘ï¼Œä½†æ˜¯ä¼¼ä¹ç»„è£…çš„ç”µè„‘çš„cpuåªèƒ½æ˜¯Intelçš„ï¼Œå†…å­˜æ¡åªèƒ½æ˜¯é‡‘å£«é¡¿çš„ï¼Œç¡¬ç›˜åªèƒ½æ˜¯å¸Œæ·çš„ï¼Œè¿™å¯¹ç”¨æˆ·è‚¯å®šæ˜¯ä¸å‹å¥½çš„ï¼Œç”¨æˆ·æœ‰äº†æœºç®±è‚¯å®šæ˜¯æƒ³æŒ‰ç…§è‡ªå·±çš„å–œå¥½ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„é…ä»¶ã€‚</p><p>æ ¹æ®ä¾èµ–å€’è½¬åŸåˆ™è¿›è¡Œæ”¹è¿›ï¼š</p><p>ä»£ç æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹Computerç±»ï¼Œè®©Computerç±»ä¾èµ–æŠ½è±¡ï¼ˆå„ä¸ªé…ä»¶çš„æ¥å£ï¼‰ï¼Œè€Œä¸æ˜¯ä¾èµ–äºå„ä¸ªç»„ä»¶å…·ä½“çš„å®ç°ç±»ã€‚</p><p><strong>ç±»å›¾å¦‚ä¸‹ï¼š</strong></p><img src="img/ä¾èµ–å€’è½¬åŸåˆ™æ”¹è¿›.png" alt="image-20191229173554296" style="zoom:70%;" /><p><strong>ç”µè„‘ï¼ˆComputerï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HardDisk hardDisk;</span><br><span class="line">    <span class="keyword">private</span> Cpu cpu;</span><br><span class="line">    <span class="keyword">private</span> Memory memory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HardDisk <span class="title function_">getHardDisk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hardDisk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHardDisk</span><span class="params">(HardDisk hardDisk)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hardDisk = hardDisk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Cpu <span class="title function_">getCpu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCpu</span><span class="params">(Cpu cpu)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cpu = cpu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Memory <span class="title function_">getMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemory</span><span class="params">(Memory memory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memory = memory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¡ç®—æœºå·¥ä½œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢å‘å¯¹è±¡çš„å¼€å‘å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æŠ½è±¡çš„å˜åŒ–æ¦‚ç‡å¾ˆå°ï¼Œè®©ç”¨æˆ·ç¨‹åºä¾èµ–äºæŠ½è±¡ï¼Œå®ç°çš„ç»†èŠ‚ä¹Ÿä¾èµ–äºæŠ½è±¡ã€‚å³ä½¿å®ç°ç»†èŠ‚ä¸æ–­å˜åŠ¨ï¼Œåªè¦æŠ½è±¡ä¸å˜ï¼Œå®¢æˆ·ç¨‹åºå°±ä¸éœ€è¦å˜åŒ–ã€‚è¿™å¤§å¤§é™ä½äº†å®¢æˆ·ç¨‹åºä¸å®ç°ç»†èŠ‚çš„è€¦åˆåº¦ã€‚</p><h2 id="3-4-æ¥å£éš”ç¦»åŸåˆ™ISP"><a href="#3-4-æ¥å£éš”ç¦»åŸåˆ™ISP" class="headerlink" title="3.4 æ¥å£éš”ç¦»åŸåˆ™ISP"></a>3.4 æ¥å£éš”ç¦»åŸåˆ™ISP</h2><p>å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–äºå®ƒä¸ä½¿ç”¨çš„æ–¹æ³•ï¼›ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£æ¥å£éš”ç¦»åŸåˆ™</p><p>ã€ä¾‹ã€‘å®‰å…¨é—¨æ¡ˆä¾‹</p><p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>é»‘é©¬</code>å“ç‰Œçš„å®‰å…¨é—¨ï¼Œè¯¥å®‰å…¨é—¨å…·æœ‰é˜²ç«ã€é˜²æ°´ã€é˜²ç›—çš„åŠŸèƒ½ã€‚å¯ä»¥å°†é˜²ç«ï¼Œé˜²æ°´ï¼Œé˜²ç›—åŠŸèƒ½æå–æˆä¸€ä¸ªæ¥å£ï¼Œå½¢æˆä¸€å¥—è§„èŒƒã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99.png"></p><p>ä¸Šé¢çš„è®¾è®¡æˆ‘ä»¬å‘ç°äº†å®ƒå­˜åœ¨çš„é—®é¢˜ï¼Œé»‘é©¬å“ç‰Œçš„å®‰å…¨é—¨å…·æœ‰é˜²ç›—ï¼Œé˜²æ°´ï¼Œé˜²ç«çš„åŠŸèƒ½ã€‚ç°åœ¨å¦‚æœæˆ‘ä»¬è¿˜éœ€è¦å†åˆ›å»ºä¸€ä¸ªä¼ æ™ºå“ç‰Œçš„å®‰å…¨é—¨ï¼Œè€Œè¯¥å®‰å…¨é—¨åªå…·æœ‰é˜²ç›—ã€é˜²æ°´åŠŸèƒ½å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶å¦‚æœå®ç°SafetyDooræ¥å£å°±è¿èƒŒäº†æ¥å£éš”ç¦»åŸåˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿçœ‹å¦‚ä¸‹ç±»å›¾ï¼š</p><p><img src="/img/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%991.png"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><p><strong>AntiTheftï¼ˆæ¥å£ï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AntiTheft</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">antiTheft</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Fireproofï¼ˆæ¥å£ï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Fireproof</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fireproof</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Waterproofï¼ˆæ¥å£ï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Waterproof</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">waterproof</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>HeiMaSafetyDoorï¼ˆç±»ï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeiMaSafetyDoor</span> <span class="keyword">implements</span> <span class="title class_">AntiTheft</span>,Fireproof,Waterproof &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">antiTheft</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é˜²ç›—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fireproof</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é˜²ç«&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">waterproof</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é˜²æ°´&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ItcastSafetyDoorï¼ˆç±»ï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItcastSafetyDoor</span> <span class="keyword">implements</span> <span class="title class_">AntiTheft</span>,Fireproof &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">antiTheft</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é˜²ç›—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fireproof</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é˜²ç«&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-5-è¿ªç±³ç‰¹æ³•åˆ™LOD"><a href="#3-5-è¿ªç±³ç‰¹æ³•åˆ™LOD" class="headerlink" title="3.5 è¿ªç±³ç‰¹æ³•åˆ™LOD"></a>3.5 è¿ªç±³ç‰¹æ³•åˆ™LOD</h2><p>è¿ªç±³ç‰¹æ³•åˆ™åˆå«æœ€å°‘çŸ¥è¯†åŸåˆ™ã€‚</p><p>åªå’Œä½ çš„ç›´æ¥æœ‹å‹äº¤è°ˆï¼Œä¸è·Ÿâ€œé™Œç”Ÿäººâ€è¯´è¯ï¼ˆTalk only to your immediate friends and not to strangersï¼‰ã€‚</p><p>å…¶å«ä¹‰æ˜¯ï¼šå¦‚æœä¸¤ä¸ªè½¯ä»¶å®ä½“æ— é¡»ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆå°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è¯¥è°ƒç”¨ã€‚å…¶ç›®çš„æ˜¯é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§ã€‚</p><p>è¿ªç±³ç‰¹æ³•åˆ™ä¸­çš„â€œæœ‹å‹â€æ˜¯æŒ‡ï¼šå½“å‰å¯¹è±¡æœ¬èº«ã€å½“å‰å¯¹è±¡çš„æˆå‘˜å¯¹è±¡ã€å½“å‰å¯¹è±¡æ‰€åˆ›å»ºçš„å¯¹è±¡ã€å½“å‰å¯¹è±¡çš„æ–¹æ³•å‚æ•°ç­‰ï¼Œè¿™äº›å¯¹è±¡åŒå½“å‰å¯¹è±¡å­˜åœ¨å…³è”ã€èšåˆæˆ–ç»„åˆå…³ç³»ï¼Œå¯ä»¥ç›´æ¥è®¿é—®è¿™äº›å¯¹è±¡çš„æ–¹æ³•ã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£è¿ªç±³ç‰¹æ³•åˆ™</p><p>ã€ä¾‹ã€‘æ˜æ˜Ÿä¸ç»çºªäººçš„å…³ç³»å®ä¾‹</p><p>æ˜æ˜Ÿç”±äºå…¨èº«å¿ƒæŠ•å…¥è‰ºæœ¯ï¼Œæ‰€ä»¥è®¸å¤šæ—¥å¸¸äº‹åŠ¡ç”±ç»çºªäººè´Ÿè´£å¤„ç†ï¼Œå¦‚å’Œç²‰ä¸çš„è§é¢ä¼šï¼Œå’Œåª’ä½“å…¬å¸çš„ä¸šåŠ¡æ´½æ·¡ç­‰ã€‚è¿™é‡Œçš„ç»çºªäººæ˜¯æ˜æ˜Ÿçš„æœ‹å‹ï¼Œè€Œç²‰ä¸å’Œåª’ä½“å…¬å¸æ˜¯é™Œç”Ÿäººï¼Œæ‰€ä»¥é€‚åˆä½¿ç”¨è¿ªç±³ç‰¹æ³•åˆ™ã€‚</p><p>ç±»å›¾å¦‚ä¸‹ï¼š</p><img src="img/è¿ªç±³ç‰¹æ³•åˆ™.png" alt="image-20191229173554296" style="zoom:80%;" /><p>ä»£ç å¦‚ä¸‹ï¼š</p><p><strong>æ˜æ˜Ÿç±»ï¼ˆStarï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Star</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Star</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç²‰ä¸ç±»ï¼ˆFansï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fans</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Fans</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åª’ä½“å…¬å¸ç±»ï¼ˆCompanyï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Company</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Company</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»çºªäººç±»ï¼ˆAgentï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Agent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Star star;</span><br><span class="line">    <span class="keyword">private</span> Fans fans;</span><br><span class="line">    <span class="keyword">private</span> Company company;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStar</span><span class="params">(Star star)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.star = star;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFans</span><span class="params">(Fans fans)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fans = fans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompany</span><span class="params">(Company company)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.company = company;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">meeting</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(fans.getName() + <span class="string">&quot;ä¸æ˜æ˜Ÿ&quot;</span> + star.getName() + <span class="string">&quot;è§é¢äº†ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">business</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(company.getName() + <span class="string">&quot;ä¸æ˜æ˜Ÿ&quot;</span> + star.getName() + <span class="string">&quot;æ´½æ·¡ä¸šåŠ¡ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-6-åˆæˆå¤ç”¨åŸåˆ™CARP"><a href="#3-6-åˆæˆå¤ç”¨åŸåˆ™CARP" class="headerlink" title="3.6 åˆæˆå¤ç”¨åŸåˆ™CARP"></a>3.6 åˆæˆå¤ç”¨åŸåˆ™CARP</h2><p>åˆæˆå¤ç”¨åŸåˆ™æ˜¯æŒ‡ï¼šå°½é‡å…ˆä½¿ç”¨ <code>ç»„åˆæˆ–è€…èšåˆç­‰å…³è”å…³ç³»æ¥å®ç°ï¼Œå…¶æ¬¡æ‰è€ƒè™‘ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°ã€‚</code></p><p>é€šå¸¸ç±»çš„å¤ç”¨åˆ†ä¸ºç»§æ‰¿å¤ç”¨å’Œåˆæˆå¤ç”¨ä¸¤ç§ã€‚</p><p>ç»§æ‰¿å¤ç”¨è™½ç„¶æœ‰ç®€å•å’Œæ˜“å®ç°çš„ä¼˜ç‚¹ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ol><li>ç»§æ‰¿å¤ç”¨ç ´åäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºç»§æ‰¿ä¼šå°†çˆ¶ç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ï¼Œçˆ¶ç±»å¯¹å­ç±»æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œç™½ç®±â€å¤ç”¨ã€‚</li><li>å­ç±»ä¸çˆ¶ç±»çš„è€¦åˆåº¦é«˜ã€‚çˆ¶ç±»çš„å®ç°çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå¯¼è‡´å­ç±»çš„å®ç°å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸åˆ©äºç±»çš„æ‰©å±•ä¸ç»´æŠ¤ã€‚</li><li>å®ƒé™åˆ¶äº†å¤ç”¨çš„çµæ´»æ€§ã€‚ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥çš„å®ç°æ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶å·²ç»å®šä¹‰ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶ä¸å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚</li></ol><p>é‡‡ç”¨ç»„åˆæˆ–èšåˆå¤ç”¨æ—¶ï¼Œå¯ä»¥å°†å·²æœ‰å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li>å®ƒç»´æŒäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºæˆåˆ†å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚æ˜¯æ–°å¯¹è±¡çœ‹ä¸è§çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œé»‘ç®±â€å¤ç”¨ã€‚</li><li>å¯¹è±¡é—´çš„è€¦åˆåº¦ä½ã€‚å¯ä»¥åœ¨ç±»çš„æˆå‘˜ä½ç½®å£°æ˜æŠ½è±¡ã€‚</li><li>å¤ç”¨çš„çµæ´»æ€§é«˜ã€‚è¿™ç§å¤ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è¿›è¡Œï¼Œæ–°å¯¹è±¡å¯ä»¥åŠ¨æ€åœ°å¼•ç”¨ä¸æˆåˆ†å¯¹è±¡ç±»å‹ç›¸åŒçš„å¯¹è±¡ã€‚</li></ol><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­æ¥ç†è§£åˆæˆå¤ç”¨åŸåˆ™</p><p>ã€ä¾‹ã€‘æ±½è½¦åˆ†ç±»ç®¡ç†ç¨‹åº</p><p>æ±½è½¦æŒ‰â€œåŠ¨åŠ›æºâ€åˆ’åˆ†å¯åˆ†ä¸ºæ±½æ²¹æ±½è½¦ã€ç”µåŠ¨æ±½è½¦ç­‰ï¼›æŒ‰â€œé¢œè‰²â€åˆ’åˆ†å¯åˆ†ä¸ºç™½è‰²æ±½è½¦ã€é»‘è‰²æ±½è½¦å’Œçº¢è‰²æ±½è½¦ç­‰ã€‚å¦‚æœåŒæ—¶è€ƒè™‘è¿™ä¸¤ç§åˆ†ç±»ï¼Œå…¶ç»„åˆå°±å¾ˆå¤šã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><img src="img/åˆæˆå¤ç”¨åŸåˆ™.png" alt="image-20191229173554296" style="zoom:80%;" /><p>ä»ä¸Šé¢ç±»å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ç»§æ‰¿å¤ç”¨äº§ç”Ÿäº†å¾ˆå¤šå­ç±»ï¼Œå¦‚æœç°åœ¨åˆæœ‰æ–°çš„åŠ¨åŠ›æºæˆ–è€…æ–°çš„é¢œè‰²çš„è¯ï¼Œå°±éœ€è¦å†å®šä¹‰æ–°çš„ç±»ã€‚æˆ‘ä»¬è¯•ç€å°†ç»§æ‰¿å¤ç”¨æ”¹ä¸ºèšåˆå¤ç”¨çœ‹ä¸€ä¸‹ã€‚</p><img src="img/åˆæˆå¤ç”¨åŸåˆ™1.png" alt="image-20191229173554296" style="zoom:80%;" /><h1 id="4ï¼Œåˆ›å»ºè€…æ¨¡å¼"><a href="#4ï¼Œåˆ›å»ºè€…æ¨¡å¼" class="headerlink" title="4ï¼Œåˆ›å»ºè€…æ¨¡å¼"></a>4ï¼Œåˆ›å»ºè€…æ¨¡å¼</h1><p>åˆ›å»ºå‹æ¨¡å¼çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯â€œæ€æ ·åˆ›å»ºå¯¹è±¡ï¼Ÿâ€ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚</p><p>è¿™æ ·å¯ä»¥é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œä½¿ç”¨è€…ä¸éœ€è¦å…³æ³¨å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚ã€‚</p><p>åˆ›å»ºå‹æ¨¡å¼åˆ†ä¸ºï¼š</p><ul><li>å•ä¾‹æ¨¡å¼</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼</li><li>æŠ½è±¡å·¥ç¨‹æ¨¡å¼</li><li>åŸå‹æ¨¡å¼</li><li>å»ºé€ è€…æ¨¡å¼</li></ul><h2 id="4-1-å•ä¾‹è®¾è®¡æ¨¡å¼"><a href="#4-1-å•ä¾‹è®¾è®¡æ¨¡å¼" class="headerlink" title="4.1 å•ä¾‹è®¾è®¡æ¨¡å¼"></a>4.1 å•ä¾‹è®¾è®¡æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ Java ä¸­æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p><p>è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚</p><h3 id="4-1-1-å•ä¾‹æ¨¡å¼çš„ç»“æ„"><a href="#4-1-1-å•ä¾‹æ¨¡å¼çš„ç»“æ„" class="headerlink" title="4.1.1 å•ä¾‹æ¨¡å¼çš„ç»“æ„"></a>4.1.1 å•ä¾‹æ¨¡å¼çš„ç»“æ„</h3><p>å•ä¾‹æ¨¡å¼çš„ä¸»è¦æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>å•ä¾‹ç±»ã€‚åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ç±»</li><li>è®¿é—®ç±»ã€‚ä½¿ç”¨å•ä¾‹ç±»</li></ul><h3 id="4-1-2-å•ä¾‹æ¨¡å¼çš„å®ç°"><a href="#4-1-2-å•ä¾‹æ¨¡å¼çš„å®ç°" class="headerlink" title="4.1.2 å•ä¾‹æ¨¡å¼çš„å®ç°"></a>4.1.2 å•ä¾‹æ¨¡å¼çš„å®ç°</h3><blockquote><p>å•ä¾‹è®¾è®¡æ¨¡å¼åˆ†ç±»ä¸¤ç§ï¼š</p><p>é¥¿æ±‰å¼ï¼šç±»åŠ è½½å°±ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»º</p><p>æ‡’æ±‰å¼ï¼šç±»åŠ è½½ä¸ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»ºï¼Œè€Œæ˜¯é¦–æ¬¡ä½¿ç”¨è¯¥å¯¹è±¡æ—¶æ‰ä¼šåˆ›å»º</p></blockquote><ol><li><p>é¥¿æ±‰å¼-æ–¹å¼1ï¼ˆé™æ€å˜é‡æ–¹å¼ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¥¿æ±‰å¼</span></span><br><span class="line"><span class="comment"> *      é™æ€å˜é‡åˆ›å»ºç±»çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;font color=&#39;red&#39;&gt;</code>è¯´æ˜ï¼š<code>&lt;/font&gt;</code></p><p>è¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œå¹¶åˆ›å»ºSingletonç±»çš„å¯¹è±¡instanceã€‚instanceå¯¹è±¡æ˜¯éšç€ç±»çš„åŠ è½½è€Œåˆ›å»ºçš„ã€‚å¦‚æœè¯¥å¯¹è±¡è¶³å¤Ÿå¤§çš„è¯ï¼Œè€Œä¸€ç›´æ²¡æœ‰ä½¿ç”¨å°±ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚</p></li><li><p>é¥¿æ±‰å¼-æ–¹å¼2ï¼ˆé™æ€ä»£ç å—æ–¹å¼ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶æ±‰å¼</span></span><br><span class="line"><span class="comment"> *      åœ¨é™æ€ä»£ç å—ä¸­åˆ›å»ºè¯¥ç±»å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;font color=&#39;red&#39;&gt;</code>è¯´æ˜ï¼š<code>&lt;/font&gt;</code></p><p>è¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œè€Œå¯¹è±¡çš„åˆ›å»ºæ˜¯åœ¨é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯å¯¹ç€ç±»çš„åŠ è½½è€Œåˆ›å»ºã€‚æ‰€ä»¥å’Œé¥¿æ±‰å¼çš„æ–¹å¼1åŸºæœ¬ä¸Šä¸€æ ·ï¼Œå½“ç„¶è¯¥æ–¹å¼ä¹Ÿå­˜åœ¨å†…å­˜æµªè´¹é—®é¢˜ã€‚</p></li><li><p>æ‡’æ±‰å¼-æ–¹å¼1ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼</span></span><br><span class="line"><span class="comment"> *  çº¿ç¨‹ä¸å®‰å…¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;font color=&#39;red&#39;&gt;</code>è¯´æ˜ï¼š<code>&lt;/font&gt;</code></p><p>ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¯¥æ–¹å¼åœ¨æˆå‘˜ä½ç½®å£°æ˜Singletonç±»å‹çš„é™æ€å˜é‡ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå¯¹è±¡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™èµ‹å€¼çš„å‘¢ï¼Ÿå½“è°ƒç”¨getInstance()æ–¹æ³•è·å–Singletonç±»çš„å¯¹è±¡çš„æ—¶å€™æ‰åˆ›å»ºSingletonç±»çš„å¯¹è±¡ï¼Œè¿™æ ·å°±å®ç°äº†æ‡’åŠ è½½çš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯å¤šçº¿ç¨‹ç¯å¢ƒï¼Œä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p></li><li><p>æ‡’æ±‰å¼-æ–¹å¼2ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‡’æ±‰å¼</span></span><br><span class="line"><span class="comment"> *  çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨æˆå‘˜ä½ç½®åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;font color=&#39;red&#39;&gt;</code>è¯´æ˜ï¼š<code>&lt;/font&gt;</code></p><p>è¯¥æ–¹å¼ä¹Ÿå®ç°äº†æ‡’åŠ è½½æ•ˆæœï¼ŒåŒæ—¶åˆè§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯åœ¨getInstance()æ–¹æ³•ä¸Šæ·»åŠ äº†synchronizedå…³é”®å­—ï¼Œå¯¼è‡´è¯¥æ–¹æ³•çš„æ‰§è¡Œæ•ˆæœç‰¹åˆ«ä½ã€‚ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå…¶å®å°±æ˜¯åœ¨åˆå§‹åŒ–instanceçš„æ—¶å€™æ‰ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸€æ—¦åˆå§‹åŒ–å®Œæˆå°±ä¸å­˜åœ¨äº†ã€‚</p></li><li><p>æ‡’æ±‰å¼-æ–¹å¼3ï¼ˆåŒé‡æ£€æŸ¥é”ï¼‰</p><p>å†æ¥è®¨è®ºä¸€ä¸‹æ‡’æ±‰æ¨¡å¼ä¸­åŠ é”çš„é—®é¢˜ï¼Œå¯¹äº <code>getInstance()</code> æ–¹æ³•æ¥è¯´ï¼Œç»å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½æ˜¯è¯»æ“ä½œï¼Œè¯»æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡å¿…è®©æ¯ä¸ªçº¿ç¨‹å¿…é¡»æŒæœ‰é”æ‰èƒ½è°ƒç”¨è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´åŠ é”çš„æ—¶æœºã€‚ç”±æ­¤ä¹Ÿäº§ç”Ÿäº†ä¸€ç§æ–°çš„å®ç°æ¨¡å¼ï¼šåŒé‡æ£€æŸ¥é”æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒé‡æ£€æŸ¥æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//ç¬¬ä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœinstanceä¸ä¸ºnullï¼Œä¸è¿›å…¥æŠ¢é”é˜¶æ®µï¼Œç›´æ¥è¿”å›å®ä¾‹</span></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="comment">//æŠ¢åˆ°é”ä¹‹åå†æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒé‡æ£€æŸ¥é”æ¨¡å¼æ˜¯ä¸€ç§éå¸¸å¥½çš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œè§£å†³äº†å•ä¾‹ã€æ€§èƒ½ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸Šé¢çš„åŒé‡æ£€æµ‹é”æ¨¡å¼çœ‹ä¸Šå»å®Œç¾æ— ç¼ºï¼Œå…¶å®æ˜¯å­˜åœ¨é—®é¢˜ï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆé—®é¢˜ï¼Œå‡ºç°é—®é¢˜çš„åŸå› æ˜¯JVMåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ä¼šè¿›è¡Œä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’åºæ“ä½œã€‚</p><p>è¦è§£å†³åŒé‡æ£€æŸ¥é”æ¨¡å¼å¸¦æ¥ç©ºæŒ‡é’ˆå¼‚å¸¸çš„é—®é¢˜ï¼Œåªéœ€è¦ä½¿ç”¨ <code>volatile</code> å…³é”®å­—, <code>volatile</code> å…³é”®å­—å¯ä»¥ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒé‡æ£€æŸ¥æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//ç¬¬ä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœinstanceä¸ä¸ºnullï¼Œä¸è¿›å…¥æŠ¢é”é˜¶æ®µï¼Œç›´æ¥è¿”å›å®é™…</span></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="comment">//æŠ¢åˆ°é”ä¹‹åå†æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;font color=&quot;red&quot;&gt;</code>å°ç»“ï¼š<code>&lt;/font&gt;</code></p><p>æ·»åŠ  <code>volatile</code> å…³é”®å­—ä¹‹åçš„åŒé‡æ£€æŸ¥é”æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œèƒ½å¤Ÿä¿è¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹çº¿ç¨‹å®‰å…¨ä¹Ÿä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚</p></li><li><p>æ‡’æ±‰å¼-æ–¹å¼4ï¼ˆé™æ€å†…éƒ¨ç±»æ–¹å¼ï¼‰</p><p>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ä¸­å®ä¾‹ç”±å†…éƒ¨ç±»åˆ›å»ºï¼Œç”±äº JVM åœ¨åŠ è½½å¤–éƒ¨ç±»çš„è¿‡ç¨‹ä¸­, æ˜¯ä¸ä¼šåŠ è½½é™æ€å†…éƒ¨ç±»çš„, åªæœ‰å†…éƒ¨ç±»çš„å±æ€§&#x2F;æ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰ä¼šè¢«åŠ è½½, å¹¶åˆå§‹åŒ–å…¶é™æ€å±æ€§ã€‚é™æ€å±æ€§ç”±äºè¢« <code>static</code> ä¿®é¥°ï¼Œä¿è¯åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸¥æ ¼ä¿è¯å®ä¾‹åŒ–é¡ºåºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é™æ€å†…éƒ¨ç±»æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;font color=&#39;red&#39;&gt;</code>è¯´æ˜ï¼š<code>&lt;/font&gt;</code></p><p>ç¬¬ä¸€æ¬¡åŠ è½½Singletonç±»æ—¶ä¸ä¼šå»åˆå§‹åŒ–INSTANCEï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceï¼Œè™šæ‹ŸæœºåŠ è½½SingletonHolder</p><p>å¹¶åˆå§‹åŒ–INSTANCEï¼Œè¿™æ ·ä¸ä»…èƒ½ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿèƒ½ä¿è¯ Singleton ç±»çš„å”¯ä¸€æ€§ã€‚</p><p><code>&lt;font color=&quot;red&quot;&gt;</code>å°ç»“ï¼š<code>&lt;/font&gt;</code></p><p>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§ä¼˜ç§€çš„å•ä¾‹æ¨¡å¼ï¼Œæ˜¯å¼€æºé¡¹ç›®ä¸­æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§å•ä¾‹æ¨¡å¼ã€‚åœ¨æ²¡æœ‰åŠ ä»»ä½•é”çš„æƒ…å†µä¸‹ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¸‹çš„å®‰å…¨ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•æ€§èƒ½å½±å“å’Œç©ºé—´çš„æµªè´¹ã€‚</p></li><li><p>æšä¸¾æ–¹å¼</p><p>æšä¸¾ç±»å®ç°å•ä¾‹æ¨¡å¼æ˜¯æåŠ›æ¨èçš„å•ä¾‹å®ç°æ¨¡å¼ï¼Œå› ä¸ºæšä¸¾ç±»å‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”åªä¼šè£…è½½ä¸€æ¬¡ï¼Œè®¾è®¡è€…å……åˆ†çš„åˆ©ç”¨äº†æšä¸¾çš„è¿™ä¸ªç‰¹æ€§æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼Œæšä¸¾çš„å†™æ³•éå¸¸ç®€å•ï¼Œè€Œä¸”æšä¸¾ç±»å‹æ˜¯æ‰€ç”¨å•ä¾‹å®ç°ä¸­å”¯ä¸€ä¸€ç§ä¸ä¼šè¢«ç ´åçš„å•ä¾‹å®ç°æ¨¡å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æšä¸¾æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;font color=&#39;red&#39;&gt;</code>è¯´æ˜ï¼š<code>&lt;/font&gt;</code></p><p>æšä¸¾æ–¹å¼å±äºæ¶æ±‰å¼æ–¹å¼ã€‚</p></li></ol><h3 id="4-1-3-å­˜åœ¨çš„é—®é¢˜"><a href="#4-1-3-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="4.1.3 å­˜åœ¨çš„é—®é¢˜"></a>4.1.3 å­˜åœ¨çš„é—®é¢˜</h3><h4 id="4-1-3-1-é—®é¢˜æ¼”ç¤º"><a href="#4-1-3-1-é—®é¢˜æ¼”ç¤º" class="headerlink" title="4.1.3.1 é—®é¢˜æ¼”ç¤º"></a>4.1.3.1 é—®é¢˜æ¼”ç¤º</h4><p>ç ´åå•ä¾‹æ¨¡å¼ï¼š</p><p>ä½¿ä¸Šé¢å®šä¹‰çš„å•ä¾‹ç±»ï¼ˆSingletonï¼‰å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œæšä¸¾æ–¹å¼é™¤å¤–ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åºåˆ—åŒ–å’Œåå°„ã€‚</p><ul><li><p>åºåˆ—åŒ–ååºåˆ—åŒ–</p><p><strong>Singletonç±»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Testç±»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//å¾€æ–‡ä»¶ä¸­å†™å¯¹è±¡</span></span><br><span class="line">        <span class="comment">//writeObject2File();</span></span><br><span class="line">        <span class="comment">//ä»æ–‡ä»¶ä¸­è¯»å–å¯¹è±¡</span></span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">s1</span> <span class="operator">=</span> readObjectFromFile();</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">s2</span> <span class="operator">=</span> readObjectFromFile();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­ä¸¤ä¸ªååºåˆ—åŒ–åçš„å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        System.out.println(s1 == s2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton <span class="title function_">readObjectFromFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå¯¹è±¡è¾“å…¥æµå¯¹è±¡</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;C:\\Users\\Think\\Desktop\\a.txt&quot;</span>));</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªè¯»å–Singletonå¯¹è±¡</span></span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> (Singleton) ois.readObject();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">writeObject2File</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//è·å–Singletonç±»çš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">instance</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line">        <span class="comment">//åˆ›å»ºå¯¹è±¡è¾“å‡ºæµ</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;C:\\Users\\Think\\Desktop\\a.txt&quot;</span>));</span><br><span class="line">        <span class="comment">//å°†instanceå¯¹è±¡å†™å‡ºåˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">        oos.writeObject(instance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢ä»£ç è¿è¡Œç»“æœæ˜¯ <code>false</code>ï¼Œè¡¨æ˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·²ç»ç ´åäº†å•ä¾‹è®¾è®¡æ¨¡å¼ã€‚</p></blockquote></li><li><p>åå°„</p><p><strong>Singletonç±»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">            <span class="keyword">if</span>(instance != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Testç±»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//è·å–Singletonç±»çš„å­—èŠ‚ç å¯¹è±¡</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Singleton.class;</span><br><span class="line">        <span class="comment">//è·å–Singletonç±»çš„ç§æœ‰æ— å‚æ„é€ æ–¹æ³•å¯¹è±¡</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> clazz.getDeclaredConstructor();</span><br><span class="line">        <span class="comment">//å–æ¶ˆè®¿é—®æ£€æŸ¥</span></span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºSingletonç±»çš„å¯¹è±¡s1</span></span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">s1</span> <span class="operator">=</span> (Singleton) constructor.newInstance();</span><br><span class="line">        <span class="comment">//åˆ›å»ºSingletonç±»çš„å¯¹è±¡s2</span></span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">s2</span> <span class="operator">=</span> (Singleton) constructor.newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­é€šè¿‡åå°„åˆ›å»ºçš„ä¸¤ä¸ªSingletonå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        System.out.println(s1 == s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢ä»£ç è¿è¡Œç»“æœæ˜¯ <code>false</code>ï¼Œè¡¨æ˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–å·²ç»ç ´åäº†å•ä¾‹è®¾è®¡æ¨¡å¼</p></blockquote></li></ul><blockquote><p><code>&lt;font color=&quot;red&quot;&gt;</code>æ³¨æ„ï¼š<code>&lt;/font&gt;</code>æšä¸¾æ–¹å¼ä¸ä¼šå‡ºç°è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p></blockquote><h4 id="4-1-3-2-é—®é¢˜çš„è§£å†³"><a href="#4-1-3-2-é—®é¢˜çš„è§£å†³" class="headerlink" title="4.1.3.2 é—®é¢˜çš„è§£å†³"></a>4.1.3.2 é—®é¢˜çš„è§£å†³</h4><ul><li><p>åºåˆ—åŒ–ã€ååºåˆ—æ–¹å¼ç ´åå•ä¾‹æ¨¡å¼çš„è§£å†³æ–¹æ³•</p><p>åœ¨Singletonç±»ä¸­æ·»åŠ  <code>readResolve()</code>æ–¹æ³•ï¼Œåœ¨ååºåˆ—åŒ–æ—¶è¢«åå°„è°ƒç”¨ï¼Œå¦‚æœå®šä¹‰äº†è¿™ä¸ªæ–¹æ³•ï¼Œå°±è¿”å›è¿™ä¸ªæ–¹æ³•çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåˆ™è¿”å›æ–°newå‡ºæ¥çš„å¯¹è±¡ã€‚</p><p><strong>Singletonç±»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹é¢æ˜¯ä¸ºäº†è§£å†³åºåˆ—åŒ–ååºåˆ—åŒ–ç ´è§£å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æºç è§£æï¼š</strong></p><p>ObjectInputStreamç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">readObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// if nested read, passHandle contains handle of enclosing object</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">outerHandle</span> <span class="operator">=</span> passHandle;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> readObject0(<span class="literal">false</span>);<span class="comment">//é‡ç‚¹æŸ¥çœ‹readObject0æ–¹æ³•</span></span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object <span class="title function_">readObject0</span><span class="params">(<span class="type">boolean</span> unshared)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"> ...</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (tc) &#123;</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">case</span> TC_OBJECT:</span><br><span class="line">    <span class="keyword">return</span> checkResolve(readOrdinaryObject(unshared));<span class="comment">//é‡ç‚¹æŸ¥çœ‹readOrdinaryObjectæ–¹æ³•</span></span><br><span class="line">   ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        depth--;</span><br><span class="line">        bin.setBlockDataMode(oldMode);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object <span class="title function_">readOrdinaryObject</span><span class="params">(<span class="type">boolean</span> unshared)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"> ...</span><br><span class="line"> <span class="comment">//isInstantiable è¿”å›trueï¼Œæ‰§è¡Œ desc.newInstance()ï¼Œé€šè¿‡åå°„åˆ›å»ºæ–°çš„å•ä¾‹ç±»ï¼Œ</span></span><br><span class="line">    obj = desc.isInstantiable() ? desc.newInstance() : <span class="literal">null</span>; </span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// åœ¨Singletonç±»ä¸­æ·»åŠ  readResolve æ–¹æ³•å desc.hasReadResolveMethod() æ–¹æ³•æ‰§è¡Œç»“æœä¸ºtrue</span></span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="literal">null</span> &amp;&amp; handles.lookupException(passHandle) == <span class="literal">null</span> &amp;&amp; desc.hasReadResolveMethod()) &#123;</span><br><span class="line">     <span class="comment">// é€šè¿‡åå°„è°ƒç”¨ Singleton ç±»ä¸­çš„ readResolve æ–¹æ³•ï¼Œå°†è¿”å›å€¼èµ‹å€¼ç»™repå˜é‡</span></span><br><span class="line">     <span class="comment">// è¿™æ ·å¤šæ¬¡è°ƒç”¨ObjectInputStreamç±»ä¸­çš„readObjectæ–¹æ³•ï¼Œç»§è€Œå°±ä¼šè°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„readResolveæ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</span></span><br><span class="line">     <span class="type">Object</span> <span class="variable">rep</span> <span class="operator">=</span> desc.invokeReadResolve(obj);</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åå°„æ–¹å¼ç ´è§£å•ä¾‹çš„è§£å†³æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç§æœ‰æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           åå°„ç ´è§£å•ä¾‹æ¨¡å¼éœ€è¦æ·»åŠ çš„ä»£ç </span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span>(instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹å¤–æä¾›é™æ€æ–¹æ³•è·å–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">            <span class="keyword">if</span>(instance != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>&lt;font color=&quot;red&quot;&gt;</code>è¯´æ˜:<code>&lt;/font&gt;</code></p><p>è¿™ç§æ–¹å¼æ¯”è¾ƒå¥½ç†è§£ã€‚å½“é€šè¿‡åå°„æ–¹å¼è°ƒç”¨æ„é€ æ–¹æ³•è¿›è¡Œåˆ›å»ºåˆ›å»ºæ—¶ï¼Œç›´æ¥æŠ›å¼‚å¸¸ã€‚ä¸è¿è¡Œæ­¤ä¸­æ“ä½œã€‚</p></li></ul><h3 id="4-1-4-JDKæºç è§£æ-Runtimeç±»"><a href="#4-1-4-JDKæºç è§£æ-Runtimeç±»" class="headerlink" title="4.1.4 JDKæºç è§£æ-Runtimeç±»"></a>4.1.4 JDKæºç è§£æ-Runtimeç±»</h3><p>Runtimeç±»å°±æ˜¯ä½¿ç”¨çš„å•ä¾‹è®¾è®¡æ¨¡å¼ã€‚</p><ol><li><p>é€šè¿‡æºä»£ç æŸ¥çœ‹ä½¿ç”¨çš„æ˜¯å“ªå„¿ç§å•ä¾‹æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Runtime</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Runtime</span> <span class="variable">currentRuntime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runtime</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the runtime object associated with the current Java application.</span></span><br><span class="line"><span class="comment">     * Most of the methods of class &lt;code&gt;Runtime&lt;/code&gt; are instance</span></span><br><span class="line"><span class="comment">     * methods and must be invoked with respect to the current runtime object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  the &lt;code&gt;Runtime&lt;/code&gt; object associated with the current</span></span><br><span class="line"><span class="comment">     *          Java application.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Runtime <span class="title function_">getRuntime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> currentRuntime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Don&#x27;t let anyone else instantiate this class */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Runtime</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢æºä»£ç ä¸­å¯ä»¥çœ‹å‡ºRuntimeç±»ä½¿ç”¨çš„æ˜¯æ¶æ±‰å¼ï¼ˆé™æ€å±æ€§ï¼‰æ–¹å¼æ¥å®ç°å•ä¾‹æ¨¡å¼çš„ã€‚</p></li><li><p>ä½¿ç”¨Runtimeç±»ä¸­çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuntimeDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//è·å–Runtimeç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿”å› Java è™šæ‹Ÿæœºä¸­çš„å†…å­˜æ€»é‡ã€‚</span></span><br><span class="line">        System.out.println(runtime.totalMemory());</span><br><span class="line">        <span class="comment">//è¿”å› Java è™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡ã€‚</span></span><br><span class="line">        System.out.println(runtime.maxMemory());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ‰§è¡ŒæŒ‡å®šçš„å­—ç¬¦ä¸²å‘½ä»¤ï¼Œè¿”å›è¿›ç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> runtime.exec(<span class="string">&quot;ipconfig&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–å‘½ä»¤æ‰§è¡Œåçš„ç»“æœï¼Œé€šè¿‡è¾“å…¥æµè·å–</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> process.getInputStream();</span><br><span class="line">        <span class="type">byte</span>[] arr = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>* <span class="number">100</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> inputStream.read(arr);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(arr,<span class="number">0</span>,b,<span class="string">&quot;gbk&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springcloud-Alibaba</title>
      <link href="//post/springcloud/7springcloudAlibaba.html"/>
      <url>//post/springcloud/7springcloudAlibaba.html</url>
      
        <content type="html"><![CDATA[<h1 id="å…¥é—¨ç®€ä»‹"><a href="#å…¥é—¨ç®€ä»‹" class="headerlink" title="å…¥é—¨ç®€ä»‹"></a>å…¥é—¨ç®€ä»‹</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="äº§å“"><a href="#äº§å“" class="headerlink" title="äº§å“"></a>äº§å“</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230830193857370.png" alt="image-20230830193857370"></p><ul><li>èµ„æ–™</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230830194211784.png" alt="image-20230830194211784"></p><h1 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><h3 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><ul><li><code>eureka + config + bus</code></li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230830194852200.png" alt="image-20230830194852200"></p><h2 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="&#x3D;&#x3D;æœåŠ¡æ³¨å†Œ&#x3D;&#x3D;"></a>&#x3D;&#x3D;æœåŠ¡æ³¨å†Œ&#x3D;&#x3D;</h2><h3 id="ä¸‹è½½å®‰è£…"><a href="#ä¸‹è½½å®‰è£…" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h3><ul><li><code>nacos.io</code></li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230830195410907.png" alt="image-20230830195410907"></p><ol><li>ä¸‹è½½ <code>https://github.com/alibaba/nacos/releases/tag/1.4.6</code></li><li>è§£å‹ <code>E:\workspace\java\springcloud</code></li><li>ä¿®æ”¹é…ç½® <code>https://blog.csdn.net/qq_44377709/article/details/119154631</code></li><li>bin ç›®å½•ä¸‹ <code>start.cmd</code></li><li><code>startup.cmd -m standalone</code></li></ol><h3 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h3><h4 id="å»º-module"><a href="#å»º-module" class="headerlink" title="å»º module"></a>å»º module</h4><ul><li><code>cloudalibaba-provider-payment9001</code></li></ul><h4 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®Nacosåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨"><a href="#ä¸»å¯åŠ¨" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain9001</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">           SpringApplication.run(PaymentMain9001.class, args);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RestController</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EchoController</span> &#123;</span><br><span class="line">        <span class="meta">@GetMapping(value = &quot;/echo/&#123;string&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">echo</span><span class="params">(<span class="meta">@PathVariable</span> String string)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Hello Nacos Discovery &quot;</span> + string;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»"><a href="#ä¸šåŠ¡ç±»" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;nacos registry, serverPort: &quot;</span>+ serverPort+<span class="string">&quot;\t id&quot;</span>+id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‹·è´å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹"><a href="#æ‹·è´å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹" class="headerlink" title="&#x3D;&#x3D;æ‹·è´å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹&#x3D;&#x3D;"></a>&#x3D;&#x3D;æ‹·è´å¯åŠ¨ç¬¬äºŒä¸ªå®ä¾‹&#x3D;&#x3D;</h4><ul><li>å‚æ•° <code>-DServer.port=9011</code></li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230830204639208.png" alt="image-20230830204639208"></p><h3 id="æœåŠ¡æ¶ˆè´¹è€…"><a href="#æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡æ¶ˆè´¹è€…"></a>æœåŠ¡æ¶ˆè´¹è€…</h3><h4 id="pom-1"><a href="#pom-1" class="headerlink" title="pom"></a>pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yaml-1"><a href="#yaml-1" class="headerlink" title="yaml"></a>yaml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®ä¸­å¿ƒ"><a href="#é…ç½®ä¸­å¿ƒ" class="headerlink" title="é…ç½®ä¸­å¿ƒ"></a>é…ç½®ä¸­å¿ƒ</h2><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831092406868.png" alt="image-20230831092406868"></p><h3 id="é…ç½®æœåŠ¡"><a href="#é…ç½®æœåŠ¡" class="headerlink" title="é…ç½®æœåŠ¡"></a>é…ç½®æœåŠ¡</h3><h4 id="å»º-module-1"><a href="#å»º-module-1" class="headerlink" title="å»º module"></a>å»º module</h4><ul><li><code>cloudalibaba-config-nacos-client3377</code></li></ul><h4 id="pom-2"><a href="#pom-2" class="headerlink" title="pom"></a>pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--nacos-config--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--nacos-discovery--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web + actuator--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yml"><a href="#yml" class="headerlink" title="yml"></a>yml</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831092727463.png" alt="image-20230831092727463"></p><ol><li><code>application.yml</code></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="comment">#active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ</span></span><br><span class="line">    <span class="comment">#active: info</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>boootstrap.yml</code></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nacosé…ç½®</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEV_GROUP</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">7d8f0f5a-6a53-4785-9686-dd460158e5d4</span></span><br><span class="line"><span class="comment"># $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span></span><br><span class="line"><span class="comment"># nacos-config-client-dev.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># nacos-config-client-test.yaml   ----&gt; config.info</span></span><br></pre></td></tr></table></figure><ol start="3"><li>é…ç½®é¡¹è¯´æ˜</li></ol><p><code>$&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</code></p><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831093432973.png" alt="image-20230831093432973"></p><h4 id="ä¸»å¯åŠ¨-1"><a href="#ä¸»å¯åŠ¨-1" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosConfigClientMain3377</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">           SpringApplication.run(NacosConfigClientMain3377.class, args);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»-1"><a href="#ä¸šåŠ¡ç±»-1" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">//æ”¯æŒNacosçš„åŠ¨æ€åˆ·æ–°åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigClientController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/config/info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getConfigInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="nacos-æ·»åŠ é…ç½®"><a href="#nacos-æ·»åŠ é…ç½®" class="headerlink" title="nacos æ·»åŠ é…ç½®"></a>nacos æ·»åŠ é…ç½®</h4><blockquote><ol><li>ç‚¹å‡»+å·</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831094000648.png" alt="image-20230831094000648"></p><ol start="2"><li>é…ç½®ä¿¡æ¯</li></ol><ul><li>æ ¹æ®å…¬å¼æ¨å‡º IDï¼š <code>nacos-config-client-dev.yaml</code> &#x3D;&#x3D;ä¸€å®šæ˜¯ yamlï¼ï¼&#x3D;&#x3D;</li><li><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831094336978.png" alt="image-20230831094336978"></li><li><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831094742829.png" alt="image-20230831094742829"></li></ul></blockquote><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831094433416.png" alt="image-20230831094433416"></p><h3 id="å‘½åç©ºé—´-åˆ†ç»„-DataID"><a href="#å‘½åç©ºé—´-åˆ†ç»„-DataID" class="headerlink" title="å‘½åç©ºé—´-åˆ†ç»„-DataID"></a>å‘½åç©ºé—´-åˆ†ç»„-DataID</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831154504344.png" alt="image-20230831154504344"></p><h4 id="DataID-é…ç½®"><a href="#DataID-é…ç½®" class="headerlink" title="DataID é…ç½®"></a>DataID é…ç½®</h4><ol><li>æ·»åŠ æ–°é…ç½®</li><li><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831160152881.png" alt="image-20230831160152881"></li><li>ä¿®æ”¹ <code>application.yml</code></li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="comment">#    active: dev # è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">test</span> <span class="comment"># è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ</span></span><br></pre></td></tr></table></figure><h4 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h4><ol><li>é…ç½® DEV ç»„</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831161328931.png" alt="image-20230831161328931"></p><ol start="2"><li>é…ç½® TEST ç»„</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831161631951.png" alt="image-20230831161631951"></p><ol start="2"><li>ä¿®æ”¹é…ç½®</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831161531406.png" alt="image-20230831161531406"></p><h4 id="NameSpace"><a href="#NameSpace" class="headerlink" title="NameSpace"></a>NameSpace</h4><ol><li>åˆ›å»ºå‘½åç©ºé—´</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831171357737.png" alt="image-20230831171357737"></p><ol start="2"><li>æ‹·è´ dev å‘½åç©ºé—´ iD</li></ol><p><code>0ecd3295-bc3d-40c8-9817-3fc1aebe3e56</code></p><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831171629956.png" alt="image-20230831171629956"></p><ol start="3"><li>å›åˆ°é…ç½®åˆ—è¡¨ dev ä¸­</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831172606477.png" alt="image-20230831172606477"></p><ol start="4"><li>æ–°å»ºé…ç½®</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230831172628614.png" alt="image-20230831172628614"></p><ol start="5"><li>ä¿®æ”¹ yaml</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bootstrap</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEV_GROUP</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">0ecd3295-bc3d-40c8-9817-3fc1aebe3e56</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># application</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="comment">#    active: test # è¡¨ç¤ºæµ‹è¯•ç¯å¢ƒ</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="comment">#    active: info</span></span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;namespace ç›¸å½“äº package&#x3D;&#x3D;</p><p>&#x3D;&#x3D;group ç›¸å½“äºæ–‡ä»¶å¤¹ controller service&#x3D;&#x3D;</p><p>&#x3D;&#x3D;id ç›¸å½“äºç±»&#x3D;&#x3D;</p><h2 id="é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"><a href="#é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®" class="headerlink" title="é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®"></a>é›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®</h2><h1 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h1><h2 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904150138400.png" alt="image-20230904150138400"></p><h3 id="ä¸»è¦ç‰¹å¾"><a href="#ä¸»è¦ç‰¹å¾" class="headerlink" title="ä¸»è¦ç‰¹å¾"></a>ä¸»è¦ç‰¹å¾</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904150422952.png" alt="image-20230904150422952"></p><h2 id="å®‰è£…-sentinel-æ§åˆ¶å°"><a href="#å®‰è£…-sentinel-æ§åˆ¶å°" class="headerlink" title="å®‰è£… sentinel æ§åˆ¶å°"></a>å®‰è£… sentinel æ§åˆ¶å°</h2><ul><li>å®‰è£…åœ°å€ï¼š <code>E:\workspace\java\springcloud</code></li><li><code>-Dserver.port=XXXï¼ŒæŒ‡å®šç«¯å£</code></li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904151341069.png" alt="image-20230904151341069"></p><ul><li>id &amp; passwordï¼š <code>sentinel</code></li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904151549527.png" alt="image-20230904151549527"></p><h2 id="åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"><a href="#åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" class="headerlink" title="åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"></a>åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹</h2><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904151827612.png" alt="image-20230904151827612"></p><h3 id="å»º-8401-æœåŠ¡"><a href="#å»º-8401-æœåŠ¡" class="headerlink" title="å»º 8401 æœåŠ¡"></a>å»º 8401 æœåŠ¡</h3><ul><li><code>cloudalibaba-sentinel-service8401</code></li></ul><h4 id="POM"><a href="#POM" class="headerlink" title="POM"></a>POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba sentinel --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶+actuator --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yml-1"><a href="#yml-1" class="headerlink" title="yml"></a>yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span> <span class="comment">#é…ç½®Sentinel dashboardåœ°å€</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">ds1:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">            <span class="attr">dataId:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">            <span class="attr">groupId:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">            <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">            <span class="attr">rule-type:</span> <span class="string">flow</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨-2"><a href="#ä¸»å¯åŠ¨-2" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApp8401</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">           SpringApplication.run(MainApp8401.class, args);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»-2"><a href="#ä¸šåŠ¡ç±»-2" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowLimitController</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testA</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testB</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        log.info(Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;...testB&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹ç›‘æ§"><a href="#æŸ¥çœ‹ç›‘æ§" class="headerlink" title="æŸ¥çœ‹ç›‘æ§"></a>æŸ¥çœ‹ç›‘æ§</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904153306752.png" alt="image-20230904153306752"></p><h2 id="æµæ§è§„åˆ™"><a href="#æµæ§è§„åˆ™" class="headerlink" title="&#x3D;&#x3D;æµæ§è§„åˆ™&#x3D;&#x3D;"></a>&#x3D;&#x3D;æµæ§è§„åˆ™&#x3D;&#x3D;</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904205634872.png" alt="image-20230904205634872"></p><h3 id="æµæ§æ¨¡å¼"><a href="#æµæ§æ¨¡å¼" class="headerlink" title="æµæ§æ¨¡å¼"></a>æµæ§æ¨¡å¼</h3><h4 id="ç›´æ¥ï¼ˆé»˜è®¤ï¼‰"><a href="#ç›´æ¥ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="ç›´æ¥ï¼ˆé»˜è®¤ï¼‰"></a>ç›´æ¥ï¼ˆé»˜è®¤ï¼‰</h4><ul><li>ç»™ testA å¢åŠ æµæ§</li><li>1s è®¿é—®ä¸€æ¬¡â€”&gt; <code>å¿«é€Ÿå¤±è´¥</code></li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904205146347.png" alt="image-20230904205146347"></p><ul><li>å¤±è´¥åœºæ™¯</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904205251932.png" alt="image-20230904205251932"></p><h4 id="å…³è”"><a href="#å…³è”" class="headerlink" title="å…³è”"></a>å…³è”</h4><ul><li>è®¾ç½®</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904210559519.png" alt="image-20230904210559519"></p><ul><li>ä½¿ç”¨ <code>postman</code> å¹¶å‘è®¿é—®</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904211354137.png" alt="image-20230904211354137"></p><h4 id="é“¾è·¯"><a href="#é“¾è·¯" class="headerlink" title="é“¾è·¯"></a>é“¾è·¯</h4><ul><li>å¤šä¸ªè¯·æ±‚è®¿é—®åŒä¸€ä¸ªèµ„æº</li></ul><h3 id="æµæ§æ•ˆæœ"><a href="#æµæ§æ•ˆæœ" class="headerlink" title="æµæ§æ•ˆæœ"></a>æµæ§æ•ˆæœ</h3><h4 id="ç›´æ¥"><a href="#ç›´æ¥" class="headerlink" title="ç›´æ¥"></a>ç›´æ¥</h4><ul><li>ç›´æ¥å¿«é€Ÿå¤±è´¥</li></ul><h4 id="é¢„çƒ­-Warm-up"><a href="#é¢„çƒ­-Warm-up" class="headerlink" title="é¢„çƒ­ Warm up"></a>é¢„çƒ­ Warm up</h4><ol><li>è¯´æ˜</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904211958561.png" alt="image-20230904211958561"></p><ol start="2"><li>é…ç½®</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904212306977.png" alt="image-20230904212306977"></p><h4 id="æ’é˜Ÿç­‰å¾…"><a href="#æ’é˜Ÿç­‰å¾…" class="headerlink" title="æ’é˜Ÿç­‰å¾…"></a>æ’é˜Ÿç­‰å¾…</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904212916870.png" alt="image-20230904212916870"></p><h2 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904213703876.png" alt="image-20230904213703876"></p><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904213808795.png" alt="image-20230904213808795"></p><h3 id="é…ç½®å®æˆ˜"><a href="#é…ç½®å®æˆ˜" class="headerlink" title="é…ç½®å®æˆ˜"></a>é…ç½®å®æˆ˜</h3><h4 id="RT"><a href="#RT" class="headerlink" title="RT"></a>RT</h4><ol><li>æ¦‚å¿µ</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904214102516.png" alt="image-20230904214102516"></p><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904214225754.png" alt="image-20230904214225754"></p><ol start="2"><li>æµ‹è¯•ä»£ç </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testD</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;testD æµ‹è¯•RT&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        log.info(&quot;testD å¼‚å¸¸æ¯”ä¾‹&quot;);</span></span><br><span class="line">    <span class="comment">//        int age = 10 / 0;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testD&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>ç»“è®º</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904214825389.png" alt="image-20230904214825389"></p><h4 id="å¼‚å¸¸æ¯”ä¾‹"><a href="#å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="å¼‚å¸¸æ¯”ä¾‹"></a>å¼‚å¸¸æ¯”ä¾‹</h4><ol><li>æ¦‚å¿µ</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904215255500.png" alt="image-20230904215255500"></p><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904215345874.png" alt="image-20230904215345874"></p><h4 id="å¼‚å¸¸æ•°"><a href="#å¼‚å¸¸æ•°" class="headerlink" title="å¼‚å¸¸æ•°"></a>å¼‚å¸¸æ•°</h4><ol><li>æ¦‚å¿µ</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904222057215.png" alt="image-20230904222057215"></p><ol start="2"><li>é…ç½®</li></ol><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230904222233518.png" alt="image-20230904222233518"></p><h2 id="çƒ­ç‚¹-Key-é™æµ"><a href="#çƒ­ç‚¹-Key-é™æµ" class="headerlink" title="çƒ­ç‚¹ Key é™æµ"></a>çƒ­ç‚¹ Key é™æµ</h2><h3 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905123825875.png" alt="image-20230905123825875"></p><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><h4 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h4><ul><li>æ³¨æ„ï¼š<code>blockHandlerä¸ç®¡è¿è¡Œæ—¶å¼‚å¸¸</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testHotKey&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testHotKey&quot;, blockHandler = &quot;deal_testHotKey&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testHotKey</span><span class="params">(<span class="meta">@RequestParam(value = &quot;p1&quot;, required = false)</span> String p1,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestParam(value = &quot;p2&quot;, required = false)</span> String p2)</span> &#123;</span><br><span class="line">    <span class="comment">//int age = 10/0;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testHotKey&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// testHotKey çš„å…œåº•æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deal_testHotKey</span><span class="params">(String p1, String p2, BlockException exception)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------deal_testHotKey,o(â•¥ï¹â•¥)o&quot;</span>;  <span class="comment">//sentinelç³»ç»Ÿé»˜è®¤çš„æç¤ºï¼šBlocked by Sentinel (flow limiting)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905125228065.png" alt="image-20230905125228065"></p><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905125312014.png" alt="image-20230905125312014"></p><h3 id="å‚æ•°ä¾‹å¤–é¡¹"><a href="#å‚æ•°ä¾‹å¤–é¡¹" class="headerlink" title="å‚æ•°ä¾‹å¤–é¡¹"></a>å‚æ•°ä¾‹å¤–é¡¹</h3><h4 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><ul><li>å½“ <code>p1å–ç‰¹æ®Šå€¼æ—¶ï¼Œé˜ˆå€¼ä¸ä¸€æ ·</code> ä¾‹å¦‚ vip åŠŸèƒ½</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905130119460.png" alt="image-20230905130119460"></p><h4 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905130411478.png" alt="image-20230905130411478"></p><h2 id="ç³»ç»Ÿè§„åˆ™"><a href="#ç³»ç»Ÿè§„åˆ™" class="headerlink" title="ç³»ç»Ÿè§„åˆ™"></a>ç³»ç»Ÿè§„åˆ™</h2><ul><li>äº†è§£å³å¯</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905131950143.png" alt="image-20230905131950143"></p><h2 id="SentinelResource"><a href="#SentinelResource" class="headerlink" title="&#x3D;&#x3D;@SentinelResource&#x3D;&#x3D;"></a>&#x3D;&#x3D;@SentinelResource&#x3D;&#x3D;</h2><h3 id="æŒ‰èµ„æºåç§°é™æµ"><a href="#æŒ‰èµ„æºåç§°é™æµ" class="headerlink" title="æŒ‰èµ„æºåç§°é™æµ"></a>æŒ‰èµ„æºåç§°é™æµ</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905180103260.png" alt="image-20230905180103260"></p><h4 id="ä¸šåŠ¡ç±»-3"><a href="#ä¸šåŠ¡ç±»-3" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/byResource&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;byResource&quot;, blockHandler = &quot;handleException&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">byResource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK&quot;</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>, <span class="string">&quot;serial001&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ***å…œåº•æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult <span class="title function_">handleException</span><span class="params">(BlockException exception)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">444</span>, exception.getClass().getCanonicalName() + <span class="string">&quot;\t æœåŠ¡ä¸å¯ç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®-2"><a href="#é…ç½®-2" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905180713807.png" alt="image-20230905180713807"></p><h4 id="é¢å¤–é—®é¢˜"><a href="#é¢å¤–é—®é¢˜" class="headerlink" title="é¢å¤–é—®é¢˜"></a>é¢å¤–é—®é¢˜</h4><ul><li>ä¸´æ—¶</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905180640627.png" alt="image-20230905180640627"></p><h3 id="æŒ‰ç…§-url-åœ°å€é™æµ"><a href="#æŒ‰ç…§-url-åœ°å€é™æµ" class="headerlink" title="æŒ‰ç…§ url åœ°å€é™æµ"></a>æŒ‰ç…§ url åœ°å€é™æµ</h3><h4 id="æ§åˆ¶ç±»"><a href="#æ§åˆ¶ç±»" class="headerlink" title="æ§åˆ¶ç±»"></a>æ§åˆ¶ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/byUrl&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;byUrl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">byUrl</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æŒ‰urlé™æµæµ‹è¯•OK&quot;</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>, <span class="string">&quot;serial002&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®-3"><a href="#é…ç½®-3" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905181306053.png" alt="image-20230905181306053"></p><h3 id="è‡ªå®šä¹‰æ–¹æ³•"><a href="#è‡ªå®šä¹‰æ–¹æ³•" class="headerlink" title="è‡ªå®šä¹‰æ–¹æ³•"></a>è‡ªå®šä¹‰æ–¹æ³•</h3><h4 id="ç—›ç‚¹"><a href="#ç—›ç‚¹" class="headerlink" title="ç—›ç‚¹"></a>ç—›ç‚¹</h4><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905201654516.png" alt="image-20230905201654516"></p><ul><li>æ­¥éª¤</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905201715671.png" alt="image-20230905201715671"></p><h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/customerBlockHandler&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;customerBlockHandler&quot;,</span></span><br><span class="line"><span class="meta">        blockHandlerClass = CustomerBlockHandler.class,</span></span><br><span class="line"><span class="meta">        blockHandler = &quot;handlerException2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">customerBlockHandler</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">200</span>, <span class="string">&quot;æŒ‰å®¢æˆ¶è‡ªå®šä¹‰&quot;</span>, <span class="keyword">new</span> <span class="title class_">Payment</span>(<span class="number">2020L</span>, <span class="string">&quot;serial003&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="myhandler"><a href="#myhandler" class="headerlink" title="myhandler"></a>myhandler</h4><ul><li>åˆ›å»º <code>/myhandler</code> åŒ…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerBlockHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title function_">handlerException</span><span class="params">(BlockException exception)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">4444</span>, <span class="string">&quot;æŒ‰å®¢æˆ¶è‡ªå®šä¹‰,global handlerException----1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title function_">handlerException2</span><span class="params">(BlockException exception)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>(<span class="number">4444</span>, <span class="string">&quot;æŒ‰å®¢æˆ¶è‡ªå®šä¹‰,global handlerException----2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜"><a href="#æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜" class="headerlink" title="æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜"></a>æ›´å¤šæ³¨è§£å±æ€§è¯´æ˜</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230905213942436.png" alt="image-20230905213942436"></p><h2 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><blockquote><ol><li>æä¾›æ¨¡å—<ul><li><code>cloudalibaba-provider-payment9003</code> <code>cloudalibaba-provider-payment9004</code></li></ul></li><li>æ¶ˆè´¹æ¨¡å—<ul><li><code>cloudalibaba-consumer-nacos-order84</code></li></ul></li></ol></blockquote><h3 id="åªé…ç½®-fallback"><a href="#åªé…ç½®-fallback" class="headerlink" title="åªé…ç½® fallback"></a>åªé…ç½® fallback</h3><ul><li>ç”¨äº java è¿è¡Œæ—¶å¼‚å¸¸å…œåº•æ–¹æ³•<ul><li><code>id=4</code>è§¦å‘å¼‚å¸¸ è®¿é—®å…œåº•æ–¹æ³• <code>handlerFallback</code></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="comment">//@SentinelResource(value = &quot;fallback&quot;) //æ²¡æœ‰é…ç½®</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;)</span> <span class="comment">//fallbackåªè´Ÿè´£ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + <span class="string">&quot;/paymentSQL/&quot;</span> + id, CommonResult.class, id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result.getData() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ¬ä¾‹æ˜¯fallback</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">handlerFallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Throwable e)</span> &#123;</span><br><span class="line">    <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">444</span>, <span class="string">&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;</span> + e.getMessage(), payment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åªé…ç½®-blockhandler"><a href="#åªé…ç½®-blockhandler" class="headerlink" title="åªé…ç½® blockhandler"></a>åªé…ç½® blockhandler</h3><ul><li>ç”¨äº Sentinel æµé‡æ§åˆ¶å…œåº•æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;)</span> <span class="comment">//blockHandleråªè´Ÿè´£sentinelæ§åˆ¶å°é…ç½®è¿è§„</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + <span class="string">&quot;/paymentSQL/&quot;</span> + id, CommonResult.class, id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result.getData() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ¬ä¾‹æ˜¯blockHandler</span></span><br><span class="line"><span class="keyword">public</span> CommonResult <span class="title function_">blockHandler</span><span class="params">(<span class="meta">@PathVariable</span> Long id, BlockException blockException)</span> &#123;</span><br><span class="line">    <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Payment</span>(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  &quot;</span> + blockException.getMessage(), payment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸¤ä¸ªéƒ½é…ç½®"><a href="#ä¸¤ä¸ªéƒ½é…ç½®" class="headerlink" title="ä¸¤ä¸ªéƒ½é…ç½®"></a>ä¸¤ä¸ªéƒ½é…ç½®</h3><ul><li><code>è‹¥blockHandlerå’Œfallbackéƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«é™æµé™çº§è€ŒæŠ›å‡ºBlockExceptionæ—¶åªä¼šè¿›å…¥blockHandlerå¤„ç†é€»è¾‘ã€‚</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handlerFallback&quot;, blockHandler = &quot;blockHandler&quot;,</span></span><br><span class="line"><span class="meta">        exceptionsToIgnore = &#123;IllegalArgumentException.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">fallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + <span class="string">&quot;/paymentSQL/&quot;</span> + id, CommonResult.class, id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result.getData() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¿½ç•¥å±æ€§"><a href="#å¿½ç•¥å±æ€§" class="headerlink" title="å¿½ç•¥å±æ€§"></a>å¿½ç•¥å±æ€§</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230907200142808.png" alt="image-20230907200142808"></p><h2 id="ç†”æ–­-openfeign"><a href="#ç†”æ–­-openfeign" class="headerlink" title="ç†”æ–­+openfeign"></a>ç†”æ–­+openfeign</h2><h3 id="é…ç½®-4"><a href="#é…ç½®-4" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ol><li>å¯¹ <code>cloudalibaba-consumer-nacos-order84</code> æ¶ˆè´¹æ¨¡å—é…ç½®</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¿€æ´»Sentinelå¯¹Feignçš„æ”¯æŒ</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ä¸»å¯åŠ¨ç±»æ³¨è§£ <code>@EnableFeignClients</code></li></ol><h3 id="ä¸šåŠ¡ç±»-4"><a href="#ä¸šåŠ¡ç±»-4" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h3><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><ol><li>æ¥å£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// value ymlä¸­ ï¼› fallback å®ç°ç±»</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;nacos-payment-provider&quot;,fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¶ˆè´¹è€…å°†è¦å»è®¿é—®çš„å¾®æœåŠ¡åç§°(æ³¨å†ŒæˆåŠŸè¿›nacosçš„å¾®æœåŠ¡æä¾›è€…)</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure><ol start="2"><li>å®ç°ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">paymentSQL</span><span class="params">(Long id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">44444</span>,<span class="string">&quot;æœåŠ¡é™çº§è¿”å›,---PaymentFallbackService&quot;</span>,<span class="keyword">new</span> <span class="title class_">Payment</span>(id,<span class="string">&quot;errorSerial&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/consumer/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> paymentService.paymentSQL(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§„åˆ™æŒä¹…åŒ–"><a href="#è§„åˆ™æŒä¹…åŒ–" class="headerlink" title="è§„åˆ™æŒä¹…åŒ–"></a>è§„åˆ™æŒä¹…åŒ–</h2><ul><li><code>https://www.bilibili.com/video/BV18E411x7eT?p=137&amp;vd_source=30924cc6debe913490fb34d7e3b62fdd</code></li></ul><h3 id="pom-3"><a href="#pom-3" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos åç»­åšæŒä¹…åŒ–ç”¨åˆ°--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="yml-2"><a href="#yml-2" class="headerlink" title="yml"></a>yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">ds1:</span></span><br><span class="line">          <span class="attr">nacos:</span></span><br><span class="line">            <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">            <span class="attr">dataId:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">            <span class="attr">groupId:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">            <span class="attr">data-type:</span> <span class="string">json</span></span><br><span class="line">            <span class="attr">rule-type:</span> <span class="string">flow</span></span><br></pre></td></tr></table></figure><h1 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h1><h2 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230907220243729.png" alt="image-20230907220243729"></p><ul><li>åˆ†å¸ƒå¼ä¹‹å</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230907220259936.png" alt="image-20230907220259936"></p><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><ul><li>3 + 1</li></ul><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230907220936982.png" alt="image-20230907220936982"></p><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><ul><li>å®˜ç½‘ <code>seata.io/zh-cn</code></li></ul><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230907221657975.png" alt="image-20230907221657975"></p><h2 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p><img src="/img/springcloud/7cloudAlibaba.assets/image-20230907222447449.png" alt="image-20230907222447449"></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springcloud </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springcloudæœåŠ¡é™çº§</title>
      <link href="//post/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.html"/>
      <url>//post/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.html</url>
      
        <content type="html"><![CDATA[<h1 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h1><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230819170537463.png" alt="image-20230819170537463"></p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="é›ªå´©æœåŠ¡"><a href="#é›ªå´©æœåŠ¡" class="headerlink" title="é›ªå´©æœåŠ¡"></a>é›ªå´©æœåŠ¡</h3><blockquote><p>â€‹ å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡ A è°ƒç”¨å¾®æœåŠ¡ B å’Œå¾®æœåŠ¡ C,å¾®æœåŠ¡ B å’Œå¾®æœåŠ¡ C åˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œæ‰‡å‡ºâ€ã€‚å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡ A çš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œâ€é›ªå´©æ•ˆåº”â€<br>â€‹ å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚</p><p>â€‹ è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚æ‰€ä»¥ï¼Œé€šå¸¸å½“ä½ å‘ç°ä¸€ä¸ªæ¨¡å—ä¸‹çš„æŸä¸ªå®ä¾‹å¤±è´¥åï¼Œè¿™æ—¶å€™è¿™ä¸ªæ¨¡å—ä¾ç„¶è¿˜ä¼šæ¥æ”¶æµé‡ï¼Œç„¶åè¿™ä¸ªæœ‰é—®é¢˜çš„æ¨¡å—è¿˜è°ƒç”¨äº†å…¶ä»–çš„æ¨¡å—ï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿçº§è”æ•…éšœï¼Œæˆ–è€…å«é›ªå´©ã€‚</p></blockquote><h3 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><blockquote><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230818103134326.png" alt="image-20230818103134326"></p></blockquote><h2 id="é‡è¦æ¦‚å¿µ"><a href="#é‡è¦æ¦‚å¿µ" class="headerlink" title="é‡è¦æ¦‚å¿µ"></a>é‡è¦æ¦‚å¿µ</h2><blockquote><ol><li><p>æœåŠ¡é™çº§ fallback</p><ol><li>&#x3D;&#x3D;ç¨‹åºè¿è¡Œå¼‚å¸¸&#x3D;&#x3D;</li><li>&#x3D;&#x3D;è¶…æ—¶&#x3D;&#x3D;</li><li>&#x3D;&#x3D;æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§&#x3D;&#x3D;</li><li>&#x3D;&#x3D;çº¿ç¨‹æ± æ‰“æ»¡&#x3D;&#x3D;</li></ol></li><li><p>æœåŠ¡ç†”æ–­ break</p></li></ol><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230818104136527.png" alt="image-20230818104136527"></p><ol><li>æ¥è¿‘å®æ—¶çš„ç›‘æ§ flowlimit</li></ol><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230818104147413.png" alt="image-20230818104147413"></p></blockquote><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><h3 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h3><h4 id="å»º-module"><a href="#å»º-module" class="headerlink" title="å»º module"></a>å»º module</h4><ul><li>cloud-provider-hystrix-payment8001</li></ul><h4 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--hystrix--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yml"><a href="#yml" class="headerlink" title="yml"></a>yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-hystrix-payment</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨"><a href="#ä¸»å¯åŠ¨" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">           SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸šåŠ¡ç±»"><a href="#ä¸šåŠ¡ç±»" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><ul><li>service</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± :&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;   paymentInfo_OK,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± :&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;   paymentInfo_TimeOut,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;è€—æ—¶3s&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> paymentService.paymentInfo_OK(id);</span><br><span class="line">        log.info(<span class="string">&quot;****result:&#123;&#125;&quot;</span>, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230818111118177.png" alt="image-20230818111118177"></p><h3 id="æ„å»º-80"><a href="#æ„å»º-80" class="headerlink" title="æ„å»º 80"></a>æ„å»º 80</h3><h4 id="å»º-module-1"><a href="#å»º-module-1" class="headerlink" title="å»º module"></a>å»º module</h4><ul><li>cloud-consumer-feign-hystrix-order80</li></ul><h4 id="pom-1"><a href="#pom-1" class="headerlink" title="pom"></a>pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--hystrix--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h3><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230818223705108.png" alt="image-20230818223705108"></p><h4 id="8001-é™çº§"><a href="#8001-é™çº§" class="headerlink" title="8001 é™çº§"></a>8001 é™çº§</h4><ol><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value=&quot;3000&quot;) // 3sé™çº§</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± :&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;   paymentInfo_TimeOut,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;è€—æ—¶3s&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™çº§åè°ƒç”¨å¤„ç†å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOutHandler</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± :&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;   ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¸»å¯åŠ¨ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span> <span class="comment">// æœåŠ¡é™çº§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">           SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="80-é™çº§"><a href="#80-é™çº§" class="headerlink" title="80 é™çº§"></a>80 é™çº§</h4><ul><li>ä¸€èˆ¬æ”¾åœ¨å®¢æˆ·ç«¯</li></ul><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230818223827541.png" alt="image-20230818223827541"></p><ol><li>å¼€å¯é…ç½®</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ä¸»å¯åŠ¨ç±»</li></ol><ul><li>æ·»åŠ  <code>@EnableHystrix</code></li></ul><ol start="3"><li>ä¸šåŠ¡ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;, commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;1500&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="comment">//@HystrixCommand</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentTimeOutFallbackMethod</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ˜¯æ¶ˆè´¹è€…80,å¯¹æ–¹æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜å¤„ç†"><a href="#é—®é¢˜å¤„ç†" class="headerlink" title="é—®é¢˜å¤„ç†"></a>é—®é¢˜å¤„ç†</h4><h4 id="DefaultProperties"><a href="#DefaultProperties" class="headerlink" title="&#x3D;&#x3D;@DefaultProperties&#x3D;&#x3D;"></a>&#x3D;&#x3D;@DefaultProperties&#x3D;&#x3D;</h4><ul><li>ç»Ÿä¸€å¤„ç† é»˜è®¤æ–¹æ³•<ul><li>å†™åœ¨ç±»åä¸Šé¢</li><li>è§£å†³ä»£ç è€¦åˆåº¦é«˜çš„é—®é¢˜</li></ul></li></ul><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230818231513905.png" alt="image-20230818231513905"></p><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@DefaultProperties(defaultFallback = &quot;payment_Global_FallbackMethod&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderHystrixController</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸‹é¢æ˜¯å…¨å±€fallbackæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">payment_Global_FallbackMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="FeignClient"><a href="#FeignClient" class="headerlink" title="&#x3D;&#x3D;@FeignClient&#x3D;&#x3D;"></a>&#x3D;&#x3D;@FeignClient&#x3D;&#x3D;</h4><ul><li>é¿å…æ··ä¹±</li></ul><p><strong>service åŒ…ä¸‹</strong></p><ol><li>æ¥å£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;, fallback = PaymentFallbackService.class)</span> <span class="comment">// æŒ‡å®šä¸‹é¢ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentHystrixService</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®ç°ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title class_">PaymentHystrixService</span> <span class="comment">// ç»§æ‰¿ä¸Šé¢æ¥å£</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_OK</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-----PaymentFallbackService fall back-paymentInfo_OK ,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo_TimeOut</span><span class="params">(Integer id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;-----PaymentFallbackService fall back-paymentInfo_TimeOut ,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>yml é…ç½®</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h3><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230819162816273.png" alt="image-20230819162816273"></p><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230819162958016.png" alt="image-20230819162958016"></p><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230819163250536.png" alt=" "></p><h4 id="ä¸šåŠ¡ç±»-1"><a href="#ä¸šåŠ¡ç±»-1" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h4><ul><li>service</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//===æœåŠ¡ç†”æ–­</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),// æ˜¯å¦å¼€å¯æ–­è·¯å™¨</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),// è¯·æ±‚æ¬¡æ•°</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;), // æ—¶é—´çª—å£æœŸ</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;),// å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(id &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;******id ä¸èƒ½è´Ÿæ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">serialNumber</span> <span class="operator">=</span> IdUtil.simpleUUID();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;è°ƒç”¨æˆåŠŸï¼Œæµæ°´å·: &quot;</span> + serialNumber;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker_fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨åå†è¯•ï¼Œ/(ã„’oã„’)/~~   id: &quot;</span> +id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//====æœåŠ¡ç†”æ–­</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/circuit/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> paymentService.paymentCircuitBreaker(id);</span><br><span class="line">    log.info(<span class="string">&quot;****result: &quot;</span>+result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>&#x3D;&#x3D;å¼€å¯å…³é—­æ¡ä»¶&#x3D;&#x3D;</li></ul><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230819170908037.png" alt="image-20230819170908037"></p><h3 id="æœåŠ¡é™æµ"><a href="#æœåŠ¡é™æµ" class="headerlink" title="æœåŠ¡é™æµ"></a>æœåŠ¡é™æµ</h3><ul><li>æš‚æ—¶ä¸å­¦</li></ul><h2 id="æœåŠ¡ç›‘æ§-HystrixDashboard"><a href="#æœåŠ¡ç›‘æ§-HystrixDashboard" class="headerlink" title="æœåŠ¡ç›‘æ§ HystrixDashboard"></a>æœåŠ¡ç›‘æ§ HystrixDashboard</h2><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230819180258909.png" alt="image-20230819180258909"></p><h3 id="å»º-module-2"><a href="#å»º-module-2" class="headerlink" title="å»º module"></a>å»º module</h3><ul><li>cloud-consumer-hystrix-dashboard9001</li></ul><h3 id="pom-2"><a href="#pom-2" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="yaml-1"><a href="#yaml-1" class="headerlink" title="yaml"></a>yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HystrixDashboardMain9001</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            SpringApplication.run(HystrixDashboardMain9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9001-ç›‘æ§-8001"><a href="#9001-ç›‘æ§-8001" class="headerlink" title="9001 ç›‘æ§ 8001"></a>9001 ç›‘æ§ 8001</h3><ol><li>8001 å¯åŠ¨ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentHystrixMain8001</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            SpringApplication.run(PaymentHystrixMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘</span></span><br><span class="line"><span class="comment">     *ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯&quot;/hystrix.stream&quot;ï¼Œ</span></span><br><span class="line"><span class="comment">     *åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">getServlet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HystrixMetricsStreamServlet</span> <span class="variable">streamServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HystrixMetricsStreamServlet</span>();</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(streamServlet);</span><br><span class="line">        registrationBean.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">        registrationBean.addUrlMappings(<span class="string">&quot;/hystrix.stream&quot;</span>);</span><br><span class="line">        registrationBean.setName(<span class="string">&quot;HystrixMetricsStreamServlet&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å¡«å…¥åœ°å€ <code>http://localhost:8001/hystrix.stream</code></li></ol><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230819182744195.png" alt="image-20230819182744195"></p><ol start="3"><li>ç»“æœ</li></ol><p><img src="/img/springcloud/4%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7.assets/image-20230819183217492.png" alt="image-20230819183217492"></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springcloud </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springcloudæœåŠ¡è°ƒç”¨</title>
      <link href="//post/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.html"/>
      <url>//post/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.html</url>
      
        <content type="html"><![CDATA[<p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/1684857931977-e8e56ad7-8c7c-46a1-a485-0fba7cc76222.png" alt="img"></p><h1 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h1><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230815175255942.png" alt="image-20230815175255942"></p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230815175345997.png" alt="image-20230815175345997"></p><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230815175750452.png" alt="image-20230815175750452"></p><h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><h3 id="ä½¿ç”¨-resetTemplate-æµ‹è¯•"><a href="#ä½¿ç”¨-resetTemplate-æµ‹è¯•" class="headerlink" title="ä½¿ç”¨ resetTemplate æµ‹è¯•"></a>ä½¿ç”¨ resetTemplate æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/getForEntity/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment2</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    ResponseEntity&lt;CommonResult&gt; entity = restTemplate.getForEntity(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    <span class="keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">        <span class="keyword">return</span> entity.getBody();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonResult</span>&lt;&gt;(<span class="number">444</span>, <span class="string">&quot;å¤±è´¥&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="IRule-æ¥å£"><a href="#IRule-æ¥å£" class="headerlink" title="IRule æ¥å£"></a>IRule æ¥å£</h3><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230815182012626.png" alt="image-20230815182012626"></p><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230815183354485.png" alt="image-20230815183354485"></p><h3 id="æ›´æ”¹æ›¿æ¢ç®—æ³•"><a href="#æ›´æ”¹æ›¿æ¢ç®—æ³•" class="headerlink" title="&#x3D;&#x3D;æ›´æ”¹æ›¿æ¢ç®—æ³•&#x3D;&#x3D;"></a>&#x3D;&#x3D;æ›´æ”¹æ›¿æ¢ç®—æ³•&#x3D;&#x3D;</h3><ul><li>&#x3D;&#x3D;æ³¨æ„&#x3D;&#x3D; ä¸èƒ½æ”¾åœ¨ä¸»ç±»ä¸‹</li></ul><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230815182455546.png" alt="image-20230815182455546"></p><ol><li>å»º package</li></ol><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230815182750035.png" alt="image-20230815182750035"></p><ol start="2"><li>Myrule ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyselfRule</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">myRule</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>(); <span class="comment">// å®šä¹‰éšæœºç®—æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>&#x3D;&#x3D;å¯åŠ¨ç±»æ·»åŠ @RibbonClient&#x3D;&#x3D;</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span> <span class="comment">// æ³¨å†ŒEurekaClient</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;CLOUD-PAYMENT-SERVICE&quot;, configuration = MyselfRule.class)</span> <span class="comment">// æ›¿æ¢ç®—æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMain80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderMain80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#è´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="è´Ÿè½½å‡è¡¡ç®—æ³•"></a>è´Ÿè½½å‡è¡¡ç®—æ³•</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230817171221536.png" alt="image-20230817171221536"></p><h1 id="OpenFeign"><a href="#OpenFeign" class="headerlink" title="OpenFeign"></a>OpenFeign</h1><h2 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><ul><li>ç”¨äºå®¢æˆ·ç«¯ï¼Œé€šè¿‡&#x3D;&#x3D;æ¥å£&#x3D;&#x3D;è¿æ¥æœåŠ¡è°ƒç”¨</li></ul><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230817175009286.png" alt="image-20230817175009286"></p><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230817175259330.png" alt="image-20230817175259330"></p><h2 id="æœåŠ¡è°ƒç”¨"><a href="#æœåŠ¡è°ƒç”¨" class="headerlink" title="&#x3D;&#x3D;æœåŠ¡è°ƒç”¨&#x3D;&#x3D;"></a>&#x3D;&#x3D;æœåŠ¡è°ƒç”¨&#x3D;&#x3D;</h2><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230817220210011.png" alt="image-20230817220210011"></p><h3 id="å»º-module"><a href="#å»º-module" class="headerlink" title="å»º module"></a>å»º module</h3><ul><li><code>cloud-consumer-feign-order80</code></li></ul><h3 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬åŸºç¡€é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å†™-yml"><a href="#å†™-yml" class="headerlink" title="å†™ yml"></a>å†™ yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><h3 id="ä¸»å¯åŠ¨"><a href="#ä¸»å¯åŠ¨" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h3><p>&#x3D;&#x3D;@EnableFeignClients&#x3D;&#x3D;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span> <span class="comment">// ä½¿ç”¨feign</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderFeignMain80</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">           SpringApplication.run(OrderFeignMain80.class, args);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸šåŠ¡ç±»"><a href="#ä¸šåŠ¡ç±»" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h3><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230817215644791.png" alt="image-20230817215644791"></p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230817220636367.png" alt="image-20230817220636367"></p><h2 id="è¶…æ—¶æ§åˆ¶"><a href="#è¶…æ—¶æ§åˆ¶" class="headerlink" title="è¶…æ—¶æ§åˆ¶"></a>è¶…æ—¶æ§åˆ¶</h2><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230817233826496.png" alt="image-20230817233826496"></p><ul><li>é…ç½®ä»£ç </li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">  <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure><h2 id="æ—¥å¿—æ‰“å°"><a href="#æ—¥å¿—æ‰“å°" class="headerlink" title="æ—¥å¿—æ‰“å°"></a>æ—¥å¿—æ‰“å°</h2><ul><li>æ—¥å¿—çº§åˆ«</li></ul><p><img src="/img/springcloud/3%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8.assets/image-20230817234337461.png" alt="image-20230817234337461"></p><ul><li>å»º config åŒ…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.Level <span class="title function_">feignLoggerLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL; <span class="comment">// å…¨éƒ¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é…ç½®</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="comment"># feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£</span></span><br><span class="line">    <span class="attr">com.atguigu.springcloud.service.PaymentFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springcloud </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java8</title>
      <link href="//post/java%E5%9F%BA%E7%A1%80/java8.html"/>
      <url>//post/java%E5%9F%BA%E7%A1%80/java8.html</url>
      
        <content type="html"><![CDATA[<ul><li>å‡½æ•°å¼ç¼–ç¨‹â€“stream æµ</li></ul><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><h2 id="ä¸ºä»€ä¹ˆå­¦"><a href="#ä¸ºä»€ä¹ˆå­¦" class="headerlink" title="ä¸ºä»€ä¹ˆå­¦"></a>ä¸ºä»€ä¹ˆå­¦</h2><p><img src="/img/java8.assets/1683389210310-dc4fd722-7a7f-4ecd-84b7-3f427049fd35.png" alt="img"></p><p><img src="/img/java8.assets/1683389223703-6c38d67c-6b34-4ec8-a0d8-f6226e62204c.png" alt="img"></p><h2 id="å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³"><a href="#å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³"></a>å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³</h2><p><img src="/img/java8.assets/1683389288242-dce39690-a9c8-4c1e-97e7-ad222e13d979.png" alt="img"></p><h1 id="Lambda-è¡¨è¾¾å¼"><a href="#Lambda-è¡¨è¾¾å¼" class="headerlink" title="Lambda è¡¨è¾¾å¼"></a>Lambda è¡¨è¾¾å¼</h1><h2 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><img src="/img/java8.assets/1683389435427-138b1a62-262d-457d-84b9-dcd577400751.png" alt="img"></p><h2 id="ä½¿ç”¨æƒ…å†µ"><a href="#ä½¿ç”¨æƒ…å†µ" class="headerlink" title="ä½¿ç”¨æƒ…å†µ"></a>ä½¿ç”¨æƒ…å†µ</h2><ul><li>å‚æ•°ä¸ºä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³• ï¼ˆä¸åŒ…å«æŠ½è±¡æ–¹æ³•|ï¼‰</li><li>ä¾‹å¦‚ï¼š</li></ul><p><img src="/img/java8.assets/1683389909356-2480dbe4-17d6-4727-98cd-c786c9f4130f.png" alt="img"></p><h2 id="ä¾‹"><a href="#ä¾‹" class="headerlink" title="ä¾‹"></a>ä¾‹</h2><h3 id="ä¾‹-1"><a href="#ä¾‹-1" class="headerlink" title="ä¾‹ 1"></a>ä¾‹ 1</h3><p><img src="/img/java8.assets/1683389759438-341d442c-5692-4491-a23f-ede84f5c6d89.png" alt="img"></p><h3 id="ä¾‹-2"><a href="#ä¾‹-2" class="headerlink" title="ä¾‹ 2"></a>ä¾‹ 2</h3><p><img src="/img/java8.assets/1683390420959-9fdc6612-7aef-450c-a665-7281e9ef545a.png" alt="img"></p><h3 id="ä¾‹-4"><a href="#ä¾‹-4" class="headerlink" title="ä¾‹ 4"></a>ä¾‹ 4</h3><p><img src="/img/java8.assets/1683391167702-88e43dfc-e4b2-433e-8bea-d55e52c23c9a.png" alt="img"></p><h3 id="ä¾‹-5"><a href="#ä¾‹-5" class="headerlink" title="ä¾‹ 5"></a>ä¾‹ 5</h3><p><img src="/img/java8.assets/1683391232047-5f820cff-f5b8-46cf-a8f7-085c81baf5a9.png" alt="img"></p><h2 id="âœ¨-çœç•¥è§„åˆ™"><a href="#âœ¨-çœç•¥è§„åˆ™" class="headerlink" title="âœ¨ çœç•¥è§„åˆ™"></a>âœ¨ çœç•¥è§„åˆ™</h2><p><img src="/img/java8.assets/1683391542937-6b7b54cc-5b6f-43e1-827d-5253e77a0b11.png" alt="img"></p><p><img src="/img/java8.assets/1683391572614-62c61508-b4f8-4488-8d84-6d7e0d2f3327.png" alt="img"></p><p><img src="/img/java8.assets/1683391592687-ac774347-6803-4681-9463-ba3cfbb4341b.png" alt="img"></p><p><img src="/img/java8.assets/1683391600987-99eaa738-bea7-4185-91e2-a27fe9e8d60d.png" alt="img"></p><h1 id="Stream-æµ"><a href="#Stream-æµ" class="headerlink" title="Stream æµ"></a>Stream æµ</h1><p><a href="https://www.bilibili.com/video/BV1Gh41187uR?p=12&spm_id_from=pageDriver&vd_source=30924cc6debe913490fb34d7e3b62fdd">https://www.bilibili.com/video/BV1Gh41187uR?p=12&amp;spm_id_from=pageDriver&amp;vd_source=30924cc6debe913490fb34d7e3b62fdd</a></p><h2 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><img src="/img/java8.assets/1684945038221-e974f6fc-a2e3-4a41-a7cc-14c07e821181.png" alt="img"></p><h2 id="åˆå§‹åŒ–å·¥ç¨‹"><a href="#åˆå§‹åŒ–å·¥ç¨‹" class="headerlink" title="åˆå§‹åŒ–å·¥ç¨‹"></a>åˆå§‹åŒ–å·¥ç¨‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">        System.out.println(authors);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Author&gt; <span class="title function_">getAuthors</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ•°æ®æœºå§‹åŒ–</span></span><br><span class="line">        <span class="type">Author</span> <span class="variable">author</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Author</span>(<span class="number">1L</span>, <span class="string">&quot;è’™å¤š&quot;</span>, <span class="number">33</span>, <span class="string">&quot;ä¸€ä¸ªä»èœåˆ€ä¸­æ˜æ‚Ÿå“²ç†çš„ç¥–å®‰äºº&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Author</span> <span class="variable">author2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Author</span>(<span class="number">2L</span>, <span class="string">&quot;äºšæ‹‰ç´¢&quot;</span>, <span class="number">33</span>, <span class="string">&quot;ç‹‚é£ä¹Ÿè¿½é€ä¸ä¸Šä»–çš„æ€è€ƒé€Ÿåº¦&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Author</span> <span class="variable">author3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Author</span>(<span class="number">3L</span>, <span class="string">&quot;æ˜“&quot;</span>, <span class="number">14</span>, <span class="string">&quot;æ˜¯è¿™ä¸ªä¸–ç•Œåœ¨é™åˆ¶ä»–çš„æ€ç»´&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Author</span> <span class="variable">author4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Author</span>(<span class="number">3L</span>, <span class="string">&quot;æ˜“&quot;</span>, <span class="number">14</span>, <span class="string">&quot;æ˜¯è¿™ä¸ªä¸–ç•Œåœ¨é™åˆ¶ä»–çš„æ€ç»´&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Book&gt; books1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Book&gt;();</span><br><span class="line">        List&lt;Book&gt; books2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Book&gt;();</span><br><span class="line">        List&lt;Book&gt; books3 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Book&gt;();</span><br><span class="line"></span><br><span class="line">        books1.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">1L</span>, <span class="string">&quot;è¥¿æ¸¸è®°&quot;</span>, <span class="string">&quot;å†’é™©ï¼Œå¥‡å¹»&quot;</span>, <span class="number">90</span>, <span class="string">&quot;è¥¿å¤©å–ç»&quot;</span>));</span><br><span class="line">        books2.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">2L</span>, <span class="string">&quot;ä¸‰å›½æ¼”ä¹‰&quot;</span>, <span class="string">&quot;ç¤¾ä¼š&quot;</span>, <span class="number">99</span>, <span class="string">&quot;ä¸‰å›½æ¼”ä¹‰&quot;</span>));</span><br><span class="line">        books3.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">3L</span>, <span class="string">&quot;çº¢æ¥¼æ¢¦&quot;</span>, <span class="string">&quot;abc&quot;</span>, <span class="number">70</span>, <span class="string">&quot;ggg&quot;</span>));</span><br><span class="line"></span><br><span class="line">        author.setBooks(books1);</span><br><span class="line">        author2.setBooks(books2);</span><br><span class="line">        author3.setBooks(books3);</span><br><span class="line">        author4.setBooks(books3);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(author, author2, author3, author4));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [Author(id=1, name=è’™å¤š, age=33, intro=ä¸€ä¸ªä»èœåˆ€ä¸­æ˜æ‚Ÿå“²ç†çš„ç¥–å®‰äºº,</span></span><br><span class="line"><span class="comment">// books=[Book(id=1, name=è¥¿æ¸¸è®°, category=å†’é™©ï¼Œå¥‡å¹», score=90, intro=è¥¿å¤©å–ç»)]),</span></span><br><span class="line"><span class="comment">// Author(id=2, name=äºšæ‹‰ç´¢, age=33, intro=ç‹‚é£ä¹Ÿè¿½é€ä¸ä¸Šä»–çš„æ€è€ƒé€Ÿåº¦, books=[Book(id=2,</span></span><br><span class="line"><span class="comment">// name=ä¸‰å›½æ¼”ä¹‰, category=ç¤¾ä¼š, score=99, intro=ä¸‰å›½æ¼”ä¹‰)]), Author(id=3, name=æ˜“,</span></span><br><span class="line"><span class="comment">// age=14, intro=æ˜¯è¿™ä¸ªä¸–ç•Œåœ¨é™åˆ¶ä»–çš„æ€ç»´, books=[Book(id=3, name=çº¢æ¥¼æ¢¦, category=abc,</span></span><br><span class="line"><span class="comment">// score=70, intro=ggg)]), Author(id=3, name=æ˜“, age=14, intro=æ˜¯è¿™ä¸ªä¸–ç•Œåœ¨é™åˆ¶ä»–çš„æ€ç»´,</span></span><br><span class="line"><span class="comment">// books=[Book(id=3, name=çº¢æ¥¼æ¢¦, category=abc, score=70, intro=ggg)])]</span></span><br></pre></td></tr></table></figure><h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><ul><li>è·å–å¹´é¾„å°äº 18 çš„ä½œè€… å¹¶ä¸”æ‰“å°å§“å</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">authors.stream() <span class="comment">// æŠŠé›†åˆè½¬åŒ–ä¸ºæµ</span></span><br><span class="line">        .distinct()</span><br><span class="line">        .filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> author.getAge() &lt; <span class="number">18</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .forEach(<span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;Author&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                System.out.println(author.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><ul><li>Lambda ä¼˜åŒ–</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">authors.stream() <span class="comment">// æŠŠé›†åˆè½¬åŒ–ä¸ºæµ</span></span><br><span class="line">        .distinct()</span><br><span class="line">        .filter(author -&gt; author.getAge() &lt; <span class="number">18</span>)</span><br><span class="line">        .forEach(author -&gt; System.out.println(author.getName()));</span><br></pre></td></tr></table></figure><h3 id="dubug-åˆ†æ"><a href="#dubug-åˆ†æ" class="headerlink" title="dubug åˆ†æ"></a>dubug åˆ†æ</h3><p><img src="/img/java8.assets/1684946997559-e36b5fc6-ad71-47c8-8ddb-cf684f6db8fb.png" alt="img"></p><ul><li>åˆå§‹</li></ul><p><img src="/img/java8.assets/1684947033165-1b2bb7a7-f442-4dd7-862d-8bf805758ef7.png" alt="img"></p><ul><li>å»é‡</li></ul><p><img src="/img/java8.assets/1684947067742-f58ecaf1-5970-4de5-a11b-88cb51184df6.png" alt="img"></p><ul><li>è¿‡æ»¤</li></ul><p><img src="/img/java8.assets/1684947083920-11bcb0d1-e30c-45e6-a396-6841a167c478.png" alt="img"></p><ul><li>æ‰“å°</li></ul><p><img src="/img/java8.assets/1684947094349-94412fc2-2b49-43cc-a5f8-086c1f24b990.png" alt="img"></p><h2 id="åˆ›å»ºæµ"><a href="#åˆ›å»ºæµ" class="headerlink" title="åˆ›å»ºæµ"></a>åˆ›å»ºæµ</h2><p><img src="/img/java8.assets/1684983125139-6d700f50-e4b0-43d9-8620-afb88e95ff24.png" alt="img"></p><ul><li>æ•°ç»„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">    Integer[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ,<span class="number">4</span> ,<span class="number">5</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    Stream&lt;Integer&gt; stream = Arrays.stream(arr);</span><br><span class="line">    <span class="comment">// Stream&lt;Integer&gt; stream1 = Stream.of(arr);</span></span><br><span class="line">    stream.distinct()</span><br><span class="line">            .filter(item -&gt; item &gt; <span class="number">4</span>)</span><br><span class="line">            .forEach(item -&gt; System.out.println(item)); <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åŒåˆ—é›†åˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒåˆ—é›†åˆ</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMap</span><span class="params">()</span> &#123;</span><br><span class="line">    HashMap&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;è¯ºæ‰‹&quot;</span>, <span class="number">99</span>);</span><br><span class="line">    map.put(<span class="string">&quot;äºšç´¢&quot;</span>, <span class="number">19</span>);</span><br><span class="line">    map.put(<span class="string">&quot;ez&quot;</span>, <span class="number">32</span>);</span><br><span class="line">    Set&lt;Map.Entry&lt;String, Integer&gt;&gt; entries = map.entrySet(); <span class="comment">// è½¬åŒ–ä¸ºå•åˆ—</span></span><br><span class="line">    Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; stream = entries.stream();</span><br><span class="line">    stream.filter(item -&gt; item.getValue() &gt; <span class="number">90</span>)</span><br><span class="line">            .forEach(item -&gt; System.out.println(item.getValue())); <span class="comment">// 99</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸­é—´æ“ä½œ"><a href="#ä¸­é—´æ“ä½œ" class="headerlink" title="ä¸­é—´æ“ä½œ"></a>ä¸­é—´æ“ä½œ</h2><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    <span class="comment">// æ‰“å°ä½œå®¶å§“åé•¿åº¦å¤§äº1çš„ä½œå®¶</span></span><br><span class="line">    authors.stream()</span><br><span class="line">            .filter(item -&gt; item.getName().length() &gt; <span class="number">1</span>)</span><br><span class="line">            .forEach(item -&gt; System.out.println(item.getName()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è’™å¤š</span></span><br><span class="line"><span class="comment">// äºšæ‹‰ç´¢</span></span><br></pre></td></tr></table></figure><h3 id="âœ¨map"><a href="#âœ¨map" class="headerlink" title="âœ¨map"></a>âœ¨map</h3><p><img src="/img/java8.assets/1684985434048-80a66cdf-9b43-48c5-a46e-808849919b97.png" alt="img"></p><ul><li>æ— ä¼˜åŒ–</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å°æ‰€æœ‰å§“å</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMap</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .map(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Author, String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="comment">// å‚æ•°mapç¬¬ä¸€ä¸ªæ³›å‹ è¿”å›å€¼ç¬¬äºŒä¸ªæ³›å‹</span></span><br><span class="line">                <span class="keyword">public</span> String <span class="title function_">apply</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> author.getName();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .forEach(<span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(String s)</span> &#123;</span><br><span class="line">                    System.out.println(s);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è’™å¤š</span></span><br><span class="line"><span class="comment">// äºšæ‹‰ç´¢</span></span><br><span class="line"><span class="comment">// æ˜“</span></span><br><span class="line"><span class="comment">// æ˜“</span></span><br></pre></td></tr></table></figure><ul><li>ä¼˜åŒ–</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">authors.stream()</span><br><span class="line">        .map(author -&gt; author.getName())</span><br><span class="line">        .forEach(s -&gt; System.out.println(s));</span><br></pre></td></tr></table></figure><ul><li>debug map</li><li>æŠŠä½œå®¶çš„å§“åä½œä¸ºæµè¿”å›</li><li>æµä¸­çš„æ•°æ®ç±»å‹ä» Author è½¬ä¸º String</li></ul><p><img src="/img/java8.assets/1684985983004-fd77268a-355d-45c0-944e-174050f132c3.png" alt="img"></p><h3 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h3><ul><li>å»é‡</li></ul><p><img src="/img/java8.assets/1684986596142-bd5ba75a-5edc-44a8-af4c-a220aa941108.png" alt="img"></p><ul><li>æ³•ä¸€ é‡å†™ cmp</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹å¹´é¾„é™åº</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testsort</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .sorted((o1, o2) -&gt; o2.getAge() - o1.getAge())</span><br><span class="line">            .forEach(item -&gt; System.out.println(item.getAge()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 33</span></span><br><span class="line"><span class="comment">// 15</span></span><br><span class="line"><span class="comment">// 14</span></span><br></pre></td></tr></table></figure><ul><li>æ³•äºŒç©ºå‚ ç±»éœ€è¦é‡å†™</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Author&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">// ç®€ä»‹</span></span><br><span class="line">    <span class="keyword">private</span> String intro;</span><br><span class="line">    <span class="comment">// ä½œå“</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; books;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Author o)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getAge() - o.getAge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Limit"><a href="#Limit" class="headerlink" title="Limit"></a>Limit</h3><ul><li>å– limit è®¾ç½®çš„å‰ n ä¸ªå…ƒç´ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å»é‡ é™åºæ’åº æ‰“å°æœ€å¤§å¹´é¾„çš„ä¸¤ä¸ªä½œå®¶</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLimit</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .sorted()</span><br><span class="line">            .limit(<span class="number">2</span>)</span><br><span class="line">            .forEach(item -&gt; System.out.println(item.getAge()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h3><ul><li>è·³è¿‡æµä¸­å‰ n ä¸ªå…ƒç´ ï¼Œè¿”å›å‰©ä¸‹çš„å…ƒç´ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSkip</span><span class="params">()</span> &#123;</span><br><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">authors.stream()</span><br><span class="line">        .distinct()</span><br><span class="line">        .sorted()</span><br><span class="line">        .skip(<span class="number">1</span>)</span><br><span class="line">        .forEach(item -&gt; System.out.println(item.getAge()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 14 è·³è¿‡</span></span><br><span class="line"><span class="comment">// 15</span></span><br><span class="line"><span class="comment">// 33</span></span><br></pre></td></tr></table></figure><h3 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h3><ul><li>map åªèƒ½å°†ä¸€ä¸ªå¯¹è±¡è½¬ä¸ºå¦ä¸€ä¸ªå¯¹è±¡ä½œä¸ºæµä¸­çš„å…ƒç´ </li><li>flatMap å¯ä»¥ä¸€ä¸ªå¯¹è±¡è½¬ä¸ºå¦å¤šä¸ªå¯¹è±¡ä½œä¸ºæµä¸­çš„å…ƒç´ </li></ul><ol><li>ä¼˜åŒ–å‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å°æ‰€æœ‰ä¹¦ç±çš„åå­— è¦æ±‚å¯¹é‡å¤çš„å…ƒç´ å»é‡</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testFlatMap</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .flatMap(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Author, Stream&lt;Book&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Stream&lt;Book&gt; <span class="title function_">apply</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> author.getBooks().stream();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .distinct()</span><br><span class="line">            .forEach(item -&gt; System.out.println(item.getName()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ä¼˜åŒ–å</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å°æ‰€æœ‰ä¹¦ç±çš„åå­— è¦æ±‚å¯¹é‡å¤çš„å…ƒç´ å»é‡</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testFlatMap</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .flatMap(author -&gt; author.getBooks().stream())</span><br><span class="line">            .distinct()</span><br><span class="line">            .forEach(item -&gt; System.out.println(item.getName()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>debug åˆ†æ</p></li><li><ol><li><code>authorsæµ-&gt;booksæµ</code></li></ol></li></ol><p><img src="/img/java8.assets/1685031706104-eee07f23-3237-4d9f-bc73-f34570c98359.png" alt="img"></p><ol><li>ä½¿ç”¨ split</li></ol><p><img src="/img/java8.assets/1685032516212-3455cd3a-c6ef-4e22-a055-0c64e380c64b.png" alt="img"></p><ul><li><p>ä½¿ç”¨äºŒ</p></li><li><p>åˆ†ç±»æ ¼å¼ xxxï¼Œxxx</p></li><li><ul><li>è¦æ±‚è·å–æ‰€æœ‰åˆ†ç±»ï¼Œå»é‡</li><li>å…ˆå¾—åˆ°ä¹¦ç±çš„æµ</li><li>å†å¾—åˆ°åˆ†ç±»æ•°ç»„ï¼ˆç”¨ split åˆ†å¼€ï¼‰</li><li>è½¬ä¸º stream <code>Arrays.stream</code></li><li>å»é‡åˆ†ç±»</li></ul></li></ul><p><img src="/img/java8.assets/1685178824897-34e1a59f-11a4-41ca-8373-8ce3342d97bf.png" alt="img"></p><h2 id="ç»ˆç»“æ“ä½œ"><a href="#ç»ˆç»“æ“ä½œ" class="headerlink" title="ç»ˆç»“æ“ä½œ"></a>ç»ˆç»“æ“ä½œ</h2><h3 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h3><p><img src="/img/java8.assets/1685179127162-38333aa9-98ed-4cf1-8b05-33b0955aa065.png" alt="img"></p><h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å°æ‰€æœ‰ä½œå®¶çš„ä¹¦ç±ç»¼åˆ</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testCount</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> authors.stream()</span><br><span class="line">        .flatMap(author -&gt; author.getBooks().stream())</span><br><span class="line">        .distinct()</span><br><span class="line">        .count();</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h3 id="max-min"><a href="#max-min" class="headerlink" title="max&amp;min"></a>max&amp;min</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ä½œå®¶ä¹¦ç±çš„æœ€é«˜åˆ†å’Œæœ€ä½åˆ†æ‰“å°</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMaxAndMin</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    Optional&lt;Integer&gt; max = authors.stream()<span class="comment">// Stream&lt;Author&gt;</span></span><br><span class="line">            .flatMap(author -&gt; author.getBooks().stream()) <span class="comment">// Stream&lt;Book&gt;</span></span><br><span class="line">            .map(book -&gt; book.getScore())<span class="comment">// Stream&lt;Integer&gt;</span></span><br><span class="line">            .max((b1, b2) -&gt; b1 - b2);</span><br><span class="line">    System.out.println(max.get());  <span class="comment">// 99</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMaxAndMin</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    Optional&lt;Integer&gt; min = authors.stream()<span class="comment">// Stream&lt;Author&gt;</span></span><br><span class="line">            .flatMap(author -&gt; author.getBooks().stream()) <span class="comment">// Stream&lt;Book&gt;</span></span><br><span class="line">            .map(book -&gt; book.getScore())<span class="comment">// Stream&lt;Integer&gt;</span></span><br><span class="line">            .min((b1, b2) -&gt; b1 - b2);</span><br><span class="line">    System.out.println(min.get());  <span class="comment">// 70</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="âœ¨collect"><a href="#âœ¨collect" class="headerlink" title="âœ¨collect"></a>âœ¨collect</h3><ul><li>ä½œç”¨ ï¼š æŠŠå½“å‰æµè½¬æ¢ä¸ºä¸€ä¸ªé›†åˆ</li></ul><ol><li>è·å–ä¸€ä¸ªå­˜æ”¾æ‰€æœ‰ä½œè€…åå­—çš„ List é›†åˆ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ä¸€ä¸ªå­˜æ”¾æ‰€æœ‰ä½œè€…åå­—çš„Listé›†åˆ</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testCollect</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    List&lt;String&gt; nameList = authors.stream()</span><br><span class="line">            .map(author -&gt; author.getName())</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    System.out.println(nameList); <span class="comment">// [è’™å¤š, äºšæ‹‰ç´¢, æ˜“, æ˜“]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è·å–ä¸€ä¸ªæ‰€æœ‰ä¹¦åçš„ set é›†åˆ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    Set&lt;String&gt; books = authors.stream()</span><br><span class="line">            .flatMap(author -&gt; author.getBooks().stream())</span><br><span class="line">            .map(book -&gt; book.getName())</span><br><span class="line">            .collect(Collectors.toSet());</span><br><span class="line">    System.out.println(books);</span><br><span class="line">    <span class="comment">// [ä¸‰å›½æ¼”ä¹‰, çº¢æ¥¼æ¢¦, è¥¿æ¸¸è®°]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è·å–ä¸€ä¸ª Map é›†åˆï¼Œ map çš„ key ä¸ºä½œè€…åï¼Œvalue ä¸º<code>List&lt;Book&gt;</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMap</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    Map&lt;String, List&lt;Book&gt;&gt; map = authors.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .collect(Collectors.toMap(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Author, String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> String <span class="title function_">apply</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> author.getName();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="keyword">new</span> <span class="title class_">Function</span>&lt;Author, List&lt;Book&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">apply</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> author.getBooks();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;));</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMap</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    Map&lt;String, List&lt;Book&gt;&gt; map = authors.stream()</span><br><span class="line">            .distinct() <span class="comment">// ä¸€å®šè¦å»é‡ mapçš„keyä¸èƒ½é‡å¤</span></span><br><span class="line">            .collect(Collectors.toMap(author -&gt; author.getName(),</span><br><span class="line">                                      author -&gt; author.getBooks()));</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>{äºšæ‹‰ç´¢&#x3D;[Book(id&#x3D;2, name&#x3D;ä¸‰å›½æ¼”ä¹‰, category&#x3D;ç¤¾ä¼š, score&#x3D;99, intro&#x3D;ä¸‰å›½æ¼”ä¹‰)], è’™å¤š&#x3D;[Book(id&#x3D;1, name&#x3D;è¥¿æ¸¸è®°, category&#x3D;å†’é™©ï¼Œå¥‡å¹», score&#x3D;90, intro&#x3D;è¥¿å¤©å–ç»)], æ˜“&#x3D;[Book(id&#x3D;3, name&#x3D;çº¢æ¥¼æ¢¦, category&#x3D;å“²å­¦, score&#x3D;70, intro&#x3D;ggg), Book(id&#x3D;3, name&#x3D;çº¢æ¥¼æ¢¦, category&#x3D;å“²å­¦, score&#x3D;70, intro&#x3D;ggg)]}</p><ul><li>debug</li></ul><p><img src="/img/java8.assets/1685182235223-7bb6ae4e-9b16-40f9-a8ac-e1405ec48ec5.png" alt="img"></p><h3 id="åŒ¹é…"><a href="#åŒ¹é…" class="headerlink" title="åŒ¹é…"></a>åŒ¹é…</h3><h4 id="anyMatch"><a href="#anyMatch" class="headerlink" title="anyMatch"></a>anyMatch</h4><p>å¯ä»¥ç”¨æ¥åˆ¤æ–­ä»»æ„ç¬¦åˆåŒ¹é…æ¡ä»¶çš„å…ƒç´ ï¼Œç»“æœä¸º boolean ç±»å‹</p><ul><li>ä¾‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAnyMatch</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> authors.stream()</span><br><span class="line">            .anyMatch(author -&gt; author.getAge() &gt; <span class="number">29</span>);</span><br><span class="line">    System.out.println(b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="allMatch"><a href="#allMatch" class="headerlink" title="allMatch"></a>allMatch</h4><p>æ‰€æœ‰éƒ½åŒ¹é…è¿”å› true</p><ul><li>ä¾‹ï¼šåˆ¤æ–­æ‰€æœ‰ä½œå®¶æ˜¯å¦éƒ½æ˜¯æˆå¹´äºº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ–­æ‰€æœ‰ä½œå®¶æ˜¯å¦éƒ½æ˜¯æˆå¹´äºº</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAllMatch</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> authors.stream()</span><br><span class="line">            .allMatch(author -&gt; author.getAge() &gt; <span class="number">18</span>);</span><br><span class="line">    System.out.println(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="noneMatch"><a href="#noneMatch" class="headerlink" title="noneMatch"></a>noneMatch</h4><p>åˆ¤æ–­æ˜¯å¦éƒ½ä¸ç¬¦åˆ</p><ul><li>ä¾‹ï¼šåˆ¤æ–­ä½œå®¶æ˜¯å¦éƒ½æ²¡æœ‰è¶…è¿‡ 100 å²çš„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testNoneMatch</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> authors.stream()</span><br><span class="line">            .noneMatch(author -&gt; author.getAge() &gt; <span class="number">100</span>);</span><br><span class="line">    System.out.println(b); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><h4 id="findAny"><a href="#findAny" class="headerlink" title="findAny"></a>findAny</h4><p>è·å–æµä¸­çš„ä»»æ„å…ƒç´ ï¼Œæ— æ³•ä¿è¯æ˜¯ç¬¬ä¸€ä¸ª</p><ul><li>ä¾‹ï¼šè·å–ä»»æ„ä¸€ä¸ªå¹´é¾„å¤§äº 18 çš„ä½œå®¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">TestFindAny</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    Optional&lt;Author&gt; optionalAuthor = authors.stream()</span><br><span class="line">            .filter(author -&gt; author.getAge() &gt; <span class="number">18</span>)</span><br><span class="line">            .findAny();</span><br><span class="line">    <span class="comment">// æœ‰æ•°æ®è¾“å‡º é˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">    optionalAuthor.ifPresent(author -&gt; System.out.println(author));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="findFirst"><a href="#findFirst" class="headerlink" title="findFirst"></a>findFirst</h4><p>è·å–æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p><ul><li>ä¾‹ï¼šè·å–ä¸€ä¸ªå¹´é¾„æœ€å°çš„ä½œå®¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testFindFirst</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    Optional&lt;Author&gt; optionalFirst = authors.stream()</span><br><span class="line">            .sorted((o1, o2) -&gt; o1.getAge() - o2.getAge())</span><br><span class="line">            .findFirst();</span><br><span class="line">    optionalFirst.ifPresent(author -&gt; System.out.println(author.getAge())); <span class="comment">// 14</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><ul><li><p>å¯¹æµä¸­çš„æ•°æ®æŒ‰ç…§ä½ æŒ‡å®šçš„è®¡ç®—æ–¹å¼è®¡ç®—å‡ºä¸€ä¸ªç»“æœã€‚ï¼ˆç¼©å‡æ“ä½œï¼‰</p></li><li><p>reduce çš„ä½œç”¨æ˜¯æŠŠ stream ä¸­çš„å…ƒç´ ç»™ç»„åˆèµ·æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªåˆå§‹å€¼ï¼Œå®ƒä¼šæŒ‰ç…§æˆ‘ä»¬çš„è®¡ç®—æ–¹å¼ä¾æ¬¡æ‹¿æµä¸­çš„å…ƒç´ å’Œåˆå§‹åŒ–å€¼è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—ç»“æœå†å’Œåé¢çš„å…ƒç´ è®¡ç®—ã€‚</p></li><li><p>ä¾‹ï¼šæ±‚æ‰€æœ‰å·¦å€¼å¹´é¾„å’Œ</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testreduce</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> authors.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .map(author -&gt; author.getAge())</span><br><span class="line">            <span class="comment">// 0åˆå§‹å€¼  res ä¸­é—´å˜é‡ element æµä¸­å…ƒç´ </span></span><br><span class="line">            .reduce(<span class="number">0</span>, (res, element) -&gt; res + element);</span><br><span class="line">    System.out.println(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/java8.assets/1685266546057-2eee3038-0937-437c-a628-a15596c62b7c.png" alt="img"></p><ul><li>ä¾‹ï¼šä½¿ç”¨ reduce æ±‚æµä¸­å¹´é¾„æœ€å¤§çš„ä½œè€…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testrduce2</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">max</span> <span class="operator">=</span> authors.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .map(author -&gt; author.getAge())</span><br><span class="line">            .reduce(Integer.MIN_VALUE, (res, element) -&gt;</span><br><span class="line">                    res = res &lt; element ? element : res);</span><br><span class="line">    System.out.println(max); <span class="comment">// 33</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p><img src="/img/java8.assets/1685267442852-8c3b448d-4ddf-4754-bbd0-16278dd7eddd.png" alt="img"></p><h1 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h1><h2 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><ul><li>é˜²æ­¢å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸</li></ul><p><img src="/img/java8.assets/1685268186722-c27055b5-c5a0-41e1-a4ac-a65bd9cb3d82.png" alt="img"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="âœ¨-åˆ›å»ºå¯¹è±¡"><a href="#âœ¨-åˆ›å»ºå¯¹è±¡" class="headerlink" title="âœ¨ åˆ›å»ºå¯¹è±¡"></a>âœ¨ åˆ›å»ºå¯¹è±¡</h3><ul><li>Optional å°±å¥½åƒæ˜¯åŒ…è£…ç±»ï¼Œå¯ä»¥æŠŠæˆ‘ä»¬çš„å…·ä½“æ•°æ®å°è£… Optionalx å¯¹è±¡å†…éƒ¨ã€‚ç„¶åæˆ‘ä»¬å»ä½¿ç”¨ Optional ä¸­å°è£…å¥½çš„æ–¹æ³•æ“ä½œå°è£…è¿›å»çš„æ•°æ®å°±å¯ä»¥éå¸¸ä¼˜é›…çš„é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</li></ul><ol><li>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Optionall çš„é™æ€æ–¹æ³• ofNullable æ¥æŠŠæ•°æ®å°è£…æˆä¸€ä¸ª Optional å¯¹è±¡ã€‚æ— è®ºä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸º nu éƒ½ä¸ä¼šå‡ºç°é—®é¢˜.ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Author</span> <span class="variable">author</span> <span class="operator">=</span> getAuthor();</span><br><span class="line">    Optional&lt;Author&gt; authorOptional = Optional.ofNullable(author);</span><br><span class="line">    authorOptional.ifPresent(author1 -&gt; System.out.println(author1));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> Author <span class="title function_">getAuthor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Author</span> <span class="variable">author</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Author</span>(<span class="number">1L</span>, <span class="string">&quot;è’™å¤š&quot;</span>, <span class="number">33</span>, <span class="string">&quot;ä¸€ä¸ªä»èœåˆ€ä¸­æ˜æ‚Ÿå“²ç†çš„ç¥–å®‰äºº&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æºç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Optional&lt;T&gt; <span class="title function_">ofNullable</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value == <span class="literal">null</span> ? empty() : of(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å¦‚æœä½ ç¡®å®šä¸€ä¸ªå¯¹è±¡ä¸æ˜¯ç©ºçš„åˆ™å¯ä»¥ä½¿ç”¨ Optionall çš„é™æ€æ–¹æ³• of æ¥æŠŠæ•°æ®å°è£…æˆ Optionali å¯¹è±¡ã€‚ï¼ˆä¸å¸¸ç”¨ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Author&gt; authorOptional = Optional.of(author);</span><br></pre></td></tr></table></figure><p><img src="/img/java8.assets/1685269085964-57b5b633-ded2-4a8f-9700-8694a8093687.png" alt="img"></p><h3 id="âœ¨-å®‰å…¨æ¶ˆè´¹å€¼"><a href="#âœ¨-å®‰å…¨æ¶ˆè´¹å€¼" class="headerlink" title="âœ¨ å®‰å…¨æ¶ˆè´¹å€¼"></a>âœ¨ å®‰å…¨æ¶ˆè´¹å€¼</h3><p><img src="/img/java8.assets/1685269908824-2b18014e-20b4-47ec-b0bf-01d83758aa3c.png" alt="img"></p><h3 id="å®‰å…¨è·å–å€¼"><a href="#å®‰å…¨è·å–å€¼" class="headerlink" title="å®‰å…¨è·å–å€¼"></a>å®‰å…¨è·å–å€¼</h3><ul><li>ä¸æ¨èä½¿ç”¨<code>get</code></li></ul><ol><li>orElseGet</li></ol><p>è·å–æ•°æ®å¹¶ä¸”è®¾ç½®æ•°æ®ä¸ºç©ºæ—¶çš„é»˜è®¤å€¼ã€‚å¦‚æœæ•°æ®ä¸ä¸ºç©ºå°±èƒ½è·å–åˆ°è¯¥æ•°æ®ï¼å¦‚æœä¸ºç©ºåˆ™æ ¹æ®ä½ ä¼ å…¥çš„å‚æ•°æ¥åˆ›å»ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼è¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testOrElseGet</span><span class="params">()</span> &#123;</span><br><span class="line">    Optional&lt;Author&gt; authorOptional = getAuthorOptional();</span><br><span class="line">    <span class="type">Author</span> <span class="variable">author</span> <span class="operator">=</span> authorOptional.orElseGet(() -&gt; <span class="keyword">new</span> <span class="title class_">Author</span>(<span class="number">1L</span>, <span class="string">&quot;é»˜è®¤&quot;</span>, <span class="number">33</span>, <span class="string">&quot;é»˜è®¤&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">    System.out.println(author.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">static</span> Optional&lt;Author&gt; <span class="title function_">getAuthorOptional</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Author</span> <span class="variable">author</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Author</span>(<span class="number">1L</span>, <span class="string">&quot;è’™å¤š&quot;</span>, <span class="number">33</span>, <span class="string">&quot;ä¸€ä¸ªä»èœåˆ€ä¸­æ˜æ‚Ÿå“²ç†çš„ç¥–å®‰äºº&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> Optional.ofNullable(author);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>orElseThrow</li></ol><p>è·å–æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸ä¸ºç©ºå°±èƒ½è·å–åˆ°è¯¥æ•°æ®ã€‚å¦‚æœä¸ºç©ºåˆ™æ ¹æ®ä½ ä¼ å…¥çš„å‚æ•°æ¥åˆ›å»ºå¼‚å¸¸æŠ›å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testOrElseThrow</span><span class="params">()</span> &#123;</span><br><span class="line">    Optional&lt;Author&gt; authorOptional = getAuthorOptional();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Author</span> <span class="variable">author</span> <span class="operator">=</span> authorOptional.orElseThrow(() -&gt;</span><br><span class="line">                                                   <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ•°æ®ä¸ºnull&quot;</span>));</span><br><span class="line">        System.out.println(author);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h3><p><img src="/img/java8.assets/1685276863225-95634322-f91c-4446-a05a-73cede34069a.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    Optional&lt;Author&gt; authorOptional = getAuthorOptional();</span><br><span class="line">    authorOptional.filter(author -&gt; author.getAge() &gt; <span class="number">18</span>)</span><br><span class="line">            .ifPresent(author -&gt; System.out.println(author));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­"><a href="#åˆ¤æ–­" class="headerlink" title="åˆ¤æ–­"></a>åˆ¤æ–­</h3><ul><li>æ˜¯å¦å­˜åœ¨</li></ul><p><img src="/img/java8.assets/1685277055492-2351cee5-7930-4d3f-be21-ed7b3db2b0af.png" alt="img"></p><h3 id="æ•°æ®è½¬æ¢-Map"><a href="#æ•°æ®è½¬æ¢-Map" class="headerlink" title="æ•°æ®è½¬æ¢ Map"></a>æ•°æ®è½¬æ¢ Map</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMap</span><span class="params">()</span> &#123;</span><br><span class="line">    Optional&lt;Author&gt; authorOptional = getAuthorOptional();</span><br><span class="line">    authorOptional.map(author -&gt; author.getName())</span><br><span class="line">              .ifPresent(name -&gt; System.out.println(name)); <span class="comment">// è’™å¤š</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><ul><li>åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£æˆ‘ä»¬ç§°ä¹‹ä¸ºå‡½æ•°æ¥å£ã€‚</li><li>JDK çš„å‡½æ•°å¼æ¥å£éƒ½åŠ ä¸Šäº†@Functionallnterface æ³¨è§£è¿›è¡Œæ ‡è¯†ã€‚ä½†æ˜¯æ— è®ºæ˜¯å¦åŠ ä¸Šè¯¥æ³¨è§£åªè¦æ¥å£ä¸­åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œéƒ½æ˜¯å‡½æ•°å¼æ¥å£ã€‚</li></ul><h2 id="å¸¸è§å‡½æ•°å¼æ¥å£"><a href="#å¸¸è§å‡½æ•°å¼æ¥å£" class="headerlink" title="å¸¸è§å‡½æ•°å¼æ¥å£"></a>å¸¸è§å‡½æ•°å¼æ¥å£</h2><ol><li>consumer</li></ol><p><img src="/img/java8.assets/1685277820057-30f11a74-2693-4cf8-9ccb-bd69e744e89d.png" alt="img"></p><ol><li>Function</li></ol><ul><li>ç¬¬ä¸€ä¸ªæ³›å‹è½¬ä¸ºç¬¬äºŒä¸ªæ³›å‹</li></ul><p><img src="/img/java8.assets/1685277868594-56fc397c-c903-4a47-9250-30f9acaa72c0.png" alt="img"></p><ol><li>Predicate</li></ol><p><img src="/img/java8.assets/1685277932817-03422e65-4bbf-4f1b-8d15-8dfb9505ce58.png" alt="img"></p><ol><li>Supplier</li></ol><p><img src="/img/java8.assets/1685277971014-5bdda7a2-a076-43fc-ad09-578825f4f5eb.png" alt="img"></p><h2 id="å‡½æ•°å¼æ¥å£å¸¸ç”¨çš„é»˜è®¤æ–¹æ³•"><a href="#å‡½æ•°å¼æ¥å£å¸¸ç”¨çš„é»˜è®¤æ–¹æ³•" class="headerlink" title="å‡½æ•°å¼æ¥å£å¸¸ç”¨çš„é»˜è®¤æ–¹æ³•"></a>å‡½æ•°å¼æ¥å£å¸¸ç”¨çš„é»˜è®¤æ–¹æ³•</h2><ol><li>and</li></ol><p><img src="/img/java8.assets/1685280515443-463b2c05-8ab3-490b-8199-f20ac4e398cb.png" alt="img"></p><ol><li>or</li></ol><h1 id="6-æ–¹æ³•å¼•ç”¨"><a href="#6-æ–¹æ³•å¼•ç”¨" class="headerlink" title="6.æ–¹æ³•å¼•ç”¨"></a>6.æ–¹æ³•å¼•ç”¨</h1><ul><li>æˆ‘ä»¬åœ¨ä½¿ç”¨ lambda æ—¶ï¼Œå¦‚æœæ–¹æ³•ä½“ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨çš„è¯ï¼ˆåŒ…æ‹¬æ„é€ æ–¹æ³•ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ–¹æ³•å¼•ç”¨è¿›ä¸€æ­¥ç®€åŒ–ä»£ç ã€‚</li></ul><h2 id="6-1-æ¨èç”¨æ³•"><a href="#6-1-æ¨èç”¨æ³•" class="headerlink" title="6.1 æ¨èç”¨æ³•"></a>6.1 æ¨èç”¨æ³•</h2><ul><li>æˆ‘ä»¬åœ¨ä½¿ç”¨ lambda æ—¶ä¸éœ€è¦è€ƒè™‘ä»€ä¹ˆæ—¶å€™ç”¨æ–¹æ³•å¼•ç”¨ï¼Œç”¨å“ªç§æ–¹æ³•å¼•ç”¨ï¼Œæ–¹æ³•å¼•ç”¨çš„æ ¼å¼æ˜¯ä»€ä¹ˆã€‚æˆ‘ä»¬åªéœ€è¦åœ¨å†™å®Œ lambda æ–¹æ³•å‘ç°æ–¹æ³•ä½“åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¹¶ä¸”æ˜¯æ–¹æ³•çš„è°ƒç”¨æ—¶ä½¿ç”¨å¿«æ·é”®å°è¯•æ˜¯å¦èƒ½å¤Ÿè½¬æ¢æˆæ–¹æ³•å¼•ç”¨å³å¯ã€‚</li><li>å½“æˆ‘ä»¬æ–¹æ³•å¼•ç”¨ä½¿ç”¨çš„å¤šäº†æ…¢æ…¢çš„ä¹Ÿå¯ä»¥ç›´æ¥å†™å‡ºæ–¹æ³•å¼•ç”¨ã€‚</li></ul><h2 id="6-2-åŸºç¡€æ ¼å¼"><a href="#6-2-åŸºç¡€æ ¼å¼" class="headerlink" title="6.2 åŸºç¡€æ ¼å¼"></a>6.2 åŸºç¡€æ ¼å¼</h2><p><img src="/img/java8.assets/1685280776144-9299cb9c-a56c-4eec-bd82-1291ce21601a.png" alt="img"></p><h2 id="6-3-è¯­æ³•è¯¦è§£"><a href="#6-3-è¯­æ³•è¯¦è§£" class="headerlink" title="6.3 è¯­æ³•è¯¦è§£"></a>6.3 è¯­æ³•è¯¦è§£</h2><h3 id="å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•"><a href="#å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•" class="headerlink" title="å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•"></a>å¼•ç”¨ç±»çš„é™æ€æ–¹æ³•</h3><p><img src="/img/java8.assets/1685280991210-8882c2ce-d824-4f20-931e-385f6469f680.png" alt="img"></p><ul><li><p>è°ƒç”¨äº† String ç±»çš„æŠ½è±¡æ–¹æ³• ä¸”å‚æ•° age ä¼ å…¥ age</p></li><li><ul><li>ä¼˜åŒ–</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testJingTai</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .map(author -&gt; author.getAge()) <span class="comment">// Stream&lt;Integer&gt;</span></span><br><span class="line">            .map(String::valueOf) <span class="comment">// Stream&lt;String&gt;</span></span><br><span class="line">            .forEach(item -&gt; System.out.println(item));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 33</span></span><br><span class="line"><span class="comment">// 15</span></span><br><span class="line"><span class="comment">// 14</span></span><br><span class="line"><span class="comment">// 14</span></span><br></pre></td></tr></table></figure><h3 id="å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•"><a href="#å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•" class="headerlink" title="å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•"></a>å¼•ç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•</h3><p><img src="/img/java8.assets/1685281345780-dc42d456-ee1a-40dc-b889-5f9f6046eb37.png" alt="img"></p><ul><li>ä¼˜åŒ–</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDuixiang</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .map(author -&gt; author.getName())</span><br><span class="line">            .forEach(sb::append);</span><br><span class="line">    System.out.println(sb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è’™å¤šäºšæ‹‰ç´¢æ˜“æ˜“</span></span><br></pre></td></tr></table></figure><h3 id="å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•"><a href="#å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•" class="headerlink" title="å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•"></a>å¼•ç”¨ç±»çš„å®ä¾‹æ–¹æ³•</h3><p><img src="/img/java8.assets/1685281658102-981b35b6-56ec-412c-b94e-b2c7e3989c07.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodDemo</span> &#123;</span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">UseString</span> &#123;</span><br><span class="line">        String <span class="title function_">use</span><span class="params">(String str, <span class="type">int</span> start, <span class="type">int</span> length)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">subAuthorName</span><span class="params">(String str, UseString useString)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> useString.use(str, start, length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        subAuthorName(<span class="string">&quot;cyt&quot;</span>, (str, start, length) -&gt; str.substring(start, length));</span><br><span class="line">        <span class="comment">//  subAuthorName(&quot;cyt&quot;, String::substring);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ å™¨å¼•ç”¨"><a href="#æ„é€ å™¨å¼•ç”¨" class="headerlink" title="æ„é€ å™¨å¼•ç”¨"></a>æ„é€ å™¨å¼•ç”¨</h3><p><img src="/img/java8.assets/1685283623097-1968d01e-7028-4ced-bfdc-3be4d3f60146.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .map(author -&gt; author.getName())</span><br><span class="line">            <span class="comment">// .map(StringBuilder::new)</span></span><br><span class="line">            .map(name -&gt; <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(name))</span><br><span class="line">            .map(sb -&gt; sb.append(<span class="string">&quot;-cyt&quot;</span>).toString()) <span class="comment">// ä¸æ˜¯ä¸€è¡Œ ä¸èƒ½ä½¿ç”¨å¼•ç”¨</span></span><br><span class="line">            .forEach(str -&gt; System.out.println(str));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è’™å¤š-cyt</span></span><br><span class="line"><span class="comment">// äºšæ‹‰ç´¢-cyt</span></span><br><span class="line"><span class="comment">// æ˜“-cyt</span></span><br><span class="line"><span class="comment">// æ˜“-cyt</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜åŒ–å…¨éƒ¨</span></span><br><span class="line">authors.stream()</span><br><span class="line">        .map(Author::getName)</span><br><span class="line">        .map(StringBuilder::<span class="keyword">new</span>)</span><br><span class="line">        .map(sb -&gt; sb.append(<span class="string">&quot;-cyt&quot;</span>).toString())</span><br><span class="line">        .forEach(System.out::println);</span><br></pre></td></tr></table></figure><h1 id="7-é«˜çº§ç”¨æ³•"><a href="#7-é«˜çº§ç”¨æ³•" class="headerlink" title="7.é«˜çº§ç”¨æ³•"></a>7.é«˜çº§ç”¨æ³•</h1><h2 id="åŸºæœ¬æ•°æ®ç±»å‹ä¼˜åŒ–"><a href="#åŸºæœ¬æ•°æ®ç±»å‹ä¼˜åŒ–" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹ä¼˜åŒ–"></a>åŸºæœ¬æ•°æ®ç±»å‹ä¼˜åŒ–</h2><p><img src="/img/java8.assets/1685284205166-84846d6c-79e6-482c-bcc6-5fa312589ad8.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGaoJi</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .map(author -&gt; author.getAge())</span><br><span class="line">            .map(age -&gt; age + <span class="number">10</span>) <span class="comment">// è£…ç®±æ‹†ç®±</span></span><br><span class="line">            .filter(age -&gt; age &gt; <span class="number">18</span>) <span class="comment">// è£…ç®±æ‹†ç®±</span></span><br><span class="line">            .map(age -&gt; age + <span class="number">2</span>) <span class="comment">// è£…ç®±æ‹†ç®±</span></span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 45</span></span><br><span class="line"><span class="comment">// 27</span></span><br><span class="line"><span class="comment">// 26</span></span><br><span class="line"><span class="comment">// 26</span></span><br><span class="line"></span><br><span class="line">authors.stream()</span><br><span class="line">        .mapToInt(author -&gt; author.getAge())</span><br><span class="line">        .map(age -&gt; age + <span class="number">10</span>)</span><br><span class="line">        .filter(age -&gt; age &gt; <span class="number">18</span>)</span><br><span class="line">        .map(age -&gt; age + <span class="number">2</span>)</span><br><span class="line">        .forEach(System.out::println);</span><br></pre></td></tr></table></figure><h2 id="å¹¶è¡Œæµ"><a href="#å¹¶è¡Œæµ" class="headerlink" title="å¹¶è¡Œæµ"></a>å¹¶è¡Œæµ</h2><ul><li><p>å½“æµä¸­æœ‰å¤§é‡å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¹¶è¡Œæµå»æé«˜æ“ä½œçš„æ•ˆç‡ã€‚å…¶å®å¹¶è¡Œæµå°±æ˜¯æŠŠä»»åŠ¡åˆ†é…ç»™å¤šä¸ªçº¿ç¨‹å»å®Œå…¨ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±å»ç”¨ä»£ç å®ç°çš„è¯å…¶å®ä¼šéå¸¸çš„å¤æ‚ï¼Œå¹¶ä¸”è¦æ±‚ä½ å¯¹å¹¶å‘ç¼–ç¨‹æœ‰è¶³å¤Ÿçš„ç†è§£å’Œè®¤è¯†ã€‚è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Stream çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±å¯ä»¥ä½¿ç”¨å¹¶è¡Œæµæ¥å¸®æˆ‘ä»¬å®ç°ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p></li><li><p><code>stream.parallel()</code>parallel æ–¹æ³•å¯ä»¥æŠŠä¸²è¡Œæµè½¬æ¢æˆå¹¶è¡Œæµã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testJuc</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Integer&gt; integerStream = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> integerStream.parallel() <span class="comment">// å¤šä¸ªçº¿ç¨‹</span></span><br><span class="line">            .filter(num -&gt; num &gt; <span class="number">5</span>)</span><br><span class="line">            .reduce(<span class="number">0</span>, (res, ele) -&gt; res + ele);</span><br><span class="line">    System.out.println(sum); <span class="comment">// 40</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ peek è°ƒè¯•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testJuc</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Integer&gt; integerStream = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> integerStream.parallel()</span><br><span class="line">            .peek(<span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Integer num)</span> &#123;</span><br><span class="line">                    System.out.println(num + Thread.currentThread().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .filter(num -&gt; num &gt; <span class="number">5</span>)</span><br><span class="line">            .reduce(<span class="number">0</span>, (res, ele) -&gt; res + ele);</span><br><span class="line">    System.out.println(sum); <span class="comment">// 40</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 7main</span></span><br><span class="line"><span class="comment">// 6main</span></span><br><span class="line"><span class="comment">// 8main</span></span><br><span class="line"><span class="comment">// 1ForkJoinPool.commonPool-worker-11</span></span><br><span class="line"><span class="comment">// 3ForkJoinPool.commonPool-worker-9</span></span><br><span class="line"><span class="comment">// 4ForkJoinPool.commonPool-worker-4</span></span><br><span class="line"><span class="comment">// 2main</span></span><br><span class="line"><span class="comment">// 9ForkJoinPool.commonPool-worker-2</span></span><br><span class="line"><span class="comment">// 10ForkJoinPool.commonPool-worker-13</span></span><br><span class="line"><span class="comment">// 5ForkJoinPool.commonPool-worker-11</span></span><br><span class="line"><span class="comment">// 40</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> javaåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> java8 </tag>
            
            <tag> Lambda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è´ªå¿ƒ</title>
      <link href="//post/%E7%AE%97%E6%B3%95/%E8%B4%AA%E5%BF%83.html"/>
      <url>//post/%E7%AE%97%E6%B3%95/%E8%B4%AA%E5%BF%83.html</url>
      
        <content type="html"><![CDATA[<h2 id="åŒºé—´é€‰ç‚¹"><a href="#åŒºé—´é€‰ç‚¹" class="headerlink" title="åŒºé—´é€‰ç‚¹"></a>åŒºé—´é€‰ç‚¹</h2><ol><li>é¢˜ç›®</li></ol><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1671977714285-e5819e83-4c7d-4ca9-a828-49344376b8c8.png" alt="img"></p><ol><li>è§£æ³•æ€è·¯</li></ol><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1671977656097-fa72f97e-1fc3-43e3-abaf-899795eba180.png" alt="img"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> int N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line">struct <span class="title class_">Range</span>&#123;</span><br><span class="line">    int l,r;</span><br><span class="line">    bool operator &lt; (<span class="keyword">const</span> <span class="title class_">Range</span> &amp;w)<span class="keyword">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> r &lt; w.<span class="property">r</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;range[N];</span><br><span class="line"></span><br><span class="line">int <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    int n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(int i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        int l,r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        range[i] = &#123;l,r&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">sort</span>(range,range + n);</span><br><span class="line">    int res = <span class="number">0</span>,ed = -<span class="number">2e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(int i = <span class="number">0</span>;i &lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(range[i].<span class="property">l</span> &gt; ed)</span><br><span class="line">        &#123;</span><br><span class="line">            res++;</span><br><span class="line">            ed = range[i].<span class="property">r</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> int N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line">struct <span class="title class_">Range</span>&#123;</span><br><span class="line">    int l,r;</span><br><span class="line">&#125;range[N];</span><br><span class="line"></span><br><span class="line">int <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    int n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(int i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        int l,r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        range[i] = &#123;l,r&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">sort</span>(range,range + n ,[](<span class="keyword">const</span> <span class="title class_">Range</span>&amp; u, <span class="keyword">const</span> <span class="title class_">Range</span>&amp; v) &#123;</span><br><span class="line">            <span class="keyword">return</span> u.<span class="property">r</span> &lt; v.<span class="property">r</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    int res = <span class="number">0</span>,ed = -<span class="number">2e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(int i = <span class="number">0</span>;i &lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(range[i].<span class="property">l</span> &gt; ed)</span><br><span class="line">        &#123;</span><br><span class="line">            res++;</span><br><span class="line">            ed = range[i].<span class="property">r</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒºé—´åˆ†ç»„"><a href="#åŒºé—´åˆ†ç»„" class="headerlink" title="åŒºé—´åˆ†ç»„"></a>åŒºé—´åˆ†ç»„</h2><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672066890008-8d5c3f58-d25e-4757-ab2d-2c8652d36747.png" alt="img"></p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><ol><li>å°æ ¹å †ç»´æŠ¤æ‰€æœ‰ç»„å³ç«¯ç‚¹æœ€å¤§å€¼</li><li>å¦‚æœæ‰€æœ‰ç»„å³ç«¯ç‚¹æœ€å°å€¼ï¼ˆtopï¼‰&gt; l[i].l ä¸å­˜åœ¨è¿™ä¸ªç»„ åŠ æ–°çš„ç»„ï¼ˆpush l[i].rï¼‰</li><li>å¦åˆ™æ”¾å…¥æœ€å°çš„ç»„ ï¼ˆpop pushï¼‰</li></ol><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672066867963-2cbc0854-1936-4760-bbe6-d5cfe27a309f.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Range</span>&#123;</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Range &amp;W) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> l &lt; W.l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;range[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l,r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        range[i] = &#123;l,r&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(range , range + n);</span><br><span class="line">    priority_queue&lt;<span class="type">int</span>,vector&lt;<span class="type">int</span>&gt;,greater&lt;<span class="type">int</span>&gt; &gt; heap;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n;i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> r = range[i];</span><br><span class="line">        <span class="keyword">if</span>(heap.<span class="built_in">empty</span>() || heap.<span class="built_in">top</span>() &gt;= r.l) heap.<span class="built_in">push</span>(r.r);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            heap.<span class="built_in">pop</span>();</span><br><span class="line">            heap.<span class="built_in">push</span>(r.r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, heap.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒºé—´è¦†ç›–"><a href="#åŒºé—´è¦†ç›–" class="headerlink" title="åŒºé—´è¦†ç›–"></a>åŒºé—´è¦†ç›–</h2><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672200676355-8f9a4a26-b639-4ab1-877a-6d61f5cefaa9.png" alt="img"></p><h3 id="é¢˜è§£-1"><a href="#é¢˜è§£-1" class="headerlink" title="é¢˜è§£ "></a>é¢˜è§£ <img src="/img/%E8%B4%AA%E5%BF%83.assets/1672201525028-19c7f246-07d2-4dce-ab42-4dfcd74e1308.png" alt="img"></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> st, ed;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Range</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> l, r;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt; (<span class="type">const</span> Range &amp;W)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> l &lt; W.l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;range[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;st,&amp;ed);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">        range[i] = &#123;l, r&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(range, range + n);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j = i,r = <span class="number">-2e9</span>;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; n &amp;&amp; range[j].l &lt;= st)</span><br><span class="line">        &#123;</span><br><span class="line">            r = <span class="built_in">max</span>(r, range[j].r);</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(r &lt; st)</span><br><span class="line">        &#123;</span><br><span class="line">            res = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res++;</span><br><span class="line">        <span class="keyword">if</span>(r &gt;= ed)</span><br><span class="line">        &#123;</span><br><span class="line">            flag = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        st = r;</span><br><span class="line">        i = j - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!flag) res = <span class="number">-1</span>;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶æœå­"><a href="#åˆå¹¶æœå­" class="headerlink" title="åˆå¹¶æœå­"></a>åˆå¹¶æœå­</h2><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672214406630-46426887-0679-45df-b6b6-40138bd53d03.png" alt="img"></p><h3 id="é¢˜è§£-2"><a href="#é¢˜è§£-2" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672214376275-b6e5fec9-6472-402f-bbe5-f4bff35bf94c.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;,greater&lt;<span class="type">int</span>&gt;&gt; heap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(n--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        cin &gt;&gt; x;</span><br><span class="line">        heap.<span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(heap.<span class="built_in">size</span>() &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a = heap.<span class="built_in">top</span>();heap.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> b = heap.<span class="built_in">top</span>();heap.<span class="built_in">pop</span>();</span><br><span class="line">        res += a + b;</span><br><span class="line">        heap.<span class="built_in">push</span>(a + b);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ’é˜Ÿæ‰“æ°´"><a href="#æ’é˜Ÿæ‰“æ°´" class="headerlink" title="æ’é˜Ÿæ‰“æ°´"></a>æ’é˜Ÿæ‰“æ°´</h2><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672218475278-002907c0-0c00-45d7-b735-f638acd89f17.png" alt="img"></p><h3 id="é¢˜è§£-3"><a href="#é¢˜è§£-3" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    LL res;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>; i &lt; n; i++)   cin &gt;&gt; a[i];</span><br><span class="line">    <span class="built_in">sort</span>(a, a + n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        res += a[i] * (n - i <span class="number">-1</span>);</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸­ä½æ•°"><a href="#ä¸­ä½æ•°" class="headerlink" title="ä¸­ä½æ•°"></a>ä¸­ä½æ•°</h2><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672219283955-141e7be5-2d07-470d-9c36-fec9906e8f49.png" alt="img"></p><h3 id="é¢˜è§£-4"><a href="#é¢˜è§£-4" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672219294996-58800eff-2a50-4ee3-8d91-8e59e2b74f62.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cin &gt;&gt; a[i];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(a, a + n);</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>; i &lt; n; i++) res += <span class="built_in">abs</span>(a[i] - a[n / <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨å…¬å¼"><a href="#æ¨å…¬å¼" class="headerlink" title="æ¨å…¬å¼"></a>æ¨å…¬å¼</h2><p><img src="/img/%E8%B4%AA%E5%BF%83.assets/1672220787834-88f24a48-49b0-4dc9-9cfb-4eacbd3c3b8b.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">PII cow[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> w,s;</span><br><span class="line">        cin &gt;&gt;w &gt;&gt; s;</span><br><span class="line">        cow[i] = &#123;w + s, w&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(cow,cow + n);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>,res = <span class="number">-2e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> w = cow[i].second,s = cow[i].first - w;</span><br><span class="line">        res = <span class="built_in">max</span>(res, sum - s);</span><br><span class="line">        sum += w;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿäº§è°ƒåº¦"><a href="#ç”Ÿäº§è°ƒåº¦" class="headerlink" title="ç”Ÿäº§è°ƒåº¦"></a>ç”Ÿäº§è°ƒåº¦</h2><h3 id="åŠ å·¥"><a href="#åŠ å·¥" class="headerlink" title="åŠ å·¥"></a>åŠ å·¥</h3><ul><li><a href="https://www.acwing.com/problem/content/description/4173/">https://www.acwing.com/problem/content/description/4173/</a></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;queue&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;unordered_map&gt;</span><br><span class="line">#include &lt;math.<span class="property">h</span>&gt;</span><br><span class="line"><span class="comment">// #define int long long</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">typedef pair&lt;int, int&gt; <span class="variable constant_">PII</span>;</span><br><span class="line">typedef long long <span class="variable constant_">LL</span>;</span><br><span class="line"></span><br><span class="line">int <span class="title function_">gcd</span>(<span class="params">int a, int b</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> b ? <span class="title function_">gcd</span>(b, a % b) : a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct <span class="title class_">Node</span> &#123;</span><br><span class="line">int a, b, pos;</span><br><span class="line">    bool operator &lt;(<span class="keyword">const</span> <span class="title class_">Node</span> &amp;M)<span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((a&lt;b &amp;&amp; M.<span class="property">a</span>&lt;M.<span class="property">b</span>) || (a==b &amp;&amp; M.<span class="property">a</span>==M.<span class="property">b</span>) || (a&gt;b &amp;&amp; M.<span class="property">a</span>&gt;M.<span class="property">b</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(a&lt;=b) <span class="keyword">return</span> a &lt; M.<span class="property">a</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> b &gt; M.<span class="property">b</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> a-b &lt; M.<span class="property">a</span>-M.<span class="property">b</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Node</span> c[<span class="number">1010</span>];</span><br><span class="line">int <span class="title function_">main</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">int n;</span><br><span class="line">cin &gt;&gt; n;</span><br><span class="line"><span class="keyword">for</span>(int i = <span class="number">1</span>; i &lt;= n; i ++) cin &gt;&gt; c[i].<span class="property">a</span>;</span><br><span class="line"><span class="keyword">for</span>(int i = <span class="number">1</span>; i &lt;= n; i ++) cin &gt;&gt; c[i].<span class="property">b</span>, c[i].<span class="property">pos</span> = i;</span><br><span class="line"><span class="title function_">sort</span>(c + <span class="number">1</span>, c + n + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int f1 = <span class="number">0</span>, f2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(int i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">&#123;</span><br><span class="line">f1 += c[i].<span class="property">a</span>;</span><br><span class="line">f2 = <span class="title function_">max</span>(f1, f2) + c[i].<span class="property">b</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; f2 &lt;&lt; endl;</span><br><span class="line"><span class="keyword">for</span>(int i = <span class="number">1</span>; i &lt;= n; i ++) cout &lt;&lt; c[i].<span class="property">pos</span> &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> è´ªå¿ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springcloudæœåŠ¡æ³¨å†Œä¸­å¿ƒ</title>
      <link href="//post/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.html"/>
      <url>//post/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.html</url>
      
        <content type="html"><![CDATA[<p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801103322932.png" alt="image-20230801103322932"></p><p><img src="/img/springcloud/1.assets/1684857931977-e8e56ad7-8c7c-46a1-a485-0fba7cc76222.png" alt="img"></p><h1 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h1><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="ä»€ä¹ˆæ˜¯æ³¨å†ŒæœåŠ¡ä¸å‘ç°ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ³¨å†ŒæœåŠ¡ä¸å‘ç°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³¨å†ŒæœåŠ¡ä¸å‘ç°ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ³¨å†ŒæœåŠ¡ä¸å‘ç°ï¼Ÿ</h3><ul><li>consumer ä¹°æˆ¿çš„äºº</li><li>Eureka æˆ¿äº§æœåŠ¡ä¸­å¿ƒ åŠç†ä¸š we</li><li>provider æˆ¿äº§å•†</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801103637874.png" alt="image-20230801103637874"></p><h3 id="ä¸¤ä¸ªç»„ä»¶"><a href="#ä¸¤ä¸ªç»„ä»¶" class="headerlink" title="ä¸¤ä¸ªç»„ä»¶"></a>ä¸¤ä¸ªç»„ä»¶</h3><ul><li>server ç§‘æŠ€å›­</li><li>client ç§‘æŠ€å›­é‡Œçš„å…¬å¸</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801103944677.png" alt="image-20230801103944677"></p><h2 id="å•æœº-Eureka-æ„å»ºæ­¥éª¤"><a href="#å•æœº-Eureka-æ„å»ºæ­¥éª¤" class="headerlink" title="å•æœº Eureka æ„å»ºæ­¥éª¤"></a>å•æœº Eureka æ„å»ºæ­¥éª¤</h2><h3 id="æ­å»ºæœåŠ¡"><a href="#æ­å»ºæœåŠ¡" class="headerlink" title="æ­å»ºæœåŠ¡"></a>æ­å»ºæœåŠ¡</h3><h4 id="å»º-model"><a href="#å»º-model" class="headerlink" title="å»º model"></a>å»º model</h4><ul><li>åç§°ï¼š <code>cloud-euraka-server7001</code></li></ul><h4 id="æ”¹-pom"><a href="#æ”¹-pom" class="headerlink" title="æ”¹ pom"></a>æ”¹ pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka-server--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--boot web actuator--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å†™-yml"><a href="#å†™-yml" class="headerlink" title="å†™ yml"></a>å†™ yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#é›†ç¾¤æŒ‡å‘å…¶å®ƒeureka</span></span><br><span class="line">      <span class="comment">#defaultZone: http://eureka7002.com:7002/eureka/</span></span><br><span class="line">      <span class="comment">#å•æœºå°±æ˜¯7001è‡ªå·±</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">  <span class="comment">#server:</span></span><br><span class="line">  <span class="comment">#å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡è¢«åŠæ—¶è¸¢é™¤</span></span><br><span class="line">  <span class="comment">#enable-self-preservation: false</span></span><br><span class="line">  <span class="comment">#eviction-interval-timer-in-ms: 2000</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨"><a href="#ä¸»å¯åŠ¨" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span> <span class="comment">// è¡¨ç¤ºè‡ªå·±æ˜¯EurekaæœåŠ¡ä¸­å¿ƒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaMain7001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaMain7001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è®¿é—®-7001"><a href="#è®¿é—®-7001" class="headerlink" title="è®¿é—® 7001"></a>è®¿é—® 7001</h4><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801105531291.png" alt="image-20230801105531291"></p><h3 id="å•æœºæ³¨å†Œ-8001-æœåŠ¡"><a href="#å•æœºæ³¨å†Œ-8001-æœåŠ¡" class="headerlink" title="å•æœºæ³¨å†Œ 8001 æœåŠ¡"></a>å•æœºæ³¨å†Œ 8001 æœåŠ¡</h3><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801105814828.png" alt="image-20230801105814828"></p><h4 id="æ”¹-pom-1"><a href="#æ”¹-pom-1" class="headerlink" title="æ”¹ pom"></a>æ”¹ pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ”¹-yml"><a href="#æ”¹-yml" class="headerlink" title="æ”¹ yml"></a>æ”¹ yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># è¡¨ç¤ºè‡ªå·±æ˜¯å¦æ³¨å†Œè¿›EurekaServer é»˜è®¤ä¸ºtrue</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><h4 id="ä¸»å¯åŠ¨-1"><a href="#ä¸»å¯åŠ¨-1" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span> <span class="comment">// æ³¨å†ŒEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨æµ‹è¯•"><a href="#å¯åŠ¨æµ‹è¯•" class="headerlink" title="å¯åŠ¨æµ‹è¯•"></a>å¯åŠ¨æµ‹è¯•</h4><ul><li>å¯åŠ¨ 8001</li><li>æŸ¥çœ‹å®ä¾‹</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801111228628.png" alt="image-20230801111228628"></p><h2 id="é›†ç¾¤ç¯å¢ƒæ„å»º"><a href="#é›†ç¾¤ç¯å¢ƒæ„å»º" class="headerlink" title="&#x3D;&#x3D;é›†ç¾¤ç¯å¢ƒæ„å»º&#x3D;&#x3D;"></a>&#x3D;&#x3D;é›†ç¾¤ç¯å¢ƒæ„å»º&#x3D;&#x3D;</h2><ul><li><strong>åŸç†</strong></li><li>äº’ç›¸æ³¨å†Œï¼Œç›¸äº’å®ˆæœ›</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801112333557.png" alt="image-20230801112333557"></p><h3 id="æ­å»ºæœåŠ¡-1"><a href="#æ­å»ºæœåŠ¡-1" class="headerlink" title="æ­å»ºæœåŠ¡"></a>æ­å»ºæœåŠ¡</h3><h4 id="å»º-model-1"><a href="#å»º-model-1" class="headerlink" title="å»º model"></a>å»º model</h4><ul><li><code>cloud-euraka-server7002</code></li></ul><h4 id="æ”¹-pom-2"><a href="#æ”¹-pom-2" class="headerlink" title="æ”¹ pom"></a>æ”¹ pom</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka-server--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--boot web actuator--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€èˆ¬é€šç”¨é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å†™-yml-1"><a href="#å†™-yml-1" class="headerlink" title="å†™ yml"></a>å†™ yml</h4><ul><li>7002</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7002.com</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#é›†ç¾¤æŒ‡å‘å…¶å®ƒeureka</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">    <span class="comment">#å•æœºå°±æ˜¯è‡ªå·±</span></span><br><span class="line">    <span class="comment">#defaultZone: http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><ul><li>7001</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span> <span class="comment">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="comment">#    hostname: localhost #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment">#falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment">#falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#é›†ç¾¤æŒ‡å‘å…¶å®ƒeureka</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹æ˜ å°„é…ç½®"><a href="#ä¿®æ”¹æ˜ å°„é…ç½®" class="headerlink" title="ä¿®æ”¹æ˜ å°„é…ç½®"></a>ä¿®æ”¹æ˜ å°„é…ç½®</h4><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801113121983.png" alt="image-20230801113121983"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">######SpringCloud2023.8.1#########</span><br><span class="line">127.0.0.1  eureka7001.com</span><br><span class="line">127.0.0.1  eureka7002.com</span><br><span class="line">127.0.0.1  eureka7003.com</span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨æµ‹è¯•-1"><a href="#å¯åŠ¨æµ‹è¯•-1" class="headerlink" title="å¯åŠ¨æµ‹è¯•"></a>å¯åŠ¨æµ‹è¯•</h4><ul><li>2 æŒ‡å‘ 1</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801114157975.png" alt="image-20230801114157975"></p><h3 id="æ³¨å†Œå¾®æœåŠ¡"><a href="#æ³¨å†Œå¾®æœåŠ¡" class="headerlink" title="æ³¨å†Œå¾®æœåŠ¡"></a>æ³¨å†Œå¾®æœåŠ¡</h3><h4 id="æ”¹-yml-1"><a href="#æ”¹-yml-1" class="headerlink" title="æ”¹ yml"></a>æ”¹ yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># è¡¨ç¤ºè‡ªå·±æ˜¯å¦æ³¨å†Œè¿›EurekaServer é»˜è®¤ä¸ºtrue</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">       <span class="comment">#å•æœºç‰ˆ</span></span><br><span class="line">  <span class="comment"># defaultZone: http://localhost:7001/eureka</span></span><br><span class="line">      <span class="comment">#é›†ç¾¤ç‰ˆ</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,</span> <span class="string">http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure><h3 id="æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤-8002"><a href="#æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤-8002" class="headerlink" title="æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤ 8002"></a>æ”¯ä»˜å¾®æœåŠ¡é›†ç¾¤ 8002</h3><h4 id="æ”¹-yml-2"><a href="#æ”¹-yml-2" class="headerlink" title="æ”¹ yml"></a>æ”¹ yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment"># å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span> <span class="comment"># mysqlé©±åŠ¨åŒ…</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">cyt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># è¡¨ç¤ºè‡ªå·±æ˜¯å¦æ³¨å†Œè¿›EurekaServer é»˜è®¤ä¸ºtrue</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#å•æœºç‰ˆ</span></span><br><span class="line">      <span class="comment"># defaultZone: http://localhost:7001/eureka</span></span><br><span class="line">      <span class="comment">#é›†ç¾¤ç‰ˆ</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,</span> <span class="string">http://eureka7002.com:7002/eureka</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.cyt.springcloud.entities</span> <span class="comment"># æ‰€æœ‰Entityåˆ«åç±»æ‰€åœ¨åŒ…</span></span><br></pre></td></tr></table></figure><h4 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="&#x3D;&#x3D;è´Ÿè½½å‡è¡¡&#x3D;&#x3D;"></a>&#x3D;&#x3D;è´Ÿè½½å‡è¡¡&#x3D;&#x3D;</h4><ol><li>ä¿®æ”¹ 80 æ¨¡å— <code>controller</code>è®¿é—®æ”¯ä»˜æ¨¡å—åœ°å€</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="comment">//    public static final String PAYMENT_URL = &quot;http://localhost:8001&quot;; å•æœºç‰ˆï¼Œå†™æ­»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹ <code>config.ApplicationContextConfig</code></li></ol><ul><li>@LoadBalanced æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span> <span class="comment">// èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡èƒ½åŠ›</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="actuator-å¾®æœåŠ¡ä¿¡æ¯å®Œå–„"><a href="#actuator-å¾®æœåŠ¡ä¿¡æ¯å®Œå–„" class="headerlink" title="actuator å¾®æœåŠ¡ä¿¡æ¯å®Œå–„"></a>actuator å¾®æœåŠ¡ä¿¡æ¯å®Œå–„</h2><h3 id="ä¸»æœºåç§°ï¼šæœåŠ¡åç§°ä¿®æ”¹"><a href="#ä¸»æœºåç§°ï¼šæœåŠ¡åç§°ä¿®æ”¹" class="headerlink" title="ä¸»æœºåç§°ï¼šæœåŠ¡åç§°ä¿®æ”¹"></a>ä¸»æœºåç§°ï¼šæœåŠ¡åç§°ä¿®æ”¹</h3><h4 id="æ”¹-yml-3"><a href="#æ”¹-yml-3" class="headerlink" title="æ”¹ yml"></a>æ”¹ yml</h4><ul><li>æ”¹ 8001 8002 æœåŠ¡ yml</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    instance-id: payment8002</span><br></pre></td></tr></table></figure><h4 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h4><ul><li>ä¿®æ”¹å‰</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801184943481.png" alt="image-20230801184943481"></p><ul><li>ä¿®æ”¹å</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801185014759.png" alt="image-20230801185014759"></p><h3 id="è®¿é—®ä¿¡æ¯æœ‰-IP-ä¿¡æ¯æç¤º"><a href="#è®¿é—®ä¿¡æ¯æœ‰-IP-ä¿¡æ¯æç¤º" class="headerlink" title="è®¿é—®ä¿¡æ¯æœ‰ IP ä¿¡æ¯æç¤º"></a>è®¿é—®ä¿¡æ¯æœ‰ IP ä¿¡æ¯æç¤º</h3><h4 id="æ”¹-yml-4"><a href="#æ”¹-yml-4" class="headerlink" title="æ”¹ yml"></a>æ”¹ yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€</span></span><br></pre></td></tr></table></figure><h4 id="å¯¹æ¯”-1"><a href="#å¯¹æ¯”-1" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h4><ul><li>ä¿®æ”¹å</li><li>å·¦ä¸‹è§’</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801185625441.png" alt="image-20230801185625441"></p><h2 id="æœåŠ¡å‘ç°-Discover"><a href="#æœåŠ¡å‘ç°-Discover" class="headerlink" title="æœåŠ¡å‘ç° Discover"></a>æœåŠ¡å‘ç° Discover</h2><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801224210265.png" alt="image-20230801224210265"></p><h3 id="æ·»åŠ -controller-æ˜ å°„è·¯å¾„"><a href="#æ·»åŠ -controller-æ˜ å°„è·¯å¾„" class="headerlink" title="æ·»åŠ  controller æ˜ å°„è·¯å¾„"></a>æ·»åŠ  controller æ˜ å°„è·¯å¾„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// discoveryé…ç½®ä¿¡æ¯å¯¹å¤–æš´éœ²</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/discovery&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">discovery</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;String&gt; services = discoveryClient.getServices();</span><br><span class="line">    <span class="keyword">for</span> (String service : services) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;**discovery: &#123;&#125;&quot;</span>, service);</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;*---------------*&quot;</span>);</span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (ServiceInstance instance : instances) &#123;</span><br><span class="line">        log.info(instance.getServiceId() + <span class="string">&quot;\t&quot;</span> + instance.getHost()</span><br><span class="line">                + <span class="string">&quot;\t&quot;</span> + instance.getPort() + <span class="string">&quot;\t&quot;</span> + instance.getUri());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.discoveryClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EnableDiscoveryClient"><a href="#EnableDiscoveryClient" class="headerlink" title="&#x3D;&#x3D;@EnableDiscoveryClient&#x3D;&#x3D;"></a>&#x3D;&#x3D;@EnableDiscoveryClient&#x3D;&#x3D;</h3><ul><li>ä¿®æ”¹å¯åŠ¨ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span> <span class="comment">// æ³¨å†ŒEurekaClient</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">// å…è®¸æœåŠ¡å‘ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Eureka-è‡ªæˆ‘ä¿æŠ¤"><a href="#Eureka-è‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="Eureka è‡ªæˆ‘ä¿æŠ¤"></a>Eureka è‡ªæˆ‘ä¿æŠ¤</h2><h3 id="æ•…éšœç°è±¡"><a href="#æ•…éšœç°è±¡" class="headerlink" title="æ•…éšœç°è±¡"></a>æ•…éšœç°è±¡</h3><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801232458717.png" alt="image-20230801232458717"></p><h3 id="å¯¼è‡´åŸå› "><a href="#å¯¼è‡´åŸå› " class="headerlink" title="å¯¼è‡´åŸå› "></a>å¯¼è‡´åŸå› </h3><ul><li>ä½œç”¨ï¼šé˜²æ­¢ç½‘ç»œå»¶æ—¶ç­‰é—®é¢˜è¯¯åˆ è°ƒå¾®æœåŠ¡å®ä¾‹</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801233030494.png" alt="image-20230801233030494"></p><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230801232903727.png" alt="image-20230801232903727"></p><h3 id="å¦‚ä½•ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"><a href="#å¦‚ä½•ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="å¦‚ä½•ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"></a>å¦‚ä½•ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤</h3><h4 id="ä¿®æ”¹é›†ç¾¤-7001"><a href="#ä¿®æ”¹é›†ç¾¤-7001" class="headerlink" title="ä¿®æ”¹é›†ç¾¤ 7001"></a>ä¿®æ”¹é›†ç¾¤ 7001</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="comment"># å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡è¢«åŠæ—¶è¸¢é™¤</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹æœåŠ¡-8001"><a href="#ä¿®æ”¹æœåŠ¡-8001" class="headerlink" title="ä¿®æ”¹æœåŠ¡ 8001"></a>ä¿®æ”¹æœåŠ¡ 8001</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€</span></span><br><span class="line">    <span class="comment"># Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºå¦™ï¼ˆé»˜è®¤30sï¼‰</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">1</span> <span class="comment"># æ”¹ä¸º1s</span></span><br><span class="line">    <span class="comment">#EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰ï¼Œè¶…æ—¶å°†åˆ«é™¤æœåŠ¡</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h1 id="Zoonkeeper"><a href="#Zoonkeeper" class="headerlink" title="Zoonkeeper"></a>Zoonkeeper</h1><h2 id="æ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸­å¿ƒ</h2><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230802110148906.png" alt="image-20230802110148906"></p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230802175604925.png" alt="image-20230802175604925"></p><h3 id="å»º-model-2"><a href="#å»º-model-2" class="headerlink" title="å»º model"></a>å»º model</h3><ul><li><code>cloud-provider-payment8004</code></li></ul><h3 id="æ”¹-pom-3"><a href="#æ”¹-pom-3" class="headerlink" title="æ”¹ pom"></a>æ”¹ pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆzookeeperå®¢æˆ·ç«¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å…ˆæ’é™¤è‡ªå¸¦çš„zookeeper3.5.3--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ·»åŠ zookeeper3.4.9ç‰ˆæœ¬--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å†™-yml-2"><a href="#å†™-yml-2" class="headerlink" title="å†™ yml"></a>å†™ yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æœåŠ¡åˆ«å---æ³¨å†Œzoonkeeperåˆ°æ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-payment</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">zookeeper:</span></span><br><span class="line">      <span class="attr">connect-string:</span> <span class="number">139.186</span><span class="number">.5</span><span class="number">.203</span><span class="string">:2181</span></span><br></pre></td></tr></table></figure><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ServerPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/payment/zk&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentzk</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springcloud with zoonkeeper: &quot;</span> + ServerPort + <span class="string">&quot;\t&quot;</span> + UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230802175741233.png" alt="image-20230802175741233"></p><h1 id="consul"><a href="#consul" class="headerlink" title="consul"></a>consul</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230815103841212.png" alt="image-20230815103841212"></p><h2 id="å®‰è£…å¹¶è¿è¡Œ"><a href="#å®‰è£…å¹¶è¿è¡Œ" class="headerlink" title="å®‰è£…å¹¶è¿è¡Œ"></a>å®‰è£…å¹¶è¿è¡Œ</h2><p><code>consul agent -dev</code></p><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230815104318351.png" alt="image-20230815104318351"></p><h2 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h2><h3 id="å»º-module"><a href="#å»º-module" class="headerlink" title="å»º module"></a>å»º module</h3><ul><li><code>cloud-providerconsul-payment8006</code></li></ul><h3 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-api-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud consul-server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###consulæœåŠ¡ç«¯å£å·</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">consul-provider-payment</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">####consulæ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#hostname: 127.0.0.1</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8006</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">           SpringApplication.run(PaymentMain8006.class, args);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸šåŠ¡ç±»-controller"><a href="#ä¸šåŠ¡ç±»-controller" class="headerlink" title="ä¸šåŠ¡ç±» controller"></a>ä¸šåŠ¡ç±» controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String ServerPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/payment/consul&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentConsul</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springcloud with consul: &quot;</span> + ServerPort + <span class="string">&quot;\t&quot;</span> + UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230815110525872.png" alt="image-20230815110525872"></p><h2 id="æœåŠ¡æ¶ˆè´¹è€…"><a href="#æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡æ¶ˆè´¹è€…"></a>æœåŠ¡æ¶ˆè´¹è€…</h2><h3 id="å»º-module-1"><a href="#å»º-module-1" class="headerlink" title="å»º module"></a>å»º module</h3><ul><li><code>cloud-consumerconsul-order80</code></li></ul><h3 id="pom-1"><a href="#pom-1" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud consul-server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringBootæ•´åˆWebç»„ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¸¸é€šç”¨jaråŒ…é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="yaml-1"><a href="#yaml-1" class="headerlink" title="yaml"></a>yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###consulæœåŠ¡ç«¯å£å·</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-consumer-order</span></span><br><span class="line">  <span class="comment">####consulæ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#hostname: 127.0.0.1</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ç±»-1"><a href="#å¯åŠ¨ç±»-1" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsulMain80</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">           SpringApplication.run(OrderConsulMain80.class, args);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-bean"><a href="#é…ç½®-bean" class="headerlink" title="é…ç½® bean"></a>é…ç½® bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span> <span class="comment">// èµ‹äºˆRestTemplateè´Ÿè½½å‡è¡¡èƒ½åŠ›</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderConsulController</span> &#123;</span><br><span class="line">    <span class="comment">//    public static final String PAYMENT_URL = &quot;http://localhost:8001&quot;; å•æœºç‰ˆï¼Œå†™æ­»</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INVOKE_URL</span> <span class="operator">=</span> <span class="string">&quot;http://consul-provider-payment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/consul&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">paymentInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> restTemplate.getForObject(INVOKE_URL + <span class="string">&quot;/payment/consul&quot;</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span>  res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230815112105792.png" alt="image-20230815112105792"></p><h3 id="è®¿é—®æµ‹è¯•åœ°å€"><a href="#è®¿é—®æµ‹è¯•åœ°å€" class="headerlink" title="è®¿é—®æµ‹è¯•åœ°å€"></a>è®¿é—®æµ‹è¯•åœ°å€</h3><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230815112059407.png" alt="image-20230815112059407"></p><h2 id="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹"><a href="#ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹" class="headerlink" title="ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹"></a>ä¸‰ä¸ªæ³¨å†Œä¸­å¿ƒå¼‚åŒç‚¹</h2><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230815113159811.png" alt="image-20230815113159811"></p><h3 id="cap"><a href="#cap" class="headerlink" title="cap"></a>cap</h3><ul><li>åˆ†å¸ƒå¼ p ä¸€å®šä¿è¯</li></ul><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230815112637710.png" alt="image-20230815112637710"></p><p><img src="/img/springcloud/2%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83.assets/image-20230815113003408.png" alt="image-20230815113003408"></p>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springcloud </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„</title>
      <link href="//post/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html"/>
      <url>//post/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html</url>
      
        <content type="html"><![CDATA[<h2 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h2><h3 id="å­˜å‚¨æ–¹å¼"><a href="#å­˜å‚¨æ–¹å¼" class="headerlink" title="å­˜å‚¨æ–¹å¼"></a>å­˜å‚¨æ–¹å¼</h3><ol><li>idx è¡¨ç¤ºç»“ç‚¹ç¼–å·</li></ol><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1667815241644-a996d7f3-45d8-4cd4-9f0c-d5b67a5a7a26-16923496906671.png" alt="img"></p><h2 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1675869281215-919aa230-d4ee-4999-b258-89f187557be9-16923496906673.png" alt="img"></p><ol><li>å­˜å‚¨</li></ol><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1675869310139-f307c0d5-dce8-43aa-b1c9-4868da057bda-16923496906675.png" alt="img"></p><h3 id="acwing143-æœ€å¤§å¼‚æˆ–å¯¹"><a href="#acwing143-æœ€å¤§å¼‚æˆ–å¯¹" class="headerlink" title="acwing143.æœ€å¤§å¼‚æˆ–å¯¹"></a>acwing143.æœ€å¤§å¼‚æˆ–å¯¹</h3><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1665148145872-3a8554e1-2152-44ba-b71f-3a8cd1bba5fc-16923496906687.png" alt="img"></p><h4 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h4><p>1.å°†æ¯ä¸ªæ•°æ”¾åœ¨æ ‘ä¸­</p><p>2.éå†ä¸€éæ•°æ®ï¼Œä» 31 ä½å¼€å§‹ æ˜¯ 1 æ‰¾ 0 æ˜¯ 0 æ‰¾ 1 æ²¡æœ‰åˆ™åªèƒ½æ‰¾å½“å‰ç›¸åŒ é€šè¿‡ res +&#x3D;1&lt;&lt;i; å¾—åˆ°ç­”æ¡ˆ</p><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1664972524375-ac42e2e2-4f3c-40bd-903a-2a4ac9fd8861-16923496906689.png" alt="img"></p><h4 id="ç§»ä½æ“ä½œ-é¢„å¤„ç†æ•°æ®ä¸ºäºŒè¿›åˆ¶"><a href="#ç§»ä½æ“ä½œ-é¢„å¤„ç†æ•°æ®ä¸ºäºŒè¿›åˆ¶" class="headerlink" title="ç§»ä½æ“ä½œ é¢„å¤„ç†æ•°æ®ä¸ºäºŒè¿›åˆ¶"></a>ç§»ä½æ“ä½œ é¢„å¤„ç†æ•°æ®ä¸ºäºŒè¿›åˆ¶</h4><p><strong>x &gt;&gt; k &amp; 1</strong></p><h4 id=""><a href="#" class="headerlink" title=""></a><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1664973615155-d435a7e3-4d2e-44e9-a29e-e8af72e47d5a-169234969066811.png" alt="img"></h4><h4 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>, M = <span class="number">3e7</span>;</span><br><span class="line"><span class="type">int</span> son[M][<span class="number">2</span>], idx;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// ~i  i&gt;=0çš„æ¡ä»¶åˆ¤æ–­  -1 -&gt;ï¼ˆ11111111111111111111111ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">30</span>; ~i; i--) &#123;</span><br><span class="line">        <span class="type">int</span> &amp;s = son[p][x &gt;&gt; i &amp; <span class="number">1</span>];  <span class="comment">//å­˜åœ¨è¿”å›0  sä¸ºæ•°ç»„è¯¥èŠ‚ç‚¹å·¦å€¼å¼•ç”¨</span></span><br><span class="line">        <span class="keyword">if</span>(!s) s= ++idx;</span><br><span class="line">        p = s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">0</span>, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">30</span>; ~i ; i--)&#123;</span><br><span class="line">        <span class="type">int</span> s = x &gt;&gt; i &amp; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(son[p][!s])  <span class="comment">//æ ¸å¿ƒç®—æ³•  æ‰¾å¼‚æˆ–ä¸åŒä¸º1</span></span><br><span class="line">        &#123;</span><br><span class="line">            res += <span class="number">1</span> &lt;&lt; i;</span><br><span class="line">            p=son[p][!s];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p=son[p][s];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,res=<span class="number">0</span>;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n;i++)&#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="built_in">insert</span>(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) res=<span class="built_in">max</span>(res,<span class="built_in">query</span>(a[i]));</span><br><span class="line">    cout &lt;&lt; res;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>line9ï¼š&gt;&#x3D;0 å¯ä»¥ç”¨ ~i è¡¨ç¤º</li><li>line10ï¼Œé€šè¿‡å·¦å€¼å¼•ç”¨å¾—åˆ°æ•°ç»„çš„å€¼ å¯¹ s ä¿®æ”¹ä¾¿ä¿®æ”¹æ•°ç»„å…ƒç´ çš„å€¼</li></ol><h2 id="å¹¶æŸ¥é›†"><a href="#å¹¶æŸ¥é›†" class="headerlink" title="å¹¶æŸ¥é›†"></a>å¹¶æŸ¥é›†</h2><h3 id="æ¦‚å¿µä½œç”¨ï¼š"><a href="#æ¦‚å¿µä½œç”¨ï¼š" class="headerlink" title="æ¦‚å¿µä½œç”¨ï¼š"></a>æ¦‚å¿µä½œç”¨ï¼š</h3><p>1.å°†ä¸¤ä¸ªé›†åˆåˆå¹¶ ï¼ˆè¿‘ä¹ Oï¼ˆ1ï¼‰å¤æ‚åº¦ï¼‰</p><p>2.è¯¢é—®ä¸¤ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªç»“åˆä¸­</p><h3 id="ç»“æ„æ ·å›¾ï¼š"><a href="#ç»“æ„æ ·å›¾ï¼š" class="headerlink" title="ç»“æ„æ ·å›¾ï¼š"></a>ç»“æ„æ ·å›¾ï¼š</h3><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1665072535440-7d530784-732e-4e0c-9851-12041b3b9745-169234969066813.png" alt="img"></p><h3 id="åŸºæœ¬é—®é¢˜ï¼š"><a href="#åŸºæœ¬é—®é¢˜ï¼š" class="headerlink" title="åŸºæœ¬é—®é¢˜ï¼š"></a>åŸºæœ¬é—®é¢˜ï¼š</h3><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1665072569040-05ffa16f-dbf2-4851-9a5c-4dbc1da69e26-169234969066815.png" alt="img"></p><h3 id="acwing836-é›†åˆåˆå¹¶ï¼š"><a href="#acwing836-é›†åˆåˆå¹¶ï¼š" class="headerlink" title="acwing836 é›†åˆåˆå¹¶ï¼š"></a>acwing836 é›†åˆåˆå¹¶ï¼š</h3><h4 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h4><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1665148258926-33188688-6449-4302-a5ad-5231aa1a0ecb-169234969066817.png" alt="img"></p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> pre[N];</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="comment">// int find(int x)&#123;</span></span><br><span class="line"><span class="comment">//     while(pre[x]!=x)</span></span><br><span class="line"><span class="comment">//         x=pre[x];</span></span><br><span class="line"><span class="comment">//     return x;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯å¾„å‹ç¼©</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">find</span>(x)!=pre[x])</span><br><span class="line">        pre[x] = <span class="built_in">find</span>(pre[x]);</span><br><span class="line">    <span class="keyword">return</span> pre[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n;i++) pre[i]=i;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">char</span> op[<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; op &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">&#x27;M&#x27;</span>) pre[<span class="built_in">find</span>(a)]==<span class="built_in">find</span>(b);  <span class="comment">// joinå‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">&#x27;Q&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">find</span>(a)==<span class="built_in">find</span>(b))</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;Yes&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;No&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ³¨ï¼š"><a href="#æ³¨ï¼š" class="headerlink" title="æ³¨ï¼š"></a>æ³¨ï¼š</h4><p>1.æ•°ç»„ 1~n ç´¢å¼•å€¼ pre[i]&#x3D;i i æ˜¯ n ä¸ªæ•° pre[i]è¡¨ç¤ºè‡ªå·±çš„çˆ¶äº²</p><p>2.find è·¯å¾„å‹ç¼© ï¼šä½¿ä¸€ä¸ªé›†åˆä¸­çš„çˆ¶äº²å…¬å…±ä¸€ä¸ª è¿‘ä¹ O(1) å¤æ‚åº¦</p><h3 id="acwing837-è¿é€šå—ä¸­ç‚¹çš„æ•°é‡ï¼š"><a href="#acwing837-è¿é€šå—ä¸­ç‚¹çš„æ•°é‡ï¼š" class="headerlink" title="acwing837 è¿é€šå—ä¸­ç‚¹çš„æ•°é‡ï¼š"></a>acwing837 è¿é€šå—ä¸­ç‚¹çš„æ•°é‡ï¼š</h3><h4 id="é¢˜ç›®ï¼š"><a href="#é¢˜ç›®ï¼š" class="headerlink" title="é¢˜ç›®ï¼š"></a>é¢˜ç›®ï¼š</h4><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1665152745415-c9165371-ef38-46cd-9b80-e4db6dcc229d-169234969066819.png" alt="img"></p><h4 id="ä»£ç ï¼š-1"><a href="#ä»£ç ï¼š-1" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> p[N], size1[N];</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(p[x] != x) x = p[x];</span><br><span class="line">    <span class="keyword">return</span> p[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// void merge(int a,int b) &#123;</span></span><br><span class="line"><span class="comment">//     int x = find(a);</span></span><br><span class="line"><span class="comment">//     int y = find(b);</span></span><br><span class="line"><span class="comment">//     fa[x] = y;</span></span><br><span class="line"><span class="comment">//     size[y] += size[x];</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i= <span class="number">1</span>; i &lt;= n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        p[i]=i;</span><br><span class="line">        size1[i]=<span class="number">1</span>;  <span class="comment">// åˆå§‹åŒ–sizeä¸º1  åªæœ‰ç¥–å…ˆç»“ç‚¹sizeæ‰æœ‰æ„ä¹‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">char</span> op[<span class="number">5</span>];</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; op;</span><br><span class="line">        <span class="comment">// 1.è¿æ¥aï¼Œb</span></span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>]==<span class="string">&#x27;C&#x27;</span>)  &#123;</span><br><span class="line">            cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">find</span>(a)==<span class="built_in">find</span>(b))  <span class="keyword">continue</span>;  <span class="comment">//å¦‚æœaï¼Œbåœ¨ä¸€ä¸ªé›†åˆ  åˆ™è·³è¿‡</span></span><br><span class="line">            size1[<span class="built_in">find</span>(b)] += size1[<span class="built_in">find</span>(a)];</span><br><span class="line">            p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­aï¼Œbæ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆ(è¿é€šåŸŸ)</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">1</span>]==<span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">            cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">find</span>(a)==<span class="built_in">find</span>(b))</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;Yes&quot;</span> &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;No&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.è¾“å‡ºaæ‰€åœ¨é›†åˆçš„ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            cin &gt;&gt; a;</span><br><span class="line">            cout &lt;&lt; size1[<span class="built_in">find</span>(a)]&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ³¨"><a href="#æ³¨" class="headerlink" title="æ³¨:"></a>æ³¨:</h4><p>1.æœ€å 3 æŸ¥æ‰¾è¯¥é›†åˆä¸ªæ•°ï¼Œä»¥ size1 æ•°ç»„åˆå§‹åŒ–æ¯ä¸ªé›†åˆä¸ªæ•°ä¸º 1ï¼Œ</p><p>2.size1[find(b)] +&#x3D; size1[find(a)]; æŠŠ a æ’å…¥åˆ° b ä¸‹ b çš„ä¸ªæ•°+&#x3D;a çš„ä¸ªæ•°</p><p>3.å¯¹åº”çš„ï¼šp[find(a)] &#x3D; find(b); æŠŠ a æ’å…¥åˆ° b ä¸‹</p><h3 id="é£Ÿç‰©é“¾"><a href="#é£Ÿç‰©é“¾" class="headerlink" title="é£Ÿç‰©é“¾"></a>é£Ÿç‰©é“¾</h3><h4 id="é¢˜ç›®ï¼š-1"><a href="#é¢˜ç›®ï¼š-1" class="headerlink" title="é¢˜ç›®ï¼š"></a>é¢˜ç›®ï¼š</h4><h4 id="æ€è·¯ï¼š-1"><a href="#æ€è·¯ï¼š-1" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h4><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1665376281660-20a70493-6508-4a17-b850-0210c64b3f11-169234969066821.png" alt="img"></p><h2 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h2><ol><li>1e9 ä¸ªæ•°æ® æ˜ å°„æˆ 1e5</li><li>å¯èƒ½ä¼šå¼•èµ·å†²çª é€šè¿‡ä¸€ä¸‹ä¸¤ç§æ–¹æ³•è§£å†³</li></ol><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1666105754702-cce4729c-8692-4f13-8587-f03161416856-169234969066823.png" alt="img"></p><h3 id="æ‹‰é“¾æ³•"><a href="#æ‹‰é“¾æ³•" class="headerlink" title="æ‹‰é“¾æ³•"></a>æ‹‰é“¾æ³•</h3><ol><li>å¼€ä¸€ä¸ªæ•°ç»„ 1e5</li><li>è‹¥ 11 23 æ˜ å°„åˆ° 3 ï¼Œ 3 ä¸‹å¼€ä¸€ä¸ªå•é“¾è¡¨</li></ol><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1666106232328-9264dd74-c652-452c-b9bd-0367d8cbffc7-169234969066825.png" alt="img"></p><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1666107728204-98325d80-c7f0-4f6a-93e6-03a0f372fda0-169234969066827.png" alt="img"></p><h4 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> k = (x % N + N) % N;   <span class="comment">//æ˜ å°„  +Né˜²æ­¢è´Ÿæ•°</span></span><br><span class="line">    e[idx] = x, ne[idx] = h[k], h[k] = idx++;  <span class="comment">//é“¾è¡¨æ’å…¥  h[k] ä¸º head</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> k = (x % N + N) % N;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[k]; i != <span class="number">-1</span>;i=ne[i])</span><br><span class="line">        <span class="keyword">if</span>(e[i] == x)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼€æ”¾å¯»å€æ³•"><a href="#å¼€æ”¾å¯»å€æ³•" class="headerlink" title="å¼€æ”¾å¯»å€æ³•"></a>å¼€æ”¾å¯»å€æ³•</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200003</span>, null = <span class="number">0x3f3f3f</span>; <span class="comment">//æ•°ç»„ä¸€èˆ¬å¼€ä¸¤å€çš„ç¬¬ä¸€ä¸ªè´¨æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> h[N];</span><br><span class="line"></span><br><span class="line"><span class="comment">// findå‡½æ•° å­˜åœ¨è¿”å›å­˜çš„ä½ç½®</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> k = (x % N + N) % N;</span><br><span class="line">    <span class="keyword">while</span> (h[k] != null &amp;&amp; h[k] != x)&#123;</span><br><span class="line">        k++;</span><br><span class="line">        <span class="keyword">if</span>(k==N) k=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸ‘€-å­—ç¬¦ä¸²å“ˆå¸Œ"><a href="#ğŸ‘€-å­—ç¬¦ä¸²å“ˆå¸Œ" class="headerlink" title="ğŸ‘€ å­—ç¬¦ä¸²å“ˆå¸Œ"></a>ğŸ‘€ å­—ç¬¦ä¸²å“ˆå¸Œ</h3><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1666110323817-cfc51ebf-a4cd-4a87-9b72-a3ccc54348e6-169234969066829.png" alt="img"></p><ol><li>å°†å­—ç¬¦ä¸² å‰ç¼€å“ˆå¸Œå€¼ 1,2,3,4â€¦ å¾—åˆ° 1 - n çš„å“ˆå¸Œå€¼</li><li>å­—ç¬¦ä¸²è½¬ä¸º p è¿›åˆ¶æ•°</li><li>ç„¶å mod 2^64 è¿™é‡Œé‡‡ç”¨ unsigned ll å­˜å‚¨ æº¢å‡ºè‡ªåŠ¨ mod</li><li>æ³¨ï¼š ä¸èƒ½æ˜ å°„æˆ 0</li><li>ç»éªŒè§„å¾‹ï¼š p &#x3D;131 æˆ– 1333 1 Q&#x3D; 2^64;</li><li>ç”¨ unsigned long long å­˜å‚¨ hï¼Œæº¢å‡ºç›¸å½“äº% Q;</li></ol><h4 id="æ±‚-L-åˆ°-R-çš„å“ˆå¸Œå€¼"><a href="#æ±‚-L-åˆ°-R-çš„å“ˆå¸Œå€¼" class="headerlink" title="æ±‚ L åˆ° R çš„å“ˆå¸Œå€¼"></a>æ±‚ L åˆ° R çš„å“ˆå¸Œå€¼</h4><p><img src="/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.assets/1666110813048-0f4b8bdd-a329-4d10-890d-52be6ed8028b-169234969066831.png" alt="img"> 1. å°† L -&gt; 1 å·¦ç§» æ‰©å¤§ è‡³å’Œ R å¯¹é½</p><p>å‰ç¼€å“ˆå¸Œï¼šh[i]&#x3D;h[i-1]*p +str[i]</p><p>L-R å“ˆå¸Œå…¬å¼ï¼š h[R] - h[L] * P^(R-L+1)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ULL;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>,P=<span class="number">131</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">char</span> str[N];</span><br><span class="line">ULL h[N], p[N];  <span class="comment">//på­˜æ”¾ä¹˜çš„æ¬¡æ–¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Låˆ°Rçš„å“ˆå¸Œå€¼</span></span><br><span class="line"><span class="function">ULL <span class="title">get</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> h[r] - h[l - <span class="number">1</span>] * p[r - l + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; str + <span class="number">1</span>;</span><br><span class="line">    p[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å‰ç¼€å“ˆå¸Œ</span></span><br><span class="line">        p[i] = p[i - <span class="number">1</span>] * P;</span><br><span class="line">        h[i] = h[i - <span class="number">1</span>] * P + str[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> l1, r1, l2, r2;</span><br><span class="line">        cin &gt;&gt; l1 &gt;&gt; r1 &gt;&gt; l2 &gt;&gt; r2;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">get</span>(l1,r1) == <span class="built_in">get</span>(l2,r2))</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;Yes&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;No&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœç´¢å’Œå›¾è®º</title>
      <link href="//post/%E7%AE%97%E6%B3%95/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.html"/>
      <url>//post/%E7%AE%97%E6%B3%95/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.html</url>
      
        <content type="html"><![CDATA[<h2 id="dfs"><a href="#dfs" class="headerlink" title="dfs"></a>dfs</h2><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1677686197275-dc2b6571-1ba5-4d2b-a65a-ffb4ba7ca235.png" alt="img"></p><h3 id="åˆ—å‡º-1-n-çš„å…¨æ’åˆ—"><a href="#åˆ—å‡º-1-n-çš„å…¨æ’åˆ—" class="headerlink" title="åˆ—å‡º 1-n çš„å…¨æ’åˆ—"></a>åˆ—å‡º 1-n çš„å…¨æ’åˆ—</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666275714940-f8b736e3-f142-4a20-a73d-392592c62d70.png" alt="img"></p><ol><li>è¯¥æ•°æœ‰ 0,1,2â€¦n å±‚</li><li>ç¬¬ n å±‚æ˜¯æ’åˆ—çš„ç¬¬ n ä¸ªæ•° 0 ä¸ç®—</li><li>ä» 0 å¼€å§‹æ·±æœ u &#x3D; n æ—¶æ‰“å°</li><li>st[N] ç”¨äºåˆ¤æ–­ç¬¬ i ä¸ªæ•°æ˜¯å¦ç”¨è¿‡ i ä¸º st ç´¢å¼•</li><li>æ³¨æ„æ¢å¤ç°åœº å›æº¯åéƒ½ä¸€æ ·</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> path[N];</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cout &lt;&lt; path[i] &lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æšä¸¾1-n æ²¡æœ‰è¢«ç”¨è¿‡è¿›å…¥</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!st[i])&#123;</span><br><span class="line">            <span class="comment">// ç¬¬uå±‚æ”¾ç¬¬uä¸ªæ•°  æ”¾å…¥i</span></span><br><span class="line">            path[u] = i;</span><br><span class="line">            <span class="comment">// çŠ¶æ€å¤„ç†  è¯¥æ•°è¢«ç”¨è¿‡</span></span><br><span class="line">            st[i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// å¤„ç†ç¬¬u + 1ä¸ªæ•°</span></span><br><span class="line">            <span class="built_in">dfs</span>(u + <span class="number">1</span>);</span><br><span class="line">            st[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="n-çš‡åé—®é¢˜"><a href="#n-çš‡åé—®é¢˜" class="headerlink" title="n çš‡åé—®é¢˜"></a>n çš‡åé—®é¢˜</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666440269326-f4275fa1-587f-4478-ac43-d928fa308d9f.png" alt="img"></p><ol><li>col dg udg åˆ†åˆ«è¡¨ç¤ºåˆ— æ­£æ–œçº¿ åæ–œçº¿ æ˜¯å¦æ”¾äº†çš‡å</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">20</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> g[N][N];</span><br><span class="line"><span class="type">bool</span> col[N], dg[N], udg[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u == n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">puts</span>(g[i]);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æšä¸¾1-n æ²¡æœ‰è¢«ç”¨è¿‡è¿›å…¥</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="comment">// æˆªè· y = -x + b</span></span><br><span class="line">        <span class="keyword">if</span>(!col[i] &amp;&amp; !dg[u + i] &amp;&amp; !udg[n - u +i])&#123;</span><br><span class="line">            g[u][i] = <span class="string">&#x27;Q&#x27;</span>;</span><br><span class="line">            col[i] = dg[u + i] = udg[n - u + i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// å¤„ç†ç¬¬u + 1ä¸ªæ•°</span></span><br><span class="line">            <span class="built_in">dfs</span>(u + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// æ¢å¤ç°åœº</span></span><br><span class="line">            col[i] = dg[u + i] = udg[n - u + i] = <span class="literal">false</span>;</span><br><span class="line">            g[u][i] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">            g[i][j] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="å…«çš‡å"><a href="#å…«çš‡å" class="headerlink" title="å…«çš‡å"></a>å…«çš‡å</h3><p><a href="https://client.vpn.nuist.edu.cn/https/webvpn893ff9021738b0357186c0f23fc2aed6e24ca283e886022bc5d861ea12f03963/course/85/problem/1220">https://client.vpn.nuist.edu.cn/https/webvpn893ff9021738b0357186c0f23fc2aed6e24ca283e886022bc5d861ea12f03963/course/85/problem/1220</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;queue&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;unordered_map&gt;</span><br><span class="line"><span class="comment">// #define int long long</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">typedef pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line">typedef <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"></span><br><span class="line">const <span class="type">int</span> <span class="variable">N</span>  <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line"><span class="type">int</span> dx[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, -<span class="number">1</span>&#125;, dy[<span class="number">4</span>] = &#123;<span class="number">1</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g[<span class="number">10</span>][<span class="number">10</span>];</span><br><span class="line">bool col[N], dg[N], udg[N];</span><br><span class="line"><span class="type">int</span> n, res;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> u)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(u &gt; n)</span><br><span class="line">&#123;</span><br><span class="line">res ++;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i ++) <span class="comment">// è¿™ä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">if</span>(g[u][i])</span><br><span class="line">&#123;</span><br><span class="line">flag = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(flag)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(!col[i] &amp;&amp; !dg[i + u - <span class="number">1</span>] &amp;&amp; !udg[i - u + n])</span><br><span class="line">&#123;</span><br><span class="line">g[u][i] = <span class="number">1</span>;</span><br><span class="line">col[i] = dg[i + u - <span class="number">1</span>] = udg[i - u + n] = <span class="literal">true</span>;</span><br><span class="line">dfs(u + <span class="number">1</span>);</span><br><span class="line">col[i] = dg[i + u - <span class="number">1</span>] = udg[i - u + n] = <span class="literal">false</span>;</span><br><span class="line">g[u][i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">dfs(u + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">n = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j ++)</span><br><span class="line">&#123;</span><br><span class="line">cin &gt;&gt; g[i][j];</span><br><span class="line"><span class="keyword">if</span>(g[i][j])</span><br><span class="line">&#123;</span><br><span class="line">col[j] = dg[i + j - <span class="number">1</span>] = udg[j - i + n] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">dfs(<span class="number">1</span>);</span><br><span class="line">cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="bfs"><a href="#bfs" class="headerlink" title="bfs"></a>bfs</h2><p>dp æ˜¯ç‰¹æ®Šçš„æœ€çŸ­è·¯å¾„é—®é¢˜</p><p>ä¸€å±‚ä¸€å±‚æ‰©å±• +1</p><h3 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666506713710-ce85c592-7a9d-4bf1-ac59-784157a8a098.png" alt="img"></p><h3 id="èµ°è¿·å®«"><a href="#èµ°è¿·å®«" class="headerlink" title="èµ°è¿·å®«"></a>èµ°è¿·å®«</h3><p>å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ æ±‚æœ€çŸ­è·¯å¾„</p><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666507188048-36400ef0-58a2-40c4-bad8-2fcd87d00f62.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g[N][N];   <span class="comment">// åœ°å›¾</span></span><br><span class="line"><span class="type">int</span> d[N][N];   <span class="comment">// è·ç¦»</span></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line">PII q[N*N];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰‹å†™é˜Ÿåˆ—æ³•</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> hh = <span class="number">0</span>, tt = <span class="number">0</span>;</span><br><span class="line">    q[<span class="number">0</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span> d);   <span class="comment">//åˆå§‹åŒ–è·ç¦»  -1 æ²¡èµ°è¿‡  èµ·ç‚¹ä¸º0</span></span><br><span class="line">    d[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> dx[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;, dy[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span>(hh &lt;= tt)&#123;</span><br><span class="line">        PII t = q[hh++];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> x = t.first + dx[i], y = t.second + dy[i];</span><br><span class="line">            <span class="keyword">if</span>( x &gt;= <span class="number">0</span> &amp;&amp; x&lt;n &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;m &amp;&amp; g[x][y]==<span class="number">0</span> &amp;&amp; d[x][y] == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                d[x][y] = d[t.first][t.second] + <span class="number">1</span>;</span><br><span class="line">                q[++tt] = &#123;x, y&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[n - <span class="number">1</span>][m - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">            cin &gt;&gt; g[i][j];</span><br><span class="line">    cout &lt;&lt; <span class="built_in">bfs</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// stlæ³•</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    queue&lt;PII&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(&#123;<span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span> d); <span class="comment">//åˆå§‹åŒ–è·ç¦»  -1 æ²¡èµ°è¿‡  èµ·ç‚¹ä¸º0</span></span><br><span class="line">    d[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> dx[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;, dy[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;   <span class="comment">// ä¸Š å³ ä¸‹ å·¦</span></span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())  <span class="comment">// å½“é˜Ÿåˆ—ä¸ä¸ºç©º  å³èµ°åˆ°åº•æ— æ³•å†èµ°</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();    <span class="comment">// ä¸è¦å¿˜è®°pop</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> x = t.first + dx[i], y = t.second + dy[i];</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ è¾¹ç•Œ  å¢™å£  æ˜¯å¦èµ°è¿‡</span></span><br><span class="line">            <span class="keyword">if</span>( x &gt;= <span class="number">0</span> &amp;&amp; x&lt;n &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;m &amp;&amp; g[x][y]==<span class="number">0</span> &amp;&amp; d[x][y] == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                d[x][y] = d[t.first][t.second] + <span class="number">1</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(&#123;x, y&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[n - <span class="number">1</span>][m - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666517616001-e8f03d62-10d7-4df8-88e0-67c89e7d755d.png" alt="img"></p><h3 id="å…«æ•°ç "><a href="#å…«æ•°ç " class="headerlink" title="å…«æ•°ç "></a>å…«æ•°ç </h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666520037117-5e4ce3bb-12e3-4e76-b634-3da34ee34862.png" alt="img"></p><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li><p>çŠ¶æ€è¡¨ç¤º</p></li><li><p><code>queue &lt;string&gt; </code>å­˜å‚¨æ¯ä¸€æ­¥çŠ¶æ€ å°†è¡¨å±•å¼€æˆå­—ç¬¦ä¸²</p></li><li><p><code>unorderd_map &lt;string,int&gt; </code>å“ˆå¸Œå­˜å‚¨ dist æ¯ä¸€ç§èµ°æ³•è·ç¦»å¼€å§‹å˜æ¢äº†å¤šå°‘æ­¥</p></li><li><p>çŠ¶æ€è½¬ç§» ï¼š string - &gt;3 x 3 - &gt; string</p></li></ol><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666518408651-f710ef0d-049c-4ebf-9a6f-524bf20a7e6b.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">(string start)</span></span>&#123;</span><br><span class="line">    string end = <span class="string">&quot;12345678x&quot;</span>;</span><br><span class="line">    queue&lt;string&gt; q;    <span class="comment">// å­˜å‚¨æ¯ä¸€ç§å˜æ¢</span></span><br><span class="line">    unordered_map&lt;string, <span class="type">int</span>&gt; d;  <span class="comment">// å­˜å‚¨æ¯ä¸€ç§å˜æ¢ç”¨äº†å¤šå°‘æ­¥</span></span><br><span class="line"></span><br><span class="line">    q.<span class="built_in">push</span>(start);</span><br><span class="line">    d[start] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> distance = d[t];</span><br><span class="line">        <span class="keyword">if</span>(t == end)  <span class="keyword">return</span> distance;</span><br><span class="line">        <span class="comment">// çŠ¶æ€è½¬ç§»</span></span><br><span class="line">        <span class="type">int</span> dx[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;, dy[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">        <span class="type">int</span> k = t.<span class="built_in">find</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">        <span class="type">int</span> x = k / <span class="number">3</span>, y = k % <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> a = x + dx[i], b = y + dy[i];</span><br><span class="line">            <span class="keyword">if</span>( a &gt;= <span class="number">0</span> &amp;&amp; a &lt; <span class="number">3</span> &amp;&amp; b &gt;= <span class="number">0</span> &amp;&amp; b&lt;<span class="number">3</span>)&#123;</span><br><span class="line">                <span class="built_in">swap</span>(t[k], t[<span class="number">3</span> * a + b]);</span><br><span class="line">                <span class="keyword">if</span>(!d.<span class="built_in">count</span>(t))</span><br><span class="line">                &#123;</span><br><span class="line">                    d[t] = distance + <span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(t);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">swap</span>(t[k], t[<span class="number">3</span> * a + b]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string start;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; ++i) &#123;</span><br><span class="line">        <span class="type">char</span> c;</span><br><span class="line">        cin &gt;&gt; c;</span><br><span class="line">        start += c;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">bfs</span>(start) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çŸ©é˜µè·ç¦»-ï¼ˆå¤šè¿œæœ€çŸ­è·¯å¾„ï¼‰"><a href="#çŸ©é˜µè·ç¦»-ï¼ˆå¤šè¿œæœ€çŸ­è·¯å¾„ï¼‰" class="headerlink" title="çŸ©é˜µè·ç¦» ï¼ˆå¤šè¿œæœ€çŸ­è·¯å¾„ï¼‰"></a>çŸ©é˜µè·ç¦» ï¼ˆå¤šè¿œæœ€çŸ­è·¯å¾„ï¼‰</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666527966963-a8f579c2-b858-46ce-b326-b18df415501e.png" alt="img"></p><h4 id="é¢˜æ„"><a href="#é¢˜æ„" class="headerlink" title="é¢˜æ„"></a>é¢˜æ„</h4><p>æ‰¾å‡º 01 çŸ©é˜µä¸­ æ‰€æœ‰ 0 åˆ° 1 çš„æœ€çŸ­è·ç¦»</p><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666526135041-e515ba8a-f66c-4025-92ab-6dec413947ed.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">char</span> g[N][N];</span><br><span class="line"><span class="type">int</span> d[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span> d);</span><br><span class="line"></span><br><span class="line">    queue&lt;PII&gt; q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n;i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m;j++)</span><br><span class="line">            <span class="keyword">if</span> (g[i][j] == <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                q.<span class="built_in">push</span>(&#123;i, j&#125;);</span><br><span class="line">                d[i][j] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> dx[<span class="number">4</span>] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>&#125;, dy[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> a = t.first;</span><br><span class="line">        <span class="type">int</span> b = t.second;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> x = a + dx[i], y = b + dy[i];</span><br><span class="line">            <span class="keyword">if</span>(x &gt;= <span class="number">0</span> &amp;&amp; x &lt; n &amp;&amp; y &gt;=<span class="number">0</span> &amp;&amp; y &lt; m &amp;&amp; d[x][y] == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                d[x][y] = d[a][b] + <span class="number">1</span>;</span><br><span class="line">                q.<span class="built_in">push</span>(&#123;x, y&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3 4</span></span><br><span class="line"><span class="comment">// 0001</span></span><br><span class="line"><span class="comment">// 0011</span></span><br><span class="line"><span class="comment">// 0110</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3 2 1 0</span></span><br><span class="line"><span class="comment">// 2 1 0 0</span></span><br><span class="line"><span class="comment">// 1 0 0 1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) cin &gt;&gt; g[i];</span><br><span class="line">        <span class="comment">// scanf(&quot;%s&quot;,g[i]);</span></span><br><span class="line">    <span class="built_in">bfs</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m;j++)</span><br><span class="line">            cout &lt;&lt; d[i][j]&lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤é¢˜æ³¨æ„è¾“å…¥ ç”¨ char æ•´è¡Œè¾“å…¥</p><h3 id="ç›´æ¥è¾“å…¥"><a href="#ç›´æ¥è¾“å…¥" class="headerlink" title="ç›´æ¥è¾“å…¥"></a>ç›´æ¥è¾“å…¥</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">string line;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">getline</span>(cin,line))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> k=<span class="number">0</span>;</span><br><span class="line">        <span class="function">stringstream <span class="title">ssin</span><span class="params">(line)</span></span>;</span><br><span class="line">        <span class="keyword">while</span>(ssin&gt;&gt;g[n][k]) k++;</span><br><span class="line">        m=k;</span><br><span class="line">        n++;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="æ•°å›¾-dfs"><a href="#æ•°å›¾-dfs" class="headerlink" title="æ•°å›¾ dfs"></a>æ•°å›¾ dfs</h2><h3 id="å›¾çš„å­˜å‚¨"><a href="#å›¾çš„å­˜å‚¨" class="headerlink" title="å›¾çš„å­˜å‚¨"></a>å›¾çš„å­˜å‚¨</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666584654013-b06139ac-0c98-44fb-99e4-1ab6e00d0e70.png" alt="img"><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1678008365333-5e6a4361-93e1-4536-a71b-8d6eaadf43a4.png" alt="img"></p><h3 id="æœç´¢éå†"><a href="#æœç´¢éå†" class="headerlink" title="æœç´¢éå†"></a>æœç´¢éå†</h3><ol><li>æ·±æœ</li></ol><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1678008359412-9127f285-34e0-4f53-81db-36f9d7beb2f2.png" alt="img"></p><h3 id="é‡è¾¹å’Œè‡ªç¯"><a href="#é‡è¾¹å’Œè‡ªç¯" class="headerlink" title="é‡è¾¹å’Œè‡ªç¯"></a>é‡è¾¹å’Œè‡ªç¯</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666594843185-2d5e3103-f164-42b7-b88b-bf3e06faf948.png" alt="img"></p><h3 id="æ ‘çš„å­˜å‚¨"><a href="#æ ‘çš„å­˜å‚¨" class="headerlink" title="æ ‘çš„å­˜å‚¨"></a>æ ‘çš„å­˜å‚¨</h3><p>æ ‘ æ˜¯ç‰¹æ®Šçš„å›¾ï¼šæ ‘æ˜¯æ— ç¯è¿é€šå›¾</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>, M = N * <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="comment">// nä¸ªé“¾è¡¨å¤´ï¼ˆç›¸å½“äºnä¸ªheadï¼‰  eæ˜¯ç»“ç‚¹å€¼ neæ˜¯nextæŒ‡é’ˆ</span></span><br><span class="line"><span class="type">int</span> h[N], e[M], ne[M],idx;</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"><span class="comment">// a æ’å‘ b</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br></pre></td></tr></table></figure><h3 id="æ ‘çš„é‡å¿ƒ"><a href="#æ ‘çš„é‡å¿ƒ" class="headerlink" title="æ ‘çš„é‡å¿ƒ"></a>æ ‘çš„é‡å¿ƒ</h3><p>é‡å¿ƒå®šä¹‰ï¼šé‡å¿ƒæ˜¯æŒ‡æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œå¦‚æœå°†è¿™ä¸ªç‚¹åˆ é™¤åï¼Œå‰©ä½™å„ä¸ªè¿é€šå—ä¸­ç‚¹æ•°çš„æœ€å¤§å€¼æœ€å°ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹è¢«ç§°ä¸ºæ ‘çš„é‡å¿ƒã€‚</p><p>ä¸‹å›¾ åˆ é™¤ 4 å å‰©ä¸‹ 12857 39 6 è¿é€šå—æ•°é‡æœ€å¤§ 5</p><ul><li><p>æ·±æœç‰¹ç‚¹ æ—¶é—´å¤æ‚åº¦ Oï¼ˆn + mï¼‰</p></li><li><ul><li>æ¯”å¦‚ 4 ä¼šè¿”å›å­æ ‘ 3,9 6 çš„ size å‰©ä½™ size &#x3D; n - 2 - 1</li></ul></li></ul><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666583905368-0d7c54f3-9e87-44a8-9c23-90a5a412893e.png" alt="img"></p><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666594378360-fe6a251b-4f59-44a9-a689-5fffbc21f5c9.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #include &lt;iostream&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>, M = N * <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="comment">// nä¸ªé“¾è¡¨å¤´  eæ˜¯ç»“ç‚¹å€¼ neæ˜¯nextæŒ‡é’ˆ</span></span><br><span class="line"><span class="type">int</span> h[N], e[M], ne[M],idx;</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ans = N;</span><br><span class="line"></span><br><span class="line"><span class="comment">// a æŒ‡å‘ b</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿”å›ä»¥uä¸ºæ ¹å­æ ‘çš„å¤§å°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span>&#123;</span><br><span class="line">    st[u] = <span class="literal">true</span>;   <span class="comment">// æ ‡è®°ä¸€ä¸‹å·²ç»è¢«æœè¿‡äº†</span></span><br><span class="line">    <span class="comment">// sumè¡¨ç¤ºä»ä¸€å¼€å§‹  sizeåˆ æ‰è¿™ä¸ªç‚¹æ¯ä¸€ä¸ªè¿é€šå—æœ€å¤§å€¼</span></span><br><span class="line">    <span class="type">int</span> sum = <span class="number">1</span>, res = <span class="number">0</span>;  <span class="comment">// reså­˜æ”¾å­æ ‘æœ€å¤§å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; i != <span class="number">-1</span>;i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(!st[j])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> s = <span class="built_in">dfs</span>(j);  <span class="comment">// å½“å‰å­æ ‘å¤§å°size</span></span><br><span class="line">            res = <span class="built_in">max</span>(res, s);  <span class="comment">// å½“å‰å­æ ‘æ˜¯è¿é€šå—  å–max</span></span><br><span class="line">            sum += s;    <span class="comment">// åŠ ä¸Šå„ä¸ªå­æ ‘size</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res = <span class="built_in">max</span>(res, n - sum);  <span class="comment">// åˆ é™¤è¯¥ç‚¹è¿é€šå—æœ€å¤§ç‚¹æ•°</span></span><br><span class="line">    ans = <span class="built_in">min</span>(ans, res);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 9</span></span><br><span class="line"><span class="comment">// 1 2</span></span><br><span class="line"><span class="comment">// 1 7</span></span><br><span class="line"><span class="comment">// 1 4</span></span><br><span class="line"><span class="comment">// 2 8</span></span><br><span class="line"><span class="comment">// 2 5</span></span><br><span class="line"><span class="comment">// 4 3</span></span><br><span class="line"><span class="comment">// 3 9</span></span><br><span class="line"><span class="comment">// 4 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>;i++)&#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="built_in">add</span>(a, b), <span class="built_in">add</span>(b, a);  <span class="comment">//æ— å‘è¾¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•°å›¾-bfs"><a href="#æ•°å›¾-bfs" class="headerlink" title="æ•°å›¾ bfs"></a>æ•°å›¾ bfs</h2><h3 id="æ ‘-1-èµ°åˆ°-n"><a href="#æ ‘-1-èµ°åˆ°-n" class="headerlink" title="æ ‘ 1 èµ°åˆ° n"></a>æ ‘ 1 èµ°åˆ° n</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666873980319-e972068f-2c3d-4547-9c02-be23a1e3af0a.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>, M = N * <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="comment">// nä¸ªé“¾è¡¨å¤´  eæ˜¯ç»“ç‚¹å€¼ neæ˜¯nextæŒ‡é’ˆ</span></span><br><span class="line"><span class="type">int</span> h[N], e[M], ne[M],idx;</span><br><span class="line"><span class="type">int</span> d[N], q[N];  <span class="comment">// è·ç¦» å’Œ é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> hh = <span class="number">0</span>, tt = <span class="number">0</span>;</span><br><span class="line">    q[<span class="number">0</span>] = <span class="number">1</span>; <span class="comment">// ä»1 å¼€å§‹èµ° 1å…¥é˜Ÿ</span></span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span> d);  <span class="comment">// è·ç¦»åˆå§‹ä½ -1 æ²¡æœ‰èµ°è¿‡</span></span><br><span class="line"></span><br><span class="line">    d[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(hh &lt;= tt)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = q[hh++];  <span class="comment">// å‡ºé˜Ÿ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>;i=ne[i])  <span class="comment">// æ‰©å±•é‚»æ¥è¡¨</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(d[j] == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                d[j] = d[t] + <span class="number">1</span>;</span><br><span class="line">                q[ ++ tt] = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[n];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4 5</span></span><br><span class="line"><span class="comment">// 1 2</span></span><br><span class="line"><span class="comment">// 2 3</span></span><br><span class="line"><span class="comment">// 3 4</span></span><br><span class="line"><span class="comment">// 1 3</span></span><br><span class="line"><span class="comment">// 1 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="built_in">add</span>(a, b);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">bfs</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‹“æ‰‘åºåˆ—"><a href="#æ‹“æ‰‘åºåˆ—" class="headerlink" title="æ‹“æ‰‘åºåˆ—"></a>æ‹“æ‰‘åºåˆ—</h3><h4 id="æ€§è´¨"><a href="#æ€§è´¨" class="headerlink" title="æ€§è´¨"></a>æ€§è´¨</h4><ol><li>æœ‰å‘å›¾æ‰æœ‰æ‹“æ‰‘åºåˆ— æ— å‘å›¾æ²¡æœ‰</li><li>æœ‰å‘æ— ç¯å›¾åˆå«æ‹“æ‰‘å›¾</li><li>æœ‰ç¯ä¸€å®šæ²¡æœ‰æ‹“æ‰‘åºåˆ—</li><li>å…¥åº¦ ï¼š æŒ‡å‘è‡ªå·±çš„è¾¹æ•°</li><li>å‡ºåº¦ï¼š æŒ‡å‘å…¶ä»–æ•°çš„è¾¹æ•°</li><li>æ‹“æ‰‘åºåˆ—ä¸€å®šå­˜åœ¨ä¸€ä¸ªå…¥åº¦ä¸º 0 çš„ç‚¹ï¼Œå°†å…¶ä»–ç‚¹çªç ´æ‰</li></ol><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666875021678-72b58d0c-40be-41c1-be4d-a214884b1e5d.png" alt="img"></p><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666875735255-02c41919-053a-49b9-9b67-3af1239beace.png" alt="img"></p><h4 id="åˆ¤æ–­æ‹“æ‰‘åºåˆ—å¹¶è¾“å‡ºï¼ˆä¾‹ï¼‰"><a href="#åˆ¤æ–­æ‹“æ‰‘åºåˆ—å¹¶è¾“å‡ºï¼ˆä¾‹ï¼‰" class="headerlink" title="åˆ¤æ–­æ‹“æ‰‘åºåˆ—å¹¶è¾“å‡ºï¼ˆä¾‹ï¼‰"></a>åˆ¤æ–­æ‹“æ‰‘åºåˆ—å¹¶è¾“å‡ºï¼ˆä¾‹ï¼‰</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1666877641141-4d2293b1-4152-4a3a-99b9-5d68be689714.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], e[N], ne[N], idx;</span><br><span class="line"><span class="type">int</span> q[N], d[N];  <span class="comment">// dè®°å½•å…¥åº¦çš„æ•°ç›®</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">topsort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> hh = <span class="number">0</span>, tt = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n;i++)</span><br><span class="line">        <span class="keyword">if</span>(d[i]==<span class="number">0</span>)  <span class="comment">// å…¥åº¦ä¸º0çš„ç‚¹å…¥é˜Ÿ</span></span><br><span class="line">            q[++tt] = i;</span><br><span class="line">    <span class="keyword">while</span>(hh &lt;= tt)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> t = q[hh++];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            d[j]--;</span><br><span class="line">            <span class="keyword">if</span> (d[j] == <span class="number">0</span>) q[++tt] = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tt == n - <span class="number">1</span>;   <span class="comment">// ä¸€å…±è¿›äº†nä¸ªç‚¹  æ˜¯æœ‰å‘æ— ç¯å›¾</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m;i++)&#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="built_in">add</span>(a, b);</span><br><span class="line">        d[b]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">topsort</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n;i++) cout &lt;&lt; q[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœ€çŸ­è·¯é—®é¢˜"><a href="#æœ€çŸ­è·¯é—®é¢˜" class="headerlink" title="æœ€çŸ­è·¯é—®é¢˜"></a>æœ€çŸ­è·¯é—®é¢˜</h2><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667050783958-2c4025d3-8ed1-4b00-ad47-721bffde756c.png" alt="img"></p><ol><li>ç¨ å¯†å›¾ç”¨ dijkstraï¼ˆä¸´æ¥çŸ©é˜µï¼‰</li><li>ç¨€ç–ç”¨å †ä¼˜åŒ–ç‰ˆï¼ˆä¸´æ¥è¡¨ï¼‰</li><li>ä¸è¶…è¿‡ k æ¡è¾¹ Bellman-Ford</li><li>éš¾ç‚¹åœ¨å»ºå›¾å’ŒæŠ½è±¡å…·ä½“é—®é¢˜ ä¸åœ¨äºè¯æ˜</li></ol><h3 id="Dijkstraï¼ˆæœ´ç´ -ç¨ å¯†å›¾ï¼‰"><a href="#Dijkstraï¼ˆæœ´ç´ -ç¨ å¯†å›¾ï¼‰" class="headerlink" title="Dijkstraï¼ˆæœ´ç´  ç¨ å¯†å›¾ï¼‰"></a>Dijkstraï¼ˆæœ´ç´  ç¨ å¯†å›¾ï¼‰</h3><h4 id="memset-è¯´æ˜-ğŸ‡"><a href="#memset-è¯´æ˜-ğŸ‡" class="headerlink" title="memset è¯´æ˜ ğŸ‡"></a>memset è¯´æ˜ ğŸ‡</h4><p>å¦‚æœç”¨ memset(a,1,20);ï¼ˆå®é™…ä¸Šä¸ memset(a,1,5*sizeof(int))ç»“æœæ˜¯ä¸€æ ·çš„ï¼‰å°±æ˜¯å¯¹ a æŒ‡å‘çš„å†…å­˜çš„ 20 ä¸ªå­—èŠ‚è¿›è¡Œèµ‹å€¼ï¼Œæ¯ä¸ªéƒ½ç”¨ ASCâ…¡ ä¸º 1 çš„å­—ç¬¦å»å¡«å……ï¼Œè½¬ä¸ºäºŒè¿›åˆ¶åï¼Œ1 å°±æ˜¯ 00000001ï¼Œå ä¸€ä¸ªå­—èŠ‚ã€‚ä¸€ä¸ª INT å…ƒç´ æ˜¯ 4 å­—èŠ‚ï¼Œåˆä¸€èµ·æ˜¯ 0000 0001,0000 0001,0000 0001,0000 0001ï¼Œè½¬åŒ–æˆåå…­è¿›åˆ¶å°±æ˜¯ 0x01010101ï¼Œå°±ç­‰äº 16843009ï¼Œå°±å®Œæˆäº†å¯¹ä¸€ä¸ª INT å…ƒç´ çš„èµ‹å€¼äº†ã€‚</p><p><a href="https://www.cnblogs.com/handsomecui/p/4723949.html">https://www.cnblogs.com/handsomecui/p/4723949.html</a></p><h4 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667052067886-2dbc1843-8b65-4bc3-b0a8-8917099027b4.png" alt="img"></p><ol><li>1 å·ç‚¹è·ç¦»åˆå§‹ä¸º 0 å…¶ä»–ç‚¹åˆå§‹æ— ç©·å¤§</li><li>æšä¸¾ 1-n ä¸ªç‚¹ tï¼ˆs å­˜å‚¨æ˜¯å¦æšä¸¾è¿‡ï¼‰ æ‰¾åˆ°æœ€è¿‘çš„ç‚¹ ç”¨ t æ›´æ–°å…¶ä»–ç‚¹è·ç¦»</li></ol><h4 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667623903746-f284004e-a9c4-423d-b82f-77c05652a7fb.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="comment">// #include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> g[N][N];</span><br><span class="line"><span class="type">int</span> dist[N];  <span class="comment">// 1åˆ°å„ä¸ªç‚¹çš„è·ç¦»</span></span><br><span class="line"><span class="type">bool</span> st[N];  <span class="comment">// å„ä¸ªç‚¹æ˜¯å¦ç¡®å®š</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dijkstra</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dist);  <span class="comment">// æ‰€æœ‰è·ç¦»æ­£æ— ç©·</span></span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;  <span class="comment">// 1å·ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)  <span class="comment">// éå†né  å³nä¸ªæ•°</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n;j++) <span class="comment">// æ‰¾åˆ°æ²¡æœ‰ç¡®å®šçš„ç‚¹ä¸­è·ç¦»æœ€å°çš„ä¸€ä¸ª</span></span><br><span class="line">            <span class="comment">// æ²¡éå†è¿‡  t = -1 å½“å‰tä¸æ˜¯æœ€çŸ­</span></span><br><span class="line">            <span class="keyword">if</span>(!st[j] &amp;&amp; (t == <span class="number">-1</span> || dist[j] &lt; dist[t]))</span><br><span class="line">                t = j;</span><br><span class="line"></span><br><span class="line">        st[t] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨tæ›´æ–°å…¶ä»–ç‚¹çš„è·ç¦»</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">            dist[j] = <span class="built_in">min</span>(dist[j], dist[t] + g[t][j]);   <span class="comment">// j =ï¼ˆ1åˆ°t   +   tåˆ°jï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dist[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; 0x3f3f3f3f &lt;&lt; endl;</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">memset</span>(g, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> g);</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        g[a][b] = <span class="built_in">min</span>(g[a][b], c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">dijkstra</span>();</span><br><span class="line">    cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667632415369-a1b1decc-e175-48b5-aa21-883de1dc7ed1.png" alt="img"></p><hr><h3 id="Dijkstra-å †ä¼˜åŒ–-ç¨€ç–å›¾"><a href="#Dijkstra-å †ä¼˜åŒ–-ç¨€ç–å›¾" class="headerlink" title="Dijkstra (å †ä¼˜åŒ– ç¨€ç–å›¾)"></a>Dijkstra (å †ä¼˜åŒ– ç¨€ç–å›¾)</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667624435159-7fbba93a-e88d-4c05-8435-38e82ad15aa1.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="comment">// #include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">150010</span>;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;  <span class="comment">// è·ç¦»  ç¼–å·</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], w[N], e[N], ne[N],idx;  <span class="comment">// é‚»æ¥è¡¨å­˜å‚¨  wæƒé‡</span></span><br><span class="line"><span class="type">int</span> dist[N];</span><br><span class="line"><span class="type">bool</span> st[N];  <span class="comment">// å„ä¸ªç‚¹æ˜¯å¦ç¡®å®š</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    e[idx] = b,w[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dijkstra</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dist);  <span class="comment">// æ‰€æœ‰è·ç¦»æ­£æ— ç©·</span></span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    priority_queue &lt;PII, vector&lt;PII&gt;, greater&lt;PII&gt;&gt; heap;</span><br><span class="line">    heap.<span class="built_in">push</span>(&#123;<span class="number">0</span>, <span class="number">1</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(heap.<span class="built_in">size</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> t = heap.<span class="built_in">top</span>();</span><br><span class="line">            heap.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> ver = t.second, dstance = t.first;  <span class="comment">// ç¼–å· å’Œ è·ç¦»</span></span><br><span class="line">            <span class="keyword">if</span>(st[ver])  <span class="keyword">continue</span>;  <span class="comment">// è‹¥å‡ºç°åˆ™è·³è¿‡</span></span><br><span class="line">            <span class="comment">// ç”¨ t æ›´æ–°å…¶ä»–ç‚¹</span></span><br><span class="line">            st[ver] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = h[ver]; i != <span class="number">-1</span>;i = ne[i])</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">int</span> j = e[i];</span><br><span class="line">                    <span class="keyword">if</span>(dist[j] &gt; dstance + w[i])</span><br><span class="line">                    &#123;</span><br><span class="line">                        dist[j] = dstance + w[i];</span><br><span class="line">                        heap.<span class="built_in">push</span>(&#123;dist[j], j&#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span>(dist[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">dijkstra</span>();</span><br><span class="line">    cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Bellman-Ford"><a href="#Bellman-Ford" class="headerlink" title="Bellman-Ford"></a>Bellman-Ford</h3><ul><li>ç”¨æ¥åˆ¤æ–­è´Ÿç¯</li><li>ä¸€èˆ¬ä¸å¸¸ç”¨</li></ul><h4 id="æ€è·¯-3"><a href="#æ€è·¯-3" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li>éå†ä¸¤æ¬¡ ä»å·¦åˆ°å³ä¾æ¬¡éå†</li><li>æœ€åæ»¡è¶³ä¸‰è§’ä¸ç­‰å¼ dist[b] &lt;&#x3D; dist[a] + w</li><li>è‹¥æœ‰èµ‹æƒå›è·¯ æ­¤æ–¹æ³•ä¸èƒ½ç”¨ ï¼ˆå¯ä»¥ç”¨æ¥æ‰¾è´Ÿç¯ ï¼‰<img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667574150479-4c01c88f-55f5-4740-932a-27884bfc5699.png" alt="img"></li></ol><h4 id="ä¾‹é¢˜-2"><a href="#ä¾‹é¢˜-2" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><ul><li>é™åˆ¶æ¬¡æ•° æœ‰è´Ÿç¯å­˜åœ¨æœ€å°å€¼</li></ul><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667577588052-12506184-4db1-4ca9-86c1-80319af552ab.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>, M = <span class="number">10010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m,k;</span><br><span class="line"><span class="type">int</span> dist[N], backup[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">    <span class="type">int</span> a, b, w;</span><br><span class="line">&#125;edges[M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bellman_ford</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dist);</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(backup, dist, <span class="keyword">sizeof</span> dist);  <span class="comment">// å¤‡ä»½ä¸Šä¸€æ¬¡æ•°æ® é˜²æ­¢æ•°æ®ä¸²è”</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">            <span class="type">int</span> a = edges[j].a, b = edges[j].b, w = edges[j].w;</span><br><span class="line">            dist[b] = <span class="built_in">min</span>(dist[b], backup[a] + w);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dist[n] &gt; <span class="number">0x3f3f3f3f</span> / <span class="number">2</span>) <span class="keyword">return</span> <span class="number">-1</span>;  <span class="comment">// è´Ÿæƒè¾¹å¯èƒ½æ›´æ–°dist[n] &lt; INF</span></span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; 0x3f3f3f3f;</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> a, b, w;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; w;</span><br><span class="line">        edges[i] = &#123;a, b, w&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">bellman_ford</span>();</span><br><span class="line">    <span class="keyword">if</span>(t == <span class="number">-1</span> &amp;&amp; dist[n] != <span class="number">-1</span>) <span class="built_in">puts</span>(<span class="string">&quot;impossible&quot;</span>);    <span class="comment">// &amp;&amp; è§£å†³ 1 -&gt; 2 = -1æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Spfa"><a href="#Spfa" class="headerlink" title="Spfa"></a>Spfa</h3><ol><li>ç”± Ford ä¼˜åŒ–è€Œæ¥<code>dist[b] = min(dist[b],dist[a] + w)</code></li><li>è€ƒè™‘åªæœ‰å˜å°çš„ a æ‰èƒ½æ›´æ–°åˆ«äºº</li><li>ç”¨é˜Ÿåˆ—åš é•¿å¾—åƒ Djstra</li></ol><h4 id="æ€è·¯-4"><a href="#æ€è·¯-4" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667625683770-4992d0d0-ccc4-46cc-a5f8-63d31e5580c2.png" alt="img"></p><h4 id="ä¾‹é¢˜-3"><a href="#ä¾‹é¢˜-3" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667625837701-8f5f518e-b45f-4fac-b800-76235e2ce944.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="comment">// #include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], w[N], e[N], ne[N],idx;  <span class="comment">// é‚»æ¥è¡¨å­˜å‚¨  wæƒé‡</span></span><br><span class="line"><span class="type">int</span> dist[N];</span><br><span class="line"><span class="type">bool</span> st[N];  <span class="comment">// å„ä¸ªç‚¹æ˜¯å¦ç¡®å®š  åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…æ›´æ–°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    e[idx] = b,w[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dist);</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">    st[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        st[t] = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>;i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(dist[j] &gt; dist[t] + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                dist[j] = dist[t] + w[i];</span><br><span class="line">                <span class="keyword">if</span>(!st[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(j);</span><br><span class="line">                    st[j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dist[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">Spfa</span>();</span><br><span class="line">    <span class="keyword">if</span>(t == <span class="number">-1</span> &amp;&amp; dist[n]!=<span class="number">-1</span>) cout &lt;&lt; <span class="string">&quot;impossible&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="comment">// dist[n] != -1 é˜²æ­¢ä¸€æ¡è¾¹-1</span></span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; t &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="spfa-åˆ¤æ–­è´Ÿç¯"><a href="#spfa-åˆ¤æ–­è´Ÿç¯" class="headerlink" title="spfa åˆ¤æ–­è´Ÿç¯"></a>spfa åˆ¤æ–­è´Ÿç¯</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667639459383-6da8ee40-fa1c-435f-82e6-b5c8263c93f5.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="comment">// #include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], w[N], e[N], ne[N],idx;  <span class="comment">// é‚»æ¥è¡¨å­˜å‚¨  wæƒé‡</span></span><br><span class="line"><span class="type">int</span> dist[N],cnt[N];  <span class="comment">// cnt å­˜æ”¾ç»è¿‡è¾¹æ•° è‹¥å¤§äºnæ‹©ä¼˜è´Ÿç¯</span></span><br><span class="line"><span class="type">bool</span> st[N];  <span class="comment">// å„ä¸ªç‚¹æ˜¯å¦ç¡®å®š  åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…æ›´æ–°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    e[idx] = b,w[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="comment">// æŠŠæ¯ä¸ªç‚¹åŠ è¿›å»  ä¸æ˜¯åˆ¤æ–­ç¬¬ä¸€ä¸ªç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        st[i] = <span class="literal">true</span>;</span><br><span class="line">        q.<span class="built_in">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        st[t] = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (dist[j] &gt; dist[t] + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                dist[j] = dist[t] + w[i];</span><br><span class="line">                <span class="comment">// æ›´æ–°è¾¹æ•°</span></span><br><span class="line">                cnt[j] = cnt[t] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (cnt[j] &gt; n)  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!st[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(j);</span><br><span class="line">                    st[j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Spfa</span>()) cout &lt;&lt;<span class="string">&quot;Yes&quot;</span> &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;No&quot;</span> &lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="floyd"><a href="#floyd" class="headerlink" title="floyd"></a>floyd</h3><h4 id="æ€è·¯-5"><a href="#æ€è·¯-5" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667713724593-9f03eb30-1a72-475f-9094-ccb1a2621cdc.png" alt="img"></p><ol><li>åŸç†åŸºäºåŠ¨æ€è§„åˆ’</li><li>ç”¨ä¸´æ¥çŸ©é˜µå­˜å‚¨</li></ol><h4 id="ä¾‹é¢˜-4"><a href="#ä¾‹é¢˜-4" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667714234560-be10baac-31be-4293-924c-5b40ff107f22.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">210</span>,INF = <span class="number">1e9</span>; <span class="comment">// INF æ­£æ— ç©·</span></span><br><span class="line"><span class="type">int</span> n, m, Q;</span><br><span class="line"><span class="type">int</span> d[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">floyd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">                d[i][j] = <span class="built_in">min</span>(d[i][j], d[i][k] + d[k][j]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; INF &lt;&lt; endl;</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; Q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">            <span class="keyword">if</span>(i == j) d[i][j] == <span class="number">0</span>;  <span class="comment">// è‡ªç¯</span></span><br><span class="line">            <span class="keyword">else</span> d[i][j] = INF;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> a, b, w;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; w;</span><br><span class="line">        d[a][b] = <span class="built_in">min</span>(d[a][b], w);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">floyd</span>();</span><br><span class="line">    <span class="keyword">while</span>(Q--)&#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="keyword">if</span>(d[a][b] &gt; INF / <span class="number">2</span>) cout &lt;&lt;<span class="string">&quot;impossible&quot;</span> &lt;&lt;endl;  <span class="comment">// è´Ÿæƒè¾¹å¯èƒ½åˆ°æ—¶1e9 - n</span></span><br><span class="line">        <span class="keyword">else</span> cout &lt;&lt; d[a][b]&lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h2><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667715689341-15c867dd-af24-4ef5-8b37-adac8dfea566.png" alt="img"></p><h3 id="prim-ç®—æ³•-ï¼ˆç¨ å¯†å›¾ï¼‰"><a href="#prim-ç®—æ³•-ï¼ˆç¨ å¯†å›¾ï¼‰" class="headerlink" title="prim ç®—æ³• ï¼ˆç¨ å¯†å›¾ï¼‰"></a>prim ç®—æ³• ï¼ˆç¨ å¯†å›¾ï¼‰</h3><h4 id="æ€è·¯-6"><a href="#æ€è·¯-6" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ul><li>æ³¨æ„ï¼šä¸ dijstra åŒºåˆ« prim ç”¨ t æ›´æ–°çš„æ˜¯åˆ°é›†åˆçš„è·ç¦»</li><li>dj æ›´æ–°çš„æ˜¯åˆ°èµ·ç‚¹çš„è·ç¦»</li><li>ç‚¹åˆ°é›†åˆè·ç¦»ï¼š ç‚¹åˆ°é›†åˆé‡Œçš„ç‚¹è·ç¦»æœ€å°å€¼</li><li><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667716925553-43035c8c-b806-4ee1-8861-e9a2ef34389f.png" alt="img"></li><li>ä» 1 å¼€å§‹æ›´æ–° 2,3,4ï¼š ï¼ˆ1 æ²¡æœ‰åˆ°é›†åˆçš„è¾¹ï¼Œè‡ªå·±å½“åšæ£®æ—èµ·å§‹ï¼‰ 1 å˜ç»¿è‰²</li><li>ç”¨ 1ï¼Œ 2 ï¼ˆåœ¨è¿é€šå—ï¼‰æ›´æ–°ï¼š 3,4 åˆ° 2 ä¸º 2 å’Œ ï¼ˆæ— ï¼‰ ä¸ç”¨æ›´æ–° ï¼Œ2 å˜ç»¿è‰²</li><li>æœ€åéƒ½æ˜¯ç»¿è‰²æ—¶ï¼Œ1 é›†åˆçš„è·ç¦»è¿çº¿æ˜¯æœ€å°ç”Ÿæˆæ ‘</li><li>æ³¨ï¼š æœ€å°ç”Ÿæˆæ ‘ä¸­è¾¹çš„ç¯æ­£è´Ÿæ— å½±å“</li></ul><hr><ul><li><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667716414706-f966b7e8-3da3-4590-8710-180289095ffb.png" alt="img"></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"><span class="keyword">const</span> int N = <span class="number">510</span>, <span class="variable constant_">INF</span> = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line">int n, m;</span><br><span class="line">int g[N][N];</span><br><span class="line">int dist[N];</span><br><span class="line">bool st[N];</span><br><span class="line"></span><br><span class="line">int <span class="title function_">prim</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">memset</span>(dist, <span class="number">0x3f</span>, sizeof dist);</span><br><span class="line">    int res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        int t = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (int j = <span class="number">1</span>; j &lt;= n;j++)  <span class="comment">// æ‰¾åˆ°å‰©ä½™ç‚¹åˆ°é›†åˆæœ€å°ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span>(!st[j] &amp;&amp; (t == -<span class="number">1</span> || dist[t] &gt; dist[j]))</span><br><span class="line">                t = j;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(i &amp;&amp; dist[t] == <span class="variable constant_">INF</span>) <span class="keyword">return</span> <span class="variable constant_">INF</span>;  <span class="comment">// å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªç‚¹å¹¶ä¸”éƒ½ä¸è¿é€šåˆ™æ²¡æœ‰ç”Ÿæˆæ ‘</span></span><br><span class="line">        <span class="keyword">if</span>(i) res += dist[t];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (int j = <span class="number">1</span>; j &lt;= n; j++)  dist[j] = <span class="title function_">min</span>(dist[j],g[t][j]);  <span class="comment">// ç”¨tæ›´æ–°å…¶ä»–ç‚¹ï¼Œå³åˆ°ç›®å‰æ ‘çš„è·ç¦»</span></span><br><span class="line">        st[t] = <span class="literal">true</span>;  <span class="comment">// tç‚¹åŠ å…¥æ ‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">int <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="title function_">memset</span>(g, <span class="number">0x3f</span>, sizeof g);</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        int a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        g[a][b] = g[b][a] =  <span class="title function_">min</span>(g[a][b], c);  <span class="comment">// æ— å‘å›¾</span></span><br><span class="line">    &#125;</span><br><span class="line">    int t = <span class="title function_">prim</span>();</span><br><span class="line">    t == <span class="variable constant_">INF</span> ? <span class="title function_">puts</span>(<span class="string">&quot;impossible&quot;</span>) : <span class="title function_">printf</span>(<span class="string">&quot;%d&quot;</span>, t);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="kruscal-ï¼ˆç¨€ç–å›¾ï¼‰"><a href="#kruscal-ï¼ˆç¨€ç–å›¾ï¼‰" class="headerlink" title="kruscal ï¼ˆç¨€ç–å›¾ï¼‰"></a>kruscal ï¼ˆç¨€ç–å›¾ï¼‰</h3><h4 id="æ€è·¯-7"><a href="#æ€è·¯-7" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li>å¹¶æŸ¥é›†</li></ol><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667788649336-ab527a53-4099-487b-a254-85dfb66e45fb.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span> + <span class="number">10</span>;  <span class="comment">// è¾¹æ•°æ˜¯Nçš„2å€******************</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> a, b, w;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Edge &amp;e)  <span class="comment">// ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> w &lt; e.w;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;edge[N];</span><br><span class="line"><span class="type">int</span> p[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x != p[x]) p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">    <span class="keyword">return</span> p[x];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">kruskal</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(edge, edge + m);  <span class="comment">// ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) p[i] = i; <span class="comment">// å¹¶æŸ¥é›†åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>, cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a = edge[i].a, b = edge[i].b, w = edge[i].w;</span><br><span class="line">        a = <span class="built_in">find</span>(a), b = <span class="built_in">find</span>(b);</span><br><span class="line">        <span class="keyword">if</span>(a != b)</span><br><span class="line">        &#123;</span><br><span class="line">            p[a] = b;</span><br><span class="line">            res += w;</span><br><span class="line">            cnt ++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; cnt;</span></span><br><span class="line">    <span class="keyword">if</span>(cnt == n - <span class="number">1</span>) cout &lt;&lt; res &lt;&lt; endl;  <span class="comment">// å­˜åœ¨æœ€å°ç”Ÿæˆæ ‘cnt == n - 1!!!</span></span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;impossible&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++)</span><br><span class="line">        cin &gt;&gt; edge[i].a &gt;&gt; edge[i].b &gt;&gt; edge[i].w;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">kruskal</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŸ“è‰²æ³•åˆ¤æ–­äºŒåˆ†å›¾"><a href="#æŸ“è‰²æ³•åˆ¤æ–­äºŒåˆ†å›¾" class="headerlink" title="æŸ“è‰²æ³•åˆ¤æ–­äºŒåˆ†å›¾"></a>æŸ“è‰²æ³•åˆ¤æ–­äºŒåˆ†å›¾</h2><h3 id="æ€è·¯-8"><a href="#æ€è·¯-8" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ol><li>äºŒåˆ†å›¾ï¼šåˆ’åˆ†æˆä¸¤ä¸ªé›†åˆï¼Œé›†åˆå†…éƒ¨æ²¡æœ‰è¾¹</li><li></li><li>æ€§è´¨ï¼šä¸€ä¸ªå›¾ä¸ºäºŒåˆ†å›¾ ï¼š å½“ä¸”ä»…å½“å›¾ä¸­ä¸å«å¥‡æ•°ç¯ ï¼ˆç¯çš„è¾¹æ•°æ˜¯å¥‡æ•°ï¼‰</li><li>åšæ³•ï¼šç”¨äºŒåˆ†æ³•æŸ“è‰²ä¸€éï¼Œæ²¡æœ‰çŸ›ç›¾åˆ™æ˜¯äºŒåˆ†å›¾</li><li>0 ä¸€å®šè¿ 1 1 ä¸€å®šè¿ 0 å¦‚æœæœ‰å¶æ•°ç¯ çŸ›ç›¾</li></ol><ul><li>è¯æ˜ï¼š å‡è®¾ç¬¬ä¸€ä¸ª ç‚¹å·¦è¾¹ æœ€åæ¨å‡ºè¯¥ç‚¹åœ¨å³è¾¹</li></ul><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667791150277-d7438760-965a-4ef9-9879-99f3317685e8.png" alt="img"></p><h3 id="ä¾‹é¢˜-5"><a href="#ä¾‹é¢˜-5" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p><img src="/img/%E6%90%9C%E7%B4%A2%E5%92%8C%E5%9B%BE%E8%AE%BA.assets/1667796485392-79cfde01-27d0-4960-a8a6-65b05ecc44b4.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>,M = <span class="number">200010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], e[M], ne[M], idx;</span><br><span class="line"><span class="type">int</span> color[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u , <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    color[u] = c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; i != <span class="number">-1</span>;i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span>(!color[j])  <span class="comment">// å¦‚æœæ²¡æœ‰æŸ“è‰²</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">dfs</span>(j,<span class="number">3</span>-c)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(color[j] == c) <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// å¦‚æœæŸ“è‰²  é¢œè‰²ç›¸åŒè¿”å›false</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">while</span>(m--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> a, b;</span><br><span class="line">            cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">            <span class="built_in">add</span>(a, b), <span class="built_in">add</span>(b, a);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(!color[i])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">dfs</span>(i,<span class="number">1</span>))  <span class="comment">// æœ‰çŸ›ç›¾å‘ç”Ÿ</span></span><br><span class="line">                &#123;</span><br><span class="line">                    flag = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> (flag) <span class="built_in">puts</span>(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒåˆ†å›¾æœ€å¤§åŒ¹é…"><a href="#äºŒåˆ†å›¾æœ€å¤§åŒ¹é…" class="headerlink" title="äºŒåˆ†å›¾æœ€å¤§åŒ¹é…"></a>äºŒåˆ†å›¾æœ€å¤§åŒ¹é…</h2><p><a href="https://blog.csdn.net/u011815404/article/details/84260940">https://blog.csdn.net/u011815404/article/details/84260940</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>, M = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> e[M], ne[M], h[N], idx;</span><br><span class="line"><span class="type">int</span> match[N];</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"><span class="type">int</span> n, m, k;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">find</span><span class="params">(<span class="type">int</span> u)</span> <span class="comment">// ç”·ç”Ÿ</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = h[u]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span>(!st[j])</span><br><span class="line">        &#123;</span><br><span class="line">            st[j] = <span class="literal">true</span>; <span class="comment">// æ ‡è®°æ‰¾è¿‡  å…ˆéœ¸å </span></span><br><span class="line">            <span class="keyword">if</span>(!match[j] || <span class="built_in">find</span>(match[j])) <span class="comment">// è¯¥å¥³ç”Ÿæ²¡æœ‰å¯¹è±¡ æˆ–è€…å…¶å¯¹è±¡å¦æœ‰å…¶äºº</span></span><br><span class="line">            &#123;</span><br><span class="line">                match[j] = u;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    <span class="keyword">while</span>(k --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="built_in">add</span>(a, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(st, <span class="literal">false</span>, <span class="keyword">sizeof</span> st);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">find</span>(i)) res ++;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> æœç´¢å’Œå›¾è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºç¡€ç®—æ³•</title>
      <link href="//post/%E7%AE%97%E6%B3%95/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.html"/>
      <url>//post/%E7%AE%97%E6%B3%95/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.html</url>
      
        <content type="html"><![CDATA[<p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1664971381812-f9235c65-cb3a-4623-a14c-0c1396b2d10d.png" alt="img"></p><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><h3 id="æ€æƒ³"><a href="#æ€æƒ³" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1674564361246-c9fe8284-d123-42c1-843d-c46d08ac100c.png" alt="img"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> x = q[(l + r) / <span class="number">2</span>], i = l - <span class="number">1</span>, j = r + <span class="number">1</span>;  <span class="comment">// x ä¸€èˆ¬å–ä¸­é—´ å·¦å³éƒ½è¡Œä¸è¿‡è¶…æ—¶</span></span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(q[++i] &lt; x);</span><br><span class="line">        <span class="keyword">while</span>(q[--j] &gt; x);</span><br><span class="line">        <span class="keyword">if</span>(i &lt; j) <span class="built_in">swap</span>(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">quick_sort</span>(q, l, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(q, j + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><h3 id="æ€æƒ³-1"><a href="#æ€æƒ³-1" class="headerlink" title="æ€æƒ³"></a>æ€æƒ³</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1674565827763-b1e3b708-de57-4b91-b9a0-c47a5f3af359.png" alt="img"></p><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> q[N], tmp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid = r + l &gt;&gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">merge_sort</span>(q, l, mid), <span class="built_in">merge_sort</span>(q, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, i = l, j = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">        <span class="keyword">if</span>(q[i] &lt;= q[j]) tmp[k ++] = q[i ++];</span><br><span class="line">        <span class="keyword">else</span> tmp[k ++] = q[j ++];</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid) tmp[k ++] = q[i ++];</span><br><span class="line">    <span class="keyword">while</span>(j &lt;= r) tmp[k ++] = q[j ++];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = l , j = <span class="number">0</span>; i &lt;= r; i ++, j ++) q[i] = tmp[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒåˆ†"><a href="#äºŒåˆ†" class="headerlink" title="äºŒåˆ†"></a>äºŒåˆ†</h2><h3 id="æ•´æ•°äºŒåˆ†"><a href="#æ•´æ•°äºŒåˆ†" class="headerlink" title="æ•´æ•°äºŒåˆ†"></a>æ•´æ•°äºŒåˆ†</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="comment">/* ... */</span>&#125; <span class="comment">// æ£€æŸ¥xæ˜¯å¦æ»¡è¶³æŸç§æ€§è´¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒºé—´[l, r]è¢«åˆ’åˆ†æˆ[l, mid]å’Œ[mid + 1, r]æ—¶ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsearch_1</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) r = mid;    <span class="comment">// check()åˆ¤æ–­midæ˜¯å¦æ»¡è¶³æ€§è´¨</span></span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŒºé—´[l, r]è¢«åˆ’åˆ†æˆ[l, mid - 1]å’Œ[mid, r]æ—¶ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bsearch_2</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;  <span class="comment">// å¦‚æœ l = r ä¸‹å–æ•´ä¸å˜</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) l = mid;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ®ç‚¹æ•°äºŒåˆ†"><a href="#æµ®ç‚¹æ•°äºŒåˆ†" class="headerlink" title="æµ®ç‚¹æ•°äºŒåˆ†"></a>æµ®ç‚¹æ•°äºŒåˆ†</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123;<span class="comment">/* ... */</span>&#125; <span class="comment">// æ£€æŸ¥xæ˜¯å¦æ»¡è¶³æŸç§æ€§è´¨</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">bsearch_3</span><span class="params">(<span class="type">double</span> l, <span class="type">double</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-6</span>;   <span class="comment">// eps è¡¨ç¤ºç²¾åº¦ï¼Œå–å†³äºé¢˜ç›®å¯¹ç²¾åº¦çš„è¦æ±‚</span></span><br><span class="line">    <span class="keyword">while</span> (r - l &gt; eps)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check</span>(mid)) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h2><h3 id="1-æ ¸å¿ƒæ€æƒ³"><a href="#1-æ ¸å¿ƒæ€æƒ³" class="headerlink" title="1.æ ¸å¿ƒæ€æƒ³"></a>1.æ ¸å¿ƒæ€æƒ³</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1663860606616-3abbbb63-bf2c-4d66-a51b-f2461c2597e7.png" alt="img"></p><h2 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h2><h3 id="åŸç ï¼Œåç ï¼Œè¡¥ç "><a href="#åŸç ï¼Œåç ï¼Œè¡¥ç " class="headerlink" title="åŸç ï¼Œåç ï¼Œè¡¥ç "></a>åŸç ï¼Œåç ï¼Œè¡¥ç </h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1664004083919-4c27913f-b6c0-416b-ad5c-861f84b816de.png" alt="img"></p><p>1.æ­£æ•°ï¼šåŸç åç è¡¥ç ç›¸åŒ</p><p>2.è´Ÿæ•°</p><p>å¯¹åº”çš„äºŒè¿›åˆ¶<strong>åŸç </strong>ï¼š10000001<br>å¯¹åº”çš„äºŒè¿›åˆ¶<strong>åç **</strong>ï¼ˆ*<strong>*ç¬¦å·ä½ä¸å˜ï¼Œå…¶å®ƒä½å–å**</strong>ï¼‰<strong>ï¼š11111110<br>å¯¹åº”çš„äºŒè¿›åˆ¶</strong>è¡¥ç *<strong>*ï¼ˆ**<strong>åç +1*</strong>*ï¼‰</strong>ï¼š11111111</p><p>3.è¿ç®—ï¼š</p><p>10 çš„åŸç ä¸º ï¼š0 1010ï¼›</p><p>10 çš„åç ä¸ºï¼š 0 1010ï¼›</p><p>10 çš„è¡¥ç ä¸ºï¼š 0 1010ï¼›</p><p>-13 çš„åŸç ä¸ºï¼š1 1101ï¼›</p><p>-13 çš„åç ä¸ºï¼š1 0010ï¼›</p><p>-13 çš„è¡¥ç ä¸ºï¼š1 0011ï¼›</p><p>é‚£ä¹ˆ 10 - 13 &#x3D; 01010 + 10011 &#x3D; 11101ï¼ˆè¡¥ç ï¼‰</p><p>å…¶åç ä¸ºï¼š11100ï¼›</p><p>å…¶åŸç ä¸ºï¼š10011ï¼Œåè¿›åˆ¶æ•°ä¸º-3ã€‚</p><p><a href="https://blog.csdn.net/weixin_43361544/article/details/122952495"></a></p><h3 id="1-è¿ç®—æ“ä½œ"><a href="#1-è¿ç®—æ“ä½œ" class="headerlink" title="1.è¿ç®—æ“ä½œ"></a>1.è¿ç®—æ“ä½œ</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1664001898644-58160843-a780-4494-8277-0fde42446dfe.png" alt="img"></p><h3 id="2-ä¼˜å…ˆçº§"><a href="#2-ä¼˜å…ˆçº§" class="headerlink" title="2.ä¼˜å…ˆçº§"></a>2.ä¼˜å…ˆçº§</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1664002289265-5e4157da-809f-45c7-8e87-a58e8c3f4d26.png" alt="img"></p><h3 id="3-è¿ç®—å¾‹"><a href="#3-è¿ç®—å¾‹" class="headerlink" title="3.è¿ç®—å¾‹"></a>3.è¿ç®—å¾‹</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1664002433039-3605cc22-0dfb-44a8-876e-eb8f0fa45440.png" alt="img"></p><h3 id="ç›¸å…³æ“ä½œ"><a href="#ç›¸å…³æ“ä½œ" class="headerlink" title="ç›¸å…³æ“ä½œ"></a>ç›¸å…³æ“ä½œ</h3><h4 id="æŸ¥çœ‹äºŒè¿›åˆ¶æ•°"><a href="#æŸ¥çœ‹äºŒè¿›åˆ¶æ•°" class="headerlink" title="æŸ¥çœ‹äºŒè¿›åˆ¶æ•°"></a>æŸ¥çœ‹äºŒè¿›åˆ¶æ•°</h4><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1664004706705-30a7e481-a113-42af-8900-834be9229c7a.png" alt="img"></p><p>æ³¨ï¼š1.ï¼ˆ-xï¼‰&#x3D;(~x+1)</p><p>â€‹ \2. x&amp;-x&#x3D; 10; (äºŒè¿›åˆ¶)_</p><h4 id="lowbit-æ“ä½œ"><a href="#lowbit-æ“ä½œ" class="headerlink" title="lowbit æ“ä½œ"></a>lowbit æ“ä½œ</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit_x</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &amp;(-x);  <span class="comment">// -x=(~x+1)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é™¤æ³•"><a href="#é™¤æ³•" class="headerlink" title="é™¤æ³•"></a>é™¤æ³•</h4><p>å°† x å·¦ç§»ä¸€ä½å®ç° Ã— 2 ï¼Œå°† x xx å³ç§»ä¸€ä½å®ç° Ã· 2</p><p>a &lt; &lt; 1 â‰¡ a âˆ— 2 a</p><p>a &gt; &gt; 1 â‰¡ a &#x2F; 2 a</p><h4 id="äº¤æ¢æ•´æ•°"><a href="#äº¤æ¢æ•´æ•°" class="headerlink" title="äº¤æ¢æ•´æ•°"></a>äº¤æ¢æ•´æ•°</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span> &amp;a,<span class="type">int</span> &amp;b)</span></span>&#123;</span><br><span class="line">     a ^= b;</span><br><span class="line">     b ^= a;</span><br><span class="line">     a ^= b;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h4 id="å¥‡å¶æ•°"><a href="#å¥‡å¶æ•°" class="headerlink" title="å¥‡å¶æ•°"></a>å¥‡å¶æ•°</h4><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨äºŒè¿›åˆ¶ä¸­ï¼Œæœ€ä½ä½å†³å®šäº†æ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æå–å‡ºæœ€ä½ä½çš„å€¼ï¼Œå³ä¸ 1 ç›¸ä¸å³å¯å®ç°ç›®çš„ï¼Œä¸º 0 åˆ™æ˜¯å¶æ•°ï¼Œä¸º 1 åˆ™æ˜¯å¥‡æ•°ã€‚</p><h4 id="ç»å¯¹å€¼"><a href="#ç»å¯¹å€¼" class="headerlink" title="ç»å¯¹å€¼"></a>ç»å¯¹å€¼</h4><p>å¯¹äºæ­£æ•°è€Œè¨€ï¼Œè¡¥ç å°±æ˜¯åŸç ï¼Œæ‰€ä»¥æŒ‰ä½å–åå†+ 1 +1+1 åˆ™å¾—åˆ°å¯¹åº”çœŸå€¼è´Ÿæ•°çš„è¡¥ç ï¼Œè€Œå¯¹äºè´Ÿæ•°ï¼Œå…¶è¡¥ç è¿›è¡ŒæŒ‰ä½å–åå†+ 1 +1+1 åˆ™å¾—åˆ°å¯¹åº”çœŸå€¼æ­£æ•°çš„è¡¥ç ï¼Œå˜ä¸ºåŸç ã€‚é‚£ä¹ˆçŸ¥é“è¿™ä¸ªæˆ‘ä»¬å°±å¯ä»¥ç‰¹åˆ¤æ˜¯å¦ä¸ºè´Ÿæ•°&#x3D;&#x3D;ï¼ˆè¿™é‡Œé€šè¿‡å³ç§» 31 3131 ä½ï¼Œè‹¥ä¸ºæ­£æ•°ï¼Œåˆ™å¾—åˆ°çš„æ˜¯ 0 00ï¼Œè‹¥ä¸ºè´Ÿæ•°ï¼Œåˆ™å¾—åˆ°çš„æ˜¯ âˆ’ 1 -1âˆ’1ï¼Œè€Œ 0 00 çš„è¡¥ç ä¸º 0000 00000000,âˆ’ 1 -1âˆ’1 çš„è¡¥ç ä¸º 1111 11111111ï¼Œæ ¹æ®å¼‚æˆ–æ€§è´¨å³å¯åˆ¤æ–­ã€‚ï¼‰&#x3D;&#x3D; å†è¿›è¡Œåè½¬å³å¯å®ç°æ±‚ç»å¯¹å€¼äº†ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">abs</span><span class="params">(<span class="type">int</span> a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a ^ (a &gt;&gt; <span class="number">31</span>) ? a : ~ a + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½è¿ç®—å®ç°å¯¹-p-å–ä½™ï¼ˆp-ä¸º-2-k"><a href="#ä½è¿ç®—å®ç°å¯¹-p-å–ä½™ï¼ˆp-ä¸º-2-k" class="headerlink" title="ä½è¿ç®—å®ç°å¯¹ p å–ä½™ï¼ˆp ä¸º 2^k)"></a>ä½è¿ç®—å®ç°å¯¹ p å–ä½™ï¼ˆp ä¸º 2^k)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">mod</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &amp; (p - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/hzf0701/article/details/117359478"></a></p><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="1-ç»Ÿè®¡-1-çš„ä¸ªæ•°"><a href="#1-ç»Ÿè®¡-1-çš„ä¸ªæ•°" class="headerlink" title="1.ç»Ÿè®¡ 1 çš„ä¸ªæ•°"></a>1.ç»Ÿè®¡ 1 çš„ä¸ªæ•°</h4><p>â€‹ ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°åˆ—ï¼Œè¯·ä½ æ±‚å‡ºæ•°åˆ—ä¸­æ¯ä¸ªæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ 1 çš„ä¸ªæ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &amp; -x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span> (n--)&#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        cin &gt;&gt; x;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x) x-=<span class="built_in">lowbit</span>(x),res++;</span><br><span class="line">        cout &lt;&lt; res &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€è·¯ï¼š 1. x ä¸è‡ªèº«-x æ±‚&amp; å¾—åˆ°æœ€åä½ 1 å¼€å§‹ä¹‹åçš„å€¼ å¦‚ 10000100101000 å¾—åˆ° 1000</p><p>2.x å‡å» 1000 å°±æ¶ˆå»ä¸€ä¸ª 1 ç›´åˆ° x ä¸º 0</p><p>è§£æ³•äºŒï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">count</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123;</span><br><span class="line">        x = x &amp; (x - <span class="number">1</span>);  <span class="comment">//æ¶ˆå»åé¢1</span></span><br><span class="line">        cnt ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-O-1-æ—¶é—´æ£€æµ‹-2-çš„å¹‚æ¬¡"><a href="#2-O-1-æ—¶é—´æ£€æµ‹-2-çš„å¹‚æ¬¡" class="headerlink" title="2.O(1)æ—¶é—´æ£€æµ‹ 2 çš„å¹‚æ¬¡"></a>2.O(1)æ—¶é—´æ£€æµ‹ 2 çš„å¹‚æ¬¡</h4><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ 2^k æ˜¯å¤§äº 0 çš„ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ¤ï¼ŒåŒç†ï¼Œ2^k</p><p>çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åªæœ‰ 1 ä¸ª 1ï¼Œæ•…æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ x &amp; ( x âˆ’ 1 )æ¥æ¶ˆé™¤å”¯ä¸€çš„ 1 åˆ¤æ–­æ˜¯å¦ç­‰äº 0 00 å³å¯ã€‚</p><p><a href="https://blog.csdn.net/hzf0701/article/details/117359478"></a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkPowerOf2</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write your code here</span></span><br><span class="line">        <span class="keyword">return</span> n &gt; <span class="number">0</span> &amp;&amp; (n &amp; (n - <span class="number">1</span>)) == <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// return n &gt; 0 &amp;&amp; (n-=lowbit(n))==0ï¼›</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="3-æ•°ç»„ä¸­å¥‡æ•°ä¸ªæ•°çš„æ•°"><a href="#3-æ•°ç»„ä¸­å¥‡æ•°ä¸ªæ•°çš„æ•°" class="headerlink" title="3.æ•°ç»„ä¸­å¥‡æ•°ä¸ªæ•°çš„æ•°"></a>3.æ•°ç»„ä¸­å¥‡æ•°ä¸ªæ•°çš„æ•°</h4><ol><li>äº¤æ¢å¾‹ï¼ša ^ b ^ c &lt;&#x3D;&gt; a ^ c ^ b</li><li>ä»»ä½•æ•°äº 0 å¼‚æˆ–ä¸ºä»»ä½•æ•° 0 ^ n &#x3D;&gt; n</li><li>ç›¸åŒçš„æ•°å¼‚æˆ–ä¸º 0: n ^ n &#x3D;&gt; 0</li></ol><p>var a &#x3D; [2,3,2,4,4]</p><p>2 ^ 3 ^ 2 ^ 4 ^ 4 ç­‰ä»·äº 2 ^ 2 ^ 4 ^ 4 ^ 3 &#x3D;&gt; 0 ^ 0 ^3 &#x3D;&gt; 3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(auto c:nums)</span><br><span class="line">      ret ^= c;</span><br></pre></td></tr></table></figure><h2 id="ç¦»æ•£åŒ–"><a href="#ç¦»æ•£åŒ–" class="headerlink" title="ç¦»æ•£åŒ–"></a>ç¦»æ•£åŒ–</h2><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1664022823816-14b37fcb-2242-4920-935a-0a64ab4d70af.png" alt="img"></p><h2 id="å‰ç¼€å’Œ"><a href="#å‰ç¼€å’Œ" class="headerlink" title="å‰ç¼€å’Œ"></a>å‰ç¼€å’Œ</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1666505225091-759d3130-754b-4679-b6f1-69181df2b322.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">productExceptSelf</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n=nums.<span class="built_in">size</span>();</span><br><span class="line">        vector &lt;<span class="type">int</span>&gt; <span class="built_in">l</span>(n,<span class="number">1</span>),<span class="built_in">r</span>(n,<span class="number">1</span>);</span><br><span class="line">        vector &lt;<span class="type">int</span>&gt; <span class="built_in">res</span>(n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ;i &lt; n <span class="number">-1</span>;i++)</span><br><span class="line">            l[i+<span class="number">1</span>] = nums[i] * l[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n - <span class="number">1</span> ;i &gt;= <span class="number">1</span>;i--)</span><br><span class="line">            r[i<span class="number">-1</span>] = nums[i] * r[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>; i&lt;n;i++)</span><br><span class="line">            res[i] = l[i] * r[i];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„å­ä¸²"><a href="#æ•°ç»„å­ä¸²" class="headerlink" title="æ•°ç»„å­ä¸²"></a>æ•°ç»„å­ä¸²</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1666870070826-b7cec613-da07-48dc-ae71-727d6c38269c.png" alt="img"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">subarraySum</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    unordered_map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; mp;</span><br><span class="line">    mp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>,pre=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> x : nums)</span><br><span class="line">        &#123;</span><br><span class="line">            pre+=x;</span><br><span class="line">            <span class="keyword">if</span>(mp.<span class="built_in">count</span>(pre - k))&#123;</span><br><span class="line">                res +=mp[pre - k];</span><br><span class="line">            &#125;</span><br><span class="line">            mp[pre]++;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1666870117234-f0d369e6-482a-4070-bdbb-0e9c138e55c3.png" alt="img"></p><h2 id="é«˜ç²¾åº¦"><a href="#é«˜ç²¾åº¦" class="headerlink" title="é«˜ç²¾åº¦"></a>é«˜ç²¾åº¦</h2><h3 id="åŠ æ³•"><a href="#åŠ æ³•" class="headerlink" title="åŠ æ³•"></a>åŠ æ³•</h3><p><img src="/img/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95.assets/1666871125636-91fb6e1f-b635-4def-aebb-bfb3b0dfebac.png" alt="img"></p><h4 id="string-ç‰ˆ"><a href="#string-ç‰ˆ" class="headerlink" title="string ç‰ˆ"></a>string ç‰ˆ</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">addStrings</span><span class="params">(string num1, string num2)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i = num1.<span class="built_in">length</span>() - <span class="number">1</span>,j = num2.<span class="built_in">length</span>() - <span class="number">1</span>,add = <span class="number">0</span>;</span><br><span class="line">        string res=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &gt;= <span class="number">0</span> || j &gt;=<span class="number">0</span> || add != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> x = i &gt;=<span class="number">0</span> ? num1[i] - <span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> y = j &gt;=<span class="number">0</span> ? num2[j] - <span class="string">&#x27;0&#x27;</span> : <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> z = x + y + add;</span><br><span class="line">            res.<span class="built_in">push_back</span>(<span class="string">&#x27;0&#x27;</span> + z % <span class="number">10</span>);</span><br><span class="line">            add = z / <span class="number">10</span>;</span><br><span class="line">            i--;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">reverse</span>(res.<span class="built_in">begin</span>(), res.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="vector-ç‰ˆ"><a href="#vector-ç‰ˆ" class="headerlink" title="vector ç‰ˆ"></a>vector ç‰ˆ</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">add</span><span class="params">(vector &lt;<span class="type">int</span>&gt;&amp;A,vector &lt;<span class="type">int</span>&gt; &amp;B)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line">    <span class="type">int</span> t=<span class="number">0</span>;  <span class="comment">//è¿›ä½</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; A.<span class="built_in">size</span>() || i &lt; B.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;A.<span class="built_in">size</span>())  t+=A[i];</span><br><span class="line">        <span class="keyword">if</span>(i&lt;B.<span class="built_in">size</span>())  t+=B[i];</span><br><span class="line">        C.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(t&gt;<span class="number">0</span>)  C.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é¢„å¤„ç†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = a.<span class="built_in">size</span>() <span class="number">-1</span>; i&gt;=<span class="number">0</span>; i--)  A.<span class="built_in">push_back</span>(a[i]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = b.<span class="built_in">size</span>() <span class="number">-1</span>; i&gt;=<span class="number">0</span>; i--)  B.<span class="built_in">push_back</span>(b[i]-<span class="string">&#x27;0&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">addTwoNumbers</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class="line">        ListNode *head=<span class="literal">nullptr</span>, *tail=<span class="literal">nullptr</span>;</span><br><span class="line">        <span class="type">int</span> carry=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (l1||l2)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> n1 = l1 ? l1-&gt;val : <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> n2 = l2 ? l2-&gt;val : <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> sum=n1+n2+carry;</span><br><span class="line">            <span class="keyword">if</span> (!head)</span><br><span class="line">            &#123;</span><br><span class="line">                head =tail= <span class="keyword">new</span> <span class="built_in">ListNode</span>(sum % <span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                tail-&gt;next = <span class="keyword">new</span> <span class="built_in">ListNode</span>(sum % <span class="number">10</span>);</span><br><span class="line">                tail = tail-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            carry = sum / <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">if</span>(l1)</span><br><span class="line">                l1=l1-&gt;next;</span><br><span class="line">            <span class="keyword">if</span>(l2)</span><br><span class="line">                l2=l2-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (carry&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            tail-&gt;next= <span class="keyword">new</span> <span class="built_in">ListNode</span>(carry);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ä¹˜æ³•"><a href="#ä¹˜æ³•" class="headerlink" title="ä¹˜æ³•"></a>ä¹˜æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; <span class="title function_">mul</span><span class="params">(vector &lt;<span class="type">int</span>&gt;&amp;A,<span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line">    <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; A.size() || t; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(i &lt; A.size())  t += A[i] * b;</span><br><span class="line">        C.push_back(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(C.size() &gt; <span class="number">1</span> &amp;&amp; C.back() == <span class="number">0</span>)  C.pop_back();  <span class="comment">//å‰å¯¼é›¶</span></span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STLå¸¸è§api</title>
      <link href="//post/%E7%AE%97%E6%B3%95/STL%E5%B8%B8%E8%A7%81api.html"/>
      <url>//post/%E7%AE%97%E6%B3%95/STL%E5%B8%B8%E8%A7%81api.html</url>
      
        <content type="html"><![CDATA[<h2 id="https-oi-wiki-org-lang-csl-algorithm"><a href="#https-oi-wiki-org-lang-csl-algorithm" class="headerlink" title="https://oi-wiki.org/lang/csl/algorithm/"></a><a href="https://oi-wiki.org/lang/csl/algorithm/">https://oi-wiki.org/lang/csl/algorithm/</a></h2><h2 id="æœ€å¤§å€¼-max-element-å’Œ-æœ€å°å€¼-min-element"><a href="#æœ€å¤§å€¼-max-element-å’Œ-æœ€å°å€¼-min-element" class="headerlink" title="æœ€å¤§å€¼ max_element å’Œ æœ€å°å€¼ min_element"></a>æœ€å¤§å€¼ max_element å’Œ æœ€å°å€¼ min_element</h2><h3 id="æ•°ç»„ç”¨æ³•"><a href="#æ•°ç»„ç”¨æ³•" class="headerlink" title="æ•°ç»„ç”¨æ³•"></a>æ•°ç»„ç”¨æ³•</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Ballons</span>&#123;</span><br><span class="line"><span class="type">int</span> cnt;</span><br><span class="line">string s;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a[] = &#123;<span class="number">3</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">sizeof</span>(a) / <span class="built_in">sizeof</span>(<span class="type">int</span>);</span><br><span class="line">    <span class="comment">//*ä¸ºè·å–åœ°å€å†…å­˜ç©ºé—´çš„å…ƒç´ </span></span><br><span class="line">    cout &lt;&lt; *<span class="built_in">max_element</span>(a, a + len) &lt;&lt; endl;<span class="comment">//8//è¾“å‡ºæœ€å¤§å…ƒç´ </span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">max_element</span>(a, a + len) &lt;&lt; endl;<span class="comment">//è¾“å‡ºçš„ä¸ºæœ€å¤§å€¼çš„åœ°å€å€¼</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">max_element</span>(a, a + len) - a &lt;&lt; endl;<span class="comment">//2 //æœ€å¤§å…ƒç´ çš„ä¸‹æ ‡</span></span><br><span class="line">    cout &lt;&lt; *<span class="built_in">min_element</span>(a, a + len) &lt;&lt; endl;<span class="comment">//2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="number">7</span>); v.<span class="built_in">push_back</span>(<span class="number">4</span>);</span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="number">2</span>); v.<span class="built_in">push_back</span>(<span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; *<span class="built_in">max_element</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>()) &lt;&lt; endl;<span class="comment">//9</span></span><br><span class="line">cout &lt;&lt; *<span class="built_in">min_element</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>()) &lt;&lt; endl;<span class="comment">//2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h2><h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><h4 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span>(intervals.<span class="built_in">begin</span>(), intervals.<span class="built_in">end</span>(),</span><br><span class="line">    [](<span class="type">const</span> <span class="keyword">auto</span>&amp; u, <span class="type">const</span> <span class="keyword">auto</span>&amp; v) &#123;</span><br><span class="line">            <span class="keyword">return</span> u[<span class="number">0</span>] &lt; v[<span class="number">0</span>];</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><h4 id="for-each"><a href="#for-each" class="headerlink" title="for_each"></a>for_each</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for_eachåº”ç”¨å®ä¾‹</span></span><br><span class="line"><span class="type">int</span> a[<span class="number">4</span>] = &#123;<span class="number">11</span>, <span class="number">2</span>, <span class="number">33</span>, <span class="number">4</span>&#125;;</span><br><span class="line"><span class="built_in">sort</span>(a, a+<span class="number">4</span>, [=](<span class="type">int</span> x, <span class="type">int</span> y) -&gt; <span class="type">bool</span> &#123; <span class="keyword">return</span> x%<span class="number">10</span> &lt; y%<span class="number">10</span>; &#125; );</span><br><span class="line">for_each(a, a+<span class="number">4</span>, [=](<span class="type">int</span> x) &#123; cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;&#125; );</span><br></pre></td></tr></table></figure><h4 id="find-if"><a href="#find-if" class="headerlink" title="find_if"></a>find_if</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find_ifåº”ç”¨å®ä¾‹</span></span><br><span class="line"><span class="type">int</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> y = <span class="number">10</span>;</span><br><span class="line">deque&lt;<span class="type">int</span>&gt; coll = &#123; <span class="number">1</span>, <span class="number">3</span>, <span class="number">19</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">17</span> &#125;;</span><br><span class="line"><span class="keyword">auto</span> pos = <span class="built_in">find_if</span>(coll.<span class="built_in">cbegin</span>(), coll.<span class="built_in">cend</span>(), [=](<span class="type">int</span> i) &#123;</span><br><span class="line">    <span class="keyword">return</span> i &gt; x &amp;&amp; i &lt; y;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="remove-if"><a href="#remove-if" class="headerlink" title="remove_if"></a>remove_if</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// remove_ifåº”ç”¨å®ä¾‹</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; vec_data = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line"><span class="type">int</span> x = <span class="number">5</span>;</span><br><span class="line">vec_data.<span class="built_in">erase</span>(std::<span class="built_in">remove_if</span>(vec.date.<span class="built_in">begin</span>(), vec_data.<span class="built_in">end</span>(),</span><br><span class="line">    [](<span class="type">int</span> i) &#123; <span class="keyword">return</span> n &lt; x;&#125;), vec_data.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">std::for_each(vec.date.<span class="built_in">begin</span>(), vec_data.<span class="built_in">end</span>(), [](<span class="type">int</span> i) &#123;</span><br><span class="line">    std::cout &lt;&lt; i &lt;&lt; std::endl;&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="lower-bound-upper-bound"><a href="#lower-bound-upper-bound" class="headerlink" title="lower_bound upper_bound"></a>lower_bound upper_bound</h2><ul><li>lower_bound( begin,end,num)ï¼šä»æ•°ç»„çš„ begin ä½ç½®åˆ° end-1 ä½ç½®äºŒåˆ†æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº num çš„æ•°å­—ï¼Œæ‰¾åˆ°è¿”å›è¯¥æ•°å­—çš„åœ°å€ï¼Œä¸å­˜åœ¨åˆ™è¿”å› endã€‚é€šè¿‡è¿”å›çš„åœ°å€å‡å»èµ·å§‹åœ°å€ begin,å¾—åˆ°æ‰¾åˆ°æ•°å­—åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ã€‚</li><li>upper_bound( begin,end,num)ï¼šä»æ•°ç»„çš„ begin ä½ç½®åˆ° end-1 ä½ç½®äºŒåˆ†æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äº num çš„æ•°å­—ï¼Œæ‰¾åˆ°è¿”å›è¯¥æ•°å­—çš„åœ°å€ï¼Œä¸å­˜åœ¨åˆ™è¿”å› endã€‚é€šè¿‡è¿”å›çš„åœ°å€å‡å»èµ·å§‹åœ°å€ begin,å¾—åˆ°æ‰¾åˆ°æ•°å­—åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">2</span>*<span class="built_in">int</span>(<span class="number">1e9</span>)+<span class="number">10</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cmd</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a&gt;b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> num[<span class="number">6</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">34</span>&#125;;</span><br><span class="line">    <span class="built_in">sort</span>(num,num+<span class="number">6</span>);                           <span class="comment">//æŒ‰ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">    <span class="type">int</span> pos1=<span class="built_in">lower_bound</span>(num,num+<span class="number">6</span>,<span class="number">7</span>)-num;    <span class="comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äºè¢«æŸ¥æ•°çš„å€¼</span></span><br><span class="line">    <span class="type">int</span> pos2=<span class="built_in">upper_bound</span>(num,num+<span class="number">6</span>,<span class="number">7</span>)-num;    <span class="comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå¤§äºè¢«æŸ¥æ•°çš„å€¼</span></span><br><span class="line">    cout&lt;&lt;pos1&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;num[pos1]&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;pos2&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;num[pos2]&lt;&lt;endl;</span><br><span class="line">    <span class="built_in">sort</span>(num,num+<span class="number">6</span>,cmd);                      <span class="comment">//æŒ‰ä»å¤§åˆ°å°æ’åº</span></span><br><span class="line">    <span class="type">int</span> pos3=<span class="built_in">lower_bound</span>(num,num+<span class="number">6</span>,<span class="number">7</span>,<span class="built_in">greater</span>&lt;<span class="type">int</span>&gt;())-num;  <span class="comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå°äºæˆ–ç­‰äºè¢«æŸ¥æ•°çš„å€¼</span></span><br><span class="line">    <span class="type">int</span> pos4=<span class="built_in">upper_bound</span>(num,num+<span class="number">6</span>,<span class="number">7</span>,<span class="built_in">greater</span>&lt;<span class="type">int</span>&gt;())-num;  <span class="comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå°äºè¢«æŸ¥æ•°çš„å€¼</span></span><br><span class="line">    cout&lt;&lt;pos3&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;num[pos3]&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;pos4&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;num[pos4]&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="number">7</span></span><br><span class="line"><span class="number">4</span> <span class="number">15</span></span><br><span class="line"><span class="number">2</span> <span class="number">7</span></span><br><span class="line"><span class="number">3</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><h2 id="priority-queueï¼ˆtop-pop-push"><a href="#priority-queueï¼ˆtop-pop-push" class="headerlink" title="priority_queueï¼ˆtop,pop, push)"></a>priority_queueï¼ˆtop,pop, push)</h2><ol><li>å®šä¹‰ï¼špriority_queue&lt;Type, Container, Functional&gt; ï¼Œpriority_queue å±äºæ˜¯å®¹å™¨é€‚é…å™¨ï¼Œéœ€è¦æŒ‡å®šåº•å±‚çš„å®¹å™¨ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå‚æ•° Type æ˜¯ queue é‡Œé¢å­˜çš„æ•°æ®çš„ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•° Container æ˜¯è¦ä½¿ç”¨çš„åº•å±‚å®¹å™¨(ä¸€èˆ¬æ˜¯ vector)ï¼ŒFunctional å°±æ˜¯æ¯”è¾ƒçš„æ–¹å¼ï¼ˆå‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯æ¯”è¾ƒæ–¹å¼çš„ç±»å‹ï¼‰.</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡åºé˜Ÿåˆ—</span></span><br><span class="line">priority_queue &lt;<span class="type">int</span>,vector&lt;<span class="type">int</span>&gt;,greater&lt;<span class="type">int</span>&gt; &gt; q; <span class="comment">// 1 2 3 4 5</span></span><br><span class="line"><span class="comment">//é™åºé˜Ÿåˆ—</span></span><br><span class="line">priority_queue &lt;<span class="type">int</span>,vector&lt;<span class="type">int</span>&gt;,less&lt;<span class="type">int</span>&gt; &gt;q; <span class="comment">// 5 4 3 2 1 å¯¹å¤´æœ€å¤§</span></span><br><span class="line">priority_queue &lt;<span class="type">int</span>&gt; q</span><br><span class="line"><span class="comment">//greaterå’Œlessæ˜¯stdå®ç°çš„ä¸¤ä¸ªä»¿å‡½æ•°ï¼ˆå°±æ˜¯ä½¿ä¸€ä¸ªç±»çš„ä½¿ç”¨çœ‹ä¸Šå»åƒä¸€ä¸ªå‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">//å…¶å®ç°å°±æ˜¯ç±»ä¸­å®ç°ä¸€ä¸ªoperator()ï¼Œè¿™ä¸ªç±»å°±æœ‰äº†ç±»ä¼¼å‡½æ•°çš„è¡Œä¸ºï¼Œå°±æ˜¯ä¸€ä¸ªä»¿å‡½æ•°ç±»äº†ï¼‰</span></span><br></pre></td></tr></table></figure><ol><li>lambda</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> cmp = [](pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; left, pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; right) -&gt;</span><br><span class="line"><span class="type">bool</span> &#123; <span class="keyword">return</span> left.second &gt; right.second; &#125;;</span><br><span class="line"></span><br><span class="line">priority_queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;, vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;, <span class="keyword">decltype</span>(cmp)&gt;  <span class="built_in">pri_que</span>(cmp);</span><br></pre></td></tr></table></figure><ol><li>ä»¿å‡½æ•°</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">mycomparison</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&amp; left, <span class="type">const</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&amp; right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left.second &gt; right.second;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">priority_queue&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;,vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;,mycomparison&gt; pri_que2;</span><br></pre></td></tr></table></figure><ol><li>ç»“æ„ä½“</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">tmp1</span> <span class="comment">//è¿ç®—ç¬¦é‡è½½&lt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">tmp1</span>(<span class="type">int</span> a) &#123;x = a;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> tmp1&amp; a) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> x &lt; a.x; <span class="comment">//å¤§é¡¶å †</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">priority_queue&lt;tmp1&gt; pri_que3;</span><br></pre></td></tr></table></figure><h2 id="vector-PII"><a href="#vector-PII" class="headerlink" title="vector PII"></a>vector PII</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;PII&gt; res;</span><br><span class="line">res.<span class="built_in">push_back</span>(&#123;<span class="number">1</span>, <span class="number">2</span>&#125;);</span><br><span class="line">res.<span class="built_in">push_back</span>(&#123;<span class="number">3</span>, <span class="number">4</span>&#125;);</span><br><span class="line">res.<span class="built_in">push_back</span>(&#123;<span class="number">5</span>, <span class="number">6</span>&#125;);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> [a, b] : res)</span><br><span class="line">    cout &lt;&lt; a &lt;&lt; b;</span><br></pre></td></tr></table></figure><h2 id="next-permutation"><a href="#next-permutation" class="headerlink" title="next_permutation"></a>next_permutation</h2><ul><li><a href="https://blog.csdn.net/qian2213762498/article/details/79683905?ops_request_misc=%7B%22request_id%22:%22167879237516800215085758%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=167879237516800215085758&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-79683905-null-null.142%5Ev73%5Ewechat_v2,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&utm_term=next_permutation&spm=1018.2226.3001.4187">https://blog.csdn.net/qian2213762498/article/details/79683905?ops_request_misc&#x3D;%257B%2522request%255Fid%2522%253A%2522167879237516800215085758%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id&#x3D;167879237516800215085758&amp;biz_id&#x3D;0&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>all</del>top_positive~default-1-79683905-null-null.142^v73^wechat_v2,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term&#x3D;next_permutation&amp;spm&#x3D;1018.2226.3001.4187</a></li></ul><ol><li>æ•°å­— 1 ~ n</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="built_in">sort</span>(a,a+<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;a[0]&lt;&lt;&quot; &quot;&lt;&lt;a[1]&lt;&lt;&quot; &quot;&lt;&lt;a[2]&lt;&lt;&quot; &quot;&lt;&lt;a[3]&lt;&lt;endl;</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">            cout&lt;&lt;a[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">    &#125;<span class="keyword">while</span>(<span class="built_in">next_permutation</span>(a,a+<span class="number">4</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å­—ç¬¦ä¸² æŒ‰å­—å…¸åºå…¨æ’åˆ—</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">string str;</span><br><span class="line">cin&gt;&gt;str;</span><br><span class="line"><span class="built_in">sort</span>(str.<span class="built_in">begin</span>(),str.<span class="built_in">end</span>());</span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">cout&lt;&lt;str&lt;&lt;endl;</span><br><span class="line">&#125;<span class="keyword">while</span>(<span class="built_in">next_permutation</span>(str.<span class="built_in">begin</span>(),str.<span class="built_in">end</span>()));</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>èƒ½å¦ç›´æ¥ç®—å‡ºé›†åˆ{1, 2, â€¦, m}çš„ç¬¬ n ä¸ªæ’åˆ—ï¼Ÿ</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> a[<span class="number">7</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="built_in">sort</span>(a,a+<span class="number">7</span>);</span><br><span class="line"><span class="type">int</span> n=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(n==<span class="number">1654</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">7</span>;i++)</span><br><span class="line">              cout&lt;&lt;a[i];</span><br><span class="line">            cout&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">        n++;</span><br><span class="line">    &#125;<span class="keyword">while</span>(<span class="built_in">next_permutation</span>(a,a+<span class="number">7</span>));</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> ç®—æ³• </tag>
            
            <tag> STLå¸¸è§api </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springcloudå…¥é—¨</title>
      <link href="//post/springcloud/1springcloud%E5%85%A5%E9%97%A8.html"/>
      <url>//post/springcloud/1springcloud%E5%85%A5%E9%97%A8.html</url>
      
        <content type="html"><![CDATA[<h1 id="https-spring-io-projects-spring-cloud"><a href="#https-spring-io-projects-spring-cloud" class="headerlink" title="https://spring.io/projects/spring-cloud"></a><a href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></h1><h1 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><img src="/img/springcloud/1.assets/1684856284493-75dd5c9d-3275-4782-97bc-c74a9b0ae5ba.png" alt="img"><br><img src="/img/springcloud/1.assets/1684856317857-3e855c1d-ea08-4d84-a275-84e9f8b9a904.png" alt="img"><br><img src="/img/springcloud/1.assets/1684856738531-8b127fe8-dde1-43b2-8e41-89288b84cba0.png" alt="img"></p><h2 id="ç‰ˆæœ¬è¯´æ˜"><a href="#ç‰ˆæœ¬è¯´æ˜" class="headerlink" title="ç‰ˆæœ¬è¯´æ˜"></a>ç‰ˆæœ¬è¯´æ˜</h2><p><img src="/img/springcloud/1.assets/1684857152569-93151536-7d7e-4ef4-a385-876b4359f912.png" alt="img"></p><ul><li>ä½¿ç”¨ H ç‰ˆ</li></ul><p><img src="/img/springcloud/1.assets/1684857226403-f8007362-f779-40c4-8ec5-206970cb234d.png" alt="img"></p><ul><li>æœ€ç»ˆç‰ˆæœ¬</li></ul><p><img src="/img/springcloud/1.assets/1684857374912-f96e807e-183e-4084-8e02-d22dd5cdd59d.png" alt="img"></p><h2 id="å…³äº-Cloud-çš„ç»„ä»¶åœæ›´-å‡çº§-æ›¿æ¢"><a href="#å…³äº-Cloud-çš„ç»„ä»¶åœæ›´-å‡çº§-æ›¿æ¢" class="headerlink" title="&#x3D;&#x3D;å…³äº Cloud çš„ç»„ä»¶åœæ›´&#x2F;å‡çº§&#x2F;æ›¿æ¢&#x3D;&#x3D;"></a>&#x3D;&#x3D;å…³äº Cloud çš„ç»„ä»¶åœæ›´&#x2F;å‡çº§&#x2F;æ›¿æ¢&#x3D;&#x3D;</h2><p><img src="/img/springcloud/1.assets/1684857931977-e8e56ad7-8c7c-46a1-a485-0fba7cc76222.png" alt="img"></p><ul><li>Eureka ä¸å­¦</li><li>&#x3D;&#x3D;é‡ç‚¹ nacos&#x3D;&#x3D;</li></ul><h2 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h2><p><img src="/img/springcloud/1.assets/image-20230731175013428.png" alt="image-20230731175013428"></p><h1 id="å·¥ç¨‹æ­å»º"><a href="#å·¥ç¨‹æ­å»º" class="headerlink" title="å·¥ç¨‹æ­å»º"></a>å·¥ç¨‹æ­å»º</h1><p><img src="/img/springcloud/1.assets/1684859561816-780c3bd6-62f0-49b6-b088-f081f0cc0b0b.png" alt="img"></p><h2 id="çˆ¶å·¥ç¨‹"><a href="#çˆ¶å·¥ç¨‹" class="headerlink" title="çˆ¶å·¥ç¨‹"></a>çˆ¶å·¥ç¨‹</h2><p><img src="/img/springcloud/1.assets/1684858570646-5352a9f5-be75-4f89-9de8-062a7b98b0e6.png" alt="img"><img src="/img/springcloud/1.assets/1684858606616-02d5f017-1e96-4ffa-844e-66fd90d1135e.png" alt="img"></p><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><p><img src="/img/springcloud/1.assets/1684858708500-5a661aa2-1f35-40c9-a0e4-89ce0e0a6c65.png" alt="img"></p><p><img src="/img/springcloud/1.assets/1684858923063-f9238051-21df-4024-84a0-944fa320726f.png" alt="img"></p><h3 id="2-å­—ç¬¦ç¼–ç "><a href="#2-å­—ç¬¦ç¼–ç " class="headerlink" title="2.å­—ç¬¦ç¼–ç "></a>2.å­—ç¬¦ç¼–ç </h3><p><img src="/img/springcloud/1.assets/1684859261849-57976339-f6eb-4770-8431-1f682e240058.png" alt="img"></p><h3 id="3-æ³¨è§£"><a href="#3-æ³¨è§£" class="headerlink" title="3.æ³¨è§£"></a>3.æ³¨è§£</h3><p><img src="/img/springcloud/1.assets/1684859387855-60424bca-1d28-4ca0-a5a8-c5e85265087b.png" alt="img"></p><h3 id="4-ç¼–è¯‘ç‰ˆæœ¬"><a href="#4-ç¼–è¯‘ç‰ˆæœ¬" class="headerlink" title="4.ç¼–è¯‘ç‰ˆæœ¬"></a>4.ç¼–è¯‘ç‰ˆæœ¬</h3><p><img src="/img/springcloud/1.assets/1684859434043-e218fe01-33d9-43e3-8cc3-1324a5924a41.png" alt="img"></p><h3 id="5-æ–‡ä»¶è¿‡æ»¤"><a href="#5-æ–‡ä»¶è¿‡æ»¤" class="headerlink" title="5.æ–‡ä»¶è¿‡æ»¤"></a>5.æ–‡ä»¶è¿‡æ»¤</h3><p><img src="/img/springcloud/1.assets/1684859676050-7083aa14-4e83-4773-b35f-db3a3809a6d3.png" alt="img"></p><h2 id="çˆ¶å·¥ç¨‹-pom-æ–‡ä»¶"><a href="#çˆ¶å·¥ç¨‹-pom-æ–‡ä»¶" class="headerlink" title="çˆ¶å·¥ç¨‹ pom æ–‡ä»¶"></a>çˆ¶å·¥ç¨‹ pom æ–‡ä»¶</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--ç»Ÿä¸€ç®¡ç†jaråŒ…å’Œç‰ˆæœ¬--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.31<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.verison</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">druid.verison</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.spring.boot.verison</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">mybatis.spring.boot.verison</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--spring boot 2.2.2--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- MySql --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Druid --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.verison&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- mybatis-springbootæ•´åˆ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.spring.boot.verison&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- log4j --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    (dependencyManagementæ˜¯åœ¨çˆ¶ç±»å®šå¥½ç‰ˆæœ¬ï¼Œè‹¥å­é¡¹ç›®ä¸­æ²¡æœ‰æŒ‡å®šï¼Œå°±ä¼šä»¥çˆ¶é¡¹ç›®ä¸­çš„ä¸ºå‡†)(ä½†æ˜¯dependencyçš„ä¼˜å…ˆçº§é«˜äºdependencyManagementï¼Œè‹¥è¿˜ä»¥dependencyæŒ‡å®šäº†ï¼Œå°±ä»¥dependencyçš„ä¸ºå‡†)(depencyManagementä¸€èˆ¬ç”¨äºçˆ¶POM))(è¿™é‡Œåªæ˜¯å£°æ˜ä¾èµ–ï¼Œå¹¶ä¸å¼•å…¥ä¾èµ–ï¼Œå­é¡¹ç›®éœ€è¦æ˜¾ç¤ºçš„å£°æ˜)--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Manager"><a href="#Manager" class="headerlink" title="Manager"></a>Manager</h2><ul><li>çˆ¶é¡¹ç›®æŒ‡å®šç‰ˆæœ¬</li><li>å­ç±»é¡¹ç›®æ ¹æ®çˆ¶ç±»ç‰ˆæœ¬</li></ul><p><img src="/img/springcloud/1.assets/1684895789534-e6733a2e-f819-48e9-9ddc-368d93d62207.png" alt="img"></p><p><img src="/img/springcloud/1.assets/1684895871738-331ef224-609f-4fd6-a4d1-ebd3e3de6663.png" alt="img"></p><p><img src="/img/springcloud/1.assets/1684895946320-a1255acb-9202-47d0-ada7-8b8724a1b4cb.png" alt="img"></p><h1 id="æ”¯ä»˜æ¨¡å—"><a href="#æ”¯ä»˜æ¨¡å—" class="headerlink" title="æ”¯ä»˜æ¨¡å—"></a>æ”¯ä»˜æ¨¡å—</h1><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p><img src="/img/springcloud/1.assets/1684896365942-47c2366c-a952-4478-8349-9b28ad4af6d6.png" alt="img"></p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ol><li>æ–°å»ºæ¨¡å—</li></ol><p><img src="/img/springcloud/1.assets/1684896461453-4aa6a74a-0755-451c-bf26-45e5a98d6874.png" alt="img"></p><ol><li>è¿™æ˜¯å·¥ä»¶ id</li></ol><p><img src="/img/springcloud/1.assets/1684896572946-904697e3-35e7-4e4e-9e2c-9df1168e5809.png" alt="img"></p><h3 id="æ”¹-pom"><a href="#æ”¹-pom" class="headerlink" title="æ”¹ pom"></a>æ”¹ pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud2023<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cyt.springcloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-provider-payment8001<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŒ…å«äº†sleuth+zipkin--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--eureka-client--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--       &lt;dependency&gt;&lt;!â€“ å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity â€“&gt;</span></span><br><span class="line"><span class="comment">    &lt;groupId&gt;com.cyt.springcloud&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">    &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">    &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;</span></span><br><span class="line"><span class="comment">  &lt;/dependency&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql-connector-java--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®-yml"><a href="#é…ç½®-yml" class="headerlink" title="é…ç½® yml"></a>é…ç½® yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">cloud-payment-service</span></span><br><span class="line"><span class="attr">zipkin:</span></span><br><span class="line"><span class="attr">base-url:</span> <span class="string">http://localhost:9411</span></span><br><span class="line"><span class="attr">sleuth:</span></span><br><span class="line"><span class="attr">sampler:</span></span><br><span class="line"><span class="comment">#é‡‡æ ·ç‡å€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œ1 åˆ™è¡¨ç¤ºå…¨éƒ¨é‡‡é›†</span></span><br><span class="line"><span class="attr">probability:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span> <span class="comment"># å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span></span><br><span class="line"><span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span> <span class="comment"># mysqlé©±åŠ¨åŒ…</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">client:</span></span><br><span class="line"><span class="comment">#è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚</span></span><br><span class="line"><span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line"><span class="attr">fetchRegistry:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line"><span class="comment">#å•æœºç‰ˆ</span></span><br><span class="line"><span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br><span class="line"><span class="comment"># é›†ç¾¤ç‰ˆ</span></span><br><span class="line"><span class="comment">#defaultZone: http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span></span><br><span class="line"><span class="attr">instance:</span></span><br><span class="line"><span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br><span class="line"><span class="comment">#è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€</span></span><br><span class="line"><span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯30ç§’)</span></span><br><span class="line"><span class="comment">#lease-renewal-interval-in-seconds: 1</span></span><br><span class="line"><span class="comment">#EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºç§’(é»˜è®¤æ˜¯90ç§’)ï¼Œè¶…æ—¶å°†å‰”é™¤æœåŠ¡</span></span><br><span class="line"><span class="comment">#lease-expiration-duration-in-seconds: 2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="attr">mapperLocations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="attr">type-aliases-package:</span> <span class="string">com.atguigu.springcloud.entities</span> <span class="comment"># æ‰€æœ‰Entityåˆ«åç±»æ‰€åœ¨åŒ…</span></span><br></pre></td></tr></table></figure><h3 id="ä¸»å¯åŠ¨"><a href="#ä¸»å¯åŠ¨" class="headerlink" title="ä¸»å¯åŠ¨"></a>ä¸»å¯åŠ¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentMain8001</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            SpringApplication.run(PaymentMain8001.class, args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸šåŠ¡ç±»"><a href="#ä¸šåŠ¡ç±»" class="headerlink" title="ä¸šåŠ¡ç±»"></a>ä¸šåŠ¡ç±»</h3><p><img src="/img/springcloud/1.assets/1684897956430-d57107f8-19c2-41e1-9333-17a0572028fc.png" alt="img"></p><ol><li>sql</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table `payment`(</span><br><span class="line">`id` bigint(<span class="number">20</span>) not <span class="literal">null</span> auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">`serial` varchar(<span class="number">200</span>)DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">PRIMARY <span class="title function_">KEY</span> <span class="params">(`id`)</span></span><br><span class="line">)ENGINE=InnoDB AUTO_INCREMENT=<span class="number">1</span> DEFAULT CHARSET=utf8</span><br></pre></td></tr></table></figure><h3 id="1entities"><a href="#1entities" class="headerlink" title="1entities"></a>1entities</h3><ul><li>CommonResult</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">// å…¨å‚</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">// ç©ºå‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonResult</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CommonResult</span><span class="params">(Integer code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(code, message, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Payment</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">// å…¨å‚</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">// ç©ºå‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Payment</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String serial;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2dao"><a href="#2dao" class="headerlink" title="2dao"></a>2dao</h3><ul><li>PaymentDao</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3resources-mapper"><a href="#3resources-mapper" class="headerlink" title="3resources.mapper"></a>3resources.mapper</h3><ul><li>PaymentMapper.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.cyt.springcloud.dao.PaymentDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;create&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Payment&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    insert into payment(serial)</span><br><span class="line">    values (#&#123;serial&#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.cyt.springcloud.entities.Payment&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- columnå¯¹åº”æ•°æ®åº“  propertyå¯¹åº”entitiesç±»  jdbcTypeå¯¹åº”æ•°æ®åº“æ•°æ®ç±»å‹--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">property</span>=<span class="string">&quot;serial&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getPaymentById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Long&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from payment</span><br><span class="line">    where id = #&#123;id&#125;;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4service"><a href="#4service" class="headerlink" title="4service"></a>4service</h3><ul><li>æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®ç°æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentDao paymentDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentDao.create(payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Payment <span class="title function_">getPaymentById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> paymentDao.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="çƒ­éƒ¨ç½²-Devtools"><a href="#çƒ­éƒ¨ç½²-Devtools" class="headerlink" title="çƒ­éƒ¨ç½² Devtools"></a>çƒ­éƒ¨ç½² Devtools</h1><ol><li>æ·»åŠ æ’ä»¶ å­é¡¹ç›®</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>çˆ¶ç±»æ€» pom</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;finalName&gt;$&#123;project.artifactId&#125;&lt;/finalName&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">2.3</span><span class="number">.5</span>.RELEASE&lt;/version&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;fork&gt;<span class="literal">true</span>&lt;/fork&gt;</span><br><span class="line">                &lt;addResources&gt;<span class="literal">true</span>&lt;/addResources&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>å…¨éƒ¨é€‰å‹¾</li></ol><p><img src="/img/springcloud/1.assets/1684933328127-ac00366d-d762-49b5-9271-a9bb2b4460a4.png" alt="img"></p><ol start="4"><li>å¼€å¯</li></ol><p><img src="/img/springcloud/1.assets/image-20230731230537698.png" alt="image-20230731230537698"></p><h1 id="æ¶ˆè´¹è€…æ¨¡å—"><a href="#æ¶ˆè´¹è€…æ¨¡å—" class="headerlink" title="æ¶ˆè´¹è€…æ¨¡å—"></a>æ¶ˆè´¹è€…æ¨¡å—</h1><p><img src="/img/springcloud/1.assets/1684934277864-e8681978-6f2a-4e2a-8ccb-858e0a8efa9e.png" alt="img"></p><h2 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h2><ul><li>config.ApplicationContextConfig</li><li>ä¸¤ä¸ªæ¨¡å—é€šä¿¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PAYMENT_URL</span> <span class="operator">=</span> <span class="string">&quot;http://loccalhost:8001&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">create</span><span class="params">(Payment payment)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="string">&quot;/payment/create&quot;</span>, payment, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title function_">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å·¥ç¨‹é‡æ„"><a href="#å·¥ç¨‹é‡æ„" class="headerlink" title="å·¥ç¨‹é‡æ„"></a>å·¥ç¨‹é‡æ„</h1><h2 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p><img src="/img/springcloud/1.assets/image-20230731233842434.png" alt="image-20230731233842434"></p><h3 id="clean-install"><a href="#clean-install" class="headerlink" title="clean install"></a>clean install</h3><p><img src="/img/springcloud/1.assets/image-20230731233943273.png" alt="image-20230731233943273"></p><h3 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h3><ul><li>åˆ é™¤ 80 æ¨¡å—çš„ entities æ–‡ä»¶å¤¹</li><li>80 æ¨¡å— pom å¯¼å…¥</li><li><pre><code class="language-xml">&lt;dependency&gt;&lt;!-- å¼•å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä»¥ä½¿ç”¨Paymentæ”¯ä»˜Entity --&gt;    &lt;groupId&gt;com.cyt.springcloud&lt;/groupId&gt;    &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> springcloud </category>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springcloud </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
